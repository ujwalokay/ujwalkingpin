{"file_contents":{"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 3\nconst TOAST_REMOVE_DELAY = 5000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3892,"size_tokens":null},"client/src/hooks/useKeepAlive.ts":{"content":"import { useEffect, useRef } from \"react\";\n\nconst PING_INTERVAL = 10 * 60 * 1000;\n\nexport function useKeepAlive(hasActiveTimers: boolean) {\n  const intervalRef = useRef<NodeJS.Timeout | null>(null);\n\n  useEffect(() => {\n    if (hasActiveTimers) {\n      const pingServer = async () => {\n        try {\n          await fetch(\"/api/health\");\n          console.log(\"[Keep-Alive] Server pinged successfully\");\n        } catch (error) {\n          console.error(\"[Keep-Alive] Failed to ping server:\", error);\n        }\n      };\n\n      pingServer();\n\n      intervalRef.current = setInterval(pingServer, PING_INTERVAL);\n\n      console.log(\"[Keep-Alive] Started - pinging every 10 minutes\");\n    } else {\n      if (intervalRef.current) {\n        clearInterval(intervalRef.current);\n        intervalRef.current = null;\n        console.log(\"[Keep-Alive] Stopped - no active timers\");\n      }\n    }\n\n    return () => {\n      if (intervalRef.current) {\n        clearInterval(intervalRef.current);\n        intervalRef.current = null;\n      }\n    };\n  }, [hasActiveTimers]);\n}\n","path":null,"size_bytes":1060,"size_tokens":null},"replit.md":{"content":"# Airavoto Gaming Center POS Admin Panel\n\n## Overview\n\nThis project is a local, full-stack TypeScript web application designed as an admin panel for Airavoto Gaming Center's Point-of-Sale (POS) system. It manages gaming sessions across various device types (PC, PS5, VR, car simulators), handles walk-in and advance bookings, and provides comprehensive reporting, including an expense tracker. The application aims to streamline operations, manage inventory, track expenses, and improve customer service. It features a gaming-themed dark mode UI inspired by Discord and Steam. Key capabilities include dynamic device and pricing configuration, real-time session management (pause/resume, seat changes), a simplified customer loyalty program, tournament management, and a robust notification system.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n\n**Technology Stack:**\n- React 18+ with TypeScript\n- Vite for development and build\n- Wouter for client-side routing\n- TanStack React Query for server state management and caching\n\n**UI/UX Decisions:**\n- Radix UI primitives and shadcn/ui for accessible components.\n- Tailwind CSS with a custom, gaming-themed dark mode color palette (cyan/teal accents).\n- Theme toggle for light/dark mode persistence.\n- Gaming aesthetic with neon accents and status-based color coding.\n- **Card Design System**: All cards use a uniform `shape-diagonal-rounded` style for consistent aesthetics.\n- Fully Responsive Design: Accessible on mobile, tablet, and desktop.\n\n**State Management:**\n- React Query for server state caching.\n- Local component state with React hooks.\n\n### Backend Architecture\n\n**Server Framework:**\n- Express.js with TypeScript.\n- RESTful API design with JSON communication.\n\n**Database Layer:**\n- PostgreSQL via Neon serverless provider (Free tier: 512 MB).\n- Drizzle ORM for type-safe database interactions.\n- Schema-first approach with Zod validation.\n- **Data Retention Strategy:** ALL data kept permanently (100 years) - no automatic cleanup.\n  - Owner requirement: Preserve all business records for tax, analytics, and compliance.\n  - Current storage: ~103 MB/year at 70 customers/day.\n  - Free tier sufficient for 6-7 years with no cleanup.\n  - Future scaling option: 6 free Neon projects = 3 GB for 41+ years (see NEON_6_DATABASE_SETUP.md).\n\n**Data Models:**\n- `Bookings`: Manages active sessions, status, timing, and pricing. Includes unique booking codes (BK-XXXXX) and group codes (GRP-XXXXX) for tracking related sessions.\n- `Booking History`: Archives completed/expired bookings with preserved booking and group codes.\n- `Device Configs`: Stores dynamic device categories and seat configurations.\n- `Pricing Configs`: Defines pricing rules per category and duration.\n- `Food Items`: Stores available food and beverage options with inventory tracking.\n- `Settings`: General admin configurations.\n- `Expenses`: Tracks operational costs.\n- `Happy Hours Configs`: Defines time slots and pricing for special rates.\n- `Retention Config`: Stores data retention policy settings.\n- `Tournaments`: Stores tournament information.\n- `Tournament Participants`: Tracks participant registration.\n- `Notifications`: Stores system notifications.\n- `Customer Loyalty`: Tracks customer spending and points.\n- `Loyalty Rewards`: Catalog of redeemable rewards.\n- `Reward Redemptions`: History of customer reward redemptions.\n\n### Key Architectural Decisions\n\n**Monorepo Structure:**\n- Shared TypeScript schema definitions between client and server for full-stack type safety.\n\n**Real-time Features:**\n- Client-side interval timers for session countdowns.\n- Polling for updates.\n- Audio/visual notifications for expired sessions and toast messages using Web Audio API.\n\n**Styling Architecture:**\n- CSS custom properties for theme tokens.\n- Tailwind utility classes and `clsx`/`tailwind-merge` for styling.\n\n**Form Handling:**\n- React Hook Form for form state and validation.\n- Zod schemas for robust input validation.\n\n**Feature Specifications:**\n- **Dynamic Management**: Device category, pricing, food items, happy hours, and tournament management.\n- **Booking Flow**: Smart upcoming booking flow, pause/resume, seat change, manual adjustments (discounts, bonus hours).\n- **Expense Tracker**: Comprehensive system with export.\n- **Inventory Management**: Dual-page system for food item catalog and current stock, with automatic stock deduction and alerts.\n- **Public Status Board**: Customer-facing real-time availability display at `/status`.\n- **Data Retention Policies**: Automatic cleanup of old data with configurable retention periods.\n- **Analytics Chart Export**: Save as Image functionality for all analytics charts.\n- **Prediction System**: Custom calculation-based predictive maintenance and traffic forecasting using deterministic algorithms.\n- **Sound Alert System**: Comprehensive audio notification system for user feedback.\n- **Unsaved Changes Protection**: Confirmation dialogs for preventing accidental data loss in settings.\n- **Notification System**: Comprehensive notification center with real-time notifications for key events, bell icon, grouped notifications, and actions.\n- **Categorized Sidebar**: Reorganized navigation with categories and count badges.\n- **Enhanced Activity Logs**: Detailed logging across all operations with rich contextual information and consistent formatting.\n- **Simplified Loyalty & Rewards System**: Automatic point earning (1 point per ‚Çπ1 spent) and reward redemption, focusing on a simplified Rewards Catalog and Customer Management.\n- **Unified Payment Dialog**: Streamlined credit balance payment system supporting Cash, UPI/Online, and Split Payment with comprehensive validation and enhanced payment history.\n- **Running Session Bug Fix**: Ensures running/paused sessions remain on the Dashboard after credit payment, preventing premature archiving.\n- **Enhanced Credit Balances Display**: Credit Balances table now shows comprehensive booking details for better context.\n- **Booking & Group Code System**: Unique booking codes (BK-XXXXX) for each booking and group codes (GRP-XXXXX) for linking multiple related bookings (e.g., PC 1, 2, 3 for the same table/session). Codes persist through booking creation to history archival.\n- **Simplified User Authentication**: Users authenticate with username and password only (no email, firstName, lastName fields).\n\n## WebView2 Desktop Application (Windows Offline Mode)\n\nThe application can be packaged as a standalone Windows desktop executable using Microsoft WebView2 for offline use in gaming cafes.\n\n### Desktop App Architecture\n- **Frontend**: Built React app served from local files via WebView2\n- **Wrapper**: C# WinForms application with WebView2 control\n- **Runtime**: Microsoft Edge WebView2 (Chromium-based)\n- **Distribution**: Single .exe with bundled web app files\n\n### Key Files\n- `webview2-app/AiravotoGamingPOS.csproj` - .NET 8 project file\n- `webview2-app/Program.cs` - Application entry point\n- `webview2-app/MainForm.cs` - WebView2 window implementation\n- `webview2-app/build.bat` - Windows build script\n- `webview2-app/build-portable.bat` - Portable package builder\n- `WEBVIEW2_BUILD_GUIDE.md` - Comprehensive build instructions\n\n### Build Requirements (on Windows)\n- .NET 8 SDK\n- Windows 10 version 1803 or later\n\n### Build Commands (on Windows)\n```cmd\ncd webview2-app\nbuild.bat           # Build executable\nbuild-portable.bat  # Build portable package\n```\n\n### Distribution Options\n1. **Evergreen** (~50MB): Uses system WebView2 runtime\n2. **Fixed Version** (~200MB): Includes bundled runtime for fully offline use\n\n### Notes\n- WebView2 is Windows-only (no macOS/Linux support)\n- Build must be done on Windows machine with .NET SDK\n- See WEBVIEW2_BUILD_GUIDE.md for detailed instructions\n\n## External Dependencies\n\n### Database\n- **Neon PostgreSQL**: Serverless PostgreSQL database (web version).\n\n### UI Component Libraries\n- **Radix UI**: Accessible React primitives.\n- **shadcn/ui**: Component library built on Radix UI.\n- **Lucide React**: Icon library.\n\n### Development Tools\n- **Drizzle Kit**: Database migration and schema management.\n- **Vite**: Frontend build tool.\n- **TypeScript**: Language.\n\n### Validation & Schema\n- **Zod**: Runtime type validation.\n- **drizzle-zod**: Integration between Drizzle and Zod.\n\n### Utility Libraries\n- **date-fns**: Date manipulation.\n- **clsx & tailwind-merge**: Conditional CSS class composition.\n- **class-variance-authority**: Type-safe variant API for components.\n\n### Communication\n- **Twilio**: For WhatsApp bot integration.","path":null,"size_bytes":8628,"size_tokens":null},"server/ai-traffic.ts":{"content":"import { storage } from \"./storage\";\n\nlet cachedTrafficPrediction: { data: TrafficPredictionResult; timestamp: number; date: string } | null = null;\nconst CACHE_DURATION = 10 * 60 * 1000;\n\nexport interface HourlyTrafficPrediction {\n  hour: string;\n  predictedVisitors: number;\n  confidence: \"low\" | \"medium\" | \"high\";\n}\n\nexport interface TrafficPredictionResult {\n  predictions: HourlyTrafficPrediction[];\n  summary: {\n    peakHour: string;\n    peakVisitors: number;\n    totalPredictedVisitors: number;\n    averageVisitors: number;\n    insights: string[];\n  };\n  generatedAt: Date;\n}\n\nexport async function generateTrafficPredictions(): Promise<TrafficPredictionResult> {\n  const now = new Date();\n  const today = now.toISOString().split('T')[0];\n  \n  if (cachedTrafficPrediction && \n      cachedTrafficPrediction.date === today && \n      Date.now() - cachedTrafficPrediction.timestamp < CACHE_DURATION) {\n    return cachedTrafficPrediction.data;\n  }\n\n  const todayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0);\n  const todayEnd = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59);\n\n  const [allBookings, allHistoricalBookings] = await Promise.all([\n    storage.getAllBookings(),\n    storage.getAllBookingHistory()\n  ]);\n\n  const historicalData = [];\n  for (let daysAgo = 1; daysAgo <= 30; daysAgo++) {\n    const dayStart = new Date(now);\n    dayStart.setDate(now.getDate() - daysAgo);\n    dayStart.setHours(0, 0, 0, 0);\n    const dayEnd = new Date(dayStart);\n    dayEnd.setHours(23, 59, 59, 999);\n\n    const dayBookings = allHistoricalBookings.filter(b => {\n      const start = new Date(b.startTime);\n      return start >= dayStart && start <= dayEnd && b.bookingType === \"walk-in\";\n    });\n\n    const hourlyPattern = Array.from({ length: 24 }, (_, hour) => {\n      const hourStart = new Date(dayStart);\n      hourStart.setHours(hour);\n      const hourEnd = new Date(hourStart);\n      hourEnd.setHours(hour + 1);\n\n      const hourBookings = dayBookings.filter(b => {\n        const start = new Date(b.startTime);\n        return start >= hourStart && start < hourEnd;\n      });\n\n      return hourBookings.length;\n    });\n\n    historicalData.push({\n      date: dayStart.toISOString().split('T')[0],\n      dayOfWeek: dayStart.toLocaleDateString('en-US', { weekday: 'long' }),\n      hourlyPattern,\n      totalVisitors: dayBookings.length,\n    });\n  }\n\n  const todayDayOfWeek = now.toLocaleDateString('en-US', { weekday: 'long' });\n  const currentHour = now.getHours();\n\n  const todayActual = allBookings.filter(b => {\n    const start = new Date(b.startTime);\n    return start >= todayStart && start <= todayEnd && b.bookingType === \"walk-in\";\n  });\n\n  const todayHistorical = allHistoricalBookings.filter(b => {\n    const start = new Date(b.startTime);\n    return start >= todayStart && start <= todayEnd && b.bookingType === \"walk-in\";\n  });\n\n  const todayBookings = [...todayActual, ...todayHistorical];\n\n  const predictions = calculateTrafficPrediction(\n    historicalData,\n    todayDayOfWeek,\n    currentHour,\n    todayBookings\n  );\n\n  const peakPrediction = predictions.reduce((max, p) => \n    p.predictedVisitors > max.predictedVisitors ? p : max\n  , predictions[0] || { hour: \"12:00\", predictedVisitors: 0 });\n\n  const totalPredicted = predictions.reduce((sum, p) => sum + p.predictedVisitors, 0);\n  const avgVisitors = predictions.length > 0 ? Math.round(totalPredicted / predictions.length) : 0;\n\n  const insights: string[] = [];\n  const highConfidence = predictions.filter(p => p.confidence === \"high\").length;\n  const futureHours = predictions.filter(p => {\n    const [hour] = p.hour.split(':').map(Number);\n    return hour >= currentHour;\n  });\n\n  if (peakPrediction.predictedVisitors > 0) {\n    insights.push(`Peak traffic expected at ${peakPrediction.hour} with ${peakPrediction.predictedVisitors} visitors`);\n  }\n\n  if (futureHours.length > 0) {\n    const avgFuture = Math.round(futureHours.reduce((s, p) => s + p.predictedVisitors, 0) / futureHours.length);\n    insights.push(`Average ${avgFuture} visitors expected per hour for rest of the day`);\n  }\n\n  if (highConfidence > 0) {\n    insights.push(`${highConfidence} hours have high-confidence predictions based on historical patterns`);\n  }\n\n  const todaySoFar = todayBookings.filter(b => {\n    const start = new Date(b.startTime);\n    return start.getHours() < currentHour;\n  }).length;\n  \n  if (todaySoFar > 0 && historicalData.length > 0) {\n    const sameDayAvg = historicalData\n      .filter(d => d.dayOfWeek === todayDayOfWeek)\n      .reduce((sum, d) => sum + d.hourlyPattern.slice(0, currentHour).reduce((a, b) => a + b, 0), 0) / \n      Math.max(1, historicalData.filter(d => d.dayOfWeek === todayDayOfWeek).length);\n    \n    if (todaySoFar > sameDayAvg * 1.2) {\n      insights.push(`Today is busier than usual - ${Math.round((todaySoFar / sameDayAvg - 1) * 100)}% above average`);\n    } else if (todaySoFar < sameDayAvg * 0.8) {\n      insights.push(`Today is quieter than usual - ${Math.round((1 - todaySoFar / sameDayAvg) * 100)}% below average`);\n    }\n  }\n\n  const result = {\n    predictions,\n    summary: {\n      peakHour: peakPrediction.hour,\n      peakVisitors: peakPrediction.predictedVisitors,\n      totalPredictedVisitors: totalPredicted,\n      averageVisitors: avgVisitors,\n      insights,\n    },\n    generatedAt: new Date(),\n  };\n\n  cachedTrafficPrediction = { data: result, timestamp: Date.now(), date: today };\n\n  return result;\n}\n\nfunction calculateTrafficPrediction(\n  historicalData: any[],\n  todayDayOfWeek: string,\n  currentHour: number,\n  todayBookings: any[]\n): HourlyTrafficPrediction[] {\n  const predictions: HourlyTrafficPrediction[] = [];\n\n  const sameDayData = historicalData.filter(d => d.dayOfWeek === todayDayOfWeek);\n  const recentData = historicalData.slice(0, 7);\n  \n  const todayTrend = calculateTodayTrend(todayBookings, currentHour, sameDayData);\n  \n  for (let hour = 0; hour < 24; hour++) {\n    if (hour < currentHour) {\n      const actualCount = todayBookings.filter(b => {\n        const start = new Date(b.startTime);\n        return start.getHours() === hour;\n      }).length;\n\n      predictions.push({\n        hour: `${hour.toString().padStart(2, '0')}:00`,\n        predictedVisitors: actualCount,\n        confidence: \"high\",\n      });\n    } else {\n      let predictedVisitors = 0;\n      let confidence: \"low\" | \"medium\" | \"high\" = \"low\";\n\n      if (sameDayData.length >= 3) {\n        const weights = sameDayData.map((_, idx) => Math.pow(0.85, idx));\n        const totalWeight = weights.reduce((a, b) => a + b, 0);\n        \n        const weightedAvg = sameDayData.reduce((sum, d, idx) => {\n          return sum + (d.hourlyPattern[hour] * weights[idx]);\n        }, 0) / totalWeight;\n        \n        predictedVisitors = Math.round(weightedAvg * (1 + todayTrend));\n        confidence = sameDayData.length >= 4 ? \"high\" : \"medium\";\n      } else if (recentData.length > 0) {\n        const allDaysAvg = recentData.reduce((sum, d) => sum + d.hourlyPattern[hour], 0) / recentData.length;\n        predictedVisitors = Math.round(allDaysAvg * (1 + todayTrend * 0.5));\n        confidence = \"medium\";\n      } else if (historicalData.length > 0) {\n        const fallbackAvg = historicalData.reduce((sum, d) => sum + d.hourlyPattern[hour], 0) / historicalData.length;\n        predictedVisitors = Math.round(fallbackAvg);\n        confidence = \"low\";\n      }\n\n      const typicalPeakHours = [18, 19, 20, 21, 22];\n      if (typicalPeakHours.includes(hour) && predictedVisitors > 0) {\n        predictedVisitors = Math.round(predictedVisitors * 1.1);\n      }\n\n      const earlyMorningHours = [0, 1, 2, 3, 4, 5, 6, 7, 8];\n      if (earlyMorningHours.includes(hour) && predictedVisitors > 0) {\n        predictedVisitors = Math.round(predictedVisitors * 0.7);\n      }\n\n      predictions.push({\n        hour: `${hour.toString().padStart(2, '0')}:00`,\n        predictedVisitors: Math.max(0, predictedVisitors),\n        confidence,\n      });\n    }\n  }\n\n  return predictions;\n}\n\nfunction calculateTodayTrend(\n  todayBookings: any[],\n  currentHour: number,\n  sameDayData: any[]\n): number {\n  if (currentHour === 0 || sameDayData.length === 0) {\n    return 0;\n  }\n\n  const todaySoFar = Array.from({ length: currentHour }, (_, hour) => {\n    return todayBookings.filter(b => {\n      const start = new Date(b.startTime);\n      return start.getHours() === hour;\n    }).length;\n  });\n\n  const historicalAvgSoFar = Array.from({ length: currentHour }, (_, hour) => {\n    const avg = sameDayData.reduce((sum, d) => sum + d.hourlyPattern[hour], 0) / sameDayData.length;\n    return avg;\n  });\n\n  const todayTotal = todaySoFar.reduce((a, b) => a + b, 0);\n  const historicalTotal = historicalAvgSoFar.reduce((a, b) => a + b, 0);\n\n  if (historicalTotal === 0) return 0;\n\n  const trend = (todayTotal - historicalTotal) / historicalTotal;\n  \n  return Math.max(-0.5, Math.min(0.5, trend));\n}\n","path":null,"size_bytes":8909,"size_tokens":null},"server/scheduler.ts":{"content":"import { retentionService } from \"./retention\";\n\nexport class CleanupScheduler {\n  private intervalId: NodeJS.Timeout | null = null;\n  private isRunning: boolean = false;\n\n  start() {\n    if (this.isRunning) {\n      console.log('‚è∞ Cleanup scheduler is already running');\n      return;\n    }\n\n    console.log('‚è∞ Starting automatic data cleanup scheduler...');\n    console.log('üìÖ Cleanup will run daily at 2:00 AM');\n    \n    this.scheduleNextCleanup();\n    this.isRunning = true;\n  }\n\n  stop() {\n    if (this.intervalId) {\n      clearTimeout(this.intervalId);\n      this.intervalId = null;\n      this.isRunning = false;\n      console.log('‚è∞ Cleanup scheduler stopped');\n    }\n  }\n\n  private scheduleNextCleanup() {\n    const now = new Date();\n    const next2AM = new Date();\n    \n    next2AM.setHours(2, 0, 0, 0);\n    \n    if (now.getHours() >= 2) {\n      next2AM.setDate(next2AM.getDate() + 1);\n    }\n    \n    const msUntilNextRun = next2AM.getTime() - now.getTime();\n    \n    const istTime = next2AM.toLocaleString('en-IN', {\n      timeZone: 'Asia/Kolkata',\n      dateStyle: 'short',\n      timeStyle: 'medium'\n    });\n    console.log(`‚è∞ Next cleanup scheduled for: ${istTime} IST`);\n    \n    this.intervalId = setTimeout(async () => {\n      await this.runCleanup();\n      this.scheduleNextCleanup();\n    }, msUntilNextRun);\n  }\n\n  private async runCleanup() {\n    try {\n      console.log('\\n‚è∞ Running scheduled data cleanup...');\n      const result = await retentionService.runCleanup();\n      console.log(`‚úÖ Scheduled cleanup completed. Total records deleted: ${result.totalDeleted}`);\n    } catch (error) {\n      console.error('‚ùå Error during scheduled cleanup:', error);\n    }\n  }\n\n  async runNow(): Promise<void> {\n    console.log('üîß Running manual cleanup...');\n    await this.runCleanup();\n  }\n}\n\nexport const cleanupScheduler = new CleanupScheduler();\n","path":null,"size_bytes":1880,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"server/pdf-generator.ts":{"content":"import PDFDocument from 'pdfkit';\nimport { Response } from 'express';\n\nexport function generateApplicationPDF(res: Response) {\n  const doc = new PDFDocument({ \n    size: 'A4', \n    margins: { top: 50, bottom: 50, left: 50, right: 50 },\n    info: {\n      Title: 'Ankylo Gaming - Gaming Center POS System Documentation',\n      Author: 'Ankylo Gaming',\n      Subject: 'Complete Feature Documentation'\n    }\n  });\n\n  res.setHeader('Content-Type', 'application/pdf');\n  res.setHeader('Content-Disposition', 'attachment; filename=ankylo-gaming-features.pdf');\n  \n  doc.pipe(res);\n\n  // Title Page\n  doc.fontSize(28).font('Helvetica-Bold').text('ANKYLO GAMING', { align: 'center' });\n  doc.moveDown(0.5);\n  doc.fontSize(20).font('Helvetica').text('Gaming Center POS System', { align: 'center' });\n  doc.moveDown(0.5);\n  doc.fontSize(14).text('Complete Feature Documentation', { align: 'center' });\n  doc.moveDown(2);\n\n  // Introduction\n  doc.fontSize(18).font('Helvetica-Bold').text('Overview', { underline: true });\n  doc.moveDown(0.5);\n  doc.fontSize(11).font('Helvetica').text(\n    'Ankylo Gaming POS is a comprehensive local admin panel web application designed for managing gaming centers. ' +\n    'It provides real-time tracking of gaming sessions, handles bookings, manages inventory, tracks expenses, and ' +\n    'improves customer service in a gaming center environment.',\n    { align: 'justify' }\n  );\n  doc.moveDown(1);\n\n  // Technology Stack Section\n  doc.fontSize(18).font('Helvetica-Bold').text('Technology Stack', { underline: true });\n  doc.moveDown(0.5);\n  \n  doc.fontSize(12).font('Helvetica-Bold').text('Frontend:');\n  doc.fontSize(11).font('Helvetica');\n  doc.list([\n    'React 18+ with TypeScript',\n    'Vite for development and build',\n    'Wouter for client-side routing',\n    'TanStack React Query for server state management',\n    'Radix UI & shadcn/ui components',\n    'Tailwind CSS with gaming-themed dark mode',\n    'React Hook Form with Zod validation'\n  ], { bulletRadius: 2 });\n  doc.moveDown(0.5);\n\n  doc.fontSize(12).font('Helvetica-Bold').text('Backend:');\n  doc.fontSize(11).font('Helvetica');\n  doc.list([\n    'Express.js with TypeScript',\n    'PostgreSQL via Neon serverless',\n    'Drizzle ORM for type-safe database',\n    'RESTful API design',\n    'Bcrypt for password hashing',\n    'Express-session for authentication'\n  ], { bulletRadius: 2 });\n  doc.moveDown(1);\n\n  // Core Features Section\n  doc.addPage();\n  doc.fontSize(18).font('Helvetica-Bold').text('Core Features', { underline: true });\n  doc.moveDown(0.5);\n\n  // 1. Real-time Session Management\n  doc.fontSize(14).font('Helvetica-Bold').text('1. Real-time Session Management');\n  doc.fontSize(11).font('Helvetica');\n  doc.list([\n    'Live tracking of gaming sessions across multiple device types (PC, PS5, VR, car simulators)',\n    'Real-time countdown timers for active sessions',\n    'Visual and audio notifications for expired sessions',\n    'Dynamic seat availability display',\n    'Category-based device organization',\n    'Session pause and resume functionality',\n    'Automatic session status updates'\n  ], { bulletRadius: 2 });\n  doc.moveDown(0.8);\n\n  // 2. Booking Management\n  doc.fontSize(14).font('Helvetica-Bold').text('2. Booking Management');\n  doc.fontSize(11).font('Helvetica');\n  doc.list([\n    'Walk-in booking creation with instant seat allocation',\n    'Advance booking system with date/time selection',\n    'Smart conflict detection to prevent double bookings',\n    'Customer information management (name, WhatsApp number)',\n    'Booking extension during active sessions',\n    'Bulk booking operations (complete, delete multiple)',\n    'Session history archival for completed bookings',\n    'Filter and search capabilities'\n  ], { bulletRadius: 2 });\n  doc.moveDown(0.8);\n\n  // 3. Inventory & Food Management\n  doc.fontSize(14).font('Helvetica-Bold').text('3. Inventory & Food Management');\n  doc.fontSize(11).font('Helvetica');\n  doc.list([\n    'Food and beverage item catalog',\n    'Dynamic pricing configuration',\n    'Add food orders to active bookings',\n    'Order quantity and price tracking',\n    'Real-time order total calculation',\n    'Food revenue analytics',\n    'Item creation, editing, and deletion'\n  ], { bulletRadius: 2 });\n  doc.moveDown(0.8);\n\n  // 4. Financial Management\n  doc.fontSize(14).font('Helvetica-Bold').text('4. Financial Management');\n  doc.fontSize(11).font('Helvetica');\n  doc.list([\n    'Comprehensive expense tracking system',\n    'Multiple expense categories (Rent, Utilities, Maintenance, Food & Beverages, Marketing, Equipment, Staff, Miscellaneous)',\n    'Date-based expense recording',\n    'Expense filtering by category and date range',\n    'CSV export for accounting integration',\n    'PDF export for expense reports',\n    'Monthly and yearly expense summaries',\n    'Revenue tracking from bookings and food orders'\n  ], { bulletRadius: 2 });\n  doc.moveDown(1);\n\n  // Advanced Features\n  doc.addPage();\n  doc.fontSize(18).font('Helvetica-Bold').text('Advanced Features', { underline: true });\n  doc.moveDown(0.5);\n\n  // 5. Analytics & Reporting\n  doc.fontSize(14).font('Helvetica-Bold').text('5. Analytics & Reporting');\n  doc.fontSize(11).font('Helvetica');\n  doc.list([\n    'Real-time occupancy monitoring',\n    'Category-wise usage statistics',\n    'Hourly booking patterns and trends',\n    'Daily, weekly, and monthly revenue reports',\n    'Unique customer tracking',\n    'Average session duration analysis',\n    'Food order statistics',\n    'Capacity utilization metrics',\n    'Interactive charts and visualizations',\n    'Historical data comparison'\n  ], { bulletRadius: 2 });\n  doc.moveDown(0.8);\n\n  // 6. Loyalty Program\n  doc.fontSize(14).font('Helvetica-Bold').text('6. Loyalty Program');\n  doc.fontSize(11).font('Helvetica');\n  doc.list([\n    'Customer loyalty tier system (Bronze, Silver, Gold, Platinum)',\n    'Points accumulation based on spending',\n    'Automatic tier upgrades',\n    'Redemption history tracking',\n    'Visit count monitoring',\n    'Total spend tracking per member',\n    'WhatsApp-based member identification',\n    'Configurable points per currency ratio',\n    'Customizable tier thresholds',\n    'Member analytics and insights'\n  ], { bulletRadius: 2 });\n  doc.moveDown(0.8);\n\n  // 7. Device Configuration\n  doc.fontSize(14).font('Helvetica-Bold').text('7. Device Configuration & Pricing');\n  doc.fontSize(11).font('Helvetica');\n  doc.list([\n    'Dynamic device category management',\n    'Custom seat naming (e.g., \"PC-1\", \"PS5-Pro\", \"VR-1\")',\n    'Flexible pricing rules per category',\n    'Duration-based pricing (30 min, 1 hour, 2 hours, etc.)',\n    'Real-time seat availability updates',\n    'Category-wise capacity configuration',\n    'Pricing rule updates without downtime'\n  ], { bulletRadius: 2 });\n  doc.moveDown(1);\n\n  // Customer-Facing Features\n  doc.addPage();\n  doc.fontSize(18).font('Helvetica-Bold').text('Customer-Facing Features', { underline: true });\n  doc.moveDown(0.5);\n\n  // 8. Public Status Board\n  doc.fontSize(14).font('Helvetica-Bold').text('8. Public Status Board');\n  doc.fontSize(11).font('Helvetica');\n  doc.list([\n    'Real-time device availability display',\n    'No authentication required (accessible at /status)',\n    'Auto-refresh every 10 seconds',\n    'Visual indicators (available/occupied)',\n    'Category-wise seat counts',\n    'Large display format for customer screens',\n    'Gaming-themed interface'\n  ], { bulletRadius: 2 });\n  doc.moveDown(0.8);\n\n  // 9. WhatsApp Bot Integration\n  doc.fontSize(14).font('Helvetica-Bold').text('9. WhatsApp Bot Integration');\n  doc.fontSize(11).font('Helvetica');\n  doc.list([\n    'Automated device availability queries',\n    'Twilio WhatsApp API integration',\n    'Real-time availability responses',\n    'Customer inquiry handling',\n    'Webhook-based message processing',\n    '24/7 automated customer service'\n  ], { bulletRadius: 2 });\n  doc.moveDown(0.8);\n\n  // 10. Consumer Website\n  doc.fontSize(14).font('Helvetica-Bold').text('10. Consumer Website Pages');\n  doc.fontSize(11).font('Helvetica');\n  doc.list([\n    'Home page with gaming center information',\n    'Photo gallery showcase',\n    'Facilities and amenities display',\n    'Available games catalog',\n    'Contact information and hours',\n    'Gaming-themed UI design'\n  ], { bulletRadius: 2 });\n  doc.moveDown(1);\n\n  // Security & Access Control\n  doc.addPage();\n  doc.fontSize(18).font('Helvetica-Bold').text('Security & Access Control', { underline: true });\n  doc.moveDown(0.5);\n\n  // 11. Authentication & Authorization\n  doc.fontSize(14).font('Helvetica-Bold').text('11. Authentication & Authorization');\n  doc.fontSize(11).font('Helvetica');\n  doc.list([\n    'Secure user authentication system',\n    'Role-based access control (Admin and Staff roles)',\n    'Bcrypt password hashing',\n    'Session-based authentication',\n    'Password strength validation',\n    'Username uniqueness enforcement',\n    'Secure login/logout functionality'\n  ], { bulletRadius: 2 });\n  doc.moveDown(0.8);\n\n  // 12. Device-Based Access Control\n  doc.fontSize(14).font('Helvetica-Bold').text('12. Device-Based Access Control');\n  doc.fontSize(11).font('Helvetica');\n  doc.list([\n    'PC/Desktop: Full access with all editing capabilities',\n    'Mobile/Tablet (< 1024px): View-only mode for security',\n    'Automatic device detection',\n    'Visual alerts for restricted access',\n    'Prevents accidental changes from mobile devices',\n    'Optimized UX for different screen sizes'\n  ], { bulletRadius: 2 });\n  doc.moveDown(0.8);\n\n  // 13. Security Features\n  doc.fontSize(14).font('Helvetica-Bold').text('13. Security Features');\n  doc.fontSize(11).font('Helvetica');\n  doc.list([\n    'Rate limiting on public APIs',\n    'Helmet.js security headers',\n    'CORS configuration',\n    'SQL injection prevention via ORM',\n    'XSS protection',\n    'Secure session storage',\n    'Environment variable protection for secrets'\n  ], { bulletRadius: 2 });\n  doc.moveDown(1);\n\n  // Admin Management\n  doc.addPage();\n  doc.fontSize(18).font('Helvetica-Bold').text('Administrative Features', { underline: true });\n  doc.moveDown(0.5);\n\n  // 14. User Management\n  doc.fontSize(14).font('Helvetica-Bold').text('14. User Management');\n  doc.fontSize(11).font('Helvetica');\n  doc.list([\n    'Admin user creation and management',\n    'Staff user creation and management',\n    'Role assignment (Admin/Staff)',\n    'User activity logging',\n    'Login history tracking'\n  ], { bulletRadius: 2 });\n  doc.moveDown(0.8);\n\n  // 15. Activity Logging\n  doc.fontSize(14).font('Helvetica-Bold').text('15. Activity Logging & Audit Trail');\n  doc.fontSize(11).font('Helvetica');\n  doc.list([\n    'Comprehensive activity logging system',\n    'User action tracking (create, update, delete, login)',\n    'Entity-specific logging (bookings, food items, configs)',\n    'Timestamp recording for all activities',\n    'User role and username tracking',\n    'Audit trail for accountability'\n  ], { bulletRadius: 2 });\n  doc.moveDown(0.8);\n\n  // 16. Game Updates Management\n  doc.fontSize(14).font('Helvetica-Bold').text('16. Game Updates Management');\n  doc.fontSize(11).font('Helvetica');\n  doc.list([\n    'Track latest game updates and patches',\n    'Event announcements',\n    'News and updates display',\n    'Image and description support',\n    'Source and URL tracking',\n    'Publication date management',\n    'Update type categorization'\n  ], { bulletRadius: 2 });\n  doc.moveDown(1);\n\n  // User Interface\n  doc.addPage();\n  doc.fontSize(18).font('Helvetica-Bold').text('User Interface & Experience', { underline: true });\n  doc.moveDown(0.5);\n\n  // 17. UI/UX Features\n  doc.fontSize(14).font('Helvetica-Bold').text('17. UI/UX Features');\n  doc.fontSize(11).font('Helvetica');\n  doc.list([\n    'Gaming-themed dark mode with cyan/teal accents',\n    'Light/dark theme toggle with persistence',\n    'Responsive design for all screen sizes',\n    'Accessible components via Radix UI',\n    'Smooth animations and transitions',\n    'Toast notifications for user feedback',\n    'Loading states and skeleton screens',\n    'Intuitive navigation with sidebar',\n    'Status-based color coding (running, paused, expired)',\n    'Icon-based visual cues (Lucide icons)'\n  ], { bulletRadius: 2 });\n  doc.moveDown(0.8);\n\n  // 18. Data Visualization\n  doc.fontSize(14).font('Helvetica-Bold').text('18. Data Visualization');\n  doc.fontSize(11).font('Helvetica');\n  doc.list([\n    'Real-time charts and graphs (Recharts)',\n    'Occupancy rate visualizations',\n    'Revenue trend analysis',\n    'Category usage breakdown',\n    'Hourly booking patterns',\n    'Interactive data exploration',\n    'Export capabilities (CSV, PDF)'\n  ], { bulletRadius: 2 });\n  doc.moveDown(1);\n\n  // Database Schema\n  doc.addPage();\n  doc.fontSize(18).font('Helvetica-Bold').text('Database Schema', { underline: true });\n  doc.moveDown(0.5);\n\n  doc.fontSize(11).font('Helvetica').text(\n    'The application uses PostgreSQL with the following main entities:',\n    { align: 'justify' }\n  );\n  doc.moveDown(0.5);\n\n  const tables = [\n    { name: 'Bookings', desc: 'Active gaming sessions with status, timing, pricing, and food orders' },\n    { name: 'Booking History', desc: 'Archived bookings for historical analysis' },\n    { name: 'Users', desc: 'Admin and staff user accounts with role-based access' },\n    { name: 'Device Configs', desc: 'Dynamic device categories and seat configurations' },\n    { name: 'Pricing Configs', desc: 'Pricing rules per category and duration' },\n    { name: 'Food Items', desc: 'Available food and beverage catalog' },\n    { name: 'Expenses', desc: 'Operational cost tracking by category' },\n    { name: 'Activity Logs', desc: 'User action audit trail' },\n    { name: 'Loyalty Members', desc: 'Customer loyalty program participants' },\n    { name: 'Loyalty Events', desc: 'Points and tier change history' },\n    { name: 'Loyalty Config', desc: 'Loyalty program settings and thresholds' },\n    { name: 'Game Updates', desc: 'Latest game news and updates' },\n    { name: 'Gaming Center Info', desc: 'Center details and contact information' },\n    { name: 'Gallery Images', desc: 'Photo gallery for consumer website' },\n    { name: 'Facilities', desc: 'Amenities and facilities information' },\n    { name: 'Games', desc: 'Available games catalog' }\n  ];\n\n  tables.forEach(table => {\n    doc.fontSize(11).font('Helvetica-Bold').text(`‚Ä¢ ${table.name}: `, { continued: true });\n    doc.font('Helvetica').text(table.desc);\n  });\n  doc.moveDown(1);\n\n  // API Endpoints\n  doc.addPage();\n  doc.fontSize(18).font('Helvetica-Bold').text('API Endpoints Overview', { underline: true });\n  doc.moveDown(0.5);\n\n  const apiSections = [\n    {\n      title: 'Authentication',\n      endpoints: ['POST /api/auth/login', 'POST /api/auth/logout', 'GET /api/auth/me']\n    },\n    {\n      title: 'Bookings',\n      endpoints: ['GET /api/bookings', 'POST /api/bookings', 'PATCH /api/bookings/:id', \n                 'DELETE /api/bookings/:id', 'GET /api/bookings/available-seats',\n                 'POST /api/bookings/archive']\n    },\n    {\n      title: 'Analytics',\n      endpoints: ['GET /api/analytics/usage', 'GET /api/reports/stats', 'GET /api/reports/history']\n    },\n    {\n      title: 'Configuration',\n      endpoints: ['GET /api/device-config', 'POST /api/device-config', 'DELETE /api/device-config/:category',\n                 'GET /api/pricing-config', 'POST /api/pricing-config']\n    },\n    {\n      title: 'Food & Inventory',\n      endpoints: ['GET /api/food-items', 'POST /api/food-items', 'PATCH /api/food-items/:id',\n                 'DELETE /api/food-items/:id']\n    },\n    {\n      title: 'Expenses',\n      endpoints: ['GET /api/expenses', 'POST /api/expenses', 'PATCH /api/expenses/:id',\n                 'DELETE /api/expenses/:id']\n    },\n    {\n      title: 'Loyalty Program',\n      endpoints: ['GET /api/loyalty/members', 'POST /api/loyalty/members', \n                 'GET /api/loyalty/config', 'POST /api/loyalty/config']\n    },\n    {\n      title: 'Public APIs',\n      endpoints: ['GET /api/public/status', 'GET /api/whatsapp/availability', \n                 'POST /api/whatsapp/webhook']\n    }\n  ];\n\n  apiSections.forEach(section => {\n    doc.fontSize(12).font('Helvetica-Bold').text(`${section.title}:`);\n    doc.fontSize(10).font('Helvetica');\n    section.endpoints.forEach(endpoint => {\n      doc.text(`  ‚Ä¢ ${endpoint}`);\n    });\n    doc.moveDown(0.5);\n  });\n  doc.moveDown(1);\n\n  // Deployment & Setup\n  doc.addPage();\n  doc.fontSize(18).font('Helvetica-Bold').text('Deployment & Setup', { underline: true });\n  doc.moveDown(0.5);\n\n  doc.fontSize(12).font('Helvetica-Bold').text('Environment Requirements:');\n  doc.fontSize(11).font('Helvetica');\n  doc.list([\n    'Node.js 20+',\n    'PostgreSQL database (via Replit/Neon)',\n    'Environment variables: ADMIN_USERNAME, ADMIN_PASSWORD, DATABASE_URL'\n  ], { bulletRadius: 2 });\n  doc.moveDown(0.5);\n\n  doc.fontSize(12).font('Helvetica-Bold').text('Running the Application:');\n  doc.fontSize(11).font('Helvetica');\n  doc.list([\n    'Development: npm run dev (runs on port 5000)',\n    'Build: npm run build',\n    'Production: npm run start',\n    'Database Push: npm run db:push'\n  ], { bulletRadius: 2 });\n  doc.moveDown(1);\n\n  // Benefits Section\n  doc.fontSize(18).font('Helvetica-Bold').text('Key Benefits', { underline: true });\n  doc.moveDown(0.5);\n\n  doc.fontSize(11).font('Helvetica');\n  doc.list([\n    'Streamlined Operations: Centralized management of all gaming center activities',\n    'Real-time Monitoring: Live tracking of sessions and availability',\n    'Financial Control: Comprehensive expense and revenue tracking',\n    'Customer Satisfaction: Automated WhatsApp bot and public status board',\n    'Data-Driven Decisions: Analytics and reporting for business insights',\n    'Scalability: Flexible device and pricing configuration',\n    'Security: Role-based access and device-based restrictions',\n    'Loyalty Building: Integrated customer loyalty program',\n    'Professional Interface: Modern, gaming-themed UI/UX',\n    'Type Safety: Full-stack TypeScript for reliable code'\n  ], { bulletRadius: 2 });\n  doc.moveDown(1);\n\n  // Conclusion\n  doc.fontSize(18).font('Helvetica-Bold').text('Conclusion', { underline: true });\n  doc.moveDown(0.5);\n  doc.fontSize(11).font('Helvetica').text(\n    'Ankylo Gaming POS is a comprehensive, modern solution for gaming center management. ' +\n    'Built with cutting-edge technologies and following best practices, it provides all the tools ' +\n    'necessary to run a successful gaming center efficiently. From real-time session tracking to ' +\n    'financial management, customer loyalty programs, and automated customer service, this application ' +\n    'covers every aspect of gaming center operations.',\n    { align: 'justify' }\n  );\n  doc.moveDown(0.5);\n  doc.text(\n    'The application is designed to be user-friendly for staff while providing powerful administrative ' +\n    'capabilities for management. With its responsive design, security features, and extensive analytics, ' +\n    'Ankylo Gaming POS empowers gaming center owners to make data-driven decisions and provide ' +\n    'exceptional customer experiences.',\n    { align: 'justify' }\n  );\n\n  // Footer\n  doc.moveDown(2);\n  doc.fontSize(10).font('Helvetica').fillColor('gray').text(\n    'Generated on: ' + new Date().toLocaleDateString('en-US', { \n      year: 'numeric', \n      month: 'long', \n      day: 'numeric' \n    }),\n    { align: 'center' }\n  );\n\n  doc.end();\n}\n","path":null,"size_bytes":19499,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"server/notifications.ts":{"content":"import { storage } from \"./storage\";\nimport type { InsertNotification } from \"@shared/schema\";\n\nexport async function notifyBookingCreated(bookingId: string, seatName: string, customerName: string) {\n  try {\n    await storage.createNotification({\n      type: \"booking\",\n      title: \"New Booking Created\",\n      message: `${customerName} has booked ${seatName}`,\n      entityType: \"booking\",\n      entityId: bookingId,\n      isRead: 0,\n    });\n  } catch (error) {\n    console.error(\"Failed to create booking notification:\", error);\n  }\n}\n\nexport async function notifyActivityLog(activityLogId: string, username: string, action: string, entityType?: string) {\n  try {\n    const actionMessages: Record<string, string> = {\n      create: \"created\",\n      update: \"updated\",\n      delete: \"deleted\",\n      login: \"logged in\",\n    };\n\n    const actionMessage = actionMessages[action] || action;\n    const message = entityType \n      ? `${username} ${actionMessage} a ${entityType}` \n      : `${username} ${actionMessage}`;\n\n    await storage.createNotification({\n      type: \"activity\",\n      title: \"Activity Logged\",\n      message,\n      entityType: \"activity_log\",\n      entityId: activityLogId,\n      activityLogId,\n      isRead: 0,\n    });\n  } catch (error) {\n    console.error(\"Failed to create activity log notification:\", error);\n  }\n}\n\nexport async function notifyLowInventory(foodItemId: string, foodName: string, currentStock: number, minStockLevel: number) {\n  try {\n    await storage.createNotification({\n      type: \"inventory\",\n      title: \"Low Inventory Alert\",\n      message: `${foodName} is running low (${currentStock}/${minStockLevel} units remaining)`,\n      entityType: \"food_item\",\n      entityId: foodItemId,\n      isRead: 0,\n    });\n  } catch (error) {\n    console.error(\"Failed to create inventory notification:\", error);\n  }\n}\n\nexport async function notifyExpenseAdded(expenseId: string, category: string, amount: string) {\n  try {\n    await storage.createNotification({\n      type: \"expense\",\n      title: \"New Expense Added\",\n      message: `${category} expense of ‚Çπ${amount} has been recorded`,\n      entityType: \"expense\",\n      entityId: expenseId,\n      isRead: 0,\n    });\n  } catch (error) {\n    console.error(\"Failed to create expense notification:\", error);\n  }\n}\n\nexport async function notifyPaymentReceived(bookingId: string, seatName: string, amount: string, paymentMethod: string) {\n  try {\n    await storage.createNotification({\n      type: \"payment\",\n      title: \"Payment Received\",\n      message: `Payment of ‚Çπ${amount} received for ${seatName} via ${paymentMethod}`,\n      entityType: \"booking\",\n      entityId: bookingId,\n      isRead: 0,\n    });\n  } catch (error) {\n    console.error(\"Failed to create payment notification:\", error);\n  }\n}\n\nexport async function notifySessionEnding(bookingId: string, seatName: string, customerName: string, minutesRemaining: number) {\n  try {\n    await storage.createNotification({\n      type: \"alert\",\n      title: \"Session Ending Soon\",\n      message: `${customerName}'s session on ${seatName} ends in ${minutesRemaining} minutes`,\n      entityType: \"booking\",\n      entityId: bookingId,\n      isRead: 0,\n    });\n  } catch (error) {\n    console.error(\"Failed to create session ending notification:\", error);\n  }\n}\n\nexport async function notifySessionExpired(bookingId: string, seatName: string, customerName: string) {\n  try {\n    await storage.createNotification({\n      type: \"alert\",\n      title: \"‚è∞ Session Timer Expired\",\n      message: `${customerName}'s session on ${seatName} has ended - timer expired`,\n      entityType: \"booking\",\n      entityId: bookingId,\n      isRead: 0,\n    });\n  } catch (error) {\n    console.error(\"Failed to create session expired notification:\", error);\n  }\n}\n\nexport async function notifySessionCompleted(bookingId: string, seatName: string, customerName: string) {\n  try {\n    await storage.createNotification({\n      type: \"alert\",\n      title: \"‚úÖ Session Completed\",\n      message: `${customerName}'s session on ${seatName} has been completed`,\n      entityType: \"booking\",\n      entityId: bookingId,\n      isRead: 0,\n    });\n  } catch (error) {\n    console.error(\"Failed to create session completed notification:\", error);\n  }\n}\n\nexport async function notifyCustomNotification(notification: Omit<InsertNotification, \"isRead\">) {\n  try {\n    await storage.createNotification({\n      ...notification,\n      isRead: 0,\n    });\n  } catch (error) {\n    console.error(\"Failed to create custom notification:\", error);\n  }\n}\n","path":null,"size_bytes":4544,"size_tokens":null},"client/src/pages/Inventory.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Package, Plus, Trash2, Minus, AlertTriangle, TrendingUp, Calendar } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport type { FoodItem } from \"@shared/schema\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\n\ninterface StockFormData {\n  quantity: string;\n  costPrice: string;\n  supplier: string;\n  expiryDate: string;\n  notes: string;\n}\n\nconst initialStockFormData: StockFormData = {\n  quantity: \"\",\n  costPrice: \"\",\n  supplier: \"\",\n  expiryDate: \"\",\n  notes: \"\",\n};\n\nexport default function Inventory() {\n  const { toast } = useToast();\n  const { canMakeChanges } = useAuth();\n  const [addDialog, setAddDialog] = useState(false);\n  const [deleteDialog, setDeleteDialog] = useState<{ open: boolean; item: FoodItem | null }>({\n    open: false,\n    item: null,\n  });\n  const [stockDialog, setStockDialog] = useState<{\n    open: boolean;\n    item: FoodItem | null;\n    type: 'add' | 'remove';\n  }>({\n    open: false,\n    item: null,\n    type: 'add',\n  });\n  const [stockFormData, setStockFormData] = useState<StockFormData>(initialStockFormData);\n  const [categoryFilter, setCategoryFilter] = useState<string>(\"all\");\n\n  const { data: allFoodItems = [], isLoading: loadingAll } = useQuery<FoodItem[]>({\n    queryKey: [\"/api/food-items\"],\n  });\n\n  const { data: inventoryItems = [], isLoading: loadingInventory } = useQuery<FoodItem[]>({\n    queryKey: [\"/api/food-items/inventory\"],\n  });\n\n  const { data: expiringItems = [] } = useQuery<FoodItem[]>({\n    queryKey: [\"/api/food-items/expiring\"],\n  });\n\n  const availableItems = allFoodItems.filter(item => item.inInventory === 0);\n\n  const addToInventoryMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return await apiRequest(\"POST\", `/api/food-items/${id}/add-to-inventory`);\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/food-items\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/food-items/inventory\"] });\n      toast({ \n        title: \"Added to Inventory\", \n        description: `${data.name} has been added to inventory` \n      });\n    },\n    onError: () => {\n      toast({ \n        title: \"Error\", \n        description: \"Failed to add item to inventory\", \n        variant: \"destructive\" \n      });\n    },\n  });\n\n  const removeFromInventoryMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return await apiRequest(\"POST\", `/api/food-items/${id}/remove-from-inventory`);\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/food-items\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/food-items/inventory\"] });\n      toast({ \n        title: \"Removed from Inventory\", \n        description: `${data.name} has been removed from inventory` \n      });\n      setDeleteDialog({ open: false, item: null });\n    },\n    onError: () => {\n      toast({ \n        title: \"Error\", \n        description: \"Failed to remove item from inventory\", \n        variant: \"destructive\" \n      });\n    },\n  });\n\n  const adjustStockMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: StockFormData & { type: 'add' | 'remove' } }) => {\n      const payload = {\n        quantity: parseInt(data.quantity),\n        type: data.type,\n        costPrice: data.costPrice || undefined,\n        supplier: data.supplier || undefined,\n        expiryDate: data.expiryDate || undefined,\n        notes: data.notes || undefined,\n      };\n      return await apiRequest(\"POST\", `/api/food-items/${id}/adjust-stock`, payload);\n    },\n    onSuccess: (data, variables) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/food-items\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/food-items/inventory\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/food-items/expiring\"] });\n      toast({ \n        title: \"Stock Updated\", \n        description: `${variables.data.type === 'add' ? 'Added' : 'Removed'} ${variables.data.quantity} units` \n      });\n      setStockDialog({ open: false, item: null, type: 'add' });\n      setStockFormData(initialStockFormData);\n    },\n    onError: () => {\n      toast({ \n        title: \"Error\", \n        description: \"Failed to update stock\", \n        variant: \"destructive\" \n      });\n    },\n  });\n\n  const openDeleteDialog = (item: FoodItem) => {\n    setDeleteDialog({ open: true, item });\n  };\n\n  const openStockDialog = (item: FoodItem, type: 'add' | 'remove') => {\n    setStockDialog({ open: true, item, type });\n    setStockFormData({\n      ...initialStockFormData,\n      costPrice: item.costPrice || \"\",\n      supplier: item.supplier || \"\",\n    });\n  };\n\n  const handleRemoveFromInventory = () => {\n    if (!deleteDialog.item) return;\n    removeFromInventoryMutation.mutate(deleteDialog.item.id);\n  };\n\n  const handleAdjustStock = () => {\n    if (!stockDialog.item || !stockFormData.quantity) {\n      toast({\n        title: \"Invalid Quantity\",\n        description: \"Please enter a valid positive number\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n    const quantity = parseInt(stockFormData.quantity);\n    if (isNaN(quantity) || quantity <= 0) {\n      toast({\n        title: \"Invalid Quantity\",\n        description: \"Please enter a valid positive number\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n    adjustStockMutation.mutate({\n      id: stockDialog.item.id,\n      data: { ...stockFormData, type: stockDialog.type }\n    });\n  };\n\n  const filteredItems = categoryFilter === \"all\" \n    ? inventoryItems \n    : inventoryItems.filter(item => item.category === categoryFilter);\n\n  const lowStockItems = filteredItems.filter(item => item.currentStock < item.minStockLevel);\n  const trackableLowStock = inventoryItems.filter(item => item.category === 'trackable' && item.currentStock < item.minStockLevel);\n\n  const calculateProfit = (item: FoodItem) => {\n    if (!item.costPrice) return null;\n    const profit = parseFloat(item.price) - parseFloat(item.costPrice);\n    const margin = (profit / parseFloat(item.price)) * 100;\n    return { profit, margin };\n  };\n\n  const isExpiringSoon = (item: FoodItem) => {\n    if (!item.expiryDate) return false;\n    const expiryDate = new Date(item.expiryDate);\n    const today = new Date();\n    const daysUntilExpiry = Math.ceil((expiryDate.getTime() - today.getTime()) / (1000 * 60 * 60 * 24));\n    return daysUntilExpiry <= 7 && daysUntilExpiry >= 0;\n  };\n\n  if (loadingAll || loadingInventory) {\n    return (\n      <div className=\"space-y-6\">\n        <h1 className=\"text-3xl font-bold text-foreground\">Inventory</h1>\n        <p className=\"text-muted-foreground\">Loading inventory...</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4 md:space-y-6\">\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl sm:text-3xl font-bold text-foreground\">Inventory</h1>\n          <p className=\"text-sm sm:text-base text-muted-foreground\">Manage your food inventory stock levels</p>\n        </div>\n        <Button \n          onClick={() => setAddDialog(true)}\n          disabled={!canMakeChanges}\n          data-testid=\"button-add-from-food\"\n          data-joyride=\"add-to-inventory-button\"\n        >\n          <Plus className=\"h-4 w-4 mr-2\" />\n          Add from Food\n        </Button>\n      </div>\n\n      {lowStockItems.length > 0 && (\n        <Alert variant=\"destructive\" data-testid=\"alert-low-stock\" data-joyride=\"low-stock-alert\">\n          <AlertTriangle className=\"h-4 w-4\" />\n          <AlertDescription>\n            <strong>Low Stock Warning:</strong> {lowStockItems.length} item{lowStockItems.length > 1 ? 's' : ''} below minimum quantity - {lowStockItems.map(item => item.name).join(', ')}\n          </AlertDescription>\n        </Alert>\n      )}\n\n      {expiringItems.length > 0 && (\n        <Alert className=\"border-orange-500 bg-orange-500/10\" data-testid=\"alert-expiring\">\n          <Calendar className=\"h-4 w-4 text-orange-600 dark:text-orange-400\" />\n          <AlertDescription className=\"text-orange-600 dark:text-orange-400\">\n            <strong>Expiring Soon:</strong> {expiringItems.length} item{expiringItems.length > 1 ? 's' : ''} expiring within 7 days - {expiringItems.map(item => item.name).join(', ')}\n          </AlertDescription>\n        </Alert>\n      )}\n\n      <Tabs value={categoryFilter} onValueChange={setCategoryFilter} data-joyride=\"inventory-tabs\">\n        <TabsList>\n          <TabsTrigger value=\"all\">All Items</TabsTrigger>\n          <TabsTrigger value=\"trackable\">Trackable Only</TabsTrigger>\n          <TabsTrigger value=\"made-to-order\">Made to Order</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value={categoryFilter} className=\"mt-4\" data-joyride=\"inventory-table\">\n          {filteredItems.length === 0 ? (\n            <Card>\n              <CardContent className=\"flex flex-col items-center justify-center py-12\">\n                <Package className=\"h-16 w-16 text-muted-foreground mb-4\" />\n                <h3 className=\"text-xl font-semibold mb-2\">No items in this category</h3>\n                <p className=\"text-muted-foreground text-center mb-4\">\n                  Add items from the Food page to start building your inventory\n                </p>\n                <Button onClick={() => setAddDialog(true)} disabled={!canMakeChanges} data-testid=\"button-add-first-item\">\n                  <Plus className=\"mr-2 h-4 w-4\" />\n                  Add Items\n                </Button>\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"rounded-md border\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead className=\"w-[250px]\">Food Name</TableHead>\n                    <TableHead className=\"w-[120px]\">Category</TableHead>\n                    <TableHead className=\"w-[120px]\">Min Qty</TableHead>\n                    <TableHead className=\"w-[120px]\">Available</TableHead>\n                    <TableHead className=\"w-[150px]\">Profit/Margin</TableHead>\n                    <TableHead className=\"w-[100px]\">Status</TableHead>\n                    <TableHead className=\"text-right\">Actions</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {filteredItems.map((item) => {\n                    const isLowStock = item.currentStock < item.minStockLevel;\n                    const profitData = calculateProfit(item);\n                    const expiringSoon = isExpiringSoon(item);\n                    \n                    return (\n                      <TableRow key={item.id} data-testid={`row-inventory-${item.id}`}>\n                        <TableCell className=\"font-medium\" data-testid={`text-food-name-${item.id}`}>\n                          {item.name}\n                          <div className=\"text-sm text-muted-foreground\">‚Çπ{item.price}</div>\n                          {expiringSoon && (\n                            <div className=\"text-xs text-orange-600 dark:text-orange-400 flex items-center gap-1 mt-1\">\n                              <Calendar className=\"h-3 w-3\" />\n                              Expires: {new Date(item.expiryDate!).toLocaleDateString()}\n                            </div>\n                          )}\n                        </TableCell>\n                        <TableCell>\n                          <span className={`text-xs px-2 py-1 rounded ${item.category === 'trackable' ? 'bg-blue-500/20 text-blue-600 dark:text-blue-400' : 'bg-green-500/20 text-green-600 dark:text-green-400'}`}>\n                            {item.category === 'trackable' ? 'Trackable' : 'Made to Order'}\n                          </span>\n                        </TableCell>\n                        <TableCell data-testid={`text-min-quantity-${item.id}`}>\n                          {item.minStockLevel}\n                        </TableCell>\n                        <TableCell data-testid={`text-available-quantity-${item.id}`}>\n                          <span className={isLowStock ? \"text-destructive font-semibold\" : \"\"}>\n                            {item.currentStock}\n                          </span>\n                        </TableCell>\n                        <TableCell data-testid={`text-profit-${item.id}`}>\n                          {profitData ? (\n                            <div className=\"flex items-center gap-1 text-sm\">\n                              <TrendingUp className=\"h-3 w-3 text-green-600 dark:text-green-400\" />\n                              <span className=\"text-green-600 dark:text-green-400\">\n                                ‚Çπ{profitData.profit.toFixed(2)} ({profitData.margin.toFixed(1)}%)\n                              </span>\n                            </div>\n                          ) : (\n                            <span className=\"text-xs text-muted-foreground\">-</span>\n                          )}\n                        </TableCell>\n                        <TableCell data-testid={`text-status-${item.id}`}>\n                          {isLowStock ? (\n                            <span className=\"inline-flex items-center gap-1 text-destructive text-sm\">\n                              <AlertTriangle className=\"h-3 w-3\" />\n                              Low Stock\n                            </span>\n                          ) : (\n                            <span className=\"text-green-600 dark:text-green-400 text-sm\">\n                              In Stock\n                            </span>\n                          )}\n                        </TableCell>\n                        <TableCell className=\"text-right\">\n                          <div className=\"flex items-center justify-end gap-2\">\n                            {item.category === 'trackable' && (\n                              <>\n                                <Button\n                                  variant=\"outline\"\n                                  size=\"sm\"\n                                  onClick={() => openStockDialog(item, 'add')}\n                                  disabled={!canMakeChanges}\n                                  data-testid={`button-add-stock-${item.id}`}\n                                >\n                                  <Plus className=\"h-4 w-4 mr-1\" />\n                                  Add\n                                </Button>\n                                <Button\n                                  variant=\"outline\"\n                                  size=\"sm\"\n                                  onClick={() => openStockDialog(item, 'remove')}\n                                  disabled={!canMakeChanges}\n                                  data-testid={`button-remove-stock-${item.id}`}\n                                >\n                                  <Minus className=\"h-4 w-4 mr-1\" />\n                                  Remove\n                                </Button>\n                              </>\n                            )}\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={() => openDeleteDialog(item)}\n                              disabled={!canMakeChanges}\n                              data-testid={`button-delete-${item.id}`}\n                            >\n                              <Trash2 className=\"h-4 w-4 text-destructive\" />\n                            </Button>\n                          </div>\n                        </TableCell>\n                      </TableRow>\n                    );\n                  })}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </TabsContent>\n      </Tabs>\n\n      {trackableLowStock.length > 0 && (\n        <Card className=\"mt-6\">\n          <CardContent className=\"pt-6\">\n            <h3 className=\"text-lg font-semibold mb-4 flex items-center gap-2\">\n              <Package className=\"h-5 w-5\" />\n              Reorder List (Trackable Items Below Min Stock)\n            </h3>\n            <div className=\"space-y-2\">\n              {trackableLowStock.map(item => (\n                <div key={item.id} className=\"flex justify-between items-center p-3 border rounded-lg\" data-testid={`reorder-item-${item.id}`}>\n                  <div>\n                    <span className=\"font-medium\">{item.name}</span>\n                    <span className=\"text-sm text-muted-foreground ml-2\">\n                      Need: {item.minStockLevel - item.currentStock} more units\n                    </span>\n                    {item.supplier && (\n                      <span className=\"text-xs text-muted-foreground ml-2\">\n                        (Supplier: {item.supplier})\n                      </span>\n                    )}\n                  </div>\n                  <Button\n                    size=\"sm\"\n                    onClick={() => openStockDialog(item, 'add')}\n                    disabled={!canMakeChanges}\n                    data-testid={`button-restock-${item.id}`}\n                  >\n                    <Plus className=\"h-4 w-4 mr-1\" />\n                    Restock\n                  </Button>\n                </div>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {/* Add from Food Dialog */}\n      <Dialog open={addDialog} onOpenChange={setAddDialog}>\n        <DialogContent className=\"max-w-2xl max-h-[80vh]\" data-testid=\"dialog-add-from-food\">\n          <DialogHeader>\n            <DialogTitle>Add Items to Inventory</DialogTitle>\n            <DialogDescription>Select items from the Food catalog to add to your inventory</DialogDescription>\n          </DialogHeader>\n          <div className=\"overflow-y-auto max-h-[50vh]\">\n            {availableItems.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                <p>All food items are already in inventory!</p>\n                <p className=\"text-sm mt-2\">Create new items in the Food page first.</p>\n              </div>\n            ) : (\n              <div className=\"grid gap-3 grid-cols-1 sm:grid-cols-2\">\n                {availableItems.map((item) => (\n                  <div\n                    key={item.id}\n                    className=\"border rounded-lg p-3 flex items-center justify-between hover:bg-muted/50\"\n                    data-testid={`item-available-${item.id}`}\n                  >\n                    <div>\n                      <p className=\"font-medium\" data-testid={`text-available-name-${item.id}`}>{item.name}</p>\n                      <p className=\"text-sm text-primary font-semibold\" data-testid={`text-available-price-${item.id}`}>‚Çπ{item.price}</p>\n                      <span className=\"text-xs text-muted-foreground\">\n                        {item.category === 'trackable' ? 'Trackable' : 'Made to Order'}\n                      </span>\n                    </div>\n                    <Button\n                      size=\"sm\"\n                      onClick={() => addToInventoryMutation.mutate(item.id)}\n                      disabled={addToInventoryMutation.isPending}\n                      data-testid={`button-add-to-inventory-${item.id}`}\n                    >\n                      <Plus className=\"h-4 w-4 mr-1\" />\n                      Add\n                    </Button>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setAddDialog(false)} data-testid=\"button-close-add-dialog\">\n              Close\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Stock Adjustment Dialog */}\n      <Dialog open={stockDialog.open} onOpenChange={(open) => !open && setStockDialog({ open: false, item: null, type: 'add' })}>\n        <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\" data-testid=\"dialog-adjust-stock\">\n          <DialogHeader>\n            <DialogTitle>{stockDialog.type === 'add' ? 'Add Stock' : 'Remove Stock'}</DialogTitle>\n            <DialogDescription>\n              {stockDialog.type === 'add' \n                ? `Add stock quantity to \"${stockDialog.item?.name}\"`\n                : `Remove stock quantity from \"${stockDialog.item?.name}\"`\n              }\n              <br />\n              <span className=\"text-sm text-muted-foreground mt-2 block\">\n                Current Stock: {stockDialog.item?.currentStock} | Min Level: {stockDialog.item?.minStockLevel}\n              </span>\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"quantity\">Quantity *</Label>\n              <Input\n                id=\"quantity\"\n                type=\"number\"\n                min=\"1\"\n                placeholder=\"Enter quantity\"\n                value={stockFormData.quantity}\n                onChange={(e) => setStockFormData({ ...stockFormData, quantity: e.target.value })}\n                data-testid=\"input-stock-quantity\"\n              />\n            </div>\n            {stockDialog.type === 'add' && (\n              <>\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"batch-costPrice\">Cost Price (‚Çπ)</Label>\n                    <Input\n                      id=\"batch-costPrice\"\n                      type=\"number\"\n                      placeholder=\"Purchase cost per unit\"\n                      value={stockFormData.costPrice}\n                      onChange={(e) => setStockFormData({ ...stockFormData, costPrice: e.target.value })}\n                      data-testid=\"input-batch-cost-price\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"batch-supplier\">Supplier</Label>\n                    <Input\n                      id=\"batch-supplier\"\n                      placeholder=\"Supplier name\"\n                      value={stockFormData.supplier}\n                      onChange={(e) => setStockFormData({ ...stockFormData, supplier: e.target.value })}\n                      data-testid=\"input-batch-supplier\"\n                    />\n                  </div>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"batch-expiryDate\">Expiry Date</Label>\n                  <Input\n                    id=\"batch-expiryDate\"\n                    type=\"date\"\n                    value={stockFormData.expiryDate}\n                    onChange={(e) => setStockFormData({ ...stockFormData, expiryDate: e.target.value })}\n                    data-testid=\"input-batch-expiry-date\"\n                  />\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"batch-notes\">Notes</Label>\n                  <Input\n                    id=\"batch-notes\"\n                    placeholder=\"Any additional notes\"\n                    value={stockFormData.notes}\n                    onChange={(e) => setStockFormData({ ...stockFormData, notes: e.target.value })}\n                    data-testid=\"input-batch-notes\"\n                  />\n                </div>\n              </>\n            )}\n          </div>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => setStockDialog({ open: false, item: null, type: 'add' })}\n              data-testid=\"button-cancel-adjust\"\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={handleAdjustStock}\n              disabled={adjustStockMutation.isPending || !stockFormData.quantity}\n              data-testid=\"button-confirm-adjust\"\n            >\n              {adjustStockMutation.isPending ? \"Updating...\" : stockDialog.type === 'add' ? 'Add Stock' : 'Remove Stock'}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Remove from Inventory Confirmation Dialog */}\n      <Dialog open={deleteDialog.open} onOpenChange={(open) => !open && setDeleteDialog({ open: false, item: null })}>\n        <DialogContent data-testid=\"dialog-remove-from-inventory\">\n          <DialogHeader>\n            <DialogTitle>Remove from Inventory</DialogTitle>\n            <DialogDescription>\n              Are you sure you want to remove \"{deleteDialog.item?.name}\" from inventory?\n              <br />\n              <span className=\"text-sm text-muted-foreground mt-2 block\">\n                Note: This will not delete the item from the Food catalog. You can add it back anytime.\n              </span>\n            </DialogDescription>\n          </DialogHeader>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => setDeleteDialog({ open: false, item: null })}\n              data-testid=\"button-cancel-remove\"\n            >\n              Cancel\n            </Button>\n            <Button\n              variant=\"destructive\"\n              onClick={handleRemoveFromInventory}\n              disabled={removeFromInventoryMutation.isPending}\n              data-testid=\"button-confirm-remove\"\n            >\n              {removeFromInventoryMutation.isPending ? \"Removing...\" : \"Remove\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":26196,"size_tokens":null},"client/src/components/PricingTable.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Pencil, Check, X, Plus, Trash2 } from \"lucide-react\";\n\ninterface PriceSlot {\n  duration: string;\n  price: number;\n  personCount?: number;\n}\n\ninterface PricingTableProps {\n  category: string;\n  slots: PriceSlot[];\n  onUpdateSlots?: (slots: PriceSlot[]) => void;\n}\n\nexport function PricingTable({ category, slots, onUpdateSlots }: PricingTableProps) {\n  const [editingIndex, setEditingIndex] = useState<number | null>(null);\n  const [editValue, setEditValue] = useState(\"\");\n  const [editDurationHours, setEditDurationHours] = useState(0);\n  const [editDurationMins, setEditDurationMins] = useState(0);\n  const [editPersonCount, setEditPersonCount] = useState(1);\n\n  const startEdit = (index: number) => {\n    setEditingIndex(index);\n    setEditValue(slots[index].price.toString());\n    const totalMins = getDurationMinutes(slots[index].duration);\n    setEditDurationHours(Math.floor(totalMins / 60));\n    setEditDurationMins(totalMins % 60);\n    setEditPersonCount(slots[index].personCount || 1);\n  };\n\n  const saveEdit = () => {\n    if (editingIndex !== null) {\n      const newSlots = [...slots];\n      const totalMins = editDurationHours * 60 + editDurationMins;\n      newSlots[editingIndex].price = parseInt(editValue) || 0;\n      newSlots[editingIndex].duration = getDurationString(totalMins);\n      // Only PS5 category can have personCount > 1, force others to 1\n      newSlots[editingIndex].personCount = category === \"PS5\" ? editPersonCount : 1;\n      onUpdateSlots?.(newSlots);\n      setEditingIndex(null);\n    }\n  };\n\n  const cancelEdit = () => {\n    setEditingIndex(null);\n    setEditValue(\"\");\n    setEditDurationHours(0);\n    setEditDurationMins(0);\n    setEditPersonCount(1);\n  };\n\n  const getDurationMinutes = (duration: string): number => {\n    const match = duration.match(/(\\d+)\\s*(mins?|hours?)/i);\n    if (!match) return 30;\n    const value = parseInt(match[1]);\n    const unit = match[2].toLowerCase();\n    return unit.startsWith('hour') ? value * 60 : value;\n  };\n\n  const getDurationString = (mins: number): string => {\n    if (mins < 60) return `${mins} mins`;\n    const hours = Math.floor(mins / 60);\n    const remainingMins = mins % 60;\n    if (remainingMins === 0) return hours === 1 ? \"1 hour\" : `${hours} hours`;\n    return `${hours} hour${hours > 1 ? 's' : ''} ${remainingMins} mins`;\n  };\n\n  const addSlot = () => {\n    if (slots.length === 0) {\n      const newSlots = [{ duration: \"30 mins\", price: 0, personCount: 1 }];\n      onUpdateSlots?.(newSlots);\n      return;\n    }\n    const lastSlot = slots[slots.length - 1];\n    const lastMins = getDurationMinutes(lastSlot.duration);\n    const newMins = lastMins + 30;\n    const newSlots = [...slots, { duration: getDurationString(newMins), price: 0, personCount: 1 }];\n    onUpdateSlots?.(newSlots);\n  };\n\n  const removeSlot = (index: number) => {\n    if (slots.length > 1) {\n      const newSlots = slots.filter((_, i) => i !== index);\n      onUpdateSlots?.(newSlots);\n    }\n  };\n\n  return (\n    <Card className=\"glass-card\" data-testid={`card-pricing-${category.toLowerCase()}`}>\n      <CardHeader>\n        <CardTitle>{category} Pricing</CardTitle>\n        <CardDescription>Set pricing for different time slots</CardDescription>\n      </CardHeader>\n      <CardContent>\n        <div className=\"space-y-2\">\n          {slots.map((slot, index) => (\n            <div\n              key={index}\n              className=\"rounded-md border p-3 lg:p-4 hover-elevate transition-all\"\n              data-testid={`row-pricing-${category.toLowerCase()}-${index}`}\n            >\n              {editingIndex === index ? (\n                <div className=\"flex flex-col gap-3\">\n                  <div className=\"flex flex-wrap items-center gap-2 lg:gap-3\">\n                    <div className=\"flex items-center gap-1.5\">\n                      <Input\n                        type=\"number\"\n                        min=\"0\"\n                        value={editDurationHours}\n                        onChange={(e) => setEditDurationHours(Math.max(0, parseInt(e.target.value) || 0))}\n                        className=\"w-16 lg:w-20 h-9 lg:h-10 text-center text-sm lg:text-base\"\n                        data-testid={`input-duration-hours-${category.toLowerCase()}-${index}`}\n                      />\n                      <span className=\"text-xs lg:text-sm text-muted-foreground font-medium\">hr</span>\n                    </div>\n                    <div className=\"flex items-center gap-1.5\">\n                      <Input\n                        type=\"number\"\n                        min=\"0\"\n                        step=\"30\"\n                        value={editDurationMins}\n                        onChange={(e) => {\n                          const value = parseInt(e.target.value) || 0;\n                          setEditDurationMins(value >= 30 ? 30 : 0);\n                        }}\n                        className=\"w-16 lg:w-20 h-9 lg:h-10 text-center text-sm lg:text-base\"\n                        data-testid={`input-duration-mins-${category.toLowerCase()}-${index}`}\n                      />\n                      <span className=\"text-xs lg:text-sm text-muted-foreground font-medium\">min</span>\n                    </div>\n                    {category === \"PS5\" && (\n                      <>\n                        <span className=\"text-xs lg:text-sm text-muted-foreground\">+</span>\n                        <div className=\"flex items-center gap-1.5\">\n                          <Input\n                            type=\"number\"\n                            min=\"1\"\n                            value={editPersonCount}\n                            onChange={(e) => setEditPersonCount(Math.max(1, parseInt(e.target.value) || 1))}\n                            className=\"w-16 lg:w-20 h-9 lg:h-10 text-center text-sm lg:text-base\"\n                            data-testid={`input-person-count-${category.toLowerCase()}-${index}`}\n                          />\n                          <span className=\"text-xs lg:text-sm text-muted-foreground font-medium\">person</span>\n                        </div>\n                      </>\n                    )}\n                  </div>\n                  <div className=\"flex items-center gap-2 lg:gap-3\">\n                    <div className=\"flex items-center gap-1.5 lg:gap-2 flex-1\">\n                      <span className=\"text-sm lg:text-base text-muted-foreground font-semibold\">‚Çπ</span>\n                      <Input\n                        type=\"number\"\n                        value={editValue}\n                        onChange={(e) => setEditValue(e.target.value)}\n                        className=\"w-full max-w-[200px] h-9 lg:h-10 text-sm lg:text-base\"\n                        placeholder=\"Price\"\n                        data-testid={`input-price-${category.toLowerCase()}-${index}`}\n                      />\n                    </div>\n                    <Button size=\"icon\" variant=\"ghost\" className=\"h-9 w-9 lg:h-10 lg:w-10 shrink-0 hover:bg-green-100 dark:hover:bg-green-900\" onClick={saveEdit} data-testid={`button-save-${index}`}>\n                      <Check className=\"h-4 w-4 lg:h-5 lg:w-5\" />\n                    </Button>\n                    <Button size=\"icon\" variant=\"ghost\" className=\"h-9 w-9 lg:h-10 lg:w-10 shrink-0 hover:bg-red-100 dark:hover:bg-red-900\" onClick={cancelEdit} data-testid={`button-cancel-${index}`}>\n                      <X className=\"h-4 w-4 lg:h-5 lg:w-5\" />\n                    </Button>\n                  </div>\n                </div>\n              ) : (\n                <div className=\"flex items-center justify-between gap-3\">\n                  <div className=\"text-sm lg:text-base font-medium flex-1\">\n                    {slot.duration}{category === \"PS5\" ? ` + ${slot.personCount || 1} person` : ''}\n                  </div>\n                  <div className=\"flex items-center gap-2 lg:gap-3\">\n                    <span className=\"font-bold text-primary text-lg lg:text-xl\" data-testid={`text-price-${category.toLowerCase()}-${index}`}>\n                      ‚Çπ{slot.price}\n                    </span>\n                    <Button\n                      size=\"icon\"\n                      variant=\"ghost\"\n                      className=\"h-9 w-9 lg:h-10 lg:w-10 shrink-0 hover:bg-blue-100 dark:hover:bg-blue-900\"\n                      onClick={() => startEdit(index)}\n                      data-testid={`button-edit-${category.toLowerCase()}-${index}`}\n                    >\n                      <Pencil className=\"h-4 w-4 lg:h-5 lg:w-5\" />\n                    </Button>\n                    {slots.length > 1 && (\n                      <Button\n                        size=\"icon\"\n                        variant=\"ghost\"\n                        className=\"h-9 w-9 lg:h-10 lg:w-10 shrink-0 hover:bg-red-100 dark:hover:bg-red-900\"\n                        onClick={() => removeSlot(index)}\n                        data-testid={`button-remove-${category.toLowerCase()}-${index}`}\n                      >\n                        <Trash2 className=\"h-4 w-4 lg:h-5 lg:w-5\" />\n                      </Button>\n                    )}\n                  </div>\n                </div>\n              )}\n            </div>\n          ))}\n          <Button\n            variant=\"outline\"\n            className=\"w-full\"\n            onClick={addSlot}\n            data-testid={`button-add-slot-${category.toLowerCase()}`}\n          >\n            <Plus className=\"mr-2 h-4 w-4\" />\n            Add Time Slot (+30 mins)\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":9750,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/hooks/useServerTime.ts":{"content":"import { useState, useEffect } from \"react\";\nimport { getServerTime } from \"@/lib/api\";\n\nlet timeOffset: number | null = null;\nlet offsetPromise: Promise<void> | null = null;\nlet isInitializing = false;\n\nasync function initializeTimeOffset() {\n  if (timeOffset !== null) return;\n  \n  if (isInitializing) {\n    if (offsetPromise) {\n      await offsetPromise;\n    }\n    return;\n  }\n\n  isInitializing = true;\n  offsetPromise = (async () => {\n    try {\n      const serverTime = await getServerTime();\n      const clientTime = new Date();\n      timeOffset = serverTime.getTime() - clientTime.getTime();\n    } catch (error) {\n      timeOffset = 0;\n    } finally {\n      offsetPromise = null;\n      isInitializing = false;\n    }\n  })();\n\n  await offsetPromise;\n}\n\nexport function getAdjustedTime(): Date {\n  const now = new Date();\n  if (timeOffset === null) {\n    return now;\n  }\n  return new Date(now.getTime() + timeOffset);\n}\n\nexport function useServerTime() {\n  const [isReady, setIsReady] = useState(timeOffset !== null);\n\n  useEffect(() => {\n    if (!isReady) {\n      initializeTimeOffset().then(() => setIsReady(true));\n    }\n  }, [isReady]);\n\n  return { isReady, getTime: getAdjustedTime };\n}\n","path":null,"size_bytes":1195,"size_tokens":null},"client/src/components/FlipClock.tsx":{"content":"import { useState, useEffect, memo } from \"react\";\nimport { useServerTime } from \"@/hooks/useServerTime\";\n\ninterface FlipDigitProps {\n  value: string;\n  prevValue: string;\n}\n\nconst FlipDigit = memo(({ value, prevValue }: FlipDigitProps) => {\n  const [isFlipping, setIsFlipping] = useState(false);\n\n  useEffect(() => {\n    if (value !== prevValue) {\n      setIsFlipping(true);\n      const timer = setTimeout(() => setIsFlipping(false), 600);\n      return () => clearTimeout(timer);\n    }\n  }, [value, prevValue]);\n\n  return (\n    <div className=\"relative w-6 h-8\" style={{ perspective: '200px' }}>\n      <div className=\"absolute inset-0 overflow-visible rounded\">\n        <div className=\"absolute inset-0 bg-gradient-to-br from-[#7B68EE] to-[#6A5ACD] rounded shadow-sm border border-white/10 flex items-center justify-center\">\n          <span className=\"font-mono font-bold text-xl text-white leading-none\">{value}</span>\n        </div>\n      </div>\n\n      {isFlipping && (\n        <div \n          className=\"absolute inset-0 overflow-visible rounded\"\n          style={{ \n            transformStyle: 'preserve-3d',\n            transformOrigin: 'center bottom',\n            animation: 'flip 0.6s ease-in-out'\n          }}\n        >\n          <div \n            className=\"absolute inset-0 bg-gradient-to-br from-[#7B68EE] to-[#6A5ACD] rounded shadow-sm border border-white/10 flex items-center justify-center\"\n            style={{ backfaceVisibility: 'hidden' }}\n          >\n            <span className=\"font-mono font-bold text-xl text-white leading-none\">{prevValue}</span>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n});\n\nFlipDigit.displayName = 'FlipDigit';\n\nconst FlipPeriod = memo(({ value, prevValue }: FlipDigitProps) => {\n  const [isFlipping, setIsFlipping] = useState(false);\n\n  useEffect(() => {\n    if (value !== prevValue) {\n      setIsFlipping(true);\n      const timer = setTimeout(() => setIsFlipping(false), 600);\n      return () => clearTimeout(timer);\n    }\n  }, [value, prevValue]);\n\n  return (\n    <div className=\"relative w-10 h-8\" style={{ perspective: '200px' }}>\n      <div className=\"absolute inset-0 overflow-visible rounded\">\n        <div className=\"absolute inset-0 bg-gradient-to-br from-[#7B68EE] to-[#6A5ACD] rounded shadow-sm border border-white/10 flex items-center justify-center\">\n          <span className=\"font-mono font-bold text-sm text-white leading-none\">{value}</span>\n        </div>\n      </div>\n\n      {isFlipping && (\n        <div \n          className=\"absolute inset-0 overflow-visible rounded\"\n          style={{ \n            transformStyle: 'preserve-3d',\n            transformOrigin: 'center bottom',\n            animation: 'flip 0.6s ease-in-out'\n          }}\n        >\n          <div \n            className=\"absolute inset-0 bg-gradient-to-br from-[#7B68EE] to-[#6A5ACD] rounded shadow-sm border border-white/10 flex items-center justify-center\"\n            style={{ backfaceVisibility: 'hidden' }}\n          >\n            <span className=\"font-mono font-bold text-sm text-white leading-none\">{prevValue}</span>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n});\n\nFlipPeriod.displayName = 'FlipPeriod';\n\ninterface TimeState {\n  hours: [string, string];\n  minutes: [string, string];\n  period: string;\n  dateText: string;\n}\n\nexport function FlipClock() {\n  const { isReady, getTime } = useServerTime();\n  \n  const getISTTime = (): TimeState => {\n    const now = getTime();\n    const istTimeString = now.toLocaleString('en-US', {\n      timeZone: 'Asia/Kolkata',\n      hour12: false,\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n    const [hours24Str, minutesStr] = istTimeString.split(':');\n    const hours24 = parseInt(hours24Str);\n    const hours12 = (hours24 % 12 || 12).toString().padStart(2, '0');\n    const minutes = minutesStr.padStart(2, '0');\n    const period = hours24 >= 12 ? 'PM' : 'AM';\n    \n    const dateText = now.toLocaleDateString('en-US', {\n      weekday: 'short',\n      month: 'short',\n      day: 'numeric',\n      year: 'numeric',\n      timeZone: 'Asia/Kolkata'\n    });\n    \n    return {\n      hours: [hours12[0], hours12[1]] as [string, string],\n      minutes: [minutes[0], minutes[1]] as [string, string],\n      period,\n      dateText\n    };\n  };\n\n  const [currentTime, setCurrentTime] = useState<TimeState>(getISTTime);\n  const [prevTime, setPrevTime] = useState(currentTime);\n\n  useEffect(() => {\n    const timer = setInterval(() => {\n      setPrevTime(currentTime);\n      setCurrentTime(getISTTime());\n    }, 1000);\n\n    return () => clearInterval(timer);\n  }, [currentTime, getTime]);\n\n  return (\n    <div \n      className=\"flex items-center gap-2\"\n      data-testid=\"flip-clock\"\n    >\n      <div className=\"flex items-center gap-1\">\n        <FlipDigit value={currentTime.hours[0]} prevValue={prevTime.hours[0]} />\n        <FlipDigit value={currentTime.hours[1]} prevValue={prevTime.hours[1]} />\n        \n        <span className=\"text-lg font-bold text-muted-foreground mx-0.5\">:</span>\n        \n        <FlipDigit value={currentTime.minutes[0]} prevValue={prevTime.minutes[0]} />\n        <FlipDigit value={currentTime.minutes[1]} prevValue={prevTime.minutes[1]} />\n        \n        <FlipPeriod value={currentTime.period} prevValue={prevTime.period} />\n      </div>\n      \n      <div className=\"text-xs text-muted-foreground font-medium whitespace-nowrap\">\n        {currentTime.dateText}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":5423,"size_tokens":null},"client/src/components/RetentionCharts.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  LineChart,\n  Line,\n  BarChart,\n  Bar,\n  XAxis,\n  YAxis,\n  CartesianGrid,\n  Tooltip,\n  ResponsiveContainer,\n  Legend,\n} from \"recharts\";\nimport { Users, TrendingUp, TrendingDown, IndianRupee } from \"lucide-react\";\n\ninterface RetentionMetrics {\n  summary: {\n    totalCustomers: number;\n    newCustomers: number;\n    returningCustomers: number;\n    retentionRate: number;\n    churnRate: number;\n    avgVisitFrequency: number;\n    avgLifetimeValue: number;\n  };\n  series: {\n    period: string;\n    newCustomers: number;\n    returningCustomers: number;\n    totalVisits: number;\n    retentionRate: number;\n    revenue: number;\n  }[];\n}\n\nexport default function RetentionCharts() {\n  const [period, setPeriod] = useState<'daily' | 'weekly' | 'monthly'>(\"monthly\");\n  const [months, setMonths] = useState<number>(6);\n\n  const { data: metrics, isLoading } = useQuery<RetentionMetrics>({\n    queryKey: [\"/api/reports/retention-metrics\", period, months],\n    queryFn: async () => {\n      const response = await fetch(`/api/reports/retention-metrics?period=${period}&months=${months}`);\n      if (!response.ok) throw new Error(\"Failed to fetch retention metrics\");\n      return response.json();\n    },\n  });\n\n  const formatPeriod = (periodStr: string) => {\n    if (period === 'monthly') {\n      const [year, month] = periodStr.split('-');\n      const date = new Date(parseInt(year), parseInt(month) - 1);\n      return date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });\n    }\n    return periodStr;\n  };\n\n  const chartData = metrics?.series.map(item => ({\n    ...item,\n    period: formatPeriod(item.period),\n    retentionRate: parseFloat(item.retentionRate.toFixed(1)),\n  })) || [];\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"grid gap-4 md:grid-cols-4\">\n          {[1, 2, 3, 4].map(i => (\n            <Card key={i} data-testid={`skeleton-card-${i}`}>\n              <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n                <Skeleton className=\"h-4 w-24\" />\n                <Skeleton className=\"h-4 w-4\" />\n              </CardHeader>\n              <CardContent>\n                <Skeleton className=\"h-8 w-20 mb-1\" />\n                <Skeleton className=\"h-3 w-32\" />\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  if (!metrics) {\n    return (\n      <div className=\"text-center py-8 text-muted-foreground\">\n        No retention data available\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between flex-wrap gap-4\">\n        <div>\n          <h2 className=\"text-2xl font-bold tracking-tight\" data-testid=\"text-retention-title\">\n            Customer Retention Analytics\n          </h2>\n          <p className=\"text-muted-foreground\">\n            Track customer loyalty and repeat business\n          </p>\n        </div>\n        <div className=\"flex items-center gap-3 flex-wrap\">\n          <Select value={period} onValueChange={(value) => setPeriod(value as any)}>\n            <SelectTrigger className=\"w-32\" data-testid=\"select-period\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"daily\">Daily</SelectItem>\n              <SelectItem value=\"weekly\">Weekly</SelectItem>\n              <SelectItem value=\"monthly\">Monthly</SelectItem>\n            </SelectContent>\n          </Select>\n          <Select value={months.toString()} onValueChange={(value) => setMonths(parseInt(value))}>\n            <SelectTrigger className=\"w-32\" data-testid=\"select-months\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"3\">Last 3 months</SelectItem>\n              <SelectItem value=\"6\">Last 6 months</SelectItem>\n              <SelectItem value=\"12\">Last 12 months</SelectItem>\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-4\">\n        <Card data-testid=\"card-total-customers\">\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Total Customers</CardTitle>\n            <Users className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"text-total-customers\">\n              {metrics.summary.totalCustomers}\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              {metrics.summary.newCustomers} new, {metrics.summary.returningCustomers} returning\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-retention-rate\">\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Retention Rate</CardTitle>\n            <TrendingUp className=\"h-4 w-4 text-green-600 dark:text-green-400\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-green-600 dark:text-green-400\" data-testid=\"text-retention-rate\">\n              {metrics.summary.retentionRate.toFixed(1)}%\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Customers who return\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-churn-rate\">\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Churn Rate</CardTitle>\n            <TrendingDown className=\"h-4 w-4 text-amber-600 dark:text-amber-400\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-amber-600 dark:text-amber-400\" data-testid=\"text-churn-rate\">\n              {metrics.summary.churnRate.toFixed(1)}%\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Inactive for 30+ days\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-lifetime-value\">\n          <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Avg Lifetime Value</CardTitle>\n            <IndianRupee className=\"h-4 w-4 text-muted-foreground\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"text-lifetime-value\">\n              ‚Çπ{metrics.summary.avgLifetimeValue.toFixed(0)}\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              {metrics.summary.avgVisitFrequency.toFixed(1)} avg visits\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-2\">\n        <Card data-testid=\"card-customer-trend\">\n          <CardHeader>\n            <CardTitle>New vs Returning Customers</CardTitle>\n            <CardDescription>\n              Track customer acquisition and retention over time\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <ResponsiveContainer width=\"100%\" height={300}>\n              <BarChart data={chartData}>\n                <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                <XAxis \n                  dataKey=\"period\" \n                  tick={{ fontSize: 12 }}\n                  className=\"text-muted-foreground\"\n                />\n                <YAxis \n                  tick={{ fontSize: 12 }}\n                  className=\"text-muted-foreground\"\n                />\n                <Tooltip \n                  contentStyle={{ \n                    backgroundColor: 'hsl(var(--card))',\n                    border: '1px solid hsl(var(--border))',\n                    borderRadius: '6px'\n                  }}\n                />\n                <Legend />\n                <Bar dataKey=\"newCustomers\" fill=\"hsl(var(--chart-1))\" name=\"New Customers\" />\n                <Bar dataKey=\"returningCustomers\" fill=\"hsl(var(--chart-2))\" name=\"Returning Customers\" />\n              </BarChart>\n            </ResponsiveContainer>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-retention-trend\">\n          <CardHeader>\n            <CardTitle>Retention Rate Trend</CardTitle>\n            <CardDescription>\n              Percentage of returning customers per period\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <ResponsiveContainer width=\"100%\" height={300}>\n              <LineChart data={chartData}>\n                <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                <XAxis \n                  dataKey=\"period\" \n                  tick={{ fontSize: 12 }}\n                  className=\"text-muted-foreground\"\n                />\n                <YAxis \n                  tick={{ fontSize: 12 }}\n                  className=\"text-muted-foreground\"\n                  domain={[0, 100]}\n                />\n                <Tooltip \n                  contentStyle={{ \n                    backgroundColor: 'hsl(var(--card))',\n                    border: '1px solid hsl(var(--border))',\n                    borderRadius: '6px'\n                  }}\n                  formatter={(value: number) => `${value.toFixed(1)}%`}\n                />\n                <Legend />\n                <Line \n                  type=\"monotone\" \n                  dataKey=\"retentionRate\" \n                  stroke=\"hsl(var(--chart-3))\" \n                  strokeWidth={2}\n                  name=\"Retention Rate\"\n                  dot={{ r: 4 }}\n                />\n              </LineChart>\n            </ResponsiveContainer>\n          </CardContent>\n        </Card>\n\n        <Card className=\"md:col-span-2\" data-testid=\"card-revenue-trend\">\n          <CardHeader>\n            <CardTitle>Revenue by Period</CardTitle>\n            <CardDescription>\n              Total revenue generated from customer visits\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <ResponsiveContainer width=\"100%\" height={300}>\n              <BarChart data={chartData}>\n                <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                <XAxis \n                  dataKey=\"period\" \n                  tick={{ fontSize: 12 }}\n                  className=\"text-muted-foreground\"\n                />\n                <YAxis \n                  tick={{ fontSize: 12 }}\n                  className=\"text-muted-foreground\"\n                />\n                <Tooltip \n                  contentStyle={{ \n                    backgroundColor: 'hsl(var(--card))',\n                    border: '1px solid hsl(var(--border))',\n                    borderRadius: '6px'\n                  }}\n                  formatter={(value: number) => `‚Çπ${value.toFixed(2)}`}\n                />\n                <Legend />\n                <Bar dataKey=\"revenue\" fill=\"hsl(var(--chart-4))\" name=\"Revenue (‚Çπ)\" />\n              </BarChart>\n            </ResponsiveContainer>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":11724,"size_tokens":null},"client/src/components/NetworkAlert.tsx":{"content":"import { AlertCircle, RefreshCw, WifiOff } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\n\ninterface NetworkAlertProps {\n  open: boolean;\n  onRefresh: () => void;\n  onDismiss: () => void;\n}\n\nexport function NetworkAlert({ open, onRefresh, onDismiss }: NetworkAlertProps) {\n  return (\n    <Dialog open={open} onOpenChange={(isOpen) => !isOpen && onDismiss()}>\n      <DialogContent \n        className=\"sm:max-w-md border-red-500/50 bg-gradient-to-br from-red-50 to-orange-50 dark:from-red-950/20 dark:to-orange-950/20\"\n        data-testid=\"dialog-network-alert\"\n      >\n        <DialogHeader>\n          <div className=\"flex items-center gap-3\">\n            <div className=\"bg-red-500/10 p-3 rounded-full\">\n              <WifiOff className=\"h-6 w-6 text-red-500\" />\n            </div>\n            <div>\n              <DialogTitle className=\"text-red-700 dark:text-red-400 flex items-center gap-2\">\n                <AlertCircle className=\"h-5 w-5\" />\n                Network Connection Lost\n              </DialogTitle>\n            </div>\n          </div>\n          <DialogDescription className=\"text-red-600/80 dark:text-red-300/80 pt-2\">\n            The application has lost connection to the server. This may happen when:\n          </DialogDescription>\n          <ul className=\"text-sm text-red-600/70 dark:text-red-300/70 list-disc list-inside space-y-1 pt-2\">\n            <li>Your internet connection is unstable</li>\n            <li>The server went to sleep due to inactivity</li>\n            <li>The application froze or became unresponsive</li>\n          </ul>\n        </DialogHeader>\n        \n        <DialogFooter className=\"flex gap-2 sm:gap-2\">\n          <Button\n            variant=\"outline\"\n            onClick={onDismiss}\n            className=\"flex-1\"\n            data-testid=\"button-dismiss-network-alert\"\n          >\n            Dismiss\n          </Button>\n          <Button\n            onClick={onRefresh}\n            className=\"flex-1 bg-red-600 hover:bg-red-700 text-white\"\n            data-testid=\"button-refresh-page\"\n          >\n            <RefreshCw className=\"mr-2 h-4 w-4\" />\n            Refresh Page\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":2373,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nconst isTauri = process.env.TAURI_ENV_DEBUG !== undefined || process.env.TAURI_ENV_PLATFORM !== undefined;\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined && !isTauri\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, isTauri ? \"dist\" : \"dist/public\"),\n    emptyOutDir: true,\n    target: isTauri ? [\"es2021\", \"chrome100\", \"safari14\"] : \"esnext\",\n    minify: !process.env.TAURI_ENV_DEBUG ? \"esbuild\" : false,\n    sourcemap: !!process.env.TAURI_ENV_DEBUG,\n  },\n  server: {\n    port: 5173,\n    strictPort: true,\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n  clearScreen: false,\n  envPrefix: [\"VITE_\", \"TAURI_ENV_\"],\n});\n","path":null,"size_bytes":1495,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"client/src/components/LiveClock.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Clock } from \"lucide-react\";\nimport { useServerTime } from \"@/hooks/useServerTime\";\n\nexport function LiveClock() {\n  const { isReady, getTime } = useServerTime();\n  const [time, setTime] = useState(getTime());\n\n  useEffect(() => {\n    const timer = setInterval(() => {\n      setTime(getTime());\n    }, 1000);\n\n    return () => clearInterval(timer);\n  }, [getTime]);\n\n  const formatTime = (date: Date) => {\n    return date.toLocaleTimeString('en-US', {\n      hour: '2-digit',\n      minute: '2-digit',\n      second: '2-digit',\n      hour12: true,\n      timeZone: 'Asia/Kolkata'\n    });\n  };\n\n  const formatDate = (date: Date) => {\n    return date.toLocaleDateString('en-IN', {\n      weekday: 'short',\n      month: 'short',\n      day: 'numeric',\n      timeZone: 'Asia/Kolkata'\n    });\n  };\n\n  return (\n    <div \n      className=\"flex items-center gap-2 px-3 py-1.5 rounded-md bg-card/50 backdrop-blur-sm border border-border/50\"\n      data-testid=\"live-clock\"\n    >\n      <Clock className=\"h-3.5 w-3.5 text-muted-foreground animate-pulse\" />\n      <div className=\"flex flex-col gap-0.5 min-w-[120px]\">\n        <div \n          className=\"text-sm font-mono font-semibold tabular-nums tracking-tight leading-none transition-all duration-300\"\n          style={{\n            fontVariantNumeric: 'tabular-nums',\n          }}\n        >\n          {formatTime(time)}\n        </div>\n        <div className=\"text-[10px] text-muted-foreground font-medium leading-none\">\n          {formatDate(time)}\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/pages/Reports.tsx":{"content":"import { useState, useMemo, useCallback } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { RevenueCard } from \"@/components/RevenueCard\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Calendar, Download, IndianRupee, Users, Clock, Search, Eye, TrendingUp } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { getAdjustedTime } from \"@/hooks/useServerTime\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { ColumnVisibilityToggle } from \"@/components/ColumnVisibilityToggle\";\nimport RetentionCharts from \"@/components/RetentionCharts\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\n\ninterface BookingStats {\n  totalRevenue: number;\n  totalFoodRevenue: number;\n  totalSessions: number;\n  avgSessionMinutes: number;\n  cashRevenue: number;\n  upiRevenue: number;\n}\n\ninterface BookingHistoryItem {\n  id: string;\n  date: string;\n  seatName: string;\n  customerName: string;\n  duration: string;\n  price: string;\n  foodAmount: number;\n  totalAmount: number;\n  paymentMethod: string | null;\n  paymentStatus: string;\n  cashAmount: string | null;\n  upiAmount: string | null;\n  discount?: string | null;\n  bonus?: string | null;\n  discountApplied?: string | null;\n  bonusHoursApplied?: string | null;\n}\n\ninterface SeatDetail {\n  seat: string;\n  duration: string;\n  bookingId: string;\n}\n\ninterface GroupedBookingSession {\n  id: string;\n  date: string;\n  customerName: string;\n  seats: string[];\n  seatDetails: SeatDetail[];\n  duration: string;\n  sessionPrice: number;\n  foodAmount: number;\n  cashAmount: number;\n  upiAmount: number;\n  totalAmount: number;\n  bookingIds: string[];\n  discount?: string;\n  bonus?: string;\n  discountApplied?: string;\n  bonusHoursApplied?: string;\n  paymentStatus: string;\n}\n\ninterface UnifiedTransaction {\n  id: string;\n  date: string;\n  customerName: string;\n  seats?: string[];\n  seatDetails?: SeatDetail[];\n  duration?: string;\n  sessionPrice?: number;\n  foodAmount: number;\n  cashAmount: number;\n  upiAmount: number;\n  totalAmount: number;\n  paymentMethod: string | null;\n  paymentStatus?: string;\n  discount?: string;\n  bonus?: string;\n  discountApplied?: string;\n  bonusHoursApplied?: string;\n  bookingIds?: string[];\n}\n\nexport default function Reports() {\n  const { user } = useAuth();\n  const [mainTab, setMainTab] = useState<string>(\"reports\");\n  const [selectedPeriod, setSelectedPeriod] = useState<string>(\"daily\");\n  const [startDate, setStartDate] = useState<string>(\"\");\n  const [endDate, setEndDate] = useState<string>(\"\");\n  const [selectedMonth, setSelectedMonth] = useState<string>(\"\");\n  const [searchQuery, setSearchQuery] = useState<string>(\"\");\n  const [viewSeatsDialog, setViewSeatsDialog] = useState<{ open: boolean; seatDetails: SeatDetail[] }>({ open: false, seatDetails: [] });\n  const [viewBonusDialog, setViewBonusDialog] = useState<{ open: boolean; bonusHours: string }>({ open: false, bonusHours: '' });\n  const { toast } = useToast();\n\n  const reportColumns = useMemo(() => [\n    { id: \"date\", label: \"Date\", defaultVisible: true },\n    { id: \"customer\", label: \"Customer\", defaultVisible: true },\n    { id: \"seats\", label: \"Seat/Duration\", defaultVisible: true },\n    { id: \"duration\", label: \"Duration\", defaultVisible: false },\n    { id: \"sessionPrice\", label: \"Session Price\", defaultVisible: true },\n    { id: \"foodAmount\", label: \"Food Amount\", defaultVisible: true },\n    { id: \"discount\", label: \"Discount\", defaultVisible: false },\n    { id: \"bonus\", label: \"Bonus\", defaultVisible: false },\n    { id: \"paymentMethod\", label: \"Payment Method\", defaultVisible: true },\n    { id: \"cash\", label: \"Cash\", defaultVisible: true },\n    { id: \"upi\", label: \"UPI\", defaultVisible: true },\n    { id: \"total\", label: \"Total\", defaultVisible: true },\n    { id: \"status\", label: \"Status\", defaultVisible: true },\n  ], []);\n\n  const defaultVisibleColumns = useMemo(() => \n    reportColumns.filter(col => col.defaultVisible).map(col => col.id),\n    [reportColumns]\n  );\n\n  const [visibleColumns, setVisibleColumns] = useState<string[]>(defaultVisibleColumns);\n\n  const handleVisibilityChange = useCallback((columns: string[]) => {\n    setVisibleColumns(columns);\n  }, []);\n\n  const buildQueryParams = () => {\n    const params = new URLSearchParams();\n    params.append(\"period\", selectedPeriod);\n    \n    if (selectedPeriod === \"weekly\" && startDate && endDate) {\n      params.append(\"startDate\", startDate);\n      params.append(\"endDate\", endDate);\n    } else if (selectedPeriod === \"monthly\" && selectedMonth) {\n      const date = new Date(selectedMonth);\n      const firstDay = new Date(date.getFullYear(), date.getMonth(), 1);\n      const lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0);\n      params.append(\"startDate\", firstDay.toISOString().split('T')[0]);\n      params.append(\"endDate\", lastDay.toISOString().split('T')[0]);\n    }\n    \n    return params.toString();\n  };\n\n  const { data: stats, isLoading: statsLoading } = useQuery<BookingStats>({\n    queryKey: [\"/api/reports/stats\", selectedPeriod, startDate, endDate, selectedMonth],\n    queryFn: async () => {\n      const response = await fetch(`/api/reports/stats?${buildQueryParams()}`);\n      if (!response.ok) throw new Error(\"Failed to fetch stats\");\n      return response.json();\n    },\n  });\n\n  const { data: history, isLoading: historyLoading } = useQuery<BookingHistoryItem[]>({\n    queryKey: [\"/api/reports/history\", selectedPeriod, startDate, endDate, selectedMonth],\n    queryFn: async () => {\n      const response = await fetch(`/api/reports/history?${buildQueryParams()}`);\n      if (!response.ok) throw new Error(\"Failed to fetch history\");\n      return response.json();\n    },\n  });\n\n  const groupedSessions = useMemo(() => {\n    if (!history) return [];\n    \n    const sessionMap = new Map<string, GroupedBookingSession>();\n    \n    history.forEach((record, index) => {\n      const recordDateTime = new Date(record.date);\n      let foundSession = false;\n      \n      for (const [key, session] of Array.from(sessionMap.entries())) {\n        const sessionDateTime = new Date(session.date);\n        const timeDifferenceMs = Math.abs(recordDateTime.getTime() - sessionDateTime.getTime());\n        const timeDifferenceMinutes = timeDifferenceMs / (1000 * 60);\n        \n        if (\n          session.customerName === record.customerName &&\n          timeDifferenceMinutes < 5\n        ) {\n          session.seats.push(record.seatName);\n          session.seatDetails.push({\n            seat: record.seatName,\n            duration: record.duration,\n            bookingId: record.id\n          });\n          if (session.duration !== record.duration) {\n            session.duration = \"Mixed\";\n          }\n          session.bookingIds.push(record.id);\n          session.sessionPrice += parseFloat(record.price);\n          session.foodAmount += record.foodAmount || 0;\n          session.totalAmount += record.totalAmount || parseFloat(record.price);\n          \n          if (record.cashAmount) {\n            session.cashAmount += parseFloat(record.cashAmount);\n          } else if (record.paymentMethod === 'cash') {\n            session.cashAmount += record.totalAmount || parseFloat(record.price);\n          }\n          \n          if (record.upiAmount) {\n            session.upiAmount += parseFloat(record.upiAmount);\n          } else if (record.paymentMethod === 'upi_online') {\n            session.upiAmount += record.totalAmount || parseFloat(record.price);\n          }\n          \n          if (record.discountApplied) {\n            session.discountApplied = session.discountApplied \n              ? `${session.discountApplied}, ${record.discountApplied}`\n              : record.discountApplied;\n          }\n          if (record.bonusHoursApplied) {\n            session.bonusHoursApplied = session.bonusHoursApplied \n              ? `${session.bonusHoursApplied}, ${record.bonusHoursApplied}`\n              : record.bonusHoursApplied;\n          }\n          \n          const currentStatus = session.paymentStatus || 'unpaid';\n          const recordStatus = record.paymentStatus || 'unpaid';\n          if (currentStatus !== recordStatus) {\n            session.paymentStatus = \"Mixed\";\n          }\n          \n          foundSession = true;\n          break;\n        }\n      }\n      \n      if (!foundSession) {\n        const sessionKey = `${record.customerName}-${record.date}-${record.duration}-${index}`;\n        sessionMap.set(sessionKey, {\n          id: record.id,\n          date: record.date,\n          customerName: record.customerName,\n          seats: [record.seatName],\n          seatDetails: [{\n            seat: record.seatName,\n            duration: record.duration,\n            bookingId: record.id\n          }],\n          duration: record.duration,\n          sessionPrice: parseFloat(record.price),\n          foodAmount: record.foodAmount || 0,\n          cashAmount: record.cashAmount \n            ? parseFloat(record.cashAmount)\n            : record.paymentMethod === 'cash' \n              ? (record.totalAmount || parseFloat(record.price))\n              : 0,\n          upiAmount: record.upiAmount \n            ? parseFloat(record.upiAmount)\n            : record.paymentMethod === 'upi_online' \n              ? (record.totalAmount || parseFloat(record.price))\n              : 0,\n          totalAmount: record.totalAmount || parseFloat(record.price),\n          bookingIds: [record.id],\n          discount: record.discount || undefined,\n          bonus: record.bonus || undefined,\n          discountApplied: record.discountApplied || undefined,\n          bonusHoursApplied: record.bonusHoursApplied || undefined,\n          paymentStatus: record.paymentStatus || 'unpaid',\n        });\n      }\n    });\n    \n    return Array.from(sessionMap.values());\n  }, [history]);\n\n  const unifiedTransactions = useMemo(() => {\n    if (!history) return [];\n    \n    const bookingTransactions: UnifiedTransaction[] = groupedSessions.map((session) => {\n      let paymentMethod: string | null = null;\n      if (session.cashAmount > 0 && session.upiAmount > 0) {\n        paymentMethod = \"Split\";\n      } else if (session.cashAmount > 0) {\n        paymentMethod = \"Cash\";\n      } else if (session.upiAmount > 0) {\n        paymentMethod = \"UPI\";\n      }\n      \n      return {\n        id: session.id,\n        date: session.date,\n        customerName: session.customerName,\n        seats: session.seats,\n        seatDetails: session.seatDetails,\n        duration: session.duration,\n        sessionPrice: session.sessionPrice,\n        foodAmount: session.foodAmount,\n        cashAmount: session.cashAmount,\n        upiAmount: session.upiAmount,\n        totalAmount: session.totalAmount,\n        paymentMethod,\n        paymentStatus: session.paymentStatus,\n        discount: session.discount,\n        bonus: session.bonus,\n        discountApplied: session.discountApplied,\n        bonusHoursApplied: session.bonusHoursApplied,\n        bookingIds: session.bookingIds,\n      };\n    });\n    \n    bookingTransactions.sort((a, b) => {\n      const dateA = new Date(a.date);\n      const dateB = new Date(b.date);\n      return dateB.getTime() - dateA.getTime();\n    });\n    \n    return bookingTransactions;\n  }, [groupedSessions, history]);\n\n  const filteredTransactions = useMemo(() => {\n    if (!searchQuery.trim()) return unifiedTransactions;\n\n    const query = searchQuery.toLowerCase();\n    return unifiedTransactions.filter(transaction => {\n      const matchesCustomer = transaction.customerName.toLowerCase().includes(query);\n      const matchesDate = transaction.date.toLowerCase().includes(query);\n      const matchesSeats = transaction.seats?.some(seat => seat.toLowerCase().includes(query));\n      const matchesDuration = transaction.duration?.toLowerCase().includes(query);\n      const matchesPaymentMethod = transaction.paymentMethod?.toLowerCase().includes(query);\n      \n      return matchesCustomer || matchesDate || matchesSeats || matchesDuration || matchesPaymentMethod;\n    });\n  }, [unifiedTransactions, searchQuery]);\n\n  const handleExportExcel = () => {\n    if (!filteredTransactions || filteredTransactions.length === 0) {\n      toast({\n        title: \"No data to export\",\n        description: \"There are no transactions for the selected period.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      const headers = [\"Date\", \"Customer\", \"Seat/Duration\", \"Session Price (‚Çπ)\", \"Food (‚Çπ)\", \"Discount\", \"Bonus\", \"Payment Method\", \"Cash (‚Çπ)\", \"UPI (‚Çπ)\", \"Total (‚Çπ)\", \"Status\"];\n      const csvContent = [\n        headers.join(\",\"),\n        ...filteredTransactions.map(transaction => {\n          const seatDurationPairs = transaction.seatDetails\n            ? transaction.seatDetails.map(detail => `${detail.seat} (${detail.duration})`).join(' + ')\n            : transaction.seats?.join(' + ') || '-';\n          \n          return [\n            transaction.date,\n            `\"${transaction.customerName}\"`,\n            `\"${seatDurationPairs}\"`,\n            transaction.sessionPrice?.toFixed(0) || '-',\n            transaction.foodAmount.toFixed(0),\n            transaction.discountApplied || '-',\n            transaction.bonusHoursApplied || '-',\n            transaction.paymentMethod || '-',\n            transaction.cashAmount.toFixed(0),\n            transaction.upiAmount.toFixed(0),\n            transaction.totalAmount.toFixed(0),\n            transaction.paymentStatus || '-'\n          ].join(\",\");\n        })\n      ].join(\"\\n\");\n\n      const blob = new Blob([csvContent], { type: \"text/csv;charset=utf-8;\" });\n      const link = document.createElement(\"a\");\n      const url = URL.createObjectURL(blob);\n      link.setAttribute(\"href\", url);\n      link.setAttribute(\"download\", `transactions_report_${selectedPeriod}_${getAdjustedTime().toISOString().split('T')[0]}.csv`);\n      link.style.visibility = \"hidden\";\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      \n      toast({\n        title: \"Export successful\",\n        description: \"CSV file has been downloaded.\",\n      });\n    } catch (error) {\n      toast({\n        title: \"Export failed\",\n        description: \"Failed to export CSV file. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const getPeriodLabel = () => {\n    switch (selectedPeriod) {\n      case \"daily\": return \"Today's\";\n      case \"weekly\": return \"This Week's\";\n      case \"monthly\": return \"This Month's\";\n      default: return \"Today's\";\n    }\n  };\n\n  const handleExportPDF = () => {\n    if (!filteredTransactions || filteredTransactions.length === 0) {\n      toast({\n        title: \"No data to export\",\n        description: \"There are no transactions for the selected period.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      const printWindow = window.open('', '_blank');\n      if (!printWindow) {\n        toast({\n          title: \"Popup blocked\",\n          description: \"Please allow popups for this site to export PDF.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      const currentDate = new Date().toLocaleString('en-IN', { \n        dateStyle: 'full', \n        timeStyle: 'short',\n        timeZone: 'Asia/Kolkata'\n      });\n      \n      const totalCash = filteredTransactions.reduce((sum, t) => sum + t.cashAmount, 0);\n      const totalUPI = filteredTransactions.reduce((sum, t) => sum + t.upiAmount, 0);\n      const totalRevenue = filteredTransactions.reduce((sum, t) => sum + t.totalAmount, 0);\n\n      const adminName = user?.username || \"Admin\";\n\n      const htmlContent = `\n        <!DOCTYPE html>\n        <html>\n        <head>\n          <title>${adminName} - Transaction Report</title>\n          <style>\n            * { margin: 0; padding: 0; box-sizing: border-box; }\n            body { \n              font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n              background: #f8f9fa;\n              padding: 20px;\n              color: #333;\n            }\n            .container {\n              background: white;\n              max-width: 1200px;\n              margin: 0 auto;\n              border-radius: 8px;\n              overflow: hidden;\n              box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n            }\n            .header {\n              background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);\n              padding: 24px 32px;\n              color: white;\n              border-bottom: 3px solid #6d28d9;\n            }\n            .header-top {\n              display: flex;\n              justify-content: space-between;\n              align-items: flex-start;\n              margin-bottom: 16px;\n            }\n            .company-info h1 {\n              font-size: 24px;\n              font-weight: 600;\n              margin-bottom: 4px;\n            }\n            .company-info p {\n              font-size: 13px;\n              opacity: 0.95;\n            }\n            .admin-info {\n              text-align: right;\n              font-size: 12px;\n              opacity: 0.95;\n            }\n            .admin-info .label {\n              font-weight: 500;\n              margin-bottom: 3px;\n              opacity: 0.85;\n            }\n            .admin-info .name {\n              font-size: 14px;\n              font-weight: 600;\n            }\n            .report-title {\n              font-size: 18px;\n              font-weight: 500;\n              text-align: center;\n              padding: 12px;\n              background: rgba(255,255,255,0.15);\n              border-radius: 6px;\n            }\n            .stats-grid {\n              display: grid;\n              grid-template-columns: repeat(3, 1fr);\n              gap: 16px;\n              padding: 24px 32px;\n              background: #faf5ff;\n            }\n            .stat-card {\n              background: white;\n              padding: 16px;\n              border-radius: 6px;\n              box-shadow: 0 1px 3px rgba(0,0,0,0.05);\n              border-left: 3px solid #7c3aed;\n            }\n            .stat-card h3 {\n              font-size: 12px;\n              color: #6b7280;\n              font-weight: 500;\n              margin-bottom: 8px;\n              text-transform: uppercase;\n              letter-spacing: 0.3px;\n            }\n            .stat-card .value {\n              font-size: 22px;\n              font-weight: 600;\n              color: #7c3aed;\n            }\n            .content {\n              padding: 24px 32px;\n            }\n            .table-wrapper {\n              overflow-x: auto;\n              border-radius: 6px;\n              box-shadow: 0 1px 3px rgba(0,0,0,0.05);\n              border: 1px solid #e5e7eb;\n            }\n            table {\n              width: 100%;\n              border-collapse: collapse;\n              font-size: 12px;\n              background: white;\n            }\n            thead {\n              background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);\n              color: white;\n            }\n            th {\n              padding: 12px 10px;\n              text-align: left;\n              font-weight: 500;\n              font-size: 11px;\n              text-transform: uppercase;\n              letter-spacing: 0.3px;\n            }\n            td {\n              padding: 10px;\n              border-bottom: 1px solid #f3f4f6;\n            }\n            tbody tr {\n              transition: background-color 0.15s;\n            }\n            tbody tr:nth-child(even) {\n              background-color: #faf5ff;\n            }\n            tbody tr:hover {\n              background-color: #f3e8ff;\n            }\n            .text-right {\n              text-align: right;\n            }\n            .badge {\n              display: inline-block;\n              padding: 3px 8px;\n              background: #f3e8ff;\n              border-radius: 4px;\n              margin: 2px;\n              font-size: 10px;\n              font-weight: 500;\n              color: #6d28d9;\n              border: 1px solid #e9d5ff;\n            }\n            .status-badge {\n              display: inline-block;\n              padding: 4px 8px;\n              border-radius: 4px;\n              font-size: 10px;\n              font-weight: 600;\n              text-transform: uppercase;\n            }\n            .status-paid {\n              background: #d1fae5;\n              color: #065f46;\n            }\n            .status-pending {\n              background: #fef3c7;\n              color: #92400e;\n            }\n            .status-partial {\n              background: #dbeafe;\n              color: #1e40af;\n            }\n            .summary {\n              margin-top: 24px;\n              padding: 20px;\n              background: #faf5ff;\n              border-radius: 6px;\n              border: 2px solid #7c3aed;\n            }\n            .summary-grid {\n              display: grid;\n              grid-template-columns: repeat(3, 1fr);\n              gap: 16px;\n            }\n            .summary-item {\n              text-align: center;\n            }\n            .summary-item .label {\n              font-size: 12px;\n              color: #6b7280;\n              font-weight: 500;\n              margin-bottom: 6px;\n              text-transform: uppercase;\n              letter-spacing: 0.3px;\n            }\n            .summary-item .amount {\n              font-size: 20px;\n              font-weight: 700;\n              color: #7c3aed;\n            }\n            .footer {\n              margin-top: 24px;\n              padding-top: 16px;\n              border-top: 1px solid #e5e7eb;\n              text-align: center;\n              color: #6b7280;\n              font-size: 11px;\n            }\n            .footer .powered {\n              margin-top: 8px;\n              font-size: 10px;\n              color: #9ca3af;\n            }\n            @media print {\n              body { \n                padding: 0;\n                background: white;\n              }\n              .container {\n                box-shadow: none;\n              }\n            }\n          </style>\n        </head>\n        <body>\n          <div class=\"container\">\n            <div class=\"header\">\n              <div class=\"header-top\">\n                <div class=\"company-info\">\n                  <h1>${adminName}</h1>\n                  <p>Staff Panel - Transaction Reports</p>\n                </div>\n                <div class=\"admin-info\">\n                  <div class=\"label\">Generated By</div>\n                  <div class=\"name\">${adminName}</div>\n                  <div style=\"margin-top: 6px; font-size: 11px; opacity: 0.85;\">${currentDate}</div>\n                </div>\n              </div>\n              <div class=\"report-title\">\n                ${getPeriodLabel()} Transaction Report\n              </div>\n            </div>\n\n            <div class=\"stats-grid\">\n              <div class=\"stat-card\">\n                <h3>üí∞ Total Revenue</h3>\n                <div class=\"value\">‚Çπ${stats?.totalRevenue.toLocaleString() || 0}</div>\n              </div>\n              <div class=\"stat-card\">\n                <h3>üéÆ Total Sessions</h3>\n                <div class=\"value\">${stats?.totalSessions || 0}</div>\n              </div>\n              <div class=\"stat-card\">\n                <h3>‚è±Ô∏è Avg Session</h3>\n                <div class=\"value\">${stats?.avgSessionMinutes || 0} min</div>\n              </div>\n            </div>\n\n            <div class=\"content\">\n              <div class=\"table-wrapper\">\n                <table>\n                  <thead>\n                    <tr>\n                      <th>Date</th>\n                      <th>Customer</th>\n                      <th>Seat/Duration</th>\n                      <th class=\"text-right\">Session</th>\n                      <th class=\"text-right\">Food</th>\n                      <th class=\"text-right\">Discount</th>\n                      <th class=\"text-right\">Bonus</th>\n                      <th class=\"text-right\">Payment</th>\n                      <th class=\"text-right\">Cash</th>\n                      <th class=\"text-right\">UPI</th>\n                      <th class=\"text-right\">Total</th>\n                      <th>Status</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    ${filteredTransactions.map(transaction => {\n                      const detailsDisplay = transaction.seatDetails \n                        ? transaction.seatDetails.map(d => `<span class=\"badge\">${d.seat} (${d.duration})</span>`).join(' ')\n                        : transaction.seats?.map(s => `<span class=\"badge\">${s}</span>`).join(' ') || '-';\n                      \n                      const statusClass = transaction.paymentStatus === 'Paid' ? 'status-paid' \n                        : transaction.paymentStatus === 'Pending' ? 'status-pending' \n                        : 'status-partial';\n                      \n                      return `\n                        <tr>\n                          <td>${transaction.date}</td>\n                          <td><strong>${transaction.customerName}</strong></td>\n                          <td>${detailsDisplay}</td>\n                          <td class=\"text-right\">${transaction.sessionPrice ? '‚Çπ' + transaction.sessionPrice.toFixed(0) : '-'}</td>\n                          <td class=\"text-right\">${transaction.foodAmount > 0 ? '‚Çπ' + transaction.foodAmount.toFixed(0) : '-'}</td>\n                          <td class=\"text-right\">${transaction.discountApplied || '-'}</td>\n                          <td class=\"text-right\">${transaction.bonusHoursApplied || '-'}</td>\n                          <td class=\"text-right\">${transaction.paymentMethod || '-'}</td>\n                          <td class=\"text-right\">${transaction.cashAmount > 0 ? '‚Çπ' + transaction.cashAmount.toFixed(0) : '-'}</td>\n                          <td class=\"text-right\">${transaction.upiAmount > 0 ? '‚Çπ' + transaction.upiAmount.toFixed(0) : '-'}</td>\n                          <td class=\"text-right\"><strong style=\"color: #7c3aed;\">‚Çπ${transaction.totalAmount.toFixed(0)}</strong></td>\n                          <td><span class=\"status-badge ${statusClass}\">${transaction.paymentStatus || 'N/A'}</span></td>\n                        </tr>\n                      `;\n                    }).join('')}\n                  </tbody>\n                </table>\n              </div>\n\n              <div class=\"summary\">\n                <div class=\"summary-grid\">\n                  <div class=\"summary-item\">\n                    <div class=\"label\">üíµ Total Cash</div>\n                    <div class=\"amount\">‚Çπ${totalCash.toLocaleString()}</div>\n                  </div>\n                  <div class=\"summary-item\">\n                    <div class=\"label\">üì± Total UPI</div>\n                    <div class=\"amount\">‚Çπ${totalUPI.toLocaleString()}</div>\n                  </div>\n                  <div class=\"summary-item\">\n                    <div class=\"label\">üí∞ Grand Total</div>\n                    <div class=\"amount\">‚Çπ${totalRevenue.toLocaleString()}</div>\n                  </div>\n                </div>\n              </div>\n\n              <div class=\"footer\">\n                <strong>Confidential Report</strong><br>\n                This report contains ${filteredTransactions.length} transaction(s) for ${getPeriodLabel().toLowerCase()} period\n                <div class=\"powered\">Provided by Airavoto Gaming</div>\n              </div>\n            </div>\n          </div>\n\n          <script>\n            window.onload = () => {\n              setTimeout(() => {\n                window.print();\n                setTimeout(() => {\n                  window.close();\n                }, 1000);\n              }, 500);\n            };\n            window.onafterprint = () => {\n              window.close();\n            };\n            window.onbeforeunload = null;\n          </script>\n        </body>\n        </html>\n      `;\n\n      printWindow.document.write(htmlContent);\n      printWindow.document.close();\n      \n      printWindow.onload = () => {\n        printWindow.print();\n      };\n      \n      toast({\n        title: \"Print dialog opened\",\n        description: \"Use the print dialog to save as PDF.\",\n      });\n    } catch (error) {\n      toast({\n        title: \"Export failed\",\n        description: \"Failed to open print dialog. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  return (\n    <div className=\"space-y-4 md:space-y-6\">\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3\">\n        <div>\n          <h1 className=\"text-2xl sm:text-3xl font-bold text-foreground\">Reports</h1>\n          <p className=\"text-sm sm:text-base text-muted-foreground\">Track revenue, bookings and customer retention</p>\n        </div>\n      </div>\n\n      <Tabs defaultValue=\"reports\" value={mainTab} onValueChange={setMainTab}>\n        <TabsList data-testid=\"tabs-main\" className=\"w-full sm:w-auto grid grid-cols-2 sm:inline-flex\">\n          <TabsTrigger value=\"reports\" data-testid=\"tab-reports\">\n            <Calendar className=\"h-4 w-4 mr-2\" />\n            Revenue Reports\n          </TabsTrigger>\n          <TabsTrigger value=\"retention\" data-testid=\"tab-retention\">\n            <TrendingUp className=\"h-4 w-4 mr-2\" />\n            Customer Retention\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"reports\" className=\"space-y-4 mt-4\">\n          <div className=\"flex gap-2\">\n            <Button variant=\"outline\" onClick={handleExportExcel} data-testid=\"button-export-excel\" size=\"sm\" className=\"flex-1 sm:flex-none\">\n              <Download className=\"mr-1 sm:mr-2 h-4 w-4\" />\n              <span className=\"hidden sm:inline\">Export </span>Excel\n            </Button>\n            <Button variant=\"outline\" onClick={handleExportPDF} data-testid=\"button-export-pdf\" size=\"sm\" className=\"flex-1 sm:flex-none\">\n              <Download className=\"mr-1 sm:mr-2 h-4 w-4\" />\n              <span className=\"hidden sm:inline\">Export </span>PDF\n            </Button>\n          </div>\n\n          <Tabs defaultValue=\"daily\" value={selectedPeriod} onValueChange={(value) => {\n        setSelectedPeriod(value);\n        setStartDate(\"\");\n        setEndDate(\"\");\n        setSelectedMonth(\"\");\n      }}>\n        <TabsList data-testid=\"tabs-period\" className=\"w-full sm:w-auto grid grid-cols-3 sm:inline-flex\">\n          <TabsTrigger value=\"daily\" data-testid=\"tab-daily\">Daily</TabsTrigger>\n          <TabsTrigger value=\"weekly\" data-testid=\"tab-weekly\">Weekly</TabsTrigger>\n          <TabsTrigger value=\"monthly\" data-testid=\"tab-monthly\">Monthly</TabsTrigger>\n        </TabsList>\n\n        {selectedPeriod === \"weekly\" && (\n          <div className=\"glass-card p-4 rounded-lg mt-4\">\n            <Label className=\"text-sm font-semibold mb-3 block\">Select Date Range</Label>\n            <div className=\"flex flex-col sm:flex-row gap-3\">\n              <div className=\"flex-1\">\n                <Label htmlFor=\"start-date\" className=\"text-xs text-muted-foreground\">Start Date</Label>\n                <Input\n                  id=\"start-date\"\n                  type=\"date\"\n                  value={startDate}\n                  onChange={(e) => setStartDate(e.target.value)}\n                  className=\"mt-1\"\n                  data-testid=\"input-start-date\"\n                />\n              </div>\n              <div className=\"flex-1\">\n                <Label htmlFor=\"end-date\" className=\"text-xs text-muted-foreground\">End Date</Label>\n                <Input\n                  id=\"end-date\"\n                  type=\"date\"\n                  value={endDate}\n                  onChange={(e) => setEndDate(e.target.value)}\n                  className=\"mt-1\"\n                  data-testid=\"input-end-date\"\n                />\n              </div>\n              {startDate && endDate && (\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => {\n                    setStartDate(\"\");\n                    setEndDate(\"\");\n                  }}\n                  className=\"self-end\"\n                  data-testid=\"button-clear-date-range\"\n                >\n                  Clear\n                </Button>\n              )}\n            </div>\n          </div>\n        )}\n\n        {selectedPeriod === \"monthly\" && (\n          <div className=\"glass-card p-4 rounded-lg mt-4\">\n            <Label htmlFor=\"month-select\" className=\"text-sm font-semibold mb-2 block\">\n              <Calendar className=\"inline-block mr-2 h-4 w-4\" />\n              Select Month & Year\n            </Label>\n            <div className=\"flex flex-col sm:flex-row gap-3\">\n              <div className=\"flex-1\">\n                <Input\n                  id=\"month-select\"\n                  type=\"month\"\n                  value={selectedMonth}\n                  onChange={(e) => setSelectedMonth(e.target.value)}\n                  className=\"w-full\"\n                  placeholder=\"Choose a month\"\n                  data-testid=\"input-select-month\"\n                />\n              </div>\n              {selectedMonth && (\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => setSelectedMonth(\"\")}\n                  className=\"self-start sm:self-center\"\n                  data-testid=\"button-clear-month\"\n                >\n                  Clear\n                </Button>\n              )}\n            </div>\n          </div>\n        )}\n\n        <TabsContent value={selectedPeriod} className=\"space-y-4\">\n          <div className=\"grid gap-3 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4\">\n            {statsLoading ? (\n              <>\n                <Skeleton className=\"h-32\" />\n                <Skeleton className=\"h-32\" />\n                <Skeleton className=\"h-32\" />\n                <Skeleton className=\"h-32\" />\n              </>\n            ) : (\n              <>\n                <RevenueCard\n                  title={`${getPeriodLabel()} Session Revenue`}\n                  amount={stats?.totalRevenue || 0}\n                  trend={0}\n                  icon={<IndianRupee className=\"h-4 w-4 text-muted-foreground\" />}\n                />\n                <RevenueCard\n                  title={`${getPeriodLabel()} Food Revenue`}\n                  amount={stats?.totalFoodRevenue || 0}\n                  trend={0}\n                  icon={<IndianRupee className=\"h-4 w-4 text-muted-foreground\" />}\n                />\n                <RevenueCard\n                  title=\"Total Sessions\"\n                  amount={stats?.totalSessions || 0}\n                  trend={0}\n                  icon={<Users className=\"h-4 w-4 text-muted-foreground\" />}\n                  showCurrency={false}\n                />\n                <RevenueCard\n                  title=\"Avg Session Time\"\n                  amount={stats?.avgSessionMinutes || 0}\n                  trend={0}\n                  icon={<Clock className=\"h-4 w-4 text-muted-foreground\" />}\n                  showCurrency={false}\n                  suffix=\" mins\"\n                />\n              </>\n            )}\n          </div>\n\n          <div className=\"grid gap-3 grid-cols-1 sm:grid-cols-2\">\n            {statsLoading ? (\n              <>\n                <Skeleton className=\"h-32\" />\n                <Skeleton className=\"h-32\" />\n              </>\n            ) : (\n              <>\n                <RevenueCard\n                  title=\"Cash Revenue\"\n                  amount={stats?.cashRevenue || 0}\n                  trend={0}\n                  icon={<IndianRupee className=\"h-4 w-4 text-green-600 dark:text-green-400\" />}\n                />\n                <RevenueCard\n                  title=\"UPI/Online Revenue\"\n                  amount={stats?.upiRevenue || 0}\n                  trend={0}\n                  icon={<IndianRupee className=\"h-4 w-4 text-blue-600 dark:text-blue-400\" />}\n                />\n              </>\n            )}\n          </div>\n        </TabsContent>\n      </Tabs>\n\n      <div className=\"space-y-4\">\n        <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3\">\n          <h2 className=\"text-lg sm:text-xl font-semibold\">Transactions History</h2>\n          <div className=\"flex gap-2 flex-1 max-w-2xl\">\n            <div className=\"relative flex-1\">\n              <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n              <Input\n                type=\"text\"\n                placeholder=\"Search by customer, seat, payment method...\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className=\"pl-9\"\n                data-testid=\"input-search-transactions\"\n              />\n            </div>\n            <ColumnVisibilityToggle\n              columns={reportColumns}\n              storageKey=\"reports-visible-columns\"\n              onVisibilityChange={handleVisibilityChange}\n            />\n          </div>\n        </div>\n        <div className=\"rounded-md border overflow-x-auto\">\n          <Table>\n            <TableHeader>\n              <TableRow>\n                {visibleColumns.includes(\"date\") && <TableHead>Date</TableHead>}\n                {visibleColumns.includes(\"customer\") && <TableHead>Customer</TableHead>}\n                {visibleColumns.includes(\"seats\") && <TableHead>Seat/Duration</TableHead>}\n                {visibleColumns.includes(\"duration\") && <TableHead>Duration</TableHead>}\n                {visibleColumns.includes(\"sessionPrice\") && <TableHead className=\"text-right\">Session Price</TableHead>}\n                {visibleColumns.includes(\"foodAmount\") && <TableHead className=\"text-right\">Food</TableHead>}\n                {visibleColumns.includes(\"discount\") && <TableHead className=\"text-right\">Discount</TableHead>}\n                {visibleColumns.includes(\"bonus\") && <TableHead className=\"text-right\">Bonus</TableHead>}\n                {visibleColumns.includes(\"paymentMethod\") && <TableHead>Payment Method</TableHead>}\n                {visibleColumns.includes(\"cash\") && <TableHead className=\"text-right\">Cash</TableHead>}\n                {visibleColumns.includes(\"upi\") && <TableHead className=\"text-right\">UPI</TableHead>}\n                {visibleColumns.includes(\"total\") && <TableHead className=\"text-right\">Total</TableHead>}\n                {visibleColumns.includes(\"status\") && <TableHead>Status</TableHead>}\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {historyLoading ? (\n                <TableRow>\n                  <TableCell colSpan={visibleColumns.length}>\n                    <Skeleton className=\"h-10 w-full\" />\n                  </TableCell>\n                </TableRow>\n              ) : filteredTransactions && filteredTransactions.length > 0 ? (\n                filteredTransactions.map((transaction) => (\n                  <TableRow key={transaction.id} data-testid={`row-transaction-${transaction.id}`}>\n                    {visibleColumns.includes(\"date\") && (\n                      <TableCell data-testid={`text-date-${transaction.id}`}>{transaction.date}</TableCell>\n                    )}\n                    {visibleColumns.includes(\"customer\") && (\n                      <TableCell className=\"font-medium\" data-testid={`text-customer-${transaction.id}`}>\n                        {transaction.customerName}\n                      </TableCell>\n                    )}\n                    {visibleColumns.includes(\"seats\") && (\n                      <TableCell data-testid={`text-seats-${transaction.id}`}>\n                        {transaction.seatDetails && transaction.seatDetails.length > 0 ? (\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => setViewSeatsDialog({ open: true, seatDetails: transaction.seatDetails! })}\n                            data-testid={`button-view-seats-${transaction.id}`}\n                          >\n                            <Eye className=\"mr-2 h-4 w-4\" />\n                            View ({transaction.seatDetails.length})\n                          </Button>\n                        ) : (\n                          <span className=\"text-muted-foreground text-xs\">-</span>\n                        )}\n                      </TableCell>\n                    )}\n                    {visibleColumns.includes(\"duration\") && (\n                      <TableCell data-testid={`text-duration-${transaction.id}`}>\n                        {transaction.duration || <span className=\"text-muted-foreground text-xs\">-</span>}\n                      </TableCell>\n                    )}\n                    {visibleColumns.includes(\"sessionPrice\") && (\n                      <TableCell className=\"text-right\" data-testid={`text-session-price-${transaction.id}`}>\n                        {transaction.sessionPrice ? `‚Çπ${transaction.sessionPrice.toFixed(0)}` : <span className=\"text-muted-foreground text-xs\">-</span>}\n                      </TableCell>\n                    )}\n                    {visibleColumns.includes(\"foodAmount\") && (\n                      <TableCell className=\"text-right\" data-testid={`text-food-amount-${transaction.id}`}>\n                        {transaction.foodAmount > 0 ? `‚Çπ${transaction.foodAmount.toFixed(0)}` : <span className=\"text-muted-foreground text-xs\">-</span>}\n                      </TableCell>\n                    )}\n                    {visibleColumns.includes(\"discount\") && (\n                      <TableCell className=\"text-right\" data-testid={`text-discount-${transaction.id}`}>\n                        {transaction.discountApplied || <span className=\"text-muted-foreground text-xs\">-</span>}\n                      </TableCell>\n                    )}\n                    {visibleColumns.includes(\"bonus\") && (\n                      <TableCell className=\"text-right\" data-testid={`text-bonus-${transaction.id}`}>\n                        {transaction.bonusHoursApplied ? (\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => setViewBonusDialog({ open: true, bonusHours: transaction.bonusHoursApplied! })}\n                            data-testid={`button-view-bonus-${transaction.id}`}\n                          >\n                            <Eye className=\"mr-2 h-4 w-4\" />\n                            View\n                          </Button>\n                        ) : (\n                          <span className=\"text-muted-foreground text-xs\">-</span>\n                        )}\n                      </TableCell>\n                    )}\n                    {visibleColumns.includes(\"paymentMethod\") && (\n                      <TableCell data-testid={`text-payment-method-${transaction.id}`}>\n                        {transaction.paymentMethod ? (\n                          <span className={`inline-flex items-center px-2 py-1 rounded-md text-xs font-medium ${\n                            transaction.paymentMethod === 'Cash' \n                              ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400' \n                              : transaction.paymentMethod === 'UPI'\n                              ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400'\n                              : transaction.paymentMethod === 'Split'\n                              ? 'bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400'\n                              : 'bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-400'\n                          }`}>\n                            {transaction.paymentMethod}\n                          </span>\n                        ) : (\n                          <span className=\"text-muted-foreground text-xs\">-</span>\n                        )}\n                      </TableCell>\n                    )}\n                    {visibleColumns.includes(\"cash\") && (\n                      <TableCell className=\"text-right\" data-testid={`text-cash-${transaction.id}`}>\n                        {transaction.cashAmount > 0 ? (\n                          <span className=\"text-green-600 dark:text-green-400\">‚Çπ{transaction.cashAmount.toFixed(0)}</span>\n                        ) : (\n                          <span className=\"text-muted-foreground text-xs\">-</span>\n                        )}\n                      </TableCell>\n                    )}\n                    {visibleColumns.includes(\"upi\") && (\n                      <TableCell className=\"text-right\" data-testid={`text-upi-${transaction.id}`}>\n                        {transaction.upiAmount > 0 ? (\n                          <span className=\"text-blue-600 dark:text-blue-400\">‚Çπ{transaction.upiAmount.toFixed(0)}</span>\n                        ) : (\n                          <span className=\"text-muted-foreground text-xs\">-</span>\n                        )}\n                      </TableCell>\n                    )}\n                    {visibleColumns.includes(\"total\") && (\n                      <TableCell className=\"text-right font-bold\" data-testid={`text-total-${transaction.id}`}>\n                        ‚Çπ{transaction.totalAmount.toFixed(0)}\n                      </TableCell>\n                    )}\n                    {visibleColumns.includes(\"status\") && (\n                      <TableCell data-testid={`text-status-${transaction.id}`}>\n                        {transaction.paymentStatus ? (\n                          <span className={`inline-flex items-center px-2 py-1 rounded-md text-xs font-medium ${\n                            transaction.paymentStatus === 'paid' \n                              ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400' \n                              : transaction.paymentStatus === 'unpaid'\n                              ? 'bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400'\n                              : transaction.paymentStatus === 'partial'\n                              ? 'bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400'\n                              : 'bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-400'\n                          }`}>\n                            {transaction.paymentStatus.charAt(0).toUpperCase() + transaction.paymentStatus.slice(1)}\n                          </span>\n                        ) : (\n                          <span className=\"text-muted-foreground text-xs\">-</span>\n                        )}\n                      </TableCell>\n                    )}\n                  </TableRow>\n                ))\n              ) : (\n                <TableRow>\n                  <TableCell colSpan={visibleColumns.length} className=\"text-center text-muted-foreground\">\n                    {searchQuery.trim() ? 'No transactions found matching your search' : 'No transactions for this period'}\n                  </TableCell>\n                </TableRow>\n              )}\n            </TableBody>\n          </Table>\n        </div>\n      </div>\n\n      <Dialog open={viewSeatsDialog.open} onOpenChange={(open) => setViewSeatsDialog({ open, seatDetails: [] })}>\n        <DialogContent data-testid=\"dialog-view-seats\">\n          <DialogHeader>\n            <DialogTitle>Seat Duration Details</DialogTitle>\n            <DialogDescription>\n              View the PC/seat duration breakdown for this booking session\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-3\">\n            <div className=\"space-y-2\">\n              {viewSeatsDialog.seatDetails.map((detail, idx) => (\n                <div \n                  key={idx}\n                  className=\"flex items-center justify-between px-4 py-3 bg-card border rounded-md\"\n                  data-testid={`seat-detail-${idx}`}\n                >\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"px-3 py-1 bg-primary/10 text-primary rounded-md font-semibold text-sm\">\n                      {detail.seat}\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                    <Clock className=\"h-4 w-4\" />\n                    <span className=\"font-medium\">{detail.duration}</span>\n                  </div>\n                </div>\n              ))}\n            </div>\n            {viewSeatsDialog.seatDetails.length > 1 && (\n              <p className=\"text-sm text-muted-foreground border-t pt-3\">\n                Total Seats: {viewSeatsDialog.seatDetails.length}\n              </p>\n            )}\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={viewBonusDialog.open} onOpenChange={(open) => setViewBonusDialog({ open, bonusHours: '' })}>\n        <DialogContent data-testid=\"dialog-view-bonus\">\n          <DialogHeader>\n            <DialogTitle>Bonus Free Hours</DialogTitle>\n            <DialogDescription>\n              Free hours given for this booking session\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-3\">\n            <div className=\"flex justify-center\">\n              <div className=\"px-6 py-4 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded-md font-semibold text-lg\">\n                {viewBonusDialog.bonusHours}\n              </div>\n            </div>\n            <p className=\"text-sm text-muted-foreground text-center\">\n              This session received free bonus hours\n            </p>\n          </div>\n        </DialogContent>\n      </Dialog>\n        </TabsContent>\n\n        <TabsContent value=\"retention\" className=\"mt-4\">\n          <RetentionCharts />\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","path":null,"size_bytes":50136,"size_tokens":null},"SECURITY.md":{"content":"# Security Documentation\n\nThis application implements enterprise-grade security measures following industry best practices and OWASP guidelines.\n\n## üîê Security Features Implemented\n\n### 1. **Authentication & Session Management**\n\n#### Password Security\n- Bcrypt hashing with 10 salt rounds\n- Passwords never stored in plaintext\n- Generic error messages prevent username enumeration\n- Session regeneration on login prevents session fixation\n\n#### Session Security\n- PostgreSQL-backed sessions with connect-pg-simple\n- **HttpOnly** cookies prevent XSS theft\n- **SameSite: lax** for CSRF protection (required for OAuth flows)\n- **Secure** flag enforces HTTPS in production\n- 7-day session lifetime with automatic cleanup\n- Session regeneration on authentication prevents fixation\n\n#### Two-Step Authentication (Optional)\n- Google OAuth integration\n- Staff/Admin username+password required\n- IP address tracking in activity logs\n\n#### Role-Based Access Control\n- `requireAuth`: Any authenticated user\n- `requireAdminOrStaff`: Staff and admin roles\n- `requireAdmin`: Admin-only operations\n\n### 2. **Advanced Rate Limiting**\n\n#### Login Protection\n- **5 attempts per 15 minutes** per IP\n- Prevents brute-force attacks\n- Automatic cooldown period\n\n#### Sensitive Operations\n- **20 requests per minute** per IP\n- Applied to payment and credit endpoints\n- Protects financial transactions\n\n#### Webhook Protection\n- **30 requests per minute** per IP\n- Prevents webhook abuse\n\n#### Public API\n- **60 requests per minute** per IP\n- General API protection\n\n#### Data Export\n- **10 exports per 5 minutes**\n- Prevents data scraping\n\n### 3. **HTTP Security Headers (Helmet.js)**\n\n#### Content Security Policy (CSP)\n**Note:** CSP is disabled in development for Vite HMR compatibility. In production:\n```javascript\ndefaultSrc: [\"'self'\"]\nscriptSrc: [\"'self'\"]  // No unsafe-inline or unsafe-eval\nstyleSrc: [\"'self'\", \"fonts.googleapis.com\"]\nfontSrc: [\"'self'\", \"fonts.gstatic.com\", \"data:\"]\nimgSrc: [\"'self'\", \"data:\", \"https:\", \"blob:\"]\nconnectSrc: [\"'self'\"]  // May need adjustment for external APIs\nframeSrc: [\"'none'\"]\nobjectSrc: [\"'none'\"]\nupgradeInsecureRequests: enabled\n```\n**Important:** If your app makes API calls to external services, you'll need to whitelist those domains in `connectSrc`.\n\n#### HTTP Strict Transport Security (HSTS)\n- **Max-Age**: 1 year (31536000 seconds)\n- **includeSubDomains**: true\n- **preload**: true\n\n#### Additional Protection\n- **X-Frame-Options**: DENY (prevents clickjacking)\n- **X-Content-Type-Options**: nosniff\n- **X-XSS-Protection**: enabled\n- **Referrer-Policy**: strict-origin-when-cross-origin\n- **X-Powered-By**: removed (reduces fingerprinting)\n\n### 4. **Input Validation & Protection**\n\n#### Request Size Limits\n- **JSON payload**: 1MB maximum\n- **URL-encoded**: 1MB maximum\n- Prevents DOS attacks via payload bombs\n\n#### Schema Validation\n- Zod schema validation on all API endpoints\n- Type-safe input validation with Drizzle ORM\n- Parameterized queries prevent SQL injection\n- Comprehensive error messages in development only\n\n### 5. **HTTPS Enforcement**\n\n- **Automatic HTTPS redirect** for GET/HEAD requests in production\n- Checks both `x-forwarded-proto` header and `req.protocol`\n- **301 permanent redirect** to HTTPS for page loads\n- Skips API endpoints to avoid issues with POST data\n- Compatible with reverse proxies (Nginx, load balancers)\n\n### 6. **Activity Logging**\n\n#### Built-in Activity Log System\nThe application includes a comprehensive activity log system that tracks:\n- User logins (with IP address logged in login handler)\n- Administrative actions via createActivityLog\n- Database changes through storage layer\n- Payment and booking modifications\n- Configuration updates\n\nAll activity logs are stored in the database and can be reviewed by administrators through the activity log page.\n\n## üöÄ Setting Up Admin Credentials\n\n### Initial Setup\n\n**IMPORTANT:** You must set admin credentials via environment variables to create the initial admin user.\n\n1. **Create a `.env` file in your project root:**\n\n```env\n# Admin credentials (REQUIRED for first-time setup)\nADMIN_USERNAME=your_admin_username\nADMIN_PASSWORD=your_secure_password\n\n# Session secret (REQUIRED for production)\nSESSION_SECRET=your_random_session_secret_at_least_32_characters\n\n# Database (already configured by Replit)\nDATABASE_URL=your_database_url\n```\n\n2. **Password Requirements:**\n- Minimum 8 characters (enforced with warning)\n- Use a strong, unique password\n- Do NOT use common passwords like \"admin123\"\n\n3. **Generate a Strong Session Secret:**\n```bash\n# Run this in the Shell to generate a random secret:\nnode -e \"console.log(require('crypto').randomBytes(32).toString('hex'))\"\n```\n\n### Creating Admin User\n\nThe application will automatically create an admin user on first startup **ONLY IF**:\n- No users exist in the database\n- `ADMIN_USERNAME` and `ADMIN_PASSWORD` environment variables are set\n\nCheck the console logs for confirmation:\n- ‚úÖ Success: \"Admin user created with username: your_username\"\n- ‚ö†Ô∏è Warning: \"No admin user exists and ADMIN_USERNAME/ADMIN_PASSWORD are not set!\"\n\n## üîí Security Best Practices\n\n### For Development\n1. Always use unique passwords (never reuse)\n2. Set `SESSION_SECRET` environment variable\n3. Review security warnings in console logs\n\n### For Production\n1. **MUST** set strong `SESSION_SECRET` (32+ random characters)\n2. **MUST** use HTTPS (secure cookies enabled automatically)\n3. **MUST** use strong admin password (12+ characters, mixed case, numbers, symbols)\n4. Consider IP whitelisting for admin panel\n5. Regularly update dependencies for security patches\n6. Monitor failed login attempts\n7. Enable database backups\n\n## üìù Default Credentials - REMOVED\n\n**Previous versions had default credentials (admin/admin123) - these have been REMOVED for security.**\n\nYou MUST now set credentials via environment variables. The app will not create an admin user without them.\n\n## üîç Testing Authentication\n\n1. **Test login with correct credentials:**\n   - Enter username and password set in `.env`\n   - Should redirect to dashboard on success\n\n2. **Test login with wrong credentials:**\n   - Enter incorrect password\n   - Should show \"Invalid username or password\" error\n\n3. **Test rate limiting:**\n   - Try logging in with wrong password 5+ times\n   - Should show \"Too many login attempts\" message\n\n4. **Test session persistence:**\n   - Log in successfully\n   - Refresh the page\n   - Should remain logged in (session valid)\n\n5. **Test logout:**\n   - Click lock icon in header\n   - Should return to login screen\n   - Session should be destroyed\n\n## üõ°Ô∏è Additional Security Recommendations\n\n1. **Add Two-Factor Authentication (2FA)** - For enhanced security\n2. **Add password reset functionality** - Via email verification\n3. **Implement account lockout** - After multiple failed attempts\n4. **Add audit logging** - Track all admin actions\n5. **Add IP-based access control** - Restrict admin panel to specific IPs\n6. **Implement HTTPS** - Always use SSL/TLS in production\n\n## üêõ Troubleshooting\n\n### Cannot Login\n- Check that `ADMIN_USERNAME` and `ADMIN_PASSWORD` are set in `.env`\n- Verify the admin user was created (check console logs)\n- Try resetting the session: clear browser cookies\n- Check for rate limiting (wait 15 minutes if blocked)\n\n### 401 Unauthorized Errors\n- Session may have expired (24-hour lifetime)\n- Log in again to create new session\n- Check that authentication middleware is configured correctly\n\n### Admin User Not Created\n- Verify `.env` file exists and has correct variables\n- Check console for warning messages\n- Ensure database is accessible\n- Try restarting the application\n\n## üìö API Endpoints\n\n### Authentication Endpoints (Public)\n- `POST /api/auth/login` - Login with username/password\n- `POST /api/auth/logout` - Logout and destroy session\n- `GET /api/auth/me` - Get current user (requires auth)\n\n### Protected Endpoints (Require Authentication)\nAll other `/api/*` endpoints require valid authentication session.\n\n## üîÑ Updating This Document\n\nAs you add more security features, update this document to reflect the changes and keep your team informed of security practices.\n","path":null,"size_bytes":8195,"size_tokens":null},"client/src/pages/PaymentReconciliation.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useState, useMemo } from \"react\";\nimport { format } from \"date-fns\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Calendar, User, Wallet, Clock, TrendingUp, Search } from \"lucide-react\";\nimport { useAuth } from \"@/contexts/AuthContext\";\n\ntype PaymentLog = {\n  id: string;\n  bookingId: string;\n  seatName: string;\n  customerName: string;\n  amount: string;\n  paymentMethod: string;\n  paymentStatus: string;\n  userId: string;\n  username: string;\n  previousStatus: string | null;\n  previousMethod: string | null;\n  createdAt: Date;\n};\n\nexport default function PaymentReconciliation() {\n  const [selectedDate, setSelectedDate] = useState(() => format(new Date(), 'yyyy-MM-dd'));\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const { isStaff } = useAuth();\n\n  const { data: logs = [], isLoading } = useQuery<PaymentLog[]>({\n    queryKey: [`/api/payment-logs?date=${selectedDate}`],\n  });\n\n  const filteredLogs = useMemo(() => {\n    if (!searchQuery) return logs;\n    \n    const query = searchQuery.toLowerCase();\n    return logs.filter(log => \n      log.seatName.toLowerCase().includes(query) ||\n      log.customerName.toLowerCase().includes(query) ||\n      log.paymentMethod.toLowerCase().includes(query) ||\n      log.paymentStatus.toLowerCase().includes(query) ||\n      log.username.toLowerCase().includes(query) ||\n      log.amount.includes(query)\n    );\n  }, [logs, searchQuery]);\n\n  const cashTotal = filteredLogs\n    .filter(log => log.paymentMethod === 'cash')\n    .reduce((sum, log) => sum + parseFloat(log.amount || '0'), 0);\n  const upiTotal = filteredLogs\n    .filter(log => log.paymentMethod === 'upi_online')\n    .reduce((sum, log) => sum + parseFloat(log.amount || '0'), 0);\n  const actualCollected = cashTotal + upiTotal;\n\n  const getPaymentMethodBadge = (method: string) => {\n    switch (method) {\n      case 'cash':\n        return <Badge variant=\"outline\" className=\"bg-green-500/10 text-green-700 dark:text-green-400\">Cash</Badge>;\n      case 'upi_online':\n        return <Badge variant=\"outline\" className=\"bg-blue-500/10 text-blue-700 dark:text-blue-400\">UPI/Online</Badge>;\n      default:\n        return <Badge variant=\"outline\">{method}</Badge>;\n    }\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case 'paid':\n        return <Badge variant=\"outline\" className=\"bg-green-500/10 text-green-700 dark:text-green-400\">Paid</Badge>;\n      case 'pending':\n        return <Badge variant=\"outline\" className=\"bg-yellow-500/10 text-yellow-700 dark:text-yellow-400\">Pending</Badge>;\n      case 'unpaid':\n        return <Badge variant=\"outline\" className=\"bg-red-500/10 text-red-700 dark:text-red-400\">Unpaid</Badge>;\n      default:\n        return <Badge variant=\"outline\">{status}</Badge>;\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h1 className=\"text-3xl font-bold text-foreground\">Payment Reconciliation</h1>\n        <p className=\"text-muted-foreground\">Review all payment actions and transactions</p>\n      </div>\n\n      <div className={`grid gap-4 ${isStaff ? 'md:grid-cols-2' : 'md:grid-cols-3'}`}>\n        {!isStaff && (\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Total Collected</CardTitle>\n              <TrendingUp className=\"h-4 w-4 text-muted-foreground\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold text-green-600 dark:text-green-400\">‚Çπ{actualCollected.toFixed(2)}</div>\n              <p className=\"text-xs text-muted-foreground\">Cash + UPI</p>\n            </CardContent>\n          </Card>\n        )}\n\n        {!isStaff && (\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Cash</CardTitle>\n              <Wallet className=\"h-4 w-4 text-green-600 dark:text-green-400\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">‚Çπ{cashTotal.toFixed(2)}</div>\n              <p className=\"text-xs text-muted-foreground\">\n                {filteredLogs.filter(l => l.paymentMethod === 'cash').length} payments\n              </p>\n            </CardContent>\n          </Card>\n        )}\n\n        {!isStaff && (\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">UPI/Online</CardTitle>\n              <Wallet className=\"h-4 w-4 text-blue-600 dark:text-blue-400\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">‚Çπ{upiTotal.toFixed(2)}</div>\n              <p className=\"text-xs text-muted-foreground\">\n                {filteredLogs.filter(l => l.paymentMethod === 'upi_online').length} payments\n              </p>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Payment Logs</CardTitle>\n          <CardDescription>Filter by date and search transactions</CardDescription>\n          <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-3 pt-4\">\n            <div className=\"flex items-center gap-2 w-full sm:w-auto\">\n              <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n              <Input\n                type=\"date\"\n                value={selectedDate}\n                onChange={(e) => setSelectedDate(e.target.value)}\n                className=\"max-w-xs\"\n                data-testid=\"input-date-filter\"\n              />\n            </div>\n            <div className=\"flex items-center gap-2 w-full sm:flex-1\">\n              <Search className=\"h-4 w-4 text-muted-foreground\" />\n              <Input\n                type=\"text\"\n                placeholder=\"Search by seat, customer, method, status, amount...\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className=\"flex-1\"\n                data-testid=\"input-search-logs\"\n              />\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {isLoading ? (\n            <p className=\"text-muted-foreground text-center py-8\">Loading payment logs...</p>\n          ) : filteredLogs.length === 0 ? (\n            <p className=\"text-muted-foreground text-center py-8\">\n              {searchQuery ? \"No payment logs match your search\" : \"No payment logs found for this date\"}\n            </p>\n          ) : (\n            <div className=\"space-y-3\">\n              {filteredLogs.map((log) => (\n                <div\n                  key={log.id}\n                  className=\"flex flex-col gap-3 p-4 border rounded-lg bg-card\"\n                  data-testid={`log-item-${log.id}`}\n                >\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-2 flex-wrap\">\n                      <span className=\"font-semibold\">{log.seatName}</span>\n                      <span className=\"text-muted-foreground\">‚Ä¢</span>\n                      <span className=\"text-muted-foreground\">{log.customerName}</span>\n                    </div>\n                    <div className=\"flex items-center gap-2 flex-wrap\">\n                      {getPaymentMethodBadge(log.paymentMethod)}\n                      {getStatusBadge(log.paymentStatus)}\n                    </div>\n                  </div>\n                  \n                  <div className=\"flex items-center justify-between text-sm\">\n                    <div className=\"flex items-center gap-4 text-muted-foreground\">\n                      <div className=\"flex items-center gap-1\">\n                        <User className=\"h-3 w-3\" />\n                        <span>{log.username}</span>\n                      </div>\n                      <div className=\"flex items-center gap-1\">\n                        <Clock className=\"h-3 w-3\" />\n                        <span>{format(new Date(log.createdAt), 'h:mm a')}</span>\n                      </div>\n                      {log.previousStatus && (\n                        <span className=\"text-xs\">\n                          Changed from: {log.previousStatus} \n                          {log.previousMethod && ` (${log.previousMethod})`}\n                        </span>\n                      )}\n                    </div>\n                    <span className=\"font-bold text-lg\">‚Çπ{parseFloat(log.amount).toFixed(2)}</span>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":8954,"size_tokens":null},"GOOGLE_OAUTH_SETUP.md":{"content":"# Google OAuth Setup Guide (No Replit Required)\n\nThis guide will help you set up **your own Google OAuth** for authentication on Render (or any platform).\n\n---\n\n## üéØ Step 1: Create Google Cloud Project\n\n1. Go to [Google Cloud Console](https://console.cloud.google.com/)\n2. Click **\"Select a project\"** ‚Üí **\"New Project\"**\n3. Enter project name: `Ankylo Gaming` (or any name)\n4. Click **\"Create\"**\n5. Wait for project creation (takes a few seconds)\n\n---\n\n## üîë Step 2: Enable Google+ API\n\n1. In your Google Cloud project, go to **\"APIs & Services\"** ‚Üí **\"Library\"**\n2. Search for **\"Google+ API\"**\n3. Click on it and click **\"Enable\"**\n4. (Optional) Also enable **\"People API\"** for better profile data\n\n---\n\n## üõ°Ô∏è Step 3: Configure OAuth Consent Screen\n\n1. Go to **\"APIs & Services\"** ‚Üí **\"OAuth consent screen\"**\n2. Select **\"External\"** (unless you have a Google Workspace)\n3. Click **\"Create\"**\n\n### Fill in the required fields:\n\n**App information:**\n- App name: `Ankylo Gaming Staff Panel`\n- User support email: `your-email@gmail.com`\n- App logo: (optional, upload your logo)\n\n**Developer contact information:**\n- Email addresses: `your-email@gmail.com`\n\n4. Click **\"Save and Continue\"**\n\n### Scopes:\n5. Click **\"Add or Remove Scopes\"**\n6. Select these scopes:\n   - `.../auth/userinfo.email`\n   - `.../auth/userinfo.profile`\n7. Click **\"Update\"** ‚Üí **\"Save and Continue\"**\n\n### Test users (optional for development):\n8. Add your email address as a test user\n9. Click **\"Save and Continue\"**\n10. Review and click **\"Back to Dashboard\"**\n\n---\n\n## üîê Step 4: Create OAuth 2.0 Credentials\n\n1. Go to **\"APIs & Services\"** ‚Üí **\"Credentials\"**\n2. Click **\"+ Create Credentials\"** ‚Üí **\"OAuth client ID\"**\n3. Application type: **\"Web application\"**\n4. Name: `Ankylo Gaming Web Client`\n\n### Configure Authorized URLs:\n\n**Authorized JavaScript origins:**\n```\nhttps://your-app-name.onrender.com\n```\nReplace `your-app-name` with your actual Render domain.\n\n**Authorized redirect URIs:**\n```\nhttps://your-app-name.onrender.com/api/auth/google/callback\n```\n\nFor local development, also add:\n```\nhttp://localhost:5000\nhttp://localhost:5000/api/auth/google/callback\n```\n\n5. Click **\"Create\"**\n\n---\n\n## üìã Step 5: Save Your Credentials\n\nYou'll see a popup with your credentials:\n\n- **Client ID**: `123456789-abc...googleusercontent.com`\n- **Client Secret**: `GOCSPX-...`\n\n**Important:** Copy these immediately! You'll need them for Render.\n\n---\n\n## üöÄ Step 6: Add Environment Variables to Render\n\nGo to your Render dashboard ‚Üí Your service ‚Üí **Environment** tab:\n\n### Required Variables:\n\n```\nDATABASE_URL=your-neon-postgres-connection-string\nSESSION_SECRET=random-32-character-string\nNODE_ENV=production\nGOOGLE_CLIENT_ID=your-google-client-id\nGOOGLE_CLIENT_SECRET=your-google-client-secret\n```\n\n### Optional Variables:\n\n```\nALLOWED_EMAIL=youremail@gmail.com\nADMIN_USERNAME=admin\nADMIN_PASSWORD=your-secure-password\nGOOGLE_CALLBACK_URL=https://your-app-name.onrender.com/api/auth/google/callback\n```\n\n**Notes:**\n- `GOOGLE_CALLBACK_URL` is optional - it will auto-detect your Render URL\n- `ALLOWED_EMAIL` restricts access to only one email address\n- `ADMIN_USERNAME` and `ADMIN_PASSWORD` create a staff/admin user for backup login\n\n---\n\n## ‚úÖ Step 7: Test Your Setup\n\n1. Deploy your app on Render\n2. Visit: `https://your-app-name.onrender.com`\n3. Click **\"Continue with Google\"**\n4. Sign in with your Google account\n5. ‚úÖ You should be redirected back to your app and logged in!\n\n---\n\n## üîß Troubleshooting\n\n### Error: \"redirect_uri_mismatch\"\n**Solution:** Make sure the callback URL in Google Cloud Console exactly matches:\n```\nhttps://your-app-name.onrender.com/api/auth/google/callback\n```\n\n### Error: \"Access denied\"\n**Solution:** \n1. Check if you set `ALLOWED_EMAIL` - only that email can log in\n2. Make sure the email you're logging in with matches exactly\n\n### Error: \"This app isn't verified\"\n**Solution:** This is normal during development. Click **\"Advanced\"** ‚Üí **\"Go to [App Name] (unsafe)\"**\n\nTo remove this warning (optional):\n1. Go to Google Cloud Console ‚Üí OAuth consent screen\n2. Click **\"Publish App\"**\n3. Submit for verification (takes a few days)\n\n### Google login button not working\n**Check:**\n1. `GOOGLE_CLIENT_ID` is set in Render environment variables\n2. `GOOGLE_CLIENT_SECRET` is set in Render environment variables\n3. Your Google Cloud OAuth credentials are for \"Web application\" type\n4. Callback URL is correctly configured in Google Cloud Console\n\n---\n\n## üìä Environment Variables Summary\n\n| Variable | Required | Example | Description |\n|----------|----------|---------|-------------|\n| `DATABASE_URL` | ‚úÖ Yes | `postgresql://...` | Neon database connection |\n| `SESSION_SECRET` | ‚úÖ Yes | Random 32+ chars | Session encryption key |\n| `NODE_ENV` | ‚úÖ Yes | `production` | Environment mode |\n| `GOOGLE_CLIENT_ID` | ‚úÖ Yes | `123...googleusercontent.com` | From Google Cloud |\n| `GOOGLE_CLIENT_SECRET` | ‚úÖ Yes | `GOCSPX-...` | From Google Cloud |\n| `ALLOWED_EMAIL` | ‚ùå Optional | `admin@example.com` | Restrict to one email |\n| `ADMIN_USERNAME` | ‚ùå Optional | `admin` | Staff/admin username |\n| `ADMIN_PASSWORD` | ‚ùå Optional | `SecurePass123` | Staff/admin password |\n| `GOOGLE_CALLBACK_URL` | ‚ùå Optional | Auto-detected | OAuth callback URL |\n\n---\n\n## üéâ You're Done!\n\nYour Google OAuth is now set up **completely independent** of Replit. You're using your own Google Cloud credentials.\n\n**Benefits:**\n- ‚úÖ No Replit dependencies\n- ‚úÖ You control the OAuth application\n- ‚úÖ Works on any platform (Render, Vercel, AWS, etc.)\n- ‚úÖ Email whitelist still works\n- ‚úÖ Staff/admin backup login available\n\n---\n\n## üîê Security Best Practices\n\n1. **Never commit credentials** - Keep `GOOGLE_CLIENT_SECRET` in environment variables only\n2. **Use HTTPS in production** - Google OAuth requires HTTPS for production URLs\n3. **Enable email whitelist** - Set `ALLOWED_EMAIL` to restrict access\n4. **Rotate secrets periodically** - Update `SESSION_SECRET` every few months\n5. **Monitor OAuth usage** - Check Google Cloud Console for suspicious activity\n\n---\n\n## üí° Next Steps\n\n- Set up custom domain on Render (optional)\n- Add more authorized users through your app's settings\n- Configure email notifications\n- Set up monitoring and logging\n\nNeed help? Check the main `RENDER_DEPLOYMENT_GUIDE.md` for more information!\n","path":null,"size_bytes":6384,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest<T = any>(\n  method: string,\n  url: string,\n  body?: any\n): Promise<T> {\n  const res = await fetch(url, {\n    method,\n    headers: body ? { \"Content-Type\": \"application/json\" } : {},\n    body: body ? JSON.stringify(body) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res.json();\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: true,\n      staleTime: 30000,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1371,"size_tokens":null},"client/src/components/CursorTrail.tsx":{"content":"import { useEffect, useRef } from \"react\";\n\ninterface Particle {\n  x: number;\n  y: number;\n  size: number;\n  vx: number;\n  vy: number;\n  alpha: number;\n  decay: number;\n  color: string;\n}\n\nexport function CursorTrail() {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n\n  useEffect(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const ctx = canvas.getContext(\"2d\");\n    if (!ctx) return;\n\n    canvas.width = window.innerWidth;\n    canvas.height = window.innerHeight;\n\n    const particles: Particle[] = [];\n    const mouse = { x: canvas.width / 2, y: canvas.height / 2 };\n    let animationFrameId: number | null = null;\n\n    const purpleColors = [\n      \"#1a0033\", // Deep purple/black\n      \"#330066\", // Dark purple\n      \"#6600cc\", // Medium purple\n      \"#9933ff\", // Bright purple\n      \"#cc66ff\", // Light purple\n      \"#e699ff\", // Very light purple\n    ];\n\n    const handleMouseMove = (e: MouseEvent) => {\n      mouse.x = e.clientX;\n      mouse.y = e.clientY;\n\n      for (let i = 0; i < 3; i++) {\n        particles.push({\n          x: mouse.x,\n          y: mouse.y,\n          size: Math.random() * 20 + 5,\n          vx: (Math.random() - 0.5) * 3,\n          vy: Math.random() * -4 - 1,\n          alpha: 1,\n          decay: Math.random() * 0.03 + 0.015,\n          color: purpleColors[Math.floor(Math.random() * purpleColors.length)],\n        });\n      }\n    };\n\n    const animate = () => {\n      ctx.globalAlpha = 1;\n      ctx.fillStyle = \"rgba(0, 0, 0, 0.15)\";\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n      for (let i = particles.length - 1; i >= 0; i--) {\n        const p = particles[i];\n        p.x += p.vx;\n        p.y += p.vy;\n        p.size *= 0.96;\n        p.alpha -= p.decay;\n\n        ctx.globalAlpha = p.alpha;\n        ctx.fillStyle = p.color;\n        ctx.beginPath();\n        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);\n        ctx.fill();\n\n        if (p.alpha <= 0) {\n          particles.splice(i, 1);\n        }\n      }\n\n      animationFrameId = requestAnimationFrame(animate);\n    };\n\n    const handleResize = () => {\n      canvas.width = window.innerWidth;\n      canvas.height = window.innerHeight;\n    };\n\n    window.addEventListener(\"mousemove\", handleMouseMove);\n    window.addEventListener(\"resize\", handleResize);\n    animationFrameId = requestAnimationFrame(animate);\n\n    return () => {\n      window.removeEventListener(\"mousemove\", handleMouseMove);\n      window.removeEventListener(\"resize\", handleResize);\n      if (animationFrameId !== null) {\n        cancelAnimationFrame(animationFrameId);\n      }\n      particles.length = 0;\n    };\n  }, []);\n\n  return (\n    <canvas\n      ref={canvasRef}\n      className=\"fixed top-0 left-0 w-full h-full pointer-events-none z-50\"\n      style={{ mixBlendMode: \"screen\" }}\n    />\n  );\n}\n","path":null,"size_bytes":2800,"size_tokens":null},"client/src/pages/Dashboard.tsx":{"content":"import { useState, useEffect, useMemo } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Button } from \"@/components/ui/button\";\nimport { CategoryCard } from \"@/components/CategoryCard\";\nimport { BookingTable } from \"@/components/BookingTable\";\nimport { AddBookingDialog } from \"@/components/AddBookingDialog\";\nimport { ExtendSessionDialog } from \"@/components/ExtendSessionDialog\";\nimport { EndSessionDialog } from \"@/components/EndSessionDialog\";\nimport { AddFoodToBookingDialog } from \"@/components/AddFoodToBookingDialog\";\nimport { SplitPaymentDialog } from \"@/components/SplitPaymentDialog\";\nimport { OnboardingTour } from \"@/components/OnboardingTour\";\nimport { InstallPrompt } from \"@/components/InstallPrompt\";\nimport { MergeSessionDialog } from \"@/components/MergeSessionDialog\";\nimport { useTour } from \"@/contexts/TourContext\";\nimport { dashboardTourSteps } from \"@/lib/tourSteps\";\nimport { Plus, Monitor, Gamepad2, Glasses, Car, Cpu, Tv, Radio, Box, RefreshCw, Calculator, Wallet, Users, Calendar, Clock, List, Award } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useSoundAlert } from \"@/hooks/useSoundAlert\";\nimport { fetchBookings, createBooking, updateBooking, deleteBooking, fetchDeviceConfigs, getServerTime } from \"@/lib/api\";\nimport type { Booking as DBBooking, DeviceConfig } from \"@shared/schema\";\nimport { useServerTime } from \"@/hooks/useServerTime\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { useKeyboardShortcuts } from \"@/hooks/useKeyboardShortcuts\";\nimport { useRegisterShortcuts } from \"@/contexts/ShortcutsContext\";\nimport { useKeepAlive } from \"@/hooks/useKeepAlive\";\n\ntype BookingStatus = \"available\" | \"running\" | \"expired\" | \"upcoming\" | \"completed\" | \"paused\";\n\ninterface FoodOrder {\n  foodId: string;\n  foodName: string;\n  price: string;\n  quantity: number;\n}\n\ninterface Booking {\n  id: string;\n  bookingCode?: string;\n  groupId?: string;\n  groupCode?: string;\n  category: string;\n  seatNumber: number;\n  seatName: string;\n  customerName: string;\n  whatsappNumber?: string;\n  startTime: Date;\n  endTime: Date;\n  price: string;\n  personCount?: number;\n  status: BookingStatus;\n  bookingType: string[];\n  foodOrders?: FoodOrder[];\n  pausedRemainingTime?: number | null;\n  originalPrice?: string;\n  discountApplied?: string;\n  bonusHoursApplied?: string;\n  promotionDetails?: {\n    discountPercentage?: number;\n    discountAmount?: string;\n    bonusHours?: string;\n  };\n  isPromotionalDiscount?: number;\n  isPromotionalBonus?: number;\n  manualDiscountPercentage?: number;\n  manualFreeHours?: string;\n}\n\nconst availableIcons = [Monitor, Gamepad2, Glasses, Car, Cpu, Tv, Radio, Box];\nconst availableColors = [\"text-chart-1\", \"text-chart-2\", \"text-chart-3\", \"text-chart-4\", \"text-chart-5\"];\n\nconst getIconForCategory = (category: string, index: number) => {\n  const predefinedIcons: Record<string, any> = {\n    \"PC\": Monitor,\n    \"PS5\": Gamepad2,\n    \"VR\": Glasses,\n    \"Car\": Car,\n    \"Xbox\": Gamepad2,\n    \"Nintendo\": Gamepad2,\n    \"Switch\": Gamepad2,\n  };\n  return predefinedIcons[category] || availableIcons[index % availableIcons.length];\n};\n\nconst getColorForCategory = (index: number) => {\n  return availableColors[index % availableColors.length];\n};\n\nexport default function Dashboard() {\n  const { toast } = useToast();\n  const { playSound } = useSoundAlert();\n  const queryClient = useQueryClient();\n  const { getTime } = useServerTime();\n  const { canMakeChanges, deviceRestricted, user, onboardingCompleted } = useAuth();\n  const { registerSteps } = useTour();\n  const [addDialog, setAddDialog] = useState(false);\n  const [extendDialog, setExtendDialog] = useState({ open: false, bookingId: \"\" });\n  const [deleteDialog, setDeleteDialog] = useState({ open: false, bookingId: \"\", seatName: \"\", customerName: \"\" });\n  const [foodDialog, setFoodDialog] = useState({ open: false, bookingId: \"\", seatName: \"\", customerName: \"\" });\n  const [hideCompleted, setHideCompleted] = useState(false);\n  const [selectedBookings, setSelectedBookings] = useState<Set<string>>(new Set());\n  const [showTour, setShowTour] = useState(false);\n  const [showPaymentDialog, setShowPaymentDialog] = useState(false);\n  const [showSplitPaymentDialog, setShowSplitPaymentDialog] = useState(false);\n  const [availabilityDialog, setAvailabilityDialog] = useState<{ open: boolean; category: string; }>({ open: false, category: \"\" });\n  const [mergeDialog, setMergeDialog] = useState<{ \n    open: boolean; \n    customerName: string; \n    existingSeat: string; \n    pendingBooking: any; \n    shouldMerge: boolean;\n    existingSession: Booking | null;\n  }>({ open: false, customerName: \"\", existingSeat: \"\", pendingBooking: null, shouldMerge: false, existingSession: null });\n\n  // Dashboard keyboard shortcuts\n  const dashboardShortcuts = useMemo(() => [\n    {\n      key: 'n',\n      ctrlKey: true,\n      description: 'Add new booking',\n      action: () => {\n        if (canMakeChanges) {\n          setAddDialog(true);\n        }\n      },\n      category: 'Dashboard'\n    },\n    {\n      key: 'r',\n      ctrlKey: true,\n      description: 'Refresh data',\n      action: () => {\n        queryClient.invalidateQueries({ queryKey: ['bookings'] });\n        queryClient.invalidateQueries({ queryKey: ['device-configs'] });\n        toast({\n          title: \"Data Refreshed\",\n          description: \"Bookings and device configs have been refreshed\",\n        });\n      },\n      category: 'Dashboard'\n    },\n    {\n      key: 'h',\n      description: 'Toggle completed bookings',\n      action: () => setHideCompleted(prev => !prev),\n      category: 'Dashboard'\n    }\n  ], [canMakeChanges, queryClient, toast]);\n\n  // Register dashboard shortcuts with context\n  useRegisterShortcuts(dashboardShortcuts);\n\n  // Apply shortcuts\n  useKeyboardShortcuts(dashboardShortcuts);\n\n  const { data: dbBookings = [], isLoading } = useQuery({ \n    queryKey: ['bookings'], \n    queryFn: fetchBookings \n  });\n\n  const { data: deviceConfigs = [] } = useQuery<DeviceConfig[]>({ \n    queryKey: ['device-configs'], \n    queryFn: fetchDeviceConfigs \n  });\n\n  const categories = useMemo(() => {\n    return deviceConfigs.map((config, index) => ({\n      name: config.category,\n      total: config.count,\n      icon: getIconForCategory(config.category, index),\n      color: getColorForCategory(index),\n    }));\n  }, [deviceConfigs]);\n\n  useEffect(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const tourParam = urlParams.get('tour');\n    \n    if (tourParam === 'true') {\n      setShowTour(true);\n      window.history.replaceState({}, '', window.location.pathname);\n    } else if (!onboardingCompleted && user) {\n      setShowTour(true);\n    }\n  }, [onboardingCompleted, user]);\n\n  const bookings: Booking[] = useMemo(() => {\n    return dbBookings\n      .map((dbBooking: DBBooking) => ({\n        id: dbBooking.id,\n        bookingCode: dbBooking.bookingCode || undefined,\n        groupId: dbBooking.groupId || undefined,\n        groupCode: dbBooking.groupCode || undefined,\n        category: dbBooking.category,\n        seatNumber: dbBooking.seatNumber,\n        seatName: dbBooking.seatName,\n        customerName: dbBooking.customerName,\n        whatsappNumber: dbBooking.whatsappNumber || undefined,\n        startTime: new Date(dbBooking.startTime),\n        endTime: new Date(dbBooking.endTime),\n        price: dbBooking.price,\n        personCount: dbBooking.personCount,\n        status: dbBooking.status as BookingStatus,\n        bookingType: dbBooking.bookingType || [],\n        foodOrders: dbBooking.foodOrders || [],\n        pausedRemainingTime: dbBooking.pausedRemainingTime ?? undefined,\n        originalPrice: dbBooking.originalPrice || undefined,\n        discountApplied: dbBooking.discountApplied || undefined,\n        bonusHoursApplied: dbBooking.bonusHoursApplied || undefined,\n        promotionDetails: dbBooking.promotionDetails || undefined,\n        isPromotionalDiscount: dbBooking.isPromotionalDiscount ?? undefined,\n        isPromotionalBonus: dbBooking.isPromotionalBonus ?? undefined,\n        manualDiscountPercentage: dbBooking.manualDiscountPercentage ?? undefined,\n        manualFreeHours: dbBooking.manualFreeHours || undefined,\n      }));\n  }, [dbBookings]);\n\n  const hasActiveTimers = useMemo(() => {\n    return bookings.some(booking => booking.status === \"running\");\n  }, [bookings]);\n\n  useKeepAlive(hasActiveTimers);\n\n  useEffect(() => {\n    registerSteps(dashboardTourSteps);\n  }, [registerSteps]);\n\n  const getOccupiedSeats = (category: string) => {\n    return bookings\n      .filter(b => b.category === category && (b.status === \"running\" || b.status === \"paused\"))\n      .map(b => b.seatNumber);\n  };\n\n  useEffect(() => {\n    const interval = setInterval(async () => {\n      const now = getTime();\n      const updatedBookings = bookings.map(booking => {\n        if (booking.status === \"running\" && booking.endTime < now) {\n          return { ...booking, status: \"expired\" as BookingStatus };\n        }\n        if (booking.status === \"upcoming\" && booking.startTime <= now) {\n          return { ...booking, status: \"running\" as BookingStatus };\n        }\n        return booking;\n      });\n\n      for (let i = 0; i < bookings.length; i++) {\n        if (bookings[i].status !== updatedBookings[i].status) {\n          // Play sound alert when timer expires\n          if (bookings[i].status === \"running\" && updatedBookings[i].status === \"expired\") {\n            playSound('timer');\n            toast({\n              title: \"Timer Expired\",\n              description: `${bookings[i].seatName} - ${bookings[i].customerName}'s session has ended`,\n              variant: \"destructive\",\n            });\n          }\n          try {\n            await updateBooking(bookings[i].id, { status: updatedBookings[i].status });\n          } catch (error) {\n            console.error(\"Failed to update booking status:\", error);\n          }\n        }\n      }\n\n      if (updatedBookings.some((b, i) => b.status !== bookings[i].status)) {\n        queryClient.invalidateQueries({ queryKey: ['bookings'] });\n      }\n    }, 5000);\n\n    return () => clearInterval(interval);\n  }, [bookings, queryClient, getTime]);\n\n  const getAvailableSeats = (category: string) => {\n    const cat = categories.find(c => c.name === category);\n    if (!cat) return [];\n    \n    const config = deviceConfigs.find(c => c.category === category);\n    const occupied = getOccupiedSeats(category);\n    \n    if (!config || config.seats.length === 0) {\n      return Array.from({ length: cat.total }, (_, i) => i + 1).filter(n => !occupied.includes(n));\n    }\n    \n    const visibleSeats = config.seats.map(seatName => {\n      const match = seatName.match(/\\d+$/);\n      return match ? parseInt(match[0]) : 0;\n    }).filter(n => n > 0);\n    \n    return visibleSeats.filter(n => !occupied.includes(n));\n  };\n\n  const availableSeatsData = categories.map(cat => ({\n    category: cat.name,\n    seats: getAvailableSeats(cat.name),\n  }));\n\n  const addBookingMutation = useMutation({\n    mutationFn: createBooking,\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['bookings'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/bookings/available-seats'] });\n    },\n  });\n\n  const handleAddBooking = async (newBooking: {\n    category: string;\n    seatNumbers: number[];\n    customerName: string;\n    whatsappNumber?: string;\n    duration: string;\n    price: string;\n    personCount: number;\n    bookingType: string[];\n    bookingDate?: Date;\n    timeSlot?: string;\n    usePromotionalDiscount?: boolean;\n    usePromotionalBonus?: boolean;\n    manualDiscountPercentage?: number;\n    manualFreeHours?: string;\n    groupId?: string;\n    groupCode?: string;\n  }) => {\n    const currentSessions = bookings.filter(b => \n      (b.status === \"running\" || b.status === \"paused\") &&\n      b.customerName.toLowerCase().trim() === newBooking.customerName.toLowerCase().trim()\n    );\n\n    if (currentSessions.length > 0) {\n      const normalizedNewPhone = newBooking.whatsappNumber?.trim().toLowerCase();\n      const exactMatch = currentSessions.find(session => {\n        const normalizedSessionPhone = session.whatsappNumber?.trim().toLowerCase();\n        return normalizedNewPhone && normalizedSessionPhone && normalizedNewPhone === normalizedSessionPhone;\n      });\n\n      if (exactMatch) {\n        const mergedBooking = {\n          ...newBooking,\n          whatsappNumber: exactMatch.whatsappNumber || newBooking.whatsappNumber\n        };\n        await createBookingForCustomer(mergedBooking, true, exactMatch);\n      } else {\n        setMergeDialog({\n          open: true,\n          customerName: newBooking.customerName,\n          existingSeat: currentSessions[0].seatName,\n          pendingBooking: newBooking,\n          shouldMerge: false,\n          existingSession: currentSessions[0]\n        });\n      }\n    } else {\n      await createBookingForCustomer(newBooking, false, null);\n    }\n  };\n\n  const createBookingForCustomer = async (newBooking: any, isMerge: boolean, existingSession: Booking | null) => {\n    try {\n      const now = await getServerTime();\n      const durationMap: { [key: string]: number } = {\n        \"30 mins\": 30,\n        \"1 hour\": 60,\n        \"2 hours\": 120,\n      };\n      const minutes = durationMap[newBooking.duration] || 60;\n      \n      let startTime: Date;\n      if (newBooking.bookingType.includes(\"walk-in\") || (newBooking.bookingType.includes(\"happy-hours\") && !newBooking.bookingType.includes(\"upcoming\"))) {\n        startTime = now;\n      } else {\n        if (newBooking.bookingDate && newBooking.timeSlot) {\n          const [startTime_str] = newBooking.timeSlot.split('-');\n          const [startHour, startMin] = startTime_str.split(':').map(Number);\n          startTime = new Date(newBooking.bookingDate);\n          startTime.setHours(startHour, startMin, 0, 0);\n        } else {\n          startTime = new Date(now.getTime() + 30 * 60 * 1000);\n        }\n      }\n      \n      const endTime = new Date(startTime.getTime() + minutes * 60 * 1000);\n\n      const seatNames: string[] = [];\n      \n      for (const seatNumber of newBooking.seatNumbers) {\n        const seatName = `${newBooking.category}-${seatNumber}`;\n        seatNames.push(seatName);\n        \n        await addBookingMutation.mutateAsync({\n          category: newBooking.category,\n          seatNumber,\n          seatName,\n          customerName: newBooking.customerName,\n          whatsappNumber: newBooking.whatsappNumber,\n          startTime: startTime.toISOString() as any,\n          endTime: endTime.toISOString() as any,\n          price: newBooking.price,\n          personCount: newBooking.personCount,\n          status: (newBooking.bookingType.includes(\"walk-in\") || (newBooking.bookingType.includes(\"happy-hours\") && !newBooking.bookingType.includes(\"upcoming\"))) ? \"running\" : \"upcoming\",\n          bookingType: newBooking.bookingType,\n          foodOrders: [],\n          isPromotionalDiscount: newBooking.usePromotionalDiscount ? 1 : 0,\n          isPromotionalBonus: newBooking.usePromotionalBonus ? 1 : 0,\n          manualDiscountPercentage: newBooking.manualDiscountPercentage,\n          manualFreeHours: newBooking.manualFreeHours,\n          groupId: newBooking.groupId,\n          groupCode: newBooking.groupCode,\n        } as any);\n      }\n      \n      toast({\n        title: \"Booking Added\",\n        description: isMerge \n          ? `${seatNames.join(\", \")} merged with existing session for ${newBooking.customerName}`\n          : `${seatNames.join(\", \")} booked for ${newBooking.customerName}`,\n      });\n    } catch (error: any) {\n      toast({\n        title: \"Booking Failed\",\n        description: error.message || \"Failed to create booking. The seat may already be booked for this time slot.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleExtend = (bookingId: string) => {\n    setExtendDialog({ open: true, bookingId });\n  };\n\n  const extendBookingMutation = useMutation({\n    mutationFn: ({ id, data }: { id: string; data: Partial<{ endTime: Date; price: string }> }) =>\n      updateBooking(id, data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['bookings'] });\n    },\n  });\n\n  const handleConfirmExtend = async (duration: string, price: string) => {\n    const booking = bookings.find(b => b.id === extendDialog.bookingId);\n    if (booking) {\n      const parseDuration = (durationStr: string): number => {\n        const normalized = durationStr.toLowerCase().trim();\n        const match = normalized.match(/(\\d+(?:\\.\\d+)?)\\s*(mins?\\.?|minutes?|hrs?\\.?|hours?)/);\n        if (!match) {\n          console.warn(`Could not parse duration: \"${durationStr}\", defaulting to 60 minutes`);\n          return 60;\n        }\n        const value = parseFloat(match[1]);\n        const unit = match[2];\n        if (unit.startsWith('h')) {\n          return Math.round(value * 60);\n        }\n        return Math.round(value);\n      };\n      \n      const minutes = parseDuration(duration);\n      const now = new Date();\n      const isExpiredOrCompleted = booking.status === \"expired\" || booking.status === \"completed\";\n      \n      const newEndTime = isExpiredOrCompleted\n        ? new Date(now.getTime() + minutes * 60 * 1000)\n        : new Date(booking.endTime.getTime() + minutes * 60 * 1000);\n      \n      const newPrice = (parseFloat(booking.price) + parseFloat(price)).toFixed(2);\n      \n      const updateData: any = {\n        endTime: newEndTime,\n        price: newPrice,\n      };\n      \n      if (isExpiredOrCompleted) {\n        updateData.status = \"running\";\n        updateData.startTime = now;\n        updateData.pausedRemainingTime = null;\n      }\n      \n      await extendBookingMutation.mutateAsync({\n        id: extendDialog.bookingId,\n        data: updateData,\n      });\n      \n      toast({\n        title: isExpiredOrCompleted ? \"Session Reactivated\" : \"Session Extended\",\n        description: isExpiredOrCompleted \n          ? `${booking.seatName} reactivated with ${duration} - ‚Çπ${price} added`\n          : `${booking.seatName} extended by ${duration} - ‚Çπ${price} added`,\n      });\n    }\n    setExtendDialog({ open: false, bookingId: \"\" });\n  };\n\n  const handleDelete = (bookingId: string) => {\n    const booking = bookings.find(b => b.id === bookingId);\n    if (booking) {\n      setDeleteDialog({ \n        open: true, \n        bookingId, \n        seatName: booking.seatName, \n        customerName: booking.customerName \n      });\n    }\n  };\n\n  const deleteBookingMutation = useMutation({\n    mutationFn: deleteBooking,\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['bookings'] });\n    },\n  });\n\n  const handleConfirmDelete = async () => {\n    await deleteBookingMutation.mutateAsync(deleteDialog.bookingId);\n    toast({\n      title: \"Booking Deleted\",\n      description: `${deleteDialog.seatName} booking removed`,\n      variant: \"destructive\",\n    });\n    setDeleteDialog({ open: false, bookingId: \"\", seatName: \"\", customerName: \"\" });\n  };\n\n  const completeBookingMutation = useMutation({\n    mutationFn: ({ id, data }: { id: string; data: any }) =>\n      updateBooking(id, data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['bookings'] });\n    },\n  });\n\n  const handleComplete = async (bookingId: string) => {\n    const booking = bookings.find(b => b.id === bookingId);\n    if (booking) {\n      await completeBookingMutation.mutateAsync({\n        id: bookingId,\n        data: { status: \"completed\" },\n      });\n      toast({\n        title: \"Session Completed\",\n        description: `${booking.seatName} - ${booking.customerName} session marked as complete`,\n      });\n    }\n  };\n\n  const handleAddFood = (bookingId: string) => {\n    const booking = bookings.find(b => b.id === bookingId);\n    if (booking) {\n      setFoodDialog({ \n        open: true, \n        bookingId, \n        seatName: booking.seatName, \n        customerName: booking.customerName \n      });\n    }\n  };\n\n  const addFoodMutation = useMutation({\n    mutationFn: ({ id, foodOrders, additionalCost }: { \n      id: string; \n      foodOrders: FoodOrder[];\n      additionalCost: number;\n    }) => {\n      const booking = bookings.find(b => b.id === id);\n      if (!booking) throw new Error(\"Booking not found\");\n      \n      const existingFoodOrders = booking.foodOrders || [];\n      const allFoodOrders = [...existingFoodOrders, ...foodOrders];\n      \n      return updateBooking(id, { \n        foodOrders: allFoodOrders as any\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['bookings'] });\n    },\n  });\n\n  const handleConfirmAddFood = async (bookingId: string, foodOrders: FoodOrder[]) => {\n    const additionalCost = foodOrders.reduce(\n      (sum, order) => sum + parseFloat(order.price) * order.quantity,\n      0\n    );\n    \n    await addFoodMutation.mutateAsync({ id: bookingId, foodOrders, additionalCost });\n    \n    toast({\n      title: \"Food Added\",\n      description: `Food items added to ${foodDialog.seatName} - ‚Çπ${additionalCost.toFixed(0)}`,\n    });\n    \n    setFoodDialog({ open: false, bookingId: \"\", seatName: \"\", customerName: \"\" });\n  };\n\n  const handleStopTimer = async (bookingId: string) => {\n    const booking = bookings.find(b => b.id === bookingId);\n    if (!booking) return;\n\n    const now = getTime();\n\n    if (booking.status === \"running\") {\n      const remainingTime = booking.endTime.getTime() - now.getTime();\n      \n      await completeBookingMutation.mutateAsync({\n        id: bookingId,\n        data: { \n          status: \"paused\",\n          pausedRemainingTime: remainingTime\n        },\n      });\n      toast({\n        title: \"Timer Paused\",\n        description: `${booking.seatName} - Session paused`,\n      });\n    } else if (booking.status === \"paused\") {\n      const remainingTime = booking.pausedRemainingTime || 0;\n      const newEndTime = new Date(now.getTime() + remainingTime);\n      \n      await completeBookingMutation.mutateAsync({\n        id: bookingId,\n        data: { \n          status: \"running\",\n          endTime: newEndTime as any,\n          pausedRemainingTime: null\n        },\n      });\n      toast({\n        title: \"Timer Resumed\",\n        description: `${booking.seatName} - Session resumed`,\n      });\n    }\n  };\n\n  const handleDeleteFood = async (bookingId: string, foodIndex: number) => {\n    const booking = bookings.find(b => b.id === bookingId);\n    if (!booking || !booking.foodOrders) return;\n    \n    const foodItem = booking.foodOrders[foodIndex];\n    \n    const updatedFoodOrders = booking.foodOrders.filter((_, index) => index !== foodIndex);\n    \n    await completeBookingMutation.mutateAsync({\n      id: bookingId,\n      data: { \n        foodOrders: updatedFoodOrders as any\n      },\n    });\n    \n    toast({\n      title: \"Food Item Removed\",\n      description: `${foodItem.foodName} removed from ${booking.seatName}`,\n      variant: \"destructive\",\n    });\n  };\n\n  const handleRefresh = async () => {\n    try {\n      const response = await fetch('/api/bookings/archive', {\n        method: 'POST',\n      });\n      const data = await response.json();\n      \n      queryClient.invalidateQueries({ queryKey: ['bookings'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/booking-history'] });\n      \n      toast({\n        title: \"List Refreshed\",\n        description: `${data.count} booking(s) moved to history`,\n      });\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to archive bookings\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleCalculate = () => {\n    if (selectedBookings.size === 0) {\n      toast({\n        title: \"No Bookings Selected\",\n        description: \"Please select bookings from the list to calculate the total\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    const selectedBookingsList = filteredBookings.filter(b => selectedBookings.has(b.id));\n    const totalAmount = selectedBookingsList.reduce((sum, booking) => {\n      const foodTotal = booking.foodOrders \n        ? booking.foodOrders.reduce((fSum, order) => fSum + parseFloat(order.price) * order.quantity, 0)\n        : 0;\n      return sum + parseFloat(booking.price) + foodTotal;\n    }, 0);\n    \n    toast({\n      title: \"Total Amount Calculated\",\n      description: `Total: ‚Çπ${totalAmount.toFixed(2)} from ${selectedBookings.size} selected booking(s)`,\n    });\n  };\n\n  const handlePaymentMethod = async (method: \"cash\" | \"upi_online\") => {\n    if (selectedBookings.size === 0) {\n      toast({\n        title: \"No Bookings Selected\",\n        description: \"Please select bookings from the list first\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      const response = await fetch('/api/bookings/payment-status', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          bookingIds: Array.from(selectedBookings),\n          paymentStatus: 'paid',\n          paymentMethod: method\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to update payment status');\n      }\n\n      const data = await response.json();\n      \n      queryClient.invalidateQueries({ queryKey: ['bookings'] });\n      setShowPaymentDialog(false);\n      setSelectedBookings(new Set());\n      \n      const methodName = method === 'cash' ? 'Cash' : 'UPI/Online';\n      toast({\n        title: \"Payment Confirmed\",\n        description: `${data.count} booking(s) marked as paid via ${methodName}`,\n      });\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update payment status\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleToggleSelection = (bookingId: string) => {\n    setSelectedBookings(prev => {\n      const newSet = new Set(prev);\n      if (newSet.has(bookingId)) {\n        newSet.delete(bookingId);\n      } else {\n        newSet.add(bookingId);\n      }\n      return newSet;\n    });\n  };\n\n  const handleCompleteTour = async () => {\n    try {\n      await fetch('/api/auth/complete-onboarding', {\n        method: 'POST',\n        credentials: 'include',\n      });\n      setShowTour(false);\n      window.location.reload();\n    } catch (error) {\n      console.error('Failed to complete onboarding:', error);\n    }\n  };\n\n  const filteredBookings = useMemo(() => {\n    if (hideCompleted) {\n      return bookings.filter(b => b.status !== \"completed\" && b.status !== \"expired\");\n    }\n    return bookings;\n  }, [bookings, hideCompleted]);\n\n  const walkInBookings = filteredBookings.filter(b => b.bookingType?.includes(\"walk-in\"));\n  const upcomingBookings = filteredBookings.filter(b => b.bookingType?.includes(\"upcoming\"));\n  const happyHoursBookings = filteredBookings.filter(b => b.bookingType?.includes(\"happy-hours\"));\n  \n  // Sort \"All in One\" view: Running sessions first, then others\n  const allBookings = [...filteredBookings].sort((a, b) => {\n    // Running status comes first\n    if (a.status === \"running\" && b.status !== \"running\") return -1;\n    if (a.status !== \"running\" && b.status === \"running\") return 1;\n    // Then paused sessions\n    if (a.status === \"paused\" && b.status !== \"paused\" && b.status !== \"running\") return -1;\n    if (a.status !== \"paused\" && b.status === \"paused\" && a.status !== \"running\") return 1;\n    // Then by start time (most recent first)\n    return b.startTime.getTime() - a.startTime.getTime();\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between flex-wrap gap-4\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-foreground\">Seat Management</h1>\n            <p className=\"text-muted-foreground\">Loading bookings...</p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4 sm:space-y-5 md:space-y-6\">\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n        <div className=\"space-y-1\">\n          <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-foreground tracking-tight\">Seat Management</h1>\n          <p className=\"text-sm sm:text-base text-muted-foreground\">Monitor and manage all gaming seats</p>\n        </div>\n        <TooltipProvider>\n          <Tooltip>\n            <TooltipTrigger asChild>\n              <Button \n                onClick={() => setAddDialog(true)} \n                data-testid=\"button-add-booking\"\n                data-joyride=\"add-booking-button\"\n                className=\"w-full sm:w-auto sm:min-w-[160px] h-10 sm:h-11\"\n                size=\"lg\"\n              >\n                <Plus className=\"mr-2 h-4 w-4 sm:h-5 sm:w-5\" />\n                <span className=\"font-semibold\">Add Booking</span>\n              </Button>\n            </TooltipTrigger>\n            <TooltipContent>\n              <p>Create a new booking for any available gaming seat (Ctrl+N)</p>\n            </TooltipContent>\n          </Tooltip>\n        </TooltipProvider>\n      </div>\n\n      <div className=\"grid gap-3 sm:gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4\" data-joyride=\"category-cards\">\n        {categories.map((cat) => {\n          const available = getAvailableSeats(cat.name).length;\n          return (\n            <CategoryCard\n              key={cat.name}\n              title={cat.name}\n              icon={cat.icon}\n              available={available}\n              total={cat.total}\n              color={cat.color}\n              onViewDetails={() => setAvailabilityDialog({ open: true, category: cat.name })}\n            />\n          );\n        })}\n      </div>\n\n      <Tabs defaultValue=\"all-in-one\" className=\"space-y-4 md:space-y-5\">\n        <div className=\"flex flex-col gap-3 sm:gap-4\">\n          <TabsList data-testid=\"tabs-bookings\" data-joyride=\"view-toggle\" className=\"w-full sm:w-auto grid grid-cols-2 sm:grid-cols-4 h-auto p-1\">\n            <TabsTrigger value=\"all-in-one\" data-testid=\"tab-all-in-one\" className=\"text-xs sm:text-sm py-2.5 sm:py-2\">\n              <List className=\"h-3.5 w-3.5 sm:h-4 sm:w-4 mr-1 sm:mr-2\" />\n              <span className=\"hidden sm:inline\">All in One</span>\n              <span className=\"sm:hidden\">All</span>\n              <span className=\"ml-1 font-semibold\">({allBookings.length})</span>\n            </TabsTrigger>\n            <TabsTrigger value=\"walk-in\" data-testid=\"tab-walk-in\" className=\"text-xs sm:text-sm py-2.5 sm:py-2\">\n              <Users className=\"h-3.5 w-3.5 sm:h-4 sm:w-4 mr-1 sm:mr-2\" />\n              <span className=\"hidden sm:inline\">Walk-in List</span>\n              <span className=\"sm:hidden\">Walk-in</span>\n              <span className=\"ml-1 font-semibold\">({walkInBookings.length})</span>\n            </TabsTrigger>\n            <TabsTrigger value=\"upcoming\" data-testid=\"tab-upcoming\" className=\"text-xs sm:text-sm py-2.5 sm:py-2\">\n              <Calendar className=\"h-3.5 w-3.5 sm:h-4 sm:w-4 mr-1 sm:mr-2\" />\n              <span className=\"hidden sm:inline\">Upcoming</span>\n              <span className=\"sm:hidden\">Upcoming</span>\n              <span className=\"ml-1 font-semibold\">({upcomingBookings.length})</span>\n            </TabsTrigger>\n            <TabsTrigger value=\"happy-hours\" data-testid=\"tab-happy-hours\" className=\"text-xs sm:text-sm py-2.5 sm:py-2\">\n              <Clock className=\"h-3.5 w-3.5 sm:h-4 sm:w-4 mr-1 sm:mr-2\" />\n              <span className=\"hidden sm:inline\">Happy Hours</span>\n              <span className=\"sm:hidden\">Happy Hr</span>\n              <span className=\"ml-1 font-semibold\">({happyHoursBookings.length})</span>\n            </TabsTrigger>\n          </TabsList>\n          <div className=\"flex flex-wrap gap-2 sm:gap-3\">\n            <TooltipProvider>\n              <Tooltip>\n                <TooltipTrigger asChild>\n                  <Button \n                    variant=\"outline\" \n                    size=\"sm\" \n                    onClick={handleCalculate}\n                    data-testid=\"button-calculate\"\n                    data-joyride=\"calculate-button\"\n                    className=\"flex-1 min-w-[100px] sm:flex-none h-9 sm:h-10\"\n                  >\n                    <Calculator className=\"mr-1.5 sm:mr-2 h-4 w-4\" />\n                    <span className=\"text-xs sm:text-sm\">Calculate ({selectedBookings.size})</span>\n                  </Button>\n                </TooltipTrigger>\n                <TooltipContent>\n                  <p>{selectedBookings.size > 0 \n                    ? `Calculate total amount for ${selectedBookings.size} selected booking${selectedBookings.size > 1 ? 's' : ''} including food orders` \n                    : 'Select bookings from the list below to calculate total payment amount'}</p>\n                </TooltipContent>\n              </Tooltip>\n            </TooltipProvider>\n            <TooltipProvider>\n              <Tooltip>\n                <TooltipTrigger asChild>\n                  <Button \n                    variant=\"outline\" \n                    size=\"sm\" \n                    onClick={() => {\n                      if (selectedBookings.size === 0) {\n                        toast({\n                          title: \"No Bookings Selected\",\n                          description: \"Please select bookings from the list first\",\n                          variant: \"destructive\",\n                        });\n                      } else {\n                        setShowPaymentDialog(true);\n                      }\n                    }}\n                    data-testid=\"button-payment-method\"\n                    data-joyride=\"payment-button\"\n                    className=\"flex-1 min-w-[100px] sm:flex-none h-9 sm:h-10\"\n                  >\n                    <Wallet className=\"mr-1.5 sm:mr-2 h-4 w-4\" />\n                    <span className=\"text-xs sm:text-sm\">Payment</span>\n                  </Button>\n                </TooltipTrigger>\n                <TooltipContent>\n                  <p>{selectedBookings.size > 0 \n                    ? `Mark ${selectedBookings.size} selected booking${selectedBookings.size > 1 ? 's' : ''} as paid via Cash or UPI` \n                    : 'Select completed sessions to mark payment method and record payment'}</p>\n                </TooltipContent>\n              </Tooltip>\n            </TooltipProvider>\n            <TooltipProvider>\n              <Tooltip>\n                <TooltipTrigger asChild>\n                  <Button \n                    variant=\"outline\" \n                    size=\"sm\" \n                    onClick={handleRefresh}\n                    data-testid=\"button-refresh-list\"\n                    data-joyride=\"refresh-button\"\n                    className=\"flex-1 min-w-[100px] sm:flex-none h-9 sm:h-10\"\n                  >\n                    <RefreshCw className=\"mr-1.5 sm:mr-2 h-4 w-4\" />\n                    <span className=\"text-xs sm:text-sm\">Refresh</span>\n                  </Button>\n                </TooltipTrigger>\n                <TooltipContent>\n                  <p>Archive completed bookings and move them to history report. Use after marking payments. (Ctrl+R)</p>\n                </TooltipContent>\n              </Tooltip>\n            </TooltipProvider>\n          </div>\n        </div>\n\n        <TabsContent value=\"all-in-one\" className=\"space-y-4\" data-joyride=\"booking-table\">\n          <BookingTable\n            bookings={allBookings}\n            onExtend={handleExtend}\n            onEnd={handleDelete}\n            onComplete={handleComplete}\n            onAddFood={handleAddFood}\n            onStopTimer={handleStopTimer}\n            onDeleteFood={handleDeleteFood}\n            showDateColumn={true}\n            showTypeColumn={true}\n            selectedBookings={selectedBookings}\n            onToggleSelection={handleToggleSelection}\n          />\n        </TabsContent>\n\n        <TabsContent value=\"walk-in\" className=\"space-y-4\">\n          <BookingTable\n            bookings={walkInBookings}\n            onExtend={handleExtend}\n            onEnd={handleDelete}\n            onComplete={handleComplete}\n            onAddFood={handleAddFood}\n            onStopTimer={handleStopTimer}\n            onDeleteFood={handleDeleteFood}\n            selectedBookings={selectedBookings}\n            onToggleSelection={handleToggleSelection}\n          />\n        </TabsContent>\n\n        <TabsContent value=\"upcoming\" className=\"space-y-4\">\n          <BookingTable\n            bookings={upcomingBookings}\n            onEnd={handleDelete}\n            onComplete={handleComplete}\n            onAddFood={handleAddFood}\n            onStopTimer={handleStopTimer}\n            onDeleteFood={handleDeleteFood}\n            showDateColumn={true}\n            selectedBookings={selectedBookings}\n            onToggleSelection={handleToggleSelection}\n          />\n        </TabsContent>\n\n        <TabsContent value=\"happy-hours\" className=\"space-y-4\">\n          <BookingTable\n            bookings={happyHoursBookings}\n            onExtend={handleExtend}\n            onEnd={handleDelete}\n            onComplete={handleComplete}\n            onAddFood={handleAddFood}\n            onStopTimer={handleStopTimer}\n            onDeleteFood={handleDeleteFood}\n            showDateColumn={true}\n            selectedBookings={selectedBookings}\n            onToggleSelection={handleToggleSelection}\n          />\n        </TabsContent>\n      </Tabs>\n\n      <AddBookingDialog\n        open={addDialog}\n        onOpenChange={setAddDialog}\n        onConfirm={handleAddBooking}\n        availableSeats={availableSeatsData}\n      />\n\n      <ExtendSessionDialog\n        open={extendDialog.open}\n        onOpenChange={(open) => setExtendDialog({ ...extendDialog, open })}\n        seatName={bookings.find(b => b.id === extendDialog.bookingId)?.seatName || \"\"}\n        category={bookings.find(b => b.id === extendDialog.bookingId)?.category || \"\"}\n        personCount={(bookings.find(b => b.id === extendDialog.bookingId)?.personCount) || 1}\n        onConfirm={handleConfirmExtend}\n      />\n\n      <EndSessionDialog\n        open={deleteDialog.open}\n        onOpenChange={(open) => setDeleteDialog({ ...deleteDialog, open })}\n        seatName={deleteDialog.seatName}\n        customerName={deleteDialog.customerName}\n        onConfirm={handleConfirmDelete}\n      />\n\n      <AddFoodToBookingDialog\n        open={foodDialog.open}\n        onOpenChange={(open) => setFoodDialog({ ...foodDialog, open })}\n        bookingId={foodDialog.bookingId}\n        seatName={foodDialog.seatName}\n        customerName={foodDialog.customerName}\n        onConfirm={handleConfirmAddFood}\n      />\n\n      <MergeSessionDialog\n        open={mergeDialog.open}\n        onOpenChange={(open) => setMergeDialog({ ...mergeDialog, open })}\n        customerName={mergeDialog.customerName}\n        existingSeat={mergeDialog.existingSeat}\n        onMerge={() => {\n          if (mergeDialog.pendingBooking && mergeDialog.existingSession) {\n            const mergedBooking = {\n              ...mergeDialog.pendingBooking,\n              whatsappNumber: mergeDialog.existingSession.whatsappNumber || mergeDialog.pendingBooking.whatsappNumber\n            };\n            createBookingForCustomer(mergedBooking, true, mergeDialog.existingSession);\n          }\n        }}\n        onSeparate={() => {\n          if (mergeDialog.pendingBooking) {\n            const normalizedBaseName = mergeDialog.customerName.toLowerCase().trim();\n            const existingNamesWithSuffix = bookings\n              .filter(b => b.customerName.toLowerCase().trim().startsWith(normalizedBaseName))\n              .map(b => b.customerName);\n            \n            let suffix = 2;\n            let newName = `${mergeDialog.customerName} (${suffix})`;\n            while (existingNamesWithSuffix.includes(newName)) {\n              suffix++;\n              newName = `${mergeDialog.customerName} (${suffix})`;\n            }\n            \n            const separateBooking = {\n              ...mergeDialog.pendingBooking,\n              customerName: newName\n            };\n            createBookingForCustomer(separateBooking, false, null);\n          }\n        }}\n      />\n\n      <OnboardingTour\n        open={showTour}\n        onComplete={handleCompleteTour}\n        onSkip={handleCompleteTour}\n      />\n\n      <InstallPrompt />\n\n      <Dialog open={showPaymentDialog} onOpenChange={setShowPaymentDialog}>\n        <DialogContent className=\"w-[95vw] max-w-2xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle className=\"text-lg sm:text-xl\">Payment Confirmation</DialogTitle>\n            <DialogDescription className=\"text-sm\">\n              Review selected bookings and choose payment method\n            </DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"max-h-[35vh] sm:max-h-[400px] overflow-y-auto rounded-md border p-3 sm:p-4 bg-muted/30\">\n            <h3 className=\"font-semibold mb-3 text-xs sm:text-sm text-muted-foreground uppercase\">Selected Bookings Summary</h3>\n            {(() => {\n              const selectedBookingsList = filteredBookings.filter(b => selectedBookings.has(b.id));\n              const groupedByCustomer = selectedBookingsList.reduce((acc, booking) => {\n                const customerName = booking.customerName;\n                if (!acc[customerName]) {\n                  acc[customerName] = [];\n                }\n                acc[customerName].push(booking);\n                return acc;\n              }, {} as Record<string, typeof filteredBookings>);\n\n              return (\n                <div className=\"space-y-3 sm:space-y-4\">\n                  {Object.entries(groupedByCustomer).map(([customerName, customerBookings]) => {\n                    const customerTotal = customerBookings.reduce((sum, booking) => {\n                      const foodTotal = booking.foodOrders \n                        ? booking.foodOrders.reduce((fSum, order) => fSum + parseFloat(order.price) * order.quantity, 0)\n                        : 0;\n                      return sum + parseFloat(booking.price) + foodTotal;\n                    }, 0);\n\n                    return (\n                      <div key={customerName} className=\"bg-background rounded-lg p-2.5 sm:p-3 border\">\n                        <div className=\"flex items-center justify-between mb-1.5 sm:mb-2 gap-2\">\n                          <h4 className=\"font-bold text-sm sm:text-base truncate\">{customerName}</h4>\n                          <span className=\"text-sm sm:text-base font-semibold text-primary whitespace-nowrap\">‚Çπ{customerTotal.toFixed(0)}</span>\n                        </div>\n                        <div className=\"space-y-1\">\n                          <p className=\"text-xs sm:text-sm text-muted-foreground break-words\">\n                            {customerBookings.length} PC{customerBookings.length > 1 ? 's' : ''}: {' '}\n                            {customerBookings.map(b => b.seatName).join(', ')}\n                          </p>\n                        </div>\n                      </div>\n                    );\n                  })}\n                  <div className=\"pt-2.5 sm:pt-3 border-t mt-3 sm:mt-4\">\n                    <div className=\"flex items-center justify-between gap-2\">\n                      <span className=\"font-bold text-sm sm:text-base\">Grand Total</span>\n                      <span className=\"font-bold text-lg sm:text-xl text-primary whitespace-nowrap\">\n                        ‚Çπ{selectedBookingsList.reduce((sum, booking) => {\n                          const foodTotal = booking.foodOrders \n                            ? booking.foodOrders.reduce((fSum, order) => fSum + parseFloat(order.price) * order.quantity, 0)\n                            : 0;\n                          return sum + parseFloat(booking.price) + foodTotal;\n                        }, 0).toFixed(0)}\n                      </span>\n                    </div>\n                    <p className=\"text-xs sm:text-sm text-muted-foreground mt-1\">\n                      Total: {selectedBookings.size} booking{selectedBookings.size > 1 ? 's' : ''} from {Object.keys(groupedByCustomer).length} customer{Object.keys(groupedByCustomer).length > 1 ? 's' : ''}\n                    </p>\n                  </div>\n                </div>\n              );\n            })()}\n          </div>\n\n          <div className=\"grid gap-2.5 sm:gap-3 pt-3 sm:pt-4 border-t\">\n            <p className=\"text-sm sm:text-base font-bold text-center pt-2 sm:pt-4\">Select Payment Method</p>\n            <p className=\"text-xs sm:text-sm text-center text-muted-foreground -mt-1 sm:-mt-2\">Choose how the customer paid</p>\n            <Button\n              variant=\"outline\"\n              size=\"lg\"\n              onClick={() => handlePaymentMethod(\"cash\")}\n              data-testid=\"button-payment-cash\"\n              className=\"h-12 sm:h-16 text-base sm:text-lg border-2 hover:border-primary hover:bg-primary/5\"\n            >\n              <Wallet className=\"mr-1.5 sm:mr-2 h-4 w-4 sm:h-5 sm:w-5\" />\n              Full Cash\n            </Button>\n            <Button\n              variant=\"outline\"\n              size=\"lg\"\n              onClick={() => handlePaymentMethod(\"upi_online\")}\n              data-testid=\"button-payment-upi\"\n              className=\"h-12 sm:h-16 text-base sm:text-lg border-2 hover:border-primary hover:bg-primary/5\"\n            >\n              <Wallet className=\"mr-1.5 sm:mr-2 h-4 w-4 sm:h-5 sm:w-5\" />\n              Full UPI\n            </Button>\n            <div className=\"relative\">\n              <div className=\"absolute inset-0 flex items-center\">\n                <span className=\"w-full border-t\" />\n              </div>\n              <div className=\"relative flex justify-center text-xs uppercase\">\n                <span className=\"bg-background px-2 text-muted-foreground\">Or</span>\n              </div>\n            </div>\n            <Button\n              variant=\"outline\"\n              size=\"lg\"\n              onClick={() => {\n                setShowPaymentDialog(false);\n                setShowSplitPaymentDialog(true);\n              }}\n              data-testid=\"button-payment-split\"\n              className=\"h-12 sm:h-16 text-base sm:text-lg border-2 hover:border-blue-500 hover:bg-blue-500/5 border-blue-300 dark:border-blue-700\"\n            >\n              <Calculator className=\"mr-1.5 sm:mr-2 h-4 w-4 sm:h-5 sm:w-5\" />\n              Split Payment (Cash + UPI)\n            </Button>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={availabilityDialog.open} onOpenChange={(open) => setAvailabilityDialog({ ...availabilityDialog, open })}>\n        <DialogContent className=\"max-w-2xl max-h-[80vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>{availabilityDialog.category} Availability Details</DialogTitle>\n            <DialogDescription>\n              View which specific {availabilityDialog.category} devices are available and occupied\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            {(() => {\n              const config = deviceConfigs.find(c => c.category === availabilityDialog.category);\n              if (!config) return <p className=\"text-muted-foreground\">No configuration found</p>;\n\n              const occupiedSeats = getOccupiedSeats(availabilityDialog.category);\n              const availableSeats = getAvailableSeats(availabilityDialog.category);\n              \n              const allSeatNumbers = config.seats.length > 0\n                ? config.seats.map(seatName => {\n                    const match = seatName.match(/\\d+$/);\n                    return match ? parseInt(match[0]) : 0;\n                  }).filter(n => n > 0)\n                : Array.from({ length: config.count }, (_, i) => i + 1);\n\n              const getSeatInfo = (seatNum: number) => {\n                const booking = bookings.find(\n                  b => b.category === availabilityDialog.category && \n                  b.seatNumber === seatNum && \n                  (b.status === \"running\" || b.status === \"paused\")\n                );\n                return booking;\n              };\n\n              return (\n                <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3\">\n                  {allSeatNumbers.sort((a, b) => a - b).map(seatNum => {\n                    const isAvailable = availableSeats.includes(seatNum);\n                    const booking = getSeatInfo(seatNum);\n                    const seatName = config.seats.find(s => {\n                      const match = s.match(/\\d+$/);\n                      return match && parseInt(match[0]) === seatNum;\n                    }) || `${availabilityDialog.category} ${seatNum}`;\n\n                    return (\n                      <div\n                        key={seatNum}\n                        className={`p-4 rounded-lg border-2 transition-all ${\n                          isAvailable\n                            ? \"bg-green-50 dark:bg-green-950 border-green-500 dark:border-green-700\"\n                            : \"bg-red-50 dark:bg-red-950 border-red-500 dark:border-red-700\"\n                        }`}\n                        data-testid={`seat-status-${availabilityDialog.category.toLowerCase()}-${seatNum}`}\n                      >\n                        <div className=\"flex flex-col gap-1\">\n                          <div className=\"flex items-center justify-between\">\n                            <span className=\"font-bold text-sm\">{seatName}</span>\n                            <span\n                              className={`text-xs px-2 py-0.5 rounded-full ${\n                                isAvailable\n                                  ? \"bg-green-500 dark:bg-green-700 text-white\"\n                                  : \"bg-red-500 dark:bg-red-700 text-white\"\n                              }`}\n                            >\n                              {isAvailable ? \"Available\" : \"Occupied\"}\n                            </span>\n                          </div>\n                          {!isAvailable && booking && (\n                            <div className=\"mt-2 pt-2 border-t border-red-300 dark:border-red-800\">\n                              <p className=\"text-xs font-medium truncate\">{booking.customerName}</p>\n                              {booking.status === \"paused\" && (\n                                <p className=\"text-xs text-muted-foreground\">Paused</p>\n                              )}\n                            </div>\n                          )}\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              );\n            })()}\n            <div className=\"flex items-center justify-between pt-4 border-t\">\n              <div className=\"flex items-center gap-4\">\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"w-4 h-4 rounded bg-green-500 dark:bg-green-700\"></div>\n                  <span className=\"text-sm\">Available ({getAvailableSeats(availabilityDialog.category).length})</span>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"w-4 h-4 rounded bg-red-500 dark:bg-red-700\"></div>\n                  <span className=\"text-sm\">Occupied ({getOccupiedSeats(availabilityDialog.category).length})</span>\n                </div>\n              </div>\n              <Button\n                variant=\"outline\"\n                onClick={() => setAvailabilityDialog({ open: false, category: \"\" })}\n                data-testid=\"button-close-availability-dialog\"\n              >\n                Close\n              </Button>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      <SplitPaymentDialog\n        open={showSplitPaymentDialog}\n        onOpenChange={setShowSplitPaymentDialog}\n        bookingIds={Array.from(selectedBookings)}\n        totalAmount={(() => {\n          const selectedBookingsList = filteredBookings.filter(b => selectedBookings.has(b.id));\n          return selectedBookingsList.reduce((sum, booking) => {\n            const foodTotal = booking.foodOrders \n              ? booking.foodOrders.reduce((fSum, order) => fSum + parseFloat(order.price) * order.quantity, 0)\n              : 0;\n            return sum + parseFloat(booking.price) + foodTotal;\n          }, 0);\n        })()}\n        customerName={(() => {\n          const selectedBookingsList = filteredBookings.filter(b => selectedBookings.has(b.id));\n          return selectedBookingsList.length > 0 ? selectedBookingsList[0].customerName : \"\";\n        })()}\n        whatsappNumber={(() => {\n          const selectedBookingsList = filteredBookings.filter(b => selectedBookings.has(b.id));\n          return selectedBookingsList.length > 0 ? selectedBookingsList[0].whatsappNumber : \"\";\n        })()}\n        onSuccess={() => {\n          setSelectedBookings(new Set());\n          queryClient.invalidateQueries({ queryKey: [\"/api/bookings\"] });\n        }}\n      />\n    </div>\n  );\n}\n","path":null,"size_bytes":53264,"size_tokens":null},"design_guidelines.md":{"content":"# Gaming Center POS Admin Panel - Design Guidelines\n\n## Design Approach\n**Selected Approach:** Gaming-Enhanced System Design  \n**Primary Inspiration:** Discord dashboard + Steam admin panels + Riot Games interfaces  \n**Justification:** Admin dashboard requiring high information density with gaming aesthetic differentiation\n\n## Core Design Elements\n\n### A. Color Palette\n\n**Dark Mode Foundation (Primary):**\n- Background Base: 220 15% 8% (deep slate)\n- Background Elevated: 220 15% 12% (card surfaces)\n- Background Interactive: 220 15% 16% (hover states)\n\n**Gaming Accent Colors:**\n- Primary Neon: 170 100% 50% (cyan/teal - for active seats, success states)\n- Warning Accent: 30 100% 55% (orange - for expiring timers, alerts)\n- Danger Accent: 0 85% 60% (red - for expired sessions)\n- Info Accent: 250 80% 65% (purple - for upcoming bookings)\n\n**Semantic Colors:**\n- Available: 150 70% 50% (green)\n- Running: 200 90% 55% (blue)\n- Expired: 0 75% 55% (red)\n- Upcoming: 270 70% 60% (violet)\n\n**Text Hierarchy:**\n- Primary Text: 0 0% 95%\n- Secondary Text: 0 0% 65%\n- Muted Text: 0 0% 45%\n\n### B. Typography\n**Font Stack:** 'Inter' for UI, 'JetBrains Mono' for timers/numbers  \n**Hierarchy:**\n- Page Titles: text-2xl font-bold (Inter)\n- Section Headers: text-lg font-semibold\n- Body Text: text-sm font-medium\n- Timer Display: text-3xl font-mono (JetBrains Mono)\n- Data Labels: text-xs font-medium uppercase tracking-wide\n\n### C. Layout System\n**Spacing Primitives:** Tailwind units of 2, 4, 6, 8, 12 (p-4, gap-6, mb-8, py-12)  \n**Grid System:** 12-column grid with gap-4 to gap-6  \n**Container Max-Width:** max-w-7xl with px-6 padding  \n**Sidebar Width:** w-64 fixed navigation\n\n### D. Component Library\n\n**Navigation:**\n- Fixed left sidebar (w-64) with collapsible option\n- Active state: cyan border-l-4 with subtle glow effect\n- Icons from Heroicons (solid variants for active, outline for inactive)\n- Section dividers with subtle gradient lines\n\n**Seat Status Cards:**\n- Grid layout: grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-4\n- Card size: aspect-square with rounded-lg\n- Border: 2px border with status-based color (glowing effect for running)\n- Content: Seat name (top), status badge (center), timer (bottom if active)\n- Hover: scale-105 transform with transition\n\n**Data Tables:**\n- Striped rows with alternating background opacity\n- Sticky header with backdrop-blur\n- Action buttons in rightmost column\n- Status badges with dot indicator and label\n\n**Timer Components:**\n- Large monospace display with countdown\n- Color transitions: cyan (>30min) ‚Üí orange (5-30min) ‚Üí red (<5min)\n- Pulse animation when <5 minutes remaining\n\n**Alert System:**\n- Toast notifications (top-right corner)\n- Session expiry: red background with sound icon\n- Upcoming booking: purple background with clock icon\n- Duration: 5 seconds auto-dismiss with manual close option\n\n**Buttons:**\n- Primary: cyan background with hover glow effect\n- Secondary: transparent with cyan border, hover: filled\n- Danger: red background for \"End Session\"\n- Size variants: px-4 py-2 (default), px-6 py-3 (large)\n\n**Forms & Settings:**\n- Input fields: dark background (220 15% 12%) with cyan focus ring\n- Increment/decrement buttons for seat quantities\n- Toggle switches for visibility (cyan when active)\n- Pricing editor: table layout with inline editing\n\n**Modal/Popup:**\n- Backdrop: bg-black/60 with backdrop-blur-sm\n- Modal container: rounded-xl with border and shadow-2xl\n- Close button: top-right with hover:rotate-90 transition\n\n**Reports Section:**\n- Date range picker with calendar dropdown\n- Revenue cards: large numbers with trend indicators\n- Export buttons: icon + label, cyan hover state\n- Chart placeholders: dark grid with cyan/purple gradients\n\n**Status Badges:**\n- Pill shape with dot indicator\n- Sizes: px-3 py-1 text-xs rounded-full\n- Available: green, Running: cyan, Expired: red, Upcoming: purple\n\n### E. Visual Effects\n**Subtle Animations:**\n- Running seat cards: subtle pulse on border (2s interval)\n- Timer countdown: number flip animation on minute change\n- Alert entrance: slide-in from top-right\n- Button clicks: scale-95 active state\n\n**Glow Effects:**\n- Active seats: box-shadow with cyan glow (shadow-[0_0_15px_rgba(0,255,255,0.3)])\n- Expiring timers: orange pulsing glow\n- Primary buttons: cyan glow on hover\n\n**Transitions:**\n- Default: transition-all duration-200\n- Hover states: duration-150\n- Layout shifts: duration-300\n\n## Page-Specific Layouts\n\n**Settings Page:**\nTwo-column layout (lg:grid-cols-2 gap-8)  \nLeft: Device configuration cards (PC, PS5, VR, Car)  \nRight: Pricing tables with editable time slots\n\n**Seat Management (Main Dashboard):**\nTop: Tab switcher (Walk-in / Upcoming)  \nBelow tabs: Status filter chips (All, Available, Running, Expired)  \nMain area: Seat grid with live status cards  \nRight sidebar: Active session details panel\n\n**Reports Page:**\nTop: Date range selector and filter controls  \nMiddle: Revenue summary cards (grid-cols-3)  \nBottom: Booking history table with export buttons\n\n## Critical Guidelines\n- Maintain high contrast for readability in bright/dim environments\n- Ensure timer visibility from distance (shop staff monitoring multiple screens)\n- Status colors must be instantly recognizable (colorblind-safe palette)\n- Animations should not distract from critical alerts\n- All interactive elements: min-height of 44px for touch targets (tablet use)\n- Alert sounds trigger alongside visual notifications (accessibility)\n\n## Images\nNo hero images required. This is a data-focused admin dashboard. All visual interest comes from the gaming color scheme, status indicators, and live data displays.","path":null,"size_bytes":5635,"size_tokens":null},"client/src/components/SplashScreen.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport splashLogo from \"@assets/airavoto_logo.png\";\nimport iconPattern from \"@assets/WhatsApp Image 2025-10-22 at 11.12.35_fa6763ad_1761112003243.jpg\";\n\ninterface SplashScreenProps {\n  onComplete: () => void;\n}\n\nexport function SplashScreen({ onComplete }: SplashScreenProps) {\n  const [progress, setProgress] = useState(0);\n  const [showLogo, setShowLogo] = useState(false);\n\n  useEffect(() => {\n    setTimeout(() => setShowLogo(true), 300);\n    \n    const progressInterval = setInterval(() => {\n      setProgress((prev) => {\n        if (prev >= 100) {\n          clearInterval(progressInterval);\n          setTimeout(onComplete, 500);\n          return 100;\n        }\n        return prev + 2;\n      });\n    }, 25);\n\n    return () => clearInterval(progressInterval);\n  }, [onComplete]);\n\n  return (\n    <div className=\"fixed inset-0 z-50 flex items-center justify-center overflow-hidden bg-white dark:bg-gray-100\">\n      {/* Animated Background Pattern - Moving Left to Right */}\n      <div className=\"absolute inset-0 overflow-hidden\">\n        <div \n          className=\"absolute inset-0 animate-scroll-bg opacity-20\"\n          style={{\n            backgroundImage: `url(${iconPattern})`,\n            backgroundSize: 'auto 100%',\n            backgroundRepeat: 'repeat-x',\n            backgroundPosition: '0 center',\n            width: '200%'\n          }}\n        ></div>\n        <div \n          className=\"absolute inset-0 animate-scroll-bg-delay opacity-15\"\n          style={{\n            backgroundImage: `url(${iconPattern})`,\n            backgroundSize: 'auto 100%',\n            backgroundRepeat: 'repeat-x',\n            backgroundPosition: '0 center',\n            width: '200%'\n          }}\n        ></div>\n      </div>\n\n      {/* Main Content */}\n      <div className=\"relative z-10 flex flex-col items-center gap-8 px-8\">\n        \n        {/* Logo with Fade In Animation */}\n        <div className={`transition-all duration-1500 ${showLogo ? 'opacity-100 scale-100' : 'opacity-0 scale-75'}`}>\n          <div className=\"relative\">\n            <img\n              src={splashLogo}\n              alt=\"Airavoto Gaming Logo\"\n              className=\"h-48 w-48 md:h-64 md:w-64 lg:h-80 lg:w-80 object-contain drop-shadow-2xl\"\n              data-testid=\"img-splash-logo\"\n            />\n          </div>\n        </div>\n\n        {/* Brand Name */}\n        <div className={`text-center space-y-3 transition-all duration-1500 delay-300 ${showLogo ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-4'}`}>\n          <h1 className=\"text-5xl md:text-6xl lg:text-7xl font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-600 via-violet-600 to-purple-600 tracking-tight\">\n            AIRAVOTO GAMING\n          </h1>\n          <p className=\"text-purple-600 text-lg md:text-xl font-semibold\">\n            Ultimate Gaming Experience\n          </p>\n        </div>\n\n        {/* Progress Bar */}\n        <div className={`w-80 md:w-96 space-y-3 transition-all duration-1500 delay-500 ${showLogo ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-4'}`}>\n          <div className=\"relative h-3 bg-gray-200 dark:bg-gray-300 rounded-full overflow-hidden shadow-lg\">\n            <div \n              className=\"h-full bg-gradient-to-r from-purple-600 via-violet-500 to-purple-600 rounded-full transition-all duration-300 relative overflow-hidden\"\n              style={{ width: `${progress}%` }}\n            >\n              <div className=\"absolute inset-0 bg-gradient-to-r from-transparent via-white/40 to-transparent animate-shimmer\"></div>\n            </div>\n          </div>\n          \n          <div className=\"flex items-center justify-between text-purple-700 text-sm md:text-base font-bold\">\n            <span>Loading Experience</span>\n            <span>{progress}%</span>\n          </div>\n        </div>\n      </div>\n\n      <style>{`\n        @keyframes scroll-bg {\n          0% {\n            transform: translateX(0);\n          }\n          100% {\n            transform: translateX(-50%);\n          }\n        }\n        \n        @keyframes shimmer {\n          0% {\n            transform: translateX(-100%);\n          }\n          100% {\n            transform: translateX(100%);\n          }\n        }\n        \n        .animate-scroll-bg {\n          animation: scroll-bg 30s linear infinite;\n        }\n        \n        .animate-scroll-bg-delay {\n          animation: scroll-bg 40s linear infinite;\n        }\n        \n        .animate-shimmer {\n          animation: shimmer 2s linear infinite;\n        }\n        \n        .duration-1500 {\n          transition-duration: 1500ms;\n        }\n        \n        .delay-300 {\n          transition-delay: 300ms;\n        }\n        \n        .delay-500 {\n          transition-delay: 500ms;\n        }\n      `}</style>\n    </div>\n  );\n}\n","path":null,"size_bytes":4818,"size_tokens":null},"client/src/components/AddBookingDialog.tsx":{"content":"import { useState, useMemo, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Plus, Minus, CalendarIcon, Award, Percent, Clock, IndianRupee } from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { format, isSameDay } from \"date-fns\";\n\ninterface AddBookingDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  onConfirm?: (booking: {\n    category: string;\n    seatNumbers: number[];\n    customerName: string;\n    whatsappNumber?: string;\n    duration: string;\n    price: string;\n    personCount: number;\n    bookingType: string[];\n    bookingDate?: Date;\n    timeSlot?: string;\n  }) => void;\n  availableSeats: {\n    category: string;\n    seats: number[];\n  }[];\n}\n\ninterface PricingConfig {\n  category: string;\n  duration: string;\n  price: number;\n  personCount?: number;\n}\n\ninterface HappyHoursConfig {\n  id: string;\n  category: string;\n  startTime: string;\n  endTime: string;\n  enabled: number;\n}\n\ninterface HappyHoursPricing {\n  id: string;\n  category: string;\n  duration: string;\n  price: string;\n  personCount: number;\n}\n\ninterface Booking {\n  id: string;\n  category: string;\n  seatNumber: number;\n  seatName: string;\n  customerName: string;\n  whatsappNumber?: string;\n  startTime: string;\n  endTime: string;\n  price: string;\n  status: string;\n  bookingType: string[];\n  pausedRemainingTime?: number;\n  foodOrders: Array<{\n    foodId: string;\n    foodName: string;\n    price: string;\n    quantity: number;\n  }>;\n  createdAt: string;\n}\n\nexport function AddBookingDialog({ open, onOpenChange, onConfirm, availableSeats }: AddBookingDialogProps) {\n  const [category, setCategory] = useState<string>(\"\");\n  const [selectedSeats, setSelectedSeats] = useState<number[]>([]);\n  const [generatedGroupId, setGeneratedGroupId] = useState<string>(\"\");\n  const [deviceCustomers, setDeviceCustomers] = useState<Record<number, { name: string; phone: string; isPhoneFocused: boolean }>>({});\n  const [activeTab, setActiveTab] = useState<string>(\"\");\n  const [durationMinutes, setDurationMinutes] = useState<number>(30);\n  const [personCount, setPersonCount] = useState<number>(1);\n  const [bookingType, setBookingType] = useState<\"walk-in\" | \"upcoming\">(\"walk-in\");\n  const [bookingDate, setBookingDate] = useState<Date>();\n  const [timeSlot, setTimeSlot] = useState<string>(\"\");\n  const [timePeriodFilter, setTimePeriodFilter] = useState<\"all\" | \"am\" | \"pm\">(\"all\");\n  const [useHappyHoursPricing, setUseHappyHoursPricing] = useState<boolean>(false);\n  const [usePromotionalDiscount, setUsePromotionalDiscount] = useState<boolean>(false);\n  const [usePromotionalBonus, setUsePromotionalBonus] = useState<boolean>(false);\n  const [manualDiscountPercentage, setManualDiscountPercentage] = useState<string>(\"\");\n  const [manualFreeHoursHr, setManualFreeHoursHr] = useState<string>(\"\");\n  const [manualFreeHoursMin, setManualFreeHoursMin] = useState<string>(\"\");\n  const [showAddons, setShowAddons] = useState<boolean>(false);\n\n  const { data: pricingConfig = [] } = useQuery<PricingConfig[]>({\n    queryKey: [\"/api/pricing-config\"],\n  });\n\n  const { data: happyHoursConfigs = [] } = useQuery<HappyHoursConfig[]>({\n    queryKey: [\"/api/happy-hours-config\"],\n  });\n\n  const { data: happyHoursPricing = [] } = useQuery<HappyHoursPricing[]>({\n    queryKey: [\"/api/happy-hours-pricing\"],\n  });\n\n  const { data: happyHoursStatus } = useQuery<{ active: boolean }>({\n    queryKey: [\"/api/happy-hours-active\", category],\n    queryFn: async () => {\n      if (!category) return { active: false };\n      const response = await fetch(`/api/happy-hours-active/${category}`);\n      if (!response.ok) throw new Error('Failed to check happy hours status');\n      return response.json();\n    },\n    enabled: !!category && bookingType === \"walk-in\",\n  });\n\n  // Check if Happy Hours is active for the selected upcoming time slot\n  const { data: upcomingHappyHoursStatus } = useQuery<{ active: boolean }>({\n    queryKey: [\"/api/happy-hours-active-for-time\", category, timeSlot],\n    queryFn: async () => {\n      if (!category || !timeSlot) return { active: false };\n      const response = await fetch(`/api/happy-hours-active-for-time/${category}?timeSlot=${timeSlot}`);\n      if (!response.ok) throw new Error('Failed to check happy hours status for time slot');\n      return response.json();\n    },\n    enabled: !!category && !!timeSlot && bookingType === \"upcoming\",\n  });\n\n  // Check if happy hours is active for walk-in bookings (current time)\n  const isWalkInHappyHoursActive = useMemo(() => {\n    return bookingType === \"walk-in\" && happyHoursStatus?.active;\n  }, [bookingType, happyHoursStatus]);\n\n  const { data: allBookings = [] } = useQuery<Booking[]>({\n    queryKey: [\"/api/bookings\"],\n    enabled: bookingType === \"upcoming\" && !!bookingDate,\n  });\n\n  const { data: upcomingAvailableSeats = [], isLoading: isLoadingSeats } = useQuery<{ category: string; seats: number[] }[]>({\n    queryKey: [\"/api/bookings/available-seats\", { \n      date: bookingDate?.toISOString(), \n      timeSlot, \n      durationMinutes \n    }],\n    queryFn: async ({ queryKey }) => {\n      const [url, params] = queryKey as [string, { date?: string; timeSlot?: string; durationMinutes?: number }];\n      const searchParams = new URLSearchParams();\n      if (params.date) searchParams.append('date', params.date);\n      if (params.timeSlot) searchParams.append('timeSlot', params.timeSlot);\n      if (params.durationMinutes) searchParams.append('durationMinutes', params.durationMinutes.toString());\n      \n      const response = await fetch(`${url}?${searchParams.toString()}`);\n      if (!response.ok) {\n        throw new Error('Failed to fetch available seats');\n      }\n      return response.json();\n    },\n    enabled: bookingType === \"upcoming\" && !!bookingDate && !!timeSlot && durationMinutes > 0,\n  });\n\n  const seatsToDisplay = bookingType === \"upcoming\" && bookingDate && timeSlot && durationMinutes > 0\n    ? upcomingAvailableSeats\n    : availableSeats;\n\n  const selectedCategory = seatsToDisplay.find(c => c.category === category);\n  \n  // Get Happy Hours config for the category\n  const happyHoursConfig = happyHoursConfigs.find(config => \n    config.category === category && config.enabled === 1\n  );\n  \n  const slots = category \n    ? pricingConfig\n        .filter(config => config.category === category)\n        .map(config => ({ duration: config.duration, price: config.price, personCount: config.personCount }))\n    : [];\n  \n  // Get Happy Hours pricing slots for the category\n  const happyHoursSlots = category\n    ? happyHoursPricing\n        .filter(pricing => pricing.category === category)\n        .map(pricing => ({ duration: pricing.duration, price: pricing.price, personCount: pricing.personCount }))\n    : [];\n  \n  const getDurationString = (mins: number) => {\n    if (mins < 60) return `${mins} mins`;\n    const hours = Math.floor(mins / 60);\n    const remainingMins = mins % 60;\n    if (remainingMins === 0) return hours === 1 ? \"1 hour\" : `${hours} hours`;\n    return `${hours} hour${hours > 1 ? 's' : ''} ${remainingMins} mins`;\n  };\n\n  const duration = getDurationString(durationMinutes);\n  \n  const { data: availablePromotions } = useQuery<{\n    discount: { id: string; percentage: number; description: string } | null;\n    bonus: { id: string; hours: string; description: string } | null;\n  }>({\n    queryKey: [\"/api/bookings/check-promotions\", category, duration, personCount],\n    queryFn: async () => {\n      const params = new URLSearchParams({\n        category: category || '',\n        duration: duration || '',\n        personCount: personCount.toString()\n      });\n      const response = await fetch(`/api/bookings/check-promotions?${params.toString()}`, {\n        credentials: 'include'\n      });\n      if (!response.ok) throw new Error('Failed to check promotions');\n      return response.json();\n    },\n    enabled: !!category && !!duration && !useHappyHoursPricing,\n  });\n  \n  // For PS5, match both duration and personCount; for others, just match duration\n  const selectedSlot = category === \"PS5\" \n    ? slots.find(s => s.duration === duration && s.personCount === personCount)\n    : slots.find(s => s.duration === duration);\n  const selectedHappyHoursSlot = category === \"PS5\"\n    ? happyHoursSlots.find(s => s.duration === duration && s.personCount === personCount)\n    : happyHoursSlots.find(s => s.duration === duration);\n\n  // Calculate final price\n  const calculateFinalPrice = () => {\n    const shouldUseHappyHoursPricing = (bookingType === \"walk-in\" && useHappyHoursPricing) || (bookingType === \"upcoming\" && useHappyHoursPricing);\n    const slot = shouldUseHappyHoursPricing ? selectedHappyHoursSlot : selectedSlot;\n    if (!slot) return null;\n\n    let basePrice = parseFloat(slot.price.toString());\n\n    return Math.round(basePrice).toString();\n  };\n\n  // Calculate price breakdown for preview\n  const getPriceBreakdown = () => {\n    const shouldUseHappyHoursPricing = (bookingType === \"walk-in\" && useHappyHoursPricing) || (bookingType === \"upcoming\" && useHappyHoursPricing);\n    const slot = shouldUseHappyHoursPricing ? selectedHappyHoursSlot : selectedSlot;\n    if (!slot) return null;\n\n    const originalPrice = parseFloat(slot.price.toString());\n    let discount = 0;\n    let discountType = \"\";\n\n    // Calculate discount from manual discount percentage\n    if (manualDiscountPercentage && parseFloat(manualDiscountPercentage) > 0) {\n      discount = (originalPrice * parseFloat(manualDiscountPercentage)) / 100;\n      discountType = `${manualDiscountPercentage}% Manual Discount`;\n    }\n\n    const finalPrice = originalPrice - discount;\n\n    return {\n      originalPrice: Math.round(originalPrice),\n      discount: Math.round(discount),\n      discountType,\n      finalPrice: Math.round(finalPrice),\n      hasDiscount: discount > 0\n    };\n  };\n\n  const priceBreakdown = getPriceBreakdown();\n  \n  // Check if next person count has pricing configured (for PS5)\n  const hasNextPersonPricing = category === \"PS5\" && !useHappyHoursPricing\n    ? slots.some(s => s.duration === duration && s.personCount === personCount + 1)\n    : false;\n  const hasNextPersonHappyHoursPricing = category === \"PS5\" && useHappyHoursPricing\n    ? happyHoursSlots.some(s => s.duration === duration && s.personCount === personCount + 1)\n    : false;\n\n  const generateGroupId = () => {\n    const timestamp = Date.now().toString(36).toUpperCase();\n    const random = Math.random().toString(36).substring(2, 8).toUpperCase();\n    return `GRP-${timestamp}-${random}`;\n  };\n\n  const toggleSeat = (seatNumber: number) => {\n    setSelectedSeats(prev => {\n      const newSeats = prev.includes(seatNumber)\n        ? prev.filter(s => s !== seatNumber)\n        : [...prev, seatNumber];\n      \n      if (!prev.includes(seatNumber)) {\n        setDeviceCustomers(prevCustomers => ({\n          ...prevCustomers,\n          [seatNumber]: { name: \"\", phone: \"\", isPhoneFocused: false }\n        }));\n        \n        if (!activeTab || activeTab === \"\") {\n          setActiveTab(seatNumber.toString());\n        }\n      } else {\n        setDeviceCustomers(prevCustomers => {\n          const { [seatNumber]: _, ...rest } = prevCustomers;\n          return rest;\n        });\n        \n        if (activeTab === seatNumber.toString() && newSeats.length > 0) {\n          setActiveTab(newSeats[0].toString());\n        }\n      }\n      \n      if (newSeats.length > 1 && !generatedGroupId) {\n        setGeneratedGroupId(generateGroupId());\n      } else if (newSeats.length <= 1) {\n        setGeneratedGroupId(\"\");\n      }\n      \n      return newSeats;\n    });\n  };\n  \n  const updateDeviceCustomer = (seatNumber: number, field: 'name' | 'phone' | 'isPhoneFocused', value: string | boolean) => {\n    setDeviceCustomers(prev => ({\n      ...prev,\n      [seatNumber]: {\n        ...prev[seatNumber],\n        [field]: value\n      }\n    }));\n  };\n\n  const handleConfirm = async () => {\n    const isDateRequired = bookingType === \"upcoming\" && !bookingDate;\n    const isTimeSlotRequired = bookingType === \"upcoming\" && !timeSlot;\n    \n    let allDevicesHaveCustomers = true;\n    let invalidPhones: number[] = [];\n    \n    for (const seatNumber of selectedSeats) {\n      const customer = deviceCustomers[seatNumber];\n      if (!customer || !customer.name.trim()) {\n        allDevicesHaveCustomers = false;\n        break;\n      }\n      \n      if (bookingType === \"upcoming\") {\n        if (!customer.phone.trim()) {\n          allDevicesHaveCustomers = false;\n          break;\n        }\n        if (customer.phone.trim() && customer.phone.length !== 10) {\n          invalidPhones.push(seatNumber);\n        }\n      } else if (customer.phone.trim() && customer.phone.length !== 10) {\n        invalidPhones.push(seatNumber);\n      }\n    }\n    \n    // Determine which pricing to use\n    const shouldUseHappyHoursPricing = (bookingType === \"walk-in\" && useHappyHoursPricing) || (bookingType === \"upcoming\" && useHappyHoursPricing);\n    const hasValidPrice = shouldUseHappyHoursPricing ? selectedHappyHoursSlot : selectedSlot;\n    \n    if (category && selectedSeats.length > 0 && allDevicesHaveCustomers && invalidPhones.length === 0 && duration && hasValidPrice && !isDateRequired && !isTimeSlotRequired) {\n      let finalPersonCount: number;\n      \n      if (shouldUseHappyHoursPricing) {\n        finalPersonCount = category === \"PS5\" ? personCount : 1;\n      } else if (category === \"PS5\") {\n        finalPersonCount = personCount;\n      } else {\n        finalPersonCount = 1;\n      }\n      \n      const finalPrice = calculateFinalPrice() || hasValidPrice.price.toString();\n      \n      let bookingTypes: string[];\n      if (bookingType === \"upcoming\" && useHappyHoursPricing) {\n        bookingTypes = [\"upcoming\", \"happy-hours\"];\n      } else if (bookingType === \"walk-in\" && useHappyHoursPricing) {\n        bookingTypes = [\"walk-in\", \"happy-hours\"];\n      } else {\n        bookingTypes = [bookingType];\n      }\n      \n      let manualFreeHours: string | undefined = undefined;\n      if (manualFreeHoursHr || manualFreeHoursMin) {\n        const hours = parseInt(manualFreeHoursHr) || 0;\n        const minutes = parseInt(manualFreeHoursMin) || 0;\n        manualFreeHours = `${hours}:${minutes.toString().padStart(2, '0')}`;\n      }\n      \n      // Create session group if multiple devices are selected\n      let groupId: string | undefined = undefined;\n      let groupCode: string | undefined = undefined;\n      if (selectedSeats.length > 1 && generatedGroupId) {\n        try {\n          const response = await fetch(\"/api/session-groups\", {\n            method: \"POST\",\n            headers: { \"Content-Type\": \"application/json\" },\n            body: JSON.stringify({\n              groupName: generatedGroupId,\n              category,\n              bookingType: bookingTypes,\n            }),\n          });\n          \n          if (response.ok) {\n            const sessionGroup = await response.json();\n            groupId = sessionGroup.id;\n            groupCode = sessionGroup.groupCode;\n          }\n        } catch (error) {\n          console.error(\"Failed to create session group:\", error);\n        }\n      }\n      \n      for (const seatNumber of selectedSeats) {\n        const customer = deviceCustomers[seatNumber];\n        onConfirm?.({\n          category,\n          seatNumbers: [seatNumber],\n          customerName: customer.name,\n          whatsappNumber: customer.phone.trim() || undefined,\n          duration,\n          price: finalPrice,\n          personCount: finalPersonCount,\n          bookingType: bookingTypes,\n          bookingDate: bookingType === \"upcoming\" ? bookingDate : undefined,\n          timeSlot: bookingType === \"upcoming\" ? timeSlot : undefined,\n          usePromotionalDiscount,\n          usePromotionalBonus,\n          manualDiscountPercentage: manualDiscountPercentage ? parseInt(manualDiscountPercentage) : undefined,\n          manualFreeHours: manualFreeHours,\n          groupId: groupId,\n          groupCode: groupCode,\n        } as any);\n      }\n      \n      setCategory(\"\");\n      setSelectedSeats([]);\n      setGeneratedGroupId(\"\");\n      setDeviceCustomers({});\n      setActiveTab(\"\");\n      setDurationMinutes(30);\n      setPersonCount(1);\n      setBookingType(\"walk-in\");\n      setBookingDate(undefined);\n      setTimeSlot(\"\");\n      setUseHappyHoursPricing(false);\n      setUsePromotionalDiscount(false);\n      setUsePromotionalBonus(false);\n      setManualDiscountPercentage(\"\");\n      setManualFreeHoursHr(\"\");\n      setManualFreeHoursMin(\"\");\n      setShowAddons(false);\n      onOpenChange(false);\n    }\n  };\n\n  const handleCategoryChange = (newCategory: string) => {\n    setCategory(newCategory);\n    setSelectedSeats([]);\n    setPersonCount(1);\n    setUseHappyHoursPricing(false);\n  };\n\n  const increaseDuration = () => {\n    setDurationMinutes(prev => prev + 30);\n  };\n\n  const decreaseDuration = () => {\n    setDurationMinutes(prev => Math.max(30, prev - 30));\n  };\n\n  const increasePersonCount = () => {\n    setPersonCount(prev => prev + 1);\n  };\n\n  const decreasePersonCount = () => {\n    setPersonCount(prev => Math.max(1, prev - 1));\n  };\n\n  const latestBookingEndTime = useMemo(() => {\n    if (!bookingDate || !allBookings.length) return null;\n    \n    const isToday = isSameDay(bookingDate, new Date());\n    if (!isToday) return null;\n    \n    const todayBookings = allBookings.filter(booking => {\n      const bookingStart = new Date(booking.startTime);\n      return isSameDay(bookingStart, bookingDate) && \n             (booking.status === \"running\" || booking.status === \"paused\" || booking.status === \"upcoming\");\n    });\n    \n    if (todayBookings.length === 0) return null;\n    \n    const latestEnd = todayBookings.reduce((latest, booking) => {\n      const endTime = new Date(booking.endTime);\n      return endTime > latest ? endTime : latest;\n    }, new Date(0));\n    \n    return latestEnd;\n  }, [bookingDate, allBookings]);\n\n  const generateTimeSlots = () => {\n    const allSlots = [];\n    const totalMinutesInDay = 24 * 60;\n    \n    let startMinutes = 0;\n    \n    if (latestBookingEndTime && bookingDate && isSameDay(bookingDate, new Date())) {\n      const endHour = latestBookingEndTime.getHours();\n      const endMin = latestBookingEndTime.getMinutes();\n      startMinutes = endHour * 60 + endMin;\n    }\n    \n    while (startMinutes < totalMinutesInDay) {\n      const endMinutes = startMinutes + durationMinutes;\n      if (endMinutes > totalMinutesInDay) break;\n      \n      const startHour = Math.floor(startMinutes / 60);\n      const startMin = startMinutes % 60;\n      const endHour = Math.floor(endMinutes / 60);\n      const endMin = endMinutes % 60;\n      \n      const formatTime = (hour: number, min: number) => {\n        const period = hour < 12 ? 'AM' : 'PM';\n        const displayHour = hour === 0 ? 12 : hour > 12 ? hour - 12 : hour;\n        const displayMin = min.toString().padStart(2, '0');\n        return `${displayHour}:${displayMin} ${period}`;\n      };\n      \n      const label = `${formatTime(startHour, startMin)} - ${formatTime(endHour, endMin)}`;\n      const value = `${startHour.toString().padStart(2, '0')}:${startMin.toString().padStart(2, '0')}-${endHour.toString().padStart(2, '0')}:${endMin.toString().padStart(2, '0')}`;\n      \n      allSlots.push({ label, value, startHour });\n      \n      startMinutes = endMinutes;\n    }\n    \n    if (timePeriodFilter === \"am\") {\n      return allSlots.filter(slot => slot.startHour < 12);\n    } else if (timePeriodFilter === \"pm\") {\n      return allSlots.filter(slot => slot.startHour >= 12);\n    }\n    \n    return allSlots;\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-md sm:max-w-lg md:max-w-2xl max-h-[90vh] overflow-y-auto\" data-testid=\"dialog-add-booking\">\n        <DialogHeader>\n          <DialogTitle>Add New Booking</DialogTitle>\n          <DialogDescription>\n            Select multiple seats for the same customer and time slot.\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label>Booking Type</Label>\n            <RadioGroup value={bookingType} onValueChange={(value) => setBookingType(value as \"walk-in\" | \"upcoming\")}>\n              <div className=\"flex items-center space-x-2\">\n                <RadioGroupItem value=\"walk-in\" id=\"walk-in\" data-testid=\"radio-walk-in\" />\n                <Label htmlFor=\"walk-in\" className=\"cursor-pointer font-normal\">Walk-in (Start Now)</Label>\n              </div>\n              <div className=\"flex items-center space-x-2\">\n                <RadioGroupItem value=\"upcoming\" id=\"upcoming\" data-testid=\"radio-upcoming\" />\n                <Label htmlFor=\"upcoming\" className=\"cursor-pointer font-normal\">Upcoming Booking</Label>\n              </div>\n            </RadioGroup>\n          </div>\n\n          {bookingType === \"upcoming\" && (\n            <>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"duration\">Duration <span className=\"text-destructive\">*</span></Label>\n                <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-3\">\n                  <div className=\"flex items-center gap-2 flex-1 w-full sm:w-auto\">\n                    <div className=\"flex items-center gap-1\">\n                      <Input\n                        type=\"number\"\n                        min=\"0\"\n                        value={Math.floor(durationMinutes / 60)}\n                        onChange={(e) => {\n                          const hours = Math.max(0, parseInt(e.target.value) || 0);\n                          const mins = durationMinutes % 60;\n                          setDurationMinutes(hours * 60 + mins);\n                        }}\n                        className=\"w-16 text-center\"\n                        data-testid=\"input-hours\"\n                      />\n                      <span className=\"text-sm text-muted-foreground\">hr</span>\n                    </div>\n                    <div className=\"flex items-center gap-1\">\n                      <Input\n                        type=\"number\"\n                        min=\"0\"\n                        step=\"30\"\n                        value={durationMinutes % 60}\n                        onChange={(e) => {\n                          const value = parseInt(e.target.value) || 0;\n                          const mins = value >= 30 ? 30 : 0;\n                          const hours = Math.floor(durationMinutes / 60);\n                          setDurationMinutes(hours * 60 + mins);\n                        }}\n                        className=\"w-16 text-center\"\n                        data-testid=\"input-minutes\"\n                      />\n                      <span className=\"text-sm text-muted-foreground\">min</span>\n                    </div>\n                  </div>\n                  <div className=\"flex gap-1\">\n                    <Button \n                      type=\"button\"\n                      variant=\"outline\" \n                      size=\"icon\"\n                      onClick={decreaseDuration}\n                      disabled={durationMinutes <= 30}\n                      data-testid=\"button-decrease-duration\"\n                    >\n                      <Minus className=\"h-4 w-4\" />\n                    </Button>\n                    <Button \n                      type=\"button\"\n                      variant=\"outline\" \n                      size=\"icon\"\n                      onClick={increaseDuration}\n                      data-testid=\"button-increase-duration\"\n                    >\n                      <Plus className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label>\n                  Date <span className=\"text-destructive\">*</span>\n                </Label>\n                <Popover>\n                  <PopoverTrigger asChild>\n                    <Button\n                      variant=\"outline\"\n                      className=\"w-full justify-start text-left font-normal\"\n                      data-testid=\"button-select-date\"\n                    >\n                      <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                      {bookingDate ? format(bookingDate, \"PPP\") : <span>Pick a date</span>}\n                    </Button>\n                  </PopoverTrigger>\n                  <PopoverContent className=\"w-auto p-0\" align=\"start\">\n                    <Calendar\n                      mode=\"single\"\n                      selected={bookingDate}\n                      onSelect={setBookingDate}\n                      disabled={(date) => date < new Date(new Date().setHours(0, 0, 0, 0))}\n                      initialFocus\n                    />\n                  </PopoverContent>\n                </Popover>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"timeSlot\">\n                  Time Slot <span className=\"text-destructive\">*</span>\n                </Label>\n                <div className=\"grid grid-cols-3 gap-2 mb-2\">\n                  <Button\n                    type=\"button\"\n                    variant={timePeriodFilter === \"all\" ? \"default\" : \"outline\"}\n                    size=\"sm\"\n                    onClick={() => setTimePeriodFilter(\"all\")}\n                    data-testid=\"button-filter-all\"\n                  >\n                    All Day\n                  </Button>\n                  <Button\n                    type=\"button\"\n                    variant={timePeriodFilter === \"am\" ? \"default\" : \"outline\"}\n                    size=\"sm\"\n                    onClick={() => setTimePeriodFilter(\"am\")}\n                    data-testid=\"button-filter-am\"\n                  >\n                    AM\n                  </Button>\n                  <Button\n                    type=\"button\"\n                    variant={timePeriodFilter === \"pm\" ? \"default\" : \"outline\"}\n                    size=\"sm\"\n                    onClick={() => setTimePeriodFilter(\"pm\")}\n                    data-testid=\"button-filter-pm\"\n                  >\n                    PM\n                  </Button>\n                </div>\n                <Select value={timeSlot} onValueChange={setTimeSlot}>\n                  <SelectTrigger id=\"timeSlot\" data-testid=\"select-time-slot\">\n                    <SelectValue placeholder={`Select ${duration} time slot`} />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {generateTimeSlots().map((slot) => (\n                      <SelectItem key={slot.value} value={slot.value} data-testid={`option-timeslot-${slot.value}`}>\n                        {slot.label}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              {/* Happy Hours Pricing Option for Upcoming Bookings */}\n              {category && upcomingHappyHoursStatus?.active && happyHoursSlots.length > 0 && (\n                <div className=\"flex items-center space-x-2 p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-md border border-yellow-200 dark:border-yellow-800\">\n                  <Checkbox\n                    id=\"use-happy-hours-pricing\"\n                    checked={useHappyHoursPricing}\n                    onCheckedChange={(checked) => setUseHappyHoursPricing(checked as boolean)}\n                    data-testid=\"checkbox-use-happy-hours-pricing\"\n                  />\n                  <div className=\"flex-1\">\n                    <Label htmlFor=\"use-happy-hours-pricing\" className=\"cursor-pointer font-medium text-yellow-900 dark:text-yellow-100\">\n                      Use Happy Hours Pricing üéâ\n                    </Label>\n                    <p className=\"text-xs text-yellow-700 dark:text-yellow-300 mt-1\">\n                      This time slot falls within Happy Hours! Get special pricing.\n                    </p>\n                  </div>\n                </div>\n              )}\n            </>\n          )}\n\n          {(bookingType === \"walk-in\" || (bookingType === \"upcoming\" && bookingDate && timeSlot && durationMinutes > 0)) && (\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"category\">Category <span className=\"text-destructive\">*</span></Label>\n              <Select value={category} onValueChange={handleCategoryChange}>\n                <SelectTrigger id=\"category\" data-testid=\"select-category\">\n                  <SelectValue placeholder=\"Select category\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {isLoadingSeats && bookingType === \"upcoming\" ? (\n                    <SelectItem value=\"loading\" disabled data-testid=\"option-loading\">\n                      Loading available seats...\n                    </SelectItem>\n                  ) : seatsToDisplay.length === 0 ? (\n                    <SelectItem value=\"none\" disabled data-testid=\"option-no-seats\">\n                      No seats available for this time slot\n                    </SelectItem>\n                  ) : (\n                    seatsToDisplay.map((cat) => (\n                      <SelectItem key={cat.category} value={cat.category} data-testid={`option-${cat.category.toLowerCase()}`}>\n                        {cat.category} ({cat.seats.length} available)\n                      </SelectItem>\n                    ))\n                  )}\n                </SelectContent>\n              </Select>\n            </div>\n          )}\n\n          {category && selectedCategory && selectedCategory.seats.length > 0 && (\n            <div className=\"space-y-2\">\n              <Label>\n                Select Devices ({selectedSeats.length} selected)\n              </Label>\n              <div className=\"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-2 max-h-48 overflow-y-auto p-3 border rounded-md bg-muted/30\">\n                {selectedCategory.seats.map((seat) => (\n                  <div\n                    key={seat}\n                    className=\"flex items-center space-x-2\"\n                    data-testid={`checkbox-seat-${seat}`}\n                  >\n                    <Checkbox\n                      id={`seat-${seat}`}\n                      checked={selectedSeats.includes(seat)}\n                      onCheckedChange={() => toggleSeat(seat)}\n                    />\n                    <Label\n                      htmlFor={`seat-${seat}`}\n                      className=\"cursor-pointer text-sm font-normal whitespace-nowrap\"\n                    >\n                      {category}-{seat}\n                    </Label>\n                  </div>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {selectedSeats.length > 1 && generatedGroupId && (\n            <div className=\"space-y-2\">\n              <Label>Group ID (Auto-generated)</Label>\n              <div className=\"flex items-center gap-2 p-3 bg-muted/50 rounded-md border\">\n                <span className=\"font-mono text-sm font-medium\" data-testid=\"text-group-id\">\n                  {generatedGroupId}\n                </span>\n              </div>\n              <p className=\"text-xs text-muted-foreground\">\n                This will group {selectedSeats.length} devices into one booking session\n              </p>\n            </div>\n          )}\n\n          {selectedSeats.length > 0 && (\n            <div className=\"space-y-2\">\n              <Label>Customer Details for Each Device</Label>\n              <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n                <TabsList className=\"w-full flex-wrap h-auto gap-1\">\n                  {selectedSeats.map((seat) => (\n                    <TabsTrigger \n                      key={seat} \n                      value={seat.toString()}\n                      data-testid={`tab-device-${seat}`}\n                      className=\"flex-1 min-w-[80px]\"\n                    >\n                      {category}-{seat}\n                    </TabsTrigger>\n                  ))}\n                </TabsList>\n                {selectedSeats.map((seat) => {\n                  const customer = deviceCustomers[seat] || { name: \"\", phone: \"\", isPhoneFocused: false };\n                  return (\n                    <TabsContent key={seat} value={seat.toString()} className=\"space-y-3 mt-3\">\n                      <div className=\"space-y-2\">\n                        <Label htmlFor={`customer-name-${seat}`}>\n                          Customer Name <span className=\"text-destructive\">*</span>\n                        </Label>\n                        <Input\n                          id={`customer-name-${seat}`}\n                          value={customer.name}\n                          onChange={(e) => updateDeviceCustomer(seat, 'name', e.target.value)}\n                          placeholder=\"Enter customer name\"\n                          data-testid={`input-customer-name-${seat}`}\n                        />\n                      </div>\n                      \n                      <div className=\"space-y-2\">\n                        <Label htmlFor={`whatsapp-${seat}`}>\n                          WhatsApp Number {bookingType === \"upcoming\" && <span className=\"text-destructive\">*</span>}\n                        </Label>\n                        <div className=\"relative\">\n                          <Input\n                            id={`whatsapp-${seat}`}\n                            value={\n                              customer.isPhoneFocused\n                                ? customer.phone.replace(/(\\d{5})(\\d{1,5})/, '$1 $2')\n                                : customer.phone.length > 0\n                                ? 'xxxxx xxxxx'\n                                : ''\n                            }\n                            onChange={(e) => {\n                              const value = e.target.value.replace(/\\D/g, '');\n                              if (value.length <= 10) {\n                                updateDeviceCustomer(seat, 'phone', value);\n                              }\n                            }}\n                            onFocus={() => updateDeviceCustomer(seat, 'isPhoneFocused', true)}\n                            onBlur={() => updateDeviceCustomer(seat, 'isPhoneFocused', false)}\n                            placeholder=\"xxxxx xxxxx\"\n                            data-testid={`input-whatsapp-${seat}`}\n                            className={`pr-16 ${\n                              customer.phone.length > 0 && customer.phone.length < 10\n                                ? 'border-destructive focus-visible:ring-destructive'\n                                : customer.phone.length === 10\n                                ? 'border-green-500 focus-visible:ring-green-500'\n                                : ''\n                            }`}\n                          />\n                          <div className={`absolute right-3 top-1/2 -translate-y-1/2 text-xs font-medium ${\n                            customer.phone.length === 0\n                              ? 'text-muted-foreground'\n                              : customer.phone.length < 10\n                              ? 'text-destructive'\n                              : 'text-green-600'\n                          }`}>\n                            {customer.phone.length}/10\n                          </div>\n                        </div>\n                        {customer.phone.length > 0 && customer.phone.length < 10 && (\n                          <p className=\"text-xs text-destructive flex items-center gap-1\">\n                            ‚ö†Ô∏è Please enter all 10 digits ({10 - customer.phone.length} more needed)\n                          </p>\n                        )}\n                        {customer.phone.length === 10 && (\n                          <p className=\"text-xs text-green-600 flex items-center gap-1\">\n                            ‚úì Valid Indian mobile number\n                          </p>\n                        )}\n                        {bookingType === \"upcoming\" && customer.phone.length === 0 && (\n                          <p className=\"text-xs text-muted-foreground\">Required for upcoming bookings</p>\n                        )}\n                      </div>\n                    </TabsContent>\n                  );\n                })}\n              </Tabs>\n            </div>\n          )}\n\n          {category === \"PS5\" && (\n            <div className=\"space-y-2\">\n              <Label>Number of Persons</Label>\n              <div className=\"flex flex-col sm:flex-row items-stretch sm:items-center gap-3\">\n                <div className=\"flex items-center gap-2 flex-1\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"icon\"\n                    onClick={decreasePersonCount}\n                    disabled={personCount <= 1}\n                    data-testid=\"button-decrease-person\"\n                    className=\"shrink-0\"\n                  >\n                    <Minus className=\"h-4 w-4\" />\n                  </Button>\n                  <div className=\"flex-1 text-center font-semibold py-2\" data-testid=\"text-person-count\">\n                    {personCount} {personCount === 1 ? 'Person' : 'Persons'}\n                  </div>\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"icon\"\n                    onClick={increasePersonCount}\n                    disabled={useHappyHoursPricing ? !hasNextPersonHappyHoursPricing : !hasNextPersonPricing}\n                    data-testid=\"button-increase-person\"\n                    className=\"shrink-0\"\n                  >\n                    <Plus className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </div>\n              {(useHappyHoursPricing ? selectedHappyHoursSlot : selectedSlot) ? (\n                <p className=\"text-xs text-muted-foreground\">\n                  {duration} for {personCount} {personCount === 1 ? 'person' : 'persons'}: ‚Çπ{\n                    useHappyHoursPricing \n                      ? selectedHappyHoursSlot!.price\n                      : selectedSlot!.price\n                  } (Total Price)\n                </p>\n              ) : (\n                <p className=\"text-xs text-destructive\">\n                  No pricing configured for {duration} with {personCount} {personCount === 1 ? 'person' : 'persons'}\n                </p>\n              )}\n            </div>\n          )}\n\n          {bookingType === \"walk-in\" && category && (\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"duration\">Duration</Label>\n              <div className=\"flex flex-col sm:flex-row items-start sm:items-center gap-3\">\n                <div className=\"flex items-center gap-2 flex-1 w-full sm:w-auto\">\n                  <div className=\"flex items-center gap-1\">\n                    <Input\n                      type=\"number\"\n                      min=\"0\"\n                      value={Math.floor(durationMinutes / 60)}\n                      onChange={(e) => {\n                        const hours = Math.max(0, parseInt(e.target.value) || 0);\n                        const mins = durationMinutes % 60;\n                        setDurationMinutes(hours * 60 + mins);\n                      }}\n                      className=\"w-16 text-center\"\n                      data-testid=\"input-hours\"\n                    />\n                    <span className=\"text-sm text-muted-foreground\">hr</span>\n                  </div>\n                  <div className=\"flex items-center gap-1\">\n                    <Input\n                      type=\"number\"\n                      min=\"0\"\n                      step=\"30\"\n                      value={durationMinutes % 60}\n                      onChange={(e) => {\n                        const value = parseInt(e.target.value) || 0;\n                        const mins = value >= 30 ? 30 : 0;\n                        const hours = Math.floor(durationMinutes / 60);\n                        setDurationMinutes(hours * 60 + mins);\n                      }}\n                      className=\"w-16 text-center\"\n                      data-testid=\"input-minutes\"\n                    />\n                    <span className=\"text-sm text-muted-foreground\">min</span>\n                  </div>\n                </div>\n                <div className=\"flex gap-1\">\n                  <Button \n                    type=\"button\"\n                    variant=\"outline\" \n                    size=\"icon\"\n                    onClick={decreaseDuration}\n                    disabled={durationMinutes <= 30}\n                    data-testid=\"button-decrease-duration\"\n                  >\n                    <Minus className=\"h-4 w-4\" />\n                  </Button>\n                  <Button \n                    type=\"button\"\n                    variant=\"outline\" \n                    size=\"icon\"\n                    onClick={increaseDuration}\n                    data-testid=\"button-increase-duration\"\n                  >\n                    <Plus className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </div>\n              {bookingType === \"walk-in\" && selectedSlot && !useHappyHoursPricing && (\n                <div className=\"text-sm text-muted-foreground\" data-testid=\"text-price\">\n                  Price: ‚Çπ{selectedSlot.price}\n                </div>\n              )}\n            </div>\n          )}\n\n          {/* Happy Hours Pricing for Walk-in */}\n          {bookingType === \"walk-in\" && category && isWalkInHappyHoursActive && selectedHappyHoursSlot && (\n            <div className=\"flex items-start space-x-2 p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-md border border-yellow-200 dark:border-yellow-800\">\n              <Checkbox\n                id=\"use-happy-hours-pricing-walk-in\"\n                checked={useHappyHoursPricing}\n                onCheckedChange={(checked) => setUseHappyHoursPricing(checked as boolean)}\n                data-testid=\"checkbox-use-happy-hours-pricing-walk-in\"\n              />\n              <div className=\"flex-1\">\n                <Label htmlFor=\"use-happy-hours-pricing-walk-in\" className=\"cursor-pointer font-medium text-yellow-900 dark:text-yellow-100\">\n                  Use Happy Hours Pricing üéâ\n                </Label>\n                <p className=\"text-xs text-yellow-700 dark:text-yellow-300 mt-1\">\n                  This time slot falls within Happy Hours! Get special pricing.\n                </p>\n              </div>\n            </div>\n          )}\n\n          {/* Promotional Discount/Bonus Prompts */}\n          {availablePromotions && !useHappyHoursPricing && (\n            <div className=\"space-y-2\">\n              {availablePromotions.discount && !usePromotionalBonus && !manualFreeHoursHr && !manualFreeHoursMin && (\n                <div className=\"flex items-start space-x-2 p-3 bg-green-50 dark:bg-green-900/20 rounded-md border border-green-200 dark:border-green-800\">\n                  <Checkbox\n                    id=\"use-promotional-discount\"\n                    checked={usePromotionalDiscount}\n                    onCheckedChange={(checked) => {\n                      setUsePromotionalDiscount(checked as boolean);\n                      if (checked) {\n                        setUsePromotionalBonus(false);\n                        setManualDiscountPercentage(\"\");\n                        setManualFreeHoursHr(\"\");\n                        setManualFreeHoursMin(\"\");\n                      }\n                    }}\n                    data-testid=\"checkbox-use-promotional-discount\"\n                  />\n                  <div className=\"flex-1\">\n                    <Label htmlFor=\"use-promotional-discount\" className=\"cursor-pointer font-medium text-green-900 dark:text-green-100 flex items-center gap-2\">\n                      <Percent className=\"h-4 w-4\" />\n                      Discount Promotion Available!\n                    </Label>\n                    <p className=\"text-sm text-green-700 dark:text-green-300 mt-1\">\n                      {availablePromotions.discount.description} - Do you want to use it? \n                      <span className=\"block text-xs mt-1 font-medium\">\n                        Note: Add-ons discount cannot be used with promotional discount\n                      </span>\n                    </p>\n                  </div>\n                </div>\n              )}\n\n              {availablePromotions.bonus && !usePromotionalDiscount && !manualDiscountPercentage && (\n                <div className=\"flex items-start space-x-2 p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-md border border-yellow-200 dark:border-yellow-800\">\n                  <Checkbox\n                    id=\"use-promotional-bonus\"\n                    checked={usePromotionalBonus}\n                    onCheckedChange={(checked) => {\n                      setUsePromotionalBonus(checked as boolean);\n                      if (checked) {\n                        setUsePromotionalDiscount(false);\n                        setManualFreeHoursHr(\"\");\n                        setManualFreeHoursMin(\"\");\n                        setManualDiscountPercentage(\"\");\n                      }\n                    }}\n                    data-testid=\"checkbox-use-promotional-bonus\"\n                  />\n                  <div className=\"flex-1\">\n                    <Label htmlFor=\"use-promotional-bonus\" className=\"cursor-pointer font-medium text-yellow-900 dark:text-yellow-100 flex items-center gap-2\">\n                      <Award className=\"h-4 w-4\" />\n                      Bonus Hours Promotion Available!\n                    </Label>\n                    <p className=\"text-sm text-yellow-700 dark:text-yellow-300 mt-1\">\n                      {availablePromotions.bonus.description} - Do you want to use it?\n                      <span className=\"block text-xs mt-1 font-medium\">\n                        Note: Add-ons cannot be used with promotional bonus\n                      </span>\n                    </p>\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n\n          {/* Add-ons Section */}\n          {category && !useHappyHoursPricing && (\n            <div className=\"space-y-2\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={() => setShowAddons(!showAddons)}\n                className=\"w-full justify-between\"\n                data-testid=\"button-toggle-addons\"\n              >\n                <span className=\"flex items-center gap-2\">\n                  <IndianRupee className=\"h-4 w-4\" />\n                  Add-ons (Manual Discount/Free Hours)\n                </span>\n                <Badge variant=\"secondary\">{showAddons ? \"Hide\" : \"Show\"}</Badge>\n              </Button>\n\n              {showAddons && (\n                <Card className=\"p-4 space-y-3\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"manual-discount\" className=\"flex items-center gap-2\">\n                      <Percent className=\"h-4 w-4\" />\n                      Manual Discount (%)\n                    </Label>\n                    <Input\n                      id=\"manual-discount\"\n                      type=\"number\"\n                      min=\"0\"\n                      max=\"100\"\n                      value={manualDiscountPercentage}\n                      onChange={(e) => {\n                        const value = e.target.value;\n                        const numValue = parseFloat(value);\n                        \n                        // Clamp value between 0 and 100\n                        if (value === \"\" || (numValue >= 0 && numValue <= 100)) {\n                          setManualDiscountPercentage(value);\n                          if (value) {\n                            setManualFreeHoursHr(\"\");\n                            setManualFreeHoursMin(\"\");\n                            setUsePromotionalDiscount(false);\n                            setUsePromotionalBonus(false);\n                          }\n                        }\n                      }}\n                      onBlur={(e) => {\n                        const value = e.target.value;\n                        const numValue = parseFloat(value);\n                        \n                        // On blur, enforce strict clamping\n                        if (value && !isNaN(numValue)) {\n                          const clamped = Math.min(100, Math.max(0, numValue));\n                          setManualDiscountPercentage(clamped.toString());\n                        }\n                      }}\n                      placeholder=\"Enter discount percentage\"\n                      disabled={usePromotionalDiscount || usePromotionalBonus}\n                      data-testid=\"input-manual-discount\"\n                    />\n                    <p className=\"text-xs text-muted-foreground\">\n                      {usePromotionalDiscount || usePromotionalBonus \n                        ? \"‚ùå Cannot use manual discount with promotional offers - Uncheck promotional option above to use this\" \n                        : \"Enter percentage (0-100) for manual discount\"}\n                    </p>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label className=\"flex items-center gap-2\">\n                      <Clock className=\"h-4 w-4\" />\n                      Manual Free Hours\n                    </Label>\n                    <div className=\"flex items-center gap-2\">\n                      <div className=\"flex-1\">\n                        <Input\n                          id=\"manual-free-hours-hr\"\n                          type=\"number\"\n                          min=\"0\"\n                          max=\"23\"\n                          value={manualFreeHoursHr}\n                          onChange={(e) => {\n                            const value = e.target.value;\n                            setManualFreeHoursHr(value);\n                            if (value || manualFreeHoursMin) {\n                              setManualDiscountPercentage(\"\");\n                              setUsePromotionalDiscount(false);\n                              setUsePromotionalBonus(false);\n                            }\n                          }}\n                          placeholder=\"0\"\n                          disabled={usePromotionalDiscount || usePromotionalBonus}\n                          data-testid=\"input-manual-free-hours-hr\"\n                        />\n                        <p className=\"text-xs text-muted-foreground mt-1\">Hours</p>\n                      </div>\n                      <span className=\"text-xl font-bold\">:</span>\n                      <div className=\"flex-1\">\n                        <Input\n                          id=\"manual-free-hours-min\"\n                          type=\"number\"\n                          min=\"0\"\n                          max=\"59\"\n                          value={manualFreeHoursMin}\n                          onChange={(e) => {\n                            const value = e.target.value;\n                            setManualFreeHoursMin(value);\n                            if (value || manualFreeHoursHr) {\n                              setManualDiscountPercentage(\"\");\n                              setUsePromotionalDiscount(false);\n                              setUsePromotionalBonus(false);\n                            }\n                          }}\n                          placeholder=\"0\"\n                          disabled={usePromotionalDiscount || usePromotionalBonus}\n                          data-testid=\"input-manual-free-hours-min\"\n                        />\n                        <p className=\"text-xs text-muted-foreground mt-1\">Minutes</p>\n                      </div>\n                    </div>\n                    <p className=\"text-xs text-muted-foreground\">\n                      {usePromotionalDiscount || usePromotionalBonus \n                        ? \"‚ùå Cannot use manual free hours with promotional offers - Uncheck promotional option above to use this\" \n                        : \"Enter hours and minutes separately (e.g., 1 hr 30 min)\"}\n                    </p>\n                  </div>\n\n                </Card>\n              )}\n            </div>\n          )}\n\n          {/* Price Breakdown Preview */}\n          {category && priceBreakdown && (\n            <Card className=\"bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-950/30 dark:to-indigo-950/30 border-blue-200 dark:border-blue-800\">\n              <CardContent className=\"p-4 space-y-2\">\n                <div className=\"flex items-center justify-between text-sm\">\n                  <span className=\"text-muted-foreground\">Original Price:</span>\n                  <span className=\"font-medium\">‚Çπ{priceBreakdown.originalPrice}</span>\n                </div>\n                \n                {priceBreakdown.hasDiscount && (\n                  <>\n                    <div className=\"flex items-center justify-between text-sm text-green-600 dark:text-green-400\">\n                      <span className=\"flex items-center gap-1\">\n                        <Percent className=\"h-3 w-3\" />\n                        {priceBreakdown.discountType}\n                      </span>\n                      <span className=\"font-medium\">-‚Çπ{priceBreakdown.discount}</span>\n                    </div>\n                    <div className=\"border-t border-blue-200 dark:border-blue-800 pt-2\"></div>\n                  </>\n                )}\n                \n                <div className=\"flex items-center justify-between\">\n                  <span className=\"font-semibold text-base\">Total Amount:</span>\n                  <span className=\"font-bold text-lg text-blue-600 dark:text-blue-400\">\n                    ‚Çπ{priceBreakdown.finalPrice}\n                  </span>\n                </div>\n                \n                <p className=\"text-xs text-muted-foreground pt-1\">\n                  for {duration}\n                  {(manualFreeHoursHr || manualFreeHoursMin) && (() => {\n                    const hours = parseInt(manualFreeHoursHr) || 0;\n                    const minutes = parseInt(manualFreeHoursMin) || 0;\n                    const freeText = hours > 0 && minutes > 0 \n                      ? `${hours}h ${minutes}min`\n                      : hours > 0 \n                      ? `${hours}h`\n                      : `${minutes}min`;\n                    return <span className=\"text-blue-600 dark:text-blue-400 font-medium\"> + {freeText} free</span>;\n                  })()}\n                  {useHappyHoursPricing && \" (Happy Hours üéâ)\"}\n                </p>\n              </CardContent>\n            </Card>\n          )}\n\n          {bookingType === \"upcoming\" && category && (useHappyHoursPricing ? selectedHappyHoursSlot : selectedSlot) && !priceBreakdown?.hasDiscount && (\n            <div className=\"text-sm text-muted-foreground\" data-testid=\"text-price\">\n              Price: ‚Çπ{useHappyHoursPricing && selectedHappyHoursSlot ? selectedHappyHoursSlot.price : selectedSlot?.price} for {duration}\n              {useHappyHoursPricing && selectedHappyHoursSlot && (\n                <span className=\"ml-2 text-green-600 dark:text-green-400 font-medium\">\n                  (Happy Hours üéâ)\n                </span>\n              )}\n            </div>\n          )}\n\n        </div>\n\n        <DialogFooter className=\"flex-col sm:flex-row gap-2 sm:gap-0\">\n          <Button variant=\"outline\" onClick={() => onOpenChange(false)} data-testid=\"button-cancel-booking\" className=\"w-full sm:w-auto\">\n            Cancel\n          </Button>\n          <Button \n            onClick={handleConfirm} \n            disabled={\n              !category || \n              selectedSeats.length === 0 || \n              !duration || \n              (bookingType === \"upcoming\" && (!bookingDate || !timeSlot)) ||\n              (selectedSeats.length > 1 && !generatedGroupId) ||\n              selectedSeats.some(seat => {\n                const customer = deviceCustomers[seat];\n                if (!customer || !customer.name.trim()) return true;\n                if (bookingType === \"upcoming\" && (!customer.phone.trim() || customer.phone.length !== 10)) return true;\n                if (customer.phone.trim() && customer.phone.length !== 10) return true;\n                return false;\n              })\n            }\n            data-testid=\"button-confirm-booking\"\n            className=\"w-full sm:w-auto\"\n          >\n            Add Booking {selectedSeats.length > 0 && `(${selectedSeats.length} devices)`}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":57424,"size_tokens":null},"RENDER_DEPLOYMENT_GUIDE.md":{"content":"# Render Deployment Guide for Ankylo Gaming\n\n## ‚úÖ No Replit Dependencies!\n\nYour app now uses **standard Google OAuth** - completely independent of Replit:\n- ‚úÖ No Replit account required\n- ‚úÖ Use your own Google Cloud OAuth credentials\n- ‚úÖ Works on any platform (Render, Vercel, AWS, etc.)\n- ‚úÖ Email whitelist feature included\n- ‚úÖ Fixed database migration (uses `--force` flag)\n\n---\n\n## üöÄ Step-by-Step Deployment on Render\n\n### **Step 1: Set Up Google OAuth Credentials**\n\n**Before deploying**, you need to create Google OAuth credentials:\n\nüëâ **Follow the complete guide:** `GOOGLE_OAUTH_SETUP.md`\n\nQuick summary:\n1. Create a project in [Google Cloud Console](https://console.cloud.google.com/)\n2. Enable Google+ API\n3. Configure OAuth consent screen\n4. Create OAuth 2.0 credentials (Web application)\n5. Get your `GOOGLE_CLIENT_ID` and `GOOGLE_CLIENT_SECRET`\n\n---\n\n### **Step 2: Environment Variables on Render**\n\nGo to your Render service ‚Üí **Environment** tab and add these variables:\n\n#### **Required Variables:**\n```\nDATABASE_URL=your-neon-postgres-connection-string\nSESSION_SECRET=generate-a-random-32-character-string\nNODE_ENV=production\nGOOGLE_CLIENT_ID=your-google-client-id-from-step-1\nGOOGLE_CLIENT_SECRET=your-google-client-secret-from-step-1\n```\n\n#### **Optional Variables:**\n```\nALLOWED_EMAIL=youremail@gmail.com\nADMIN_USERNAME=admin\nADMIN_PASSWORD=your-secure-password\n```\n\n---\n\n### **Step 2: Get Your Neon Database URL**\n\n1. Go to your **Neon dashboard**\n2. Select your database\n3. Click **\"Connection String\"**\n4. Copy the full PostgreSQL connection string\n5. It should look like:\n   ```\n   postgresql://username:password@hostname.neon.tech/database?sslmode=require\n   ```\n\n---\n\n### **Step 3: Generate SESSION_SECRET**\n\nRun this command locally to generate a secure secret:\n\n**On Mac/Linux:**\n```bash\nopenssl rand -base64 32\n```\n\n**On Windows (PowerShell):**\n```powershell\n[Convert]::ToBase64String((1..32 | ForEach-Object { Get-Random -Minimum 0 -Maximum 256 }))\n```\n\nOr use any random 32+ character string.\n\n---\n\n### **Step 4: Deploy on Render**\n\n1. **Connect your GitHub repo** to Render\n2. **Select your repository** (ujwalokay/ujwalkingpin)\n3. **Choose \"Web Service\"**\n4. Configure:\n   - **Name:** `ankylo-gaming` (or your choice)\n   - **Branch:** `main`\n   - **Build Command:** `npm install --include=dev && npm run build`\n   - **Start Command:** `npm run start`\n   - **Instance Type:** Free tier is fine for testing\n5. Add **environment variables** from Step 1\n6. Click **\"Create Web Service\"**\n\n---\n\n### **Step 5: Enable Google Login on Render (Optional)**\n\nIf you want users to log in with Google on Render:\n\n1. **Add these environment variables on Render:**\n   ```\n   REPLIT_DOMAINS=your-app-name.onrender.com\n   REPL_ID=ankylo-gaming-render\n   ISSUER_URL=https://replit.com/oidc\n   ```\n   Replace `your-app-name` with your actual Render domain.\n\n2. **Register your Render domain with Replit:**\n   - Go to https://replit.com (log in to your Replit account)\n   - Click your profile ‚Üí **Account Settings**\n   - Navigate to **OAuth Applications** (or similar section)\n   - Add your Render domain as an authorized redirect URI:\n     ```\n     https://your-app-name.onrender.com/api/callback\n     ```\n\n3. **Test Google Login:**\n   - Visit your Render URL\n   - Click \"Continue with Google\"\n   - You should be redirected to Google for authentication\n   - After authenticating, you'll be redirected back to your app\n\n**Troubleshooting Google Login:**\n- If you see \"redirect_uri_mismatch\" error, make sure your Render domain is registered in Replit OAuth settings\n- Make sure `REPLIT_DOMAINS` matches your exact Render domain\n- Check that `ISSUER_URL` is set to `https://replit.com/oidc`\n\n---\n\n### **Step 6: Create Admin User**\n\nAfter deployment, you need to create an admin user to log in:\n\n**Option 1: Using Neon SQL Editor**\n```sql\nINSERT INTO users (email, username, password_hash, role, onboarding_completed)\nVALUES (\n  'admin@example.com',\n  'admin',\n  '$2b$10$YourHashedPasswordHere',\n  'admin',\n  1\n);\n```\n\n**Option 2: Set Environment Variables (Easier)**\nAdd these to Render environment variables:\n```\nADMIN_USERNAME=admin\nADMIN_PASSWORD=your-secure-password\n```\n\nThe app will automatically create an admin user on startup.\n\n---\n\n### **Step 7: Access Your App**\n\n1. Wait for deployment to complete (check Render logs)\n2. Open your Render URL: `https://your-app-name.onrender.com`\n3. You should see the login page with:\n   - **\"Continue with Google\"** button (if you set up Google login)\n   - **\"Staff/Admin Login\"** link for username/password login\n4. Log in with either:\n   - **Google:** Click \"Continue with Google\"\n   - **Staff/Admin:** Click staff login link, then use:\n     - Username: admin (or what you set)\n     - Password: (what you set in ADMIN_PASSWORD)\n\n---\n\n## üîß Troubleshooting\n\n### **Issue: \"REPLIT_DOMAINS not provided\" error**\n‚úÖ **Fixed!** The app now detects non-Replit environments automatically.\n\n### **Issue: Database migration stuck**\n‚úÖ **Fixed!** Now uses `--force` flag to skip prompts.\n\n### **Issue: \"No admin user exists\" warning**\n**Solution:** Add `ADMIN_USERNAME` and `ADMIN_PASSWORD` to your Render environment variables.\n\n### **Issue: Google login not working on Render**\n**Solution:** Make sure you:\n1. Set `REPLIT_DOMAINS` to your Render domain\n2. Set `REPL_ID` to your app name\n3. Set `ISSUER_URL` to `https://replit.com/oidc`\n4. Registered your Render callback URL in Replit OAuth settings\n\n### **Issue: \"Access Denied\" when logging in**\nIf you set `ALLOWED_EMAIL`, make sure you're logging in with that exact email address.\n\n---\n\n## üìã Complete Environment Variable List\n\n| Variable | Required | Default | Description |\n|----------|----------|---------|-------------|\n| `DATABASE_URL` | ‚úÖ Yes | - | Neon PostgreSQL connection string |\n| `SESSION_SECRET` | ‚úÖ Yes | - | Random secret for session encryption |\n| `NODE_ENV` | ‚úÖ Yes | `production` | Set to `production` for Render |\n| `ADMIN_USERNAME` | ‚ö†Ô∏è Recommended | - | Creates admin user on startup |\n| `ADMIN_PASSWORD` | ‚ö†Ô∏è Recommended | - | Admin password (min 8 chars) |\n| `ALLOWED_EMAIL` | ‚ùå Optional | - | Restrict access to one email (Google login only) |\n| `REPLIT_DOMAINS` | ‚ùå Optional | - | Only needed for Replit/Google login |\n| `REPL_ID` | ‚ùå Optional | - | Only needed for Replit/Google login |\n\n---\n\n## üéØ Quick Start Checklist\n\n- [ ] Add `DATABASE_URL` to Render environment\n- [ ] Add `SESSION_SECRET` to Render environment  \n- [ ] Add `ADMIN_USERNAME` and `ADMIN_PASSWORD` to Render environment\n- [ ] Deploy on Render\n- [ ] Check deployment logs for errors\n- [ ] Access your Render URL\n- [ ] Log in with admin credentials\n- [ ] ‚úÖ You're ready to use your app!\n\n---\n\n## üí° Tips\n\n1. **Free Tier Sleep:** Render free tier apps sleep after 15 minutes of inactivity. First request after sleep takes ~30 seconds.\n2. **Database Costs:** Neon free tier includes 0.5 GB storage and 100 hours of compute per month.\n3. **Email Whitelist:** If using `ALLOWED_EMAIL`, only that email can access via Google login (Replit only).\n4. **Multiple Staff:** Create additional staff users through the Settings page after logging in as admin.\n\n---\n\n## üîê Security Best Practices\n\n1. Use strong passwords for admin accounts\n2. Never commit environment variables to Git\n3. Rotate `SESSION_SECRET` periodically\n4. Use `ALLOWED_EMAIL` to restrict Google login access\n5. Enable 2FA on your Neon and Render accounts\n\n---\n\n## üìû Need Help?\n\nIf you encounter issues:\n1. Check Render deployment logs\n2. Check Neon database connection\n3. Verify all environment variables are set correctly\n4. Make sure `ADMIN_USERNAME` and `ADMIN_PASSWORD` are at least 8 characters\n\n---\n\nGood luck with your deployment! üöÄ\n","path":null,"size_bytes":7762,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"electron/main.ts":{"content":"import { app, BrowserWindow, ipcMain, dialog, shell } from 'electron';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\nimport isDev from 'electron-is-dev';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\nlet mainWindow: BrowserWindow | null = null;\n\nconst SERVER_PORT = 5000;\n\nasync function startServer() {\n  process.env.PORT = String(SERVER_PORT);\n  \n  try {\n    const serverPath = path.join(__dirname, '../server/index-electron.js');\n    await import(serverPath);\n    console.log('Express server started on port', SERVER_PORT);\n  } catch (error) {\n    console.error('Failed to start server:', error);\n    throw error;\n  }\n}\n\nasync function createWindow() {\n  mainWindow = new BrowserWindow({\n    width: 1400,\n    height: 900,\n    minWidth: 1024,\n    minHeight: 768,\n    title: 'Airavoto Gaming POS',\n    icon: path.join(__dirname, '../client/public/favicon.ico'),\n    webPreferences: {\n      nodeIntegration: false,\n      contextIsolation: true,\n      preload: path.join(__dirname, 'preload.js'),\n      webSecurity: true,\n    },\n    autoHideMenuBar: true,\n    show: false,\n  });\n\n  mainWindow.once('ready-to-show', () => {\n    mainWindow?.show();\n  });\n\n  if (isDev) {\n    mainWindow.loadURL(`http://localhost:${SERVER_PORT}`);\n    mainWindow.webContents.openDevTools();\n  } else {\n    mainWindow.loadURL(`http://localhost:${SERVER_PORT}`);\n  }\n\n  mainWindow.on('closed', () => {\n    mainWindow = null;\n  });\n\n  mainWindow.webContents.setWindowOpenHandler(({ url }) => {\n    if (url.startsWith('http://') || url.startsWith('https://')) {\n      shell.openExternal(url);\n    }\n    return { action: 'deny' };\n  });\n}\n\napp.whenReady().then(async () => {\n  await startServer();\n  \n  setTimeout(() => {\n    createWindow();\n  }, 2000);\n});\n\napp.on('window-all-closed', () => {\n  if (process.platform !== 'darwin') {\n    app.quit();\n  }\n});\n\napp.on('activate', () => {\n  if (BrowserWindow.getAllWindows().length === 0) {\n    createWindow();\n  }\n});\n\nipcMain.handle('get-app-version', () => {\n  return app.getVersion();\n});\n\nipcMain.handle('get-app-path', () => {\n  return app.getPath('userData');\n});\n\nipcMain.handle('show-message-box', async (_, options) => {\n  if (mainWindow) {\n    return dialog.showMessageBox(mainWindow, options);\n  }\n  return null;\n});\n\nipcMain.handle('show-open-dialog', async (_, options) => {\n  if (mainWindow) {\n    return dialog.showOpenDialog(mainWindow, options);\n  }\n  return null;\n});\n\nipcMain.handle('show-save-dialog', async (_, options) => {\n  if (mainWindow) {\n    return dialog.showSaveDialog(mainWindow, options);\n  }\n  return null;\n});\n\nprocess.on('uncaughtException', (error) => {\n  console.error('Uncaught Exception:', error);\n});\n\nprocess.on('unhandledRejection', (reason, promise) => {\n  console.error('Unhandled Rejection at:', promise, 'reason:', reason);\n});\n","path":null,"size_bytes":2863,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n        \"pulse-glow\": {\n          \"0%, 100%\": { boxShadow: \"0 0 20px rgba(0, 255, 255, 0.3)\" },\n          \"50%\": { boxShadow: \"0 0 30px rgba(0, 255, 255, 0.5)\" },\n        },\n        \"pulse-danger\": {\n          \"0%, 100%\": { boxShadow: \"0 0 20px rgba(239, 68, 68, 0.3)\" },\n          \"50%\": { boxShadow: \"0 0 30px rgba(239, 68, 68, 0.5)\" },\n        },\n        \"pulse-warning\": {\n          \"0%, 100%\": { boxShadow: \"0 0 20px rgba(251, 146, 60, 0.3)\" },\n          \"50%\": { boxShadow: \"0 0 30px rgba(251, 146, 60, 0.5)\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n        \"pulse-glow\": \"pulse-glow 2s ease-in-out infinite\",\n        \"pulse-danger\": \"pulse-danger 2s ease-in-out infinite\",\n        \"pulse-warning\": \"pulse-warning 2s ease-in-out infinite\",\n      },\n      boxShadow: {\n        \"glow-cyan\": \"0 0 20px rgba(0, 255, 255, 0.3)\",\n        \"glow-cyan-lg\": \"0 0 30px rgba(0, 255, 255, 0.5)\",\n        \"glow-orange\": \"0 0 20px rgba(251, 146, 60, 0.3)\",\n        \"glow-red\": \"0 0 20px rgba(239, 68, 68, 0.3)\",\n        \"glow-purple\": \"0 0 20px rgba(168, 85, 247, 0.3)\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":5085,"size_tokens":null},"client/src/components/InactivityRefreshPrompt.tsx":{"content":"import { useEffect, useState, useCallback } from \"react\";\nimport {\n  AlertDialog,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { RefreshCw, AlertTriangle } from \"lucide-react\";\n\nconst INACTIVITY_TIMEOUT = 15 * 60 * 1000;\n\nexport function InactivityRefreshPrompt() {\n  const [showRefreshDialog, setShowRefreshDialog] = useState(false);\n  const [lastActivityTime, setLastActivityTime] = useState(Date.now());\n  const [isInactive, setIsInactive] = useState(false);\n\n  const updateActivity = useCallback(() => {\n    setLastActivityTime(Date.now());\n    setIsInactive(false);\n  }, []);\n\n  const handleRefresh = () => {\n    window.location.reload();\n  };\n\n  useEffect(() => {\n    const events = [\n      'mousedown',\n      'mousemove',\n      'keypress',\n      'scroll',\n      'touchstart',\n      'click',\n    ];\n\n    const checkActivity = (e: Event) => {\n      const now = Date.now();\n      const timeSinceLastActivity = now - lastActivityTime;\n\n      if (timeSinceLastActivity > INACTIVITY_TIMEOUT && !isInactive) {\n        setIsInactive(true);\n        setShowRefreshDialog(true);\n      } else if (timeSinceLastActivity < INACTIVITY_TIMEOUT) {\n        updateActivity();\n      }\n    };\n\n    events.forEach(event => {\n      window.addEventListener(event, checkActivity, { passive: true });\n    });\n\n    const interval = setInterval(() => {\n      const now = Date.now();\n      const timeSinceLastActivity = now - lastActivityTime;\n\n      if (timeSinceLastActivity > INACTIVITY_TIMEOUT && !isInactive) {\n        setIsInactive(true);\n      }\n    }, 60000);\n\n    return () => {\n      events.forEach(event => {\n        window.removeEventListener(event, checkActivity);\n      });\n      clearInterval(interval);\n    };\n  }, [lastActivityTime, isInactive, updateActivity]);\n\n  return (\n    <AlertDialog open={showRefreshDialog} onOpenChange={setShowRefreshDialog}>\n      <AlertDialogContent className=\"max-w-md\" data-testid=\"dialog-inactivity-refresh\">\n        <AlertDialogHeader>\n          <div className=\"flex items-center gap-3 mb-2\">\n            <div className=\"p-2 rounded-full bg-amber-500/10\">\n              <AlertTriangle className=\"h-6 w-6 text-amber-500\" />\n            </div>\n            <AlertDialogTitle className=\"text-xl\">Session Inactive</AlertDialogTitle>\n          </div>\n          <AlertDialogDescription className=\"text-base leading-relaxed\">\n            Your session has been inactive for more than 15 minutes. The server may have gone to sleep.\n            <br /><br />\n            <strong>Please refresh the page</strong> to ensure everything works properly and to reconnect to the server.\n          </AlertDialogDescription>\n        </AlertDialogHeader>\n        <AlertDialogFooter>\n          <Button\n            onClick={handleRefresh}\n            className=\"w-full gap-2\"\n            size=\"lg\"\n            data-testid=\"button-refresh-page\"\n          >\n            <RefreshCw className=\"h-4 w-4\" />\n            Refresh Page Now\n          </Button>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  );\n}\n","path":null,"size_bytes":3199,"size_tokens":null},"client/src/components/KeyboardShortcutsDialog.tsx":{"content":"import {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Keyboard } from \"lucide-react\";\nimport { formatShortcut, type KeyboardShortcut } from \"@/hooks/useKeyboardShortcuts\";\nimport { useShortcutsContext } from \"@/contexts/ShortcutsContext\";\n\ninterface KeyboardShortcutsDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n}\n\nexport function KeyboardShortcutsDialog({ \n  open, \n  onOpenChange \n}: KeyboardShortcutsDialogProps) {\n  const { shortcuts } = useShortcutsContext();\n  // Group shortcuts by category\n  const groupedShortcuts = shortcuts.reduce((acc, shortcut) => {\n    const category = shortcut.category || 'General';\n    if (!acc[category]) {\n      acc[category] = [];\n    }\n    acc[category].push(shortcut);\n    return acc;\n  }, {} as Record<string, KeyboardShortcut[]>);\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-w-2xl\" data-testid=\"dialog-keyboard-shortcuts\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Keyboard className=\"h-5 w-5\" />\n            Keyboard Shortcuts\n          </DialogTitle>\n          <DialogDescription>\n            Use these keyboard shortcuts to navigate and control the application faster\n          </DialogDescription>\n        </DialogHeader>\n        \n        <ScrollArea className=\"max-h-[60vh] pr-4\">\n          <div className=\"space-y-6\">\n            {Object.entries(groupedShortcuts).map(([category, categoryShortcuts]) => (\n              <div key={category} className=\"space-y-3\">\n                <h3 className=\"font-semibold text-sm text-muted-foreground uppercase tracking-wide\">\n                  {category}\n                </h3>\n                <div className=\"space-y-2\">\n                  {categoryShortcuts.map((shortcut, index) => (\n                    <div \n                      key={`${category}-${index}`}\n                      className=\"flex items-center justify-between p-3 rounded-lg bg-muted/50 hover:bg-muted transition-colors\"\n                      data-testid={`shortcut-${category.toLowerCase().replace(/\\s+/g, '-')}-${index}`}\n                    >\n                      <span className=\"text-sm\">{shortcut.description}</span>\n                      <kbd className=\"px-3 py-1.5 text-xs font-semibold bg-background border border-border rounded shadow-sm\">\n                        {formatShortcut(shortcut)}\n                      </kbd>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            ))}\n          </div>\n        </ScrollArea>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":2748,"size_tokens":null},"client/src/pages/Expenses.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Plus, Pencil, Trash2, IndianRupee, Calendar as CalendarIcon, Download, FileSpreadsheet, FileText } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Calendar } from \"@/components/ui/calendar\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport type { Expense } from \"@shared/schema\";\nimport { format } from \"date-fns\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { getAdjustedTime } from \"@/hooks/useServerTime\";\n\nconst EXPENSE_CATEGORIES = [\n  \"Equipment Maintenance\",\n  \"Equipment Purchase\",\n  \"Food/Beverage Purchase\",\n  \"Utilities (Electricity)\",\n  \"Utilities (Internet)\",\n  \"Utilities (Water)\",\n  \"Staff Salary\",\n  \"Game Licenses\",\n  \"Marketing\",\n  \"Rent\",\n  \"Repairs\",\n  \"Supplies\",\n  \"Other\",\n];\n\nexport default function Expenses() {\n  const { toast } = useToast();\n  const { isAdmin, canMakeChanges, deviceRestricted, user } = useAuth();\n  const [addDialog, setAddDialog] = useState(false);\n  const [editDialog, setEditDialog] = useState<{ open: boolean; item: Expense | null }>({\n    open: false,\n    item: null,\n  });\n  const [deleteDialog, setDeleteDialog] = useState<{ open: boolean; id: string; description: string }>({\n    open: false,\n    id: \"\",\n    description: \"\",\n  });\n  const [formData, setFormData] = useState({\n    category: \"\",\n    description: \"\",\n    amount: \"\",\n    date: getAdjustedTime(),\n  });\n\n  const { data: expenses = [], isLoading } = useQuery<Expense[]>({\n    queryKey: [\"/api/expenses\"],\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: { category: string; description: string; amount: string; date: Date }) => {\n      const response = await fetch(\"/api/expenses\", {\n        method: \"POST\",\n        body: JSON.stringify(data),\n        headers: { \"Content-Type\": \"application/json\" },\n      });\n      if (!response.ok) throw new Error(\"Failed to create expense\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/expenses\"] });\n      toast({ title: \"Expense Added\", description: \"Expense has been recorded successfully\" });\n      setAddDialog(false);\n      setFormData({ category: \"\", description: \"\", amount: \"\", date: getAdjustedTime() });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: { category: string; description: string; amount: string; date: Date } }) => {\n      const response = await fetch(`/api/expenses/${id}`, {\n        method: \"PATCH\",\n        body: JSON.stringify(data),\n        headers: { \"Content-Type\": \"application/json\" },\n      });\n      if (!response.ok) throw new Error(\"Failed to update expense\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/expenses\"] });\n      toast({ title: \"Expense Updated\", description: \"Expense has been updated successfully\" });\n      setEditDialog({ open: false, item: null });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const response = await fetch(`/api/expenses/${id}`, { method: \"DELETE\" });\n      if (!response.ok) throw new Error(\"Failed to delete expense\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/expenses\"] });\n      toast({ title: \"Expense Deleted\", description: \"Expense has been removed\", variant: \"destructive\" });\n      setDeleteDialog({ open: false, id: \"\", description: \"\" });\n    },\n  });\n\n  const handleAdd = () => {\n    if (!formData.category || !formData.description || !formData.amount || !formData.date) {\n      toast({ title: \"Error\", description: \"Please fill in all fields\", variant: \"destructive\" });\n      return;\n    }\n    const amount = parseFloat(formData.amount);\n    if (isNaN(amount) || amount <= 0) {\n      toast({ title: \"Error\", description: \"Please enter a valid positive amount\", variant: \"destructive\" });\n      return;\n    }\n    createMutation.mutate(formData);\n  };\n\n  const handleEdit = () => {\n    if (!editDialog.item) return;\n    if (!formData.category || !formData.description || !formData.amount || !formData.date) {\n      toast({ title: \"Error\", description: \"Please fill in all fields\", variant: \"destructive\" });\n      return;\n    }\n    const amount = parseFloat(formData.amount);\n    if (isNaN(amount) || amount <= 0) {\n      toast({ title: \"Error\", description: \"Please enter a valid positive amount\", variant: \"destructive\" });\n      return;\n    }\n    updateMutation.mutate({ id: editDialog.item.id, data: formData });\n  };\n\n  const openEditDialog = (item: Expense) => {\n    setFormData({\n      category: item.category,\n      description: item.description,\n      amount: item.amount,\n      date: new Date(item.date),\n    });\n    setEditDialog({ open: true, item });\n  };\n\n  const openDeleteDialog = (id: string, description: string) => {\n    setDeleteDialog({ open: true, id, description });\n  };\n\n  const handleExportExcel = () => {\n    if (!expenses || expenses.length === 0) {\n      toast({\n        title: \"No data to export\",\n        description: \"There are no expenses to export.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      const headers = [\"Date\", \"Category\", \"Description\", \"Amount (‚Çπ)\"];\n      const csvContent = [\n        headers.join(\",\"),\n        ...sortedExpenses.map(expense => [\n          format(new Date(expense.date), \"MMM dd, yyyy\"),\n          expense.category,\n          `\"${expense.description.replace(/\"/g, '\"\"')}\"`,\n          parseFloat(expense.amount).toFixed(2)\n        ].join(\",\"))\n      ].join(\"\\n\");\n\n      const blob = new Blob([csvContent], { type: \"text/csv;charset=utf-8;\" });\n      const link = document.createElement(\"a\");\n      const url = URL.createObjectURL(blob);\n      link.setAttribute(\"href\", url);\n      link.setAttribute(\"download\", `expenses_${getAdjustedTime().toISOString().split('T')[0]}.csv`);\n      link.style.visibility = \"hidden\";\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n      \n      toast({\n        title: \"Export successful\",\n        description: \"CSV file has been downloaded.\",\n      });\n    } catch (error) {\n      toast({\n        title: \"Export failed\",\n        description: \"Failed to export CSV file. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleExportPDF = () => {\n    if (!expenses || expenses.length === 0) {\n      toast({\n        title: \"No data to export\",\n        description: \"There are no expenses to export.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      const printWindow = window.open('', '_blank');\n      if (!printWindow) {\n        toast({\n          title: \"Popup blocked\",\n          description: \"Please allow popups for this site to export PDF.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      const htmlContent = `\n        <!DOCTYPE html>\n        <html>\n        <head>\n          <title>Expense Report</title>\n          <style>\n            body { font-family: Arial, sans-serif; padding: 20px; }\n            h1 { color: #333; margin-bottom: 10px; }\n            .summary { margin: 20px 0; padding: 15px; background-color: #f5f5f5; border-radius: 8px; }\n            .summary h3 { margin: 0 0 10px 0; font-size: 14px; color: #666; }\n            .summary .value { font-size: 24px; font-weight: bold; color: #dc2626; }\n            table { width: 100%; border-collapse: collapse; margin-top: 20px; }\n            th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }\n            th { background-color: #f5f5f5; font-weight: bold; }\n            .text-right { text-align: right; }\n            .category-badge { \n              display: inline-block; \n              padding: 4px 8px; \n              background-color: #e0e7ff; \n              border-radius: 9999px; \n              font-size: 12px;\n            }\n            @media print {\n              body { padding: 10px; }\n            }\n          </style>\n        </head>\n        <body>\n          <h1>Expense Report</h1>\n          <p>Generated on ${getAdjustedTime().toLocaleDateString()}</p>\n          <div class=\"summary\">\n            <h3>Total Expenses</h3>\n            <div class=\"value\">‚Çπ${totalExpenses.toFixed(2)}</div>\n          </div>\n          <table>\n            <thead>\n              <tr>\n                <th>Date</th>\n                <th>Category</th>\n                <th>Description</th>\n                <th class=\"text-right\">Amount</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${sortedExpenses.map(expense => `\n                <tr>\n                  <td>${format(new Date(expense.date), \"MMM dd, yyyy\")}</td>\n                  <td><span class=\"category-badge\">${expense.category}</span></td>\n                  <td>${expense.description}</td>\n                  <td class=\"text-right\">‚Çπ${parseFloat(expense.amount).toFixed(2)}</td>\n                </tr>\n              `).join('')}\n            </tbody>\n          </table>\n        </body>\n        </html>\n      `;\n\n      printWindow.document.write(htmlContent);\n      printWindow.document.close();\n      \n      printWindow.onload = () => {\n        printWindow.print();\n        setTimeout(() => {\n          printWindow.close();\n        }, 100);\n      };\n\n      toast({\n        title: \"PDF export ready\",\n        description: \"Print dialog opened. Save as PDF to download.\",\n      });\n    } catch (error) {\n      toast({\n        title: \"Export failed\",\n        description: \"Failed to export PDF. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const totalExpenses = expenses.reduce((sum, expense) => {\n    const amount = parseFloat(expense.amount);\n    return sum + (isNaN(amount) ? 0 : amount);\n  }, 0);\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <h1 className=\"text-3xl font-bold text-foreground\">Expense Tracker</h1>\n        <p className=\"text-muted-foreground\">Loading expenses...</p>\n      </div>\n    );\n  }\n\n  const sortedExpenses = [...expenses].sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\n\n  return (\n    <div className=\"space-y-4 md:space-y-6\">\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3\">\n        <div>\n          <h1 className=\"text-2xl sm:text-3xl font-bold text-foreground\">Expense Tracker</h1>\n          <p className=\"text-sm sm:text-base text-muted-foreground\">Track and manage operational expenses</p>\n        </div>\n        <div className=\"flex flex-col sm:flex-row gap-2\">\n          <div className=\"flex gap-2\">\n            <Button \n              variant=\"outline\" \n              onClick={handleExportExcel} \n              data-testid=\"button-export-excel\"\n              size=\"sm\"\n              className=\"flex-1 sm:flex-none\"\n            >\n              <FileSpreadsheet className=\"mr-1 sm:mr-2 h-4 w-4\" />\n              <span className=\"hidden sm:inline\">Export </span>Excel\n            </Button>\n            <Button \n              variant=\"outline\" \n              onClick={handleExportPDF} \n              data-testid=\"button-export-pdf\"\n              size=\"sm\"\n              className=\"flex-1 sm:flex-none\"\n            >\n              <FileText className=\"mr-1 sm:mr-2 h-4 w-4\" />\n              <span className=\"hidden sm:inline\">Export </span>PDF\n            </Button>\n          </div>\n          <Button onClick={() => setAddDialog(true)} data-testid=\"button-add-expense\" className=\"w-full sm:w-auto\">\n            <Plus className=\"mr-2 h-4 w-4\" />\n            Add Expense\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"glass-card rounded-lg p-4 sm:p-6\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"h-12 w-12 rounded-full bg-destructive/10 flex items-center justify-center\">\n            <IndianRupee className=\"h-6 w-6 text-destructive\" />\n          </div>\n          <div>\n            <p className=\"text-sm text-muted-foreground\">Total Expenses</p>\n            <p className=\"text-2xl font-bold text-foreground\" data-testid=\"text-total-expenses\">\n              ‚Çπ{totalExpenses.toFixed(2)}\n            </p>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"glass-card rounded-lg overflow-hidden\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full\">\n            <thead className=\"border-b border-border\">\n              <tr className=\"text-left\">\n                <th className=\"p-4 font-semibold text-muted-foreground\">Date</th>\n                <th className=\"p-4 font-semibold text-muted-foreground\">Category</th>\n                <th className=\"p-4 font-semibold text-muted-foreground\">Description</th>\n                <th className=\"p-4 font-semibold text-muted-foreground\">Amount</th>\n                <th className=\"p-4 font-semibold text-muted-foreground\">Actions</th>\n              </tr>\n            </thead>\n            <tbody>\n              {sortedExpenses.length === 0 ? (\n                <tr>\n                  <td colSpan={5} className=\"p-8 text-center text-muted-foreground\">\n                    No expenses recorded yet. Click \"Add Expense\" to get started.\n                  </td>\n                </tr>\n              ) : (\n                sortedExpenses.map((expense) => (\n                  <tr\n                    key={expense.id}\n                    className=\"border-b border-border last:border-0 hover:bg-muted/50 transition-colors\"\n                    data-testid={`row-expense-${expense.id}`}\n                  >\n                    <td className=\"p-4\" data-testid={`text-expense-date-${expense.id}`}>\n                      {format(new Date(expense.date), \"MMM dd, yyyy\")}\n                    </td>\n                    <td className=\"p-4\">\n                      <span\n                        className=\"inline-block px-2 py-1 rounded-full text-xs font-medium bg-primary/10 text-primary\"\n                        data-testid={`text-expense-category-${expense.id}`}\n                      >\n                        {expense.category}\n                      </span>\n                    </td>\n                    <td className=\"p-4 text-foreground\" data-testid={`text-expense-description-${expense.id}`}>\n                      {expense.description}\n                    </td>\n                    <td className=\"p-4 font-bold text-destructive\" data-testid={`text-expense-amount-${expense.id}`}>\n                      ‚Çπ{parseFloat(expense.amount).toFixed(2)}\n                    </td>\n                    <td className=\"p-4\">\n                      <div className=\"flex gap-1\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => openEditDialog(expense)}\n                          data-testid={`button-edit-expense-${expense.id}`}\n                        >\n                          <Pencil className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          onClick={() => openDeleteDialog(expense.id, expense.description)}\n                          data-testid={`button-delete-expense-${expense.id}`}\n                        >\n                          <Trash2 className=\"h-4 w-4 text-destructive\" />\n                        </Button>\n                      </div>\n                    </td>\n                  </tr>\n                ))\n              )}\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n      <Dialog open={addDialog} onOpenChange={setAddDialog}>\n        <DialogContent data-testid=\"dialog-add-expense\">\n          <DialogHeader>\n            <DialogTitle>Add Expense</DialogTitle>\n            <DialogDescription>Record a new business expense</DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"add-category\">Category</Label>\n              <Select\n                value={formData.category}\n                onValueChange={(value) => setFormData({ ...formData, category: value })}\n              >\n                <SelectTrigger id=\"add-category\" data-testid=\"select-add-category\">\n                  <SelectValue placeholder=\"Select category\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {EXPENSE_CATEGORIES.map((category) => (\n                    <SelectItem key={category} value={category}>\n                      {category}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"add-description\">Description</Label>\n              <Textarea\n                id=\"add-description\"\n                data-testid=\"input-add-description\"\n                placeholder=\"What was this expense for?\"\n                value={formData.description}\n                onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"add-amount\">Amount (‚Çπ)</Label>\n              <Input\n                id=\"add-amount\"\n                data-testid=\"input-add-amount\"\n                type=\"number\"\n                step=\"0.01\"\n                placeholder=\"0.00\"\n                value={formData.amount}\n                onChange={(e) => setFormData({ ...formData, amount: e.target.value })}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Date</Label>\n              <Popover>\n                <PopoverTrigger asChild>\n                  <Button\n                    variant=\"outline\"\n                    className=\"w-full justify-start text-left font-normal\"\n                    data-testid=\"button-add-date\"\n                  >\n                    <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                    {formData.date ? format(formData.date, \"PPP\") : <span>Pick a date</span>}\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-auto p-0\">\n                  <Calendar\n                    mode=\"single\"\n                    selected={formData.date}\n                    onSelect={(date) => date && setFormData({ ...formData, date })}\n                    initialFocus\n                  />\n                </PopoverContent>\n              </Popover>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setAddDialog(false)} data-testid=\"button-cancel-add\">\n              Cancel\n            </Button>\n            <Button onClick={handleAdd} disabled={createMutation.isPending} data-testid=\"button-confirm-add\">\n              {createMutation.isPending ? \"Adding...\" : \"Add Expense\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={editDialog.open} onOpenChange={(open) => setEditDialog({ open, item: null })}>\n        <DialogContent data-testid=\"dialog-edit-expense\">\n          <DialogHeader>\n            <DialogTitle>Edit Expense</DialogTitle>\n            <DialogDescription>Update expense details</DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"edit-category\">Category</Label>\n              <Select\n                value={formData.category}\n                onValueChange={(value) => setFormData({ ...formData, category: value })}\n              >\n                <SelectTrigger id=\"edit-category\" data-testid=\"select-edit-category\">\n                  <SelectValue placeholder=\"Select category\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {EXPENSE_CATEGORIES.map((category) => (\n                    <SelectItem key={category} value={category}>\n                      {category}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"edit-description\">Description</Label>\n              <Textarea\n                id=\"edit-description\"\n                data-testid=\"input-edit-description\"\n                placeholder=\"What was this expense for?\"\n                value={formData.description}\n                onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"edit-amount\">Amount (‚Çπ)</Label>\n              <Input\n                id=\"edit-amount\"\n                data-testid=\"input-edit-amount\"\n                type=\"number\"\n                step=\"0.01\"\n                placeholder=\"0.00\"\n                value={formData.amount}\n                onChange={(e) => setFormData({ ...formData, amount: e.target.value })}\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Date</Label>\n              <Popover>\n                <PopoverTrigger asChild>\n                  <Button\n                    variant=\"outline\"\n                    className=\"w-full justify-start text-left font-normal\"\n                    data-testid=\"button-edit-date\"\n                  >\n                    <CalendarIcon className=\"mr-2 h-4 w-4\" />\n                    {formData.date ? format(formData.date, \"PPP\") : <span>Pick a date</span>}\n                  </Button>\n                </PopoverTrigger>\n                <PopoverContent className=\"w-auto p-0\">\n                  <Calendar\n                    mode=\"single\"\n                    selected={formData.date}\n                    onSelect={(date) => date && setFormData({ ...formData, date })}\n                    initialFocus\n                  />\n                </PopoverContent>\n              </Popover>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setEditDialog({ open: false, item: null })} data-testid=\"button-cancel-edit\">\n              Cancel\n            </Button>\n            <Button onClick={handleEdit} disabled={updateMutation.isPending} data-testid=\"button-confirm-edit\">\n              {updateMutation.isPending ? \"Updating...\" : \"Update Expense\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={deleteDialog.open} onOpenChange={(open) => setDeleteDialog({ open, id: \"\", description: \"\" })}>\n        <DialogContent data-testid=\"dialog-delete-expense\">\n          <DialogHeader>\n            <DialogTitle>Delete Expense</DialogTitle>\n            <DialogDescription>\n              Are you sure you want to delete \"{deleteDialog.description}\"? This action cannot be undone.\n            </DialogDescription>\n          </DialogHeader>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setDeleteDialog({ open: false, id: \"\", description: \"\" })} data-testid=\"button-cancel-delete\">\n              Cancel\n            </Button>\n            <Button\n              variant=\"destructive\"\n              onClick={() => deleteMutation.mutate(deleteDialog.id)}\n              disabled={deleteMutation.isPending}\n              data-testid=\"button-confirm-delete\"\n            >\n              {deleteMutation.isPending ? \"Deleting...\" : \"Delete\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":24224,"size_tokens":null},"server/twilio.ts":{"content":"import twilio from 'twilio';\nimport type { Request, Response, NextFunction } from 'express';\n\nlet connectionSettings: any;\n\nasync function getCredentials() {\n  const hostname = process.env.REPLIT_CONNECTORS_HOSTNAME\n  const xReplitToken = process.env.REPL_IDENTITY \n    ? 'repl ' + process.env.REPL_IDENTITY \n    : process.env.WEB_REPL_RENEWAL \n    ? 'depl ' + process.env.WEB_REPL_RENEWAL \n    : null;\n\n  if (!xReplitToken) {\n    throw new Error('X_REPLIT_TOKEN not found for repl/depl');\n  }\n\n  connectionSettings = await fetch(\n    'https://' + hostname + '/api/v2/connection?include_secrets=true&connector_names=twilio',\n    {\n      headers: {\n        'Accept': 'application/json',\n        'X_REPLIT_TOKEN': xReplitToken\n      }\n    }\n  ).then(res => res.json()).then(data => data.items?.[0]);\n\n  if (!connectionSettings || (!connectionSettings.settings.account_sid || !connectionSettings.settings.api_key || !connectionSettings.settings.api_key_secret)) {\n    throw new Error('Twilio not connected');\n  }\n  return {\n    accountSid: connectionSettings.settings.account_sid,\n    apiKey: connectionSettings.settings.api_key,\n    apiKeySecret: connectionSettings.settings.api_key_secret,\n    phoneNumber: connectionSettings.settings.phone_number\n  };\n}\n\nexport async function getTwilioClient() {\n  const { accountSid, apiKey, apiKeySecret } = await getCredentials();\n  return twilio(apiKey, apiKeySecret, {\n    accountSid: accountSid\n  });\n}\n\nexport async function getTwilioFromPhoneNumber() {\n  const { phoneNumber } = await getCredentials();\n  return phoneNumber;\n}\n\nexport async function sendWhatsAppMessage(to: string, message: string) {\n  const client = await getTwilioClient();\n  const from = await getTwilioFromPhoneNumber();\n  \n  return await client.messages.create({\n    from: `whatsapp:${from}`,\n    to: `whatsapp:${to}`,\n    body: message\n  });\n}\n\nexport async function verifyTwilioWebhook(req: Request, res: Response, next: NextFunction) {\n  // Skip verification in development if TWILIO_AUTH_TOKEN is not set\n  if (process.env.NODE_ENV !== 'production' && !process.env.TWILIO_AUTH_TOKEN) {\n    return next();\n  }\n  \n  try {\n    const { accountSid, apiKeySecret } = await getCredentials();\n    const authToken = process.env.TWILIO_AUTH_TOKEN || apiKeySecret;\n    \n    const twilioSignature = req.headers['x-twilio-signature'] as string;\n    \n    if (!twilioSignature) {\n      return res.status(403).json({ message: 'Missing Twilio signature' });\n    }\n    \n    const url = `${req.protocol}://${req.get('host')}${req.originalUrl}`;\n    const params = req.body;\n    \n    const validator = twilio.validateRequest(\n      authToken,\n      twilioSignature,\n      url,\n      params\n    );\n    \n    if (!validator) {\n      return res.status(403).json({ message: 'Invalid Twilio signature' });\n    }\n    \n    next();\n  } catch (error) {\n    console.error('Webhook verification error:', error);\n    return res.status(500).json({ message: 'Webhook verification failed' });\n  }\n}\n","path":null,"size_bytes":2981,"size_tokens":null},"server/storage.ts":{"content":"import { \n  type Booking, \n  type InsertBooking, \n  type DeviceConfig,\n  type InsertDeviceConfig,\n  type PricingConfig,\n  type InsertPricingConfig,\n  type HappyHoursConfig,\n  type InsertHappyHoursConfig,\n  type HappyHoursPricing,\n  type InsertHappyHoursPricing,\n  type FoodItem,\n  type InsertFoodItem,\n  type StockBatch,\n  type InsertStockBatch,\n  type BookingHistory,\n  type InsertBookingHistory,\n  type User,\n  type InsertUser,\n  type UpsertUser,\n  type Expense,\n  type InsertExpense,\n  type ActivityLog,\n  type InsertActivityLog,\n  type Notification,\n  type InsertNotification,\n  type GamingCenterInfo,\n  type InsertGamingCenterInfo,\n  type GalleryImage,\n  type InsertGalleryImage,\n  type Facility,\n  type InsertFacility,\n  type Game,\n  type InsertGame,\n  type LoadMetric,\n  type InsertLoadMetric,\n  type LoadPrediction,\n  type InsertLoadPrediction,\n  type RetentionConfig,\n  type InsertRetentionConfig,\n  type DeviceMaintenance,\n  type InsertDeviceMaintenance,\n  type PaymentLog,\n  type InsertPaymentLog,\n  type StaffVisibilitySettings,\n  type VisibilityPages,\n  type VisibilityElements,\n  bookings,\n  deviceConfigs,\n  pricingConfigs,\n  happyHoursConfigs,\n  happyHoursPricing,\n  foodItems,\n  stockBatches,\n  bookingHistory,\n  users,\n  expenses,\n  activityLogs,\n  notifications,\n  gamingCenterInfo,\n  galleryImages,\n  facilities,\n  games,\n  loadMetrics,\n  loadPredictions,\n  retentionConfig,\n  deviceMaintenance,\n  paymentLogs,\n  staffVisibilitySettings\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, and, gte, lte, lt, desc, inArray, isNotNull } from \"drizzle-orm\";\nimport bcrypt from \"bcryptjs\";\nimport { SecurityConfig, validatePasswordStrength } from \"./security\";\n\nexport interface BookingStats {\n  totalRevenue: number;\n  totalFoodRevenue: number;\n  totalSessions: number;\n  avgSessionMinutes: number;\n  cashRevenue: number;\n  upiRevenue: number;\n}\n\nexport interface BookingHistoryItem {\n  id: string;\n  date: string;\n  seatName: string;\n  customerName: string;\n  duration: string;\n  durationMinutes: number;\n  price: string;\n  foodAmount: number;\n  totalAmount: number;\n  paymentMethod: string | null;\n  paymentStatus?: string;\n  cashAmount: string | null;\n  upiAmount: string | null;\n  discount?: string | null;\n  bonus?: string | null;\n  discountApplied?: string | null;\n  bonusHoursApplied?: string | null;\n}\n\nexport interface CustomerPromotionSummary {\n  discountCount: number;\n  bonusCount: number;\n  totalSavings: number;\n  totalBonusHours: number;\n}\n\nexport interface PromotionHistoryItem {\n  bookingId: string;\n  seatName: string;\n  date: string;\n  promotionType: 'discount' | 'bonus';\n  discountPercentage?: number;\n  discountAmount?: string;\n  bonusHours?: string;\n  originalPrice?: string;\n  finalPrice: string;\n}\n\nexport interface RetentionMetrics {\n  summary: {\n    totalCustomers: number;\n    newCustomers: number;\n    returningCustomers: number;\n    retentionRate: number;\n    churnRate: number;\n    avgVisitFrequency: number;\n    avgLifetimeValue: number;\n  };\n  series: {\n    period: string;\n    newCustomers: number;\n    returningCustomers: number;\n    totalVisits: number;\n    retentionRate: number;\n    revenue: number;\n  }[];\n}\n\nexport interface IStorage {\n  getAllBookings(): Promise<Booking[]>;\n  getBooking(id: string): Promise<Booking | undefined>;\n  getBookingsByIds(ids: string[]): Promise<Booking[]>;\n  getActiveBookings(): Promise<Booking[]>;\n  createBooking(booking: InsertBooking): Promise<Booking>;\n  updateBooking(id: string, data: Partial<InsertBooking>): Promise<Booking | undefined>;\n  deleteBooking(id: string): Promise<boolean>;\n  \n  getBookingStats(startDate: Date, endDate: Date): Promise<BookingStats>;\n  getBookingHistory(startDate: Date, endDate: Date): Promise<BookingHistoryItem[]>;\n  getCustomerPromotionSummary(whatsappNumber: string): Promise<CustomerPromotionSummary>;\n  getPromotionHistoryByCustomer(whatsappNumber: string): Promise<PromotionHistoryItem[]>;\n  getRetentionMetrics(startDate: Date, endDate: Date, period: 'daily' | 'weekly' | 'monthly'): Promise<RetentionMetrics>;\n  \n  moveBookingsToHistory(): Promise<number>;\n  getAllBookingHistory(): Promise<BookingHistory[]>;\n  \n  getAllDeviceConfigs(): Promise<DeviceConfig[]>;\n  getDeviceConfig(category: string): Promise<DeviceConfig | undefined>;\n  upsertDeviceConfig(config: InsertDeviceConfig): Promise<DeviceConfig>;\n  deleteDeviceConfig(category: string): Promise<boolean>;\n  \n  getAllPricingConfigs(): Promise<PricingConfig[]>;\n  getPricingConfigsByCategory(category: string): Promise<PricingConfig[]>;\n  upsertPricingConfigs(category: string, configs: InsertPricingConfig[]): Promise<PricingConfig[]>;\n  deletePricingConfig(category: string): Promise<boolean>;\n  \n  getAllHappyHoursConfigs(): Promise<HappyHoursConfig[]>;\n  getHappyHoursConfigsByCategory(category: string): Promise<HappyHoursConfig[]>;\n  upsertHappyHoursConfigs(category: string, configs: InsertHappyHoursConfig[]): Promise<HappyHoursConfig[]>;\n  deleteHappyHoursConfig(category: string): Promise<boolean>;\n  isHappyHoursActive(category: string): Promise<boolean>;\n  \n  getAllHappyHoursPricing(): Promise<HappyHoursPricing[]>;\n  getHappyHoursPricingByCategory(category: string): Promise<HappyHoursPricing[]>;\n  upsertHappyHoursPricing(category: string, configs: InsertHappyHoursPricing[]): Promise<HappyHoursPricing[]>;\n  deleteHappyHoursPricing(category: string): Promise<boolean>;\n  \n  getAllFoodItems(): Promise<FoodItem[]>;\n  getFoodItem(id: string): Promise<FoodItem | undefined>;\n  createFoodItem(item: InsertFoodItem): Promise<FoodItem>;\n  updateFoodItem(id: string, item: InsertFoodItem): Promise<FoodItem | undefined>;\n  deleteFoodItem(id: string): Promise<boolean>;\n  adjustStock(foodId: string, quantity: number, type: 'add' | 'remove', batchData?: Partial<InsertStockBatch>): Promise<FoodItem | undefined>;\n  getLowStockItems(): Promise<FoodItem[]>;\n  getInventoryItems(): Promise<FoodItem[]>;\n  addToInventory(id: string): Promise<FoodItem | undefined>;\n  removeFromInventory(id: string): Promise<FoodItem | undefined>;\n  getExpiringItems(daysAhead: number): Promise<FoodItem[]>;\n  getReorderList(): Promise<FoodItem[]>;\n  \n  createStockBatch(batch: InsertStockBatch): Promise<StockBatch>;\n  getStockBatchesByFoodItem(foodItemId: string): Promise<StockBatch[]>;\n  getAllStockBatches(): Promise<StockBatch[]>;\n  \n  getUserByUsername(username: string): Promise<User | undefined>;\n  getUserById(id: string): Promise<User | undefined>;\n  getUser(id: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  upsertUser(user: UpsertUser): Promise<User>;\n  validatePassword(username: string, password: string): Promise<User | null>;\n  updateUserOnboarding(userId: string, completed: boolean): Promise<boolean>;\n  getAllUsers(): Promise<User[]>;\n  getAllStaffUsers(): Promise<User[]>;\n  updateUserProfile(userId: string, profile: { username?: string }): Promise<User | undefined>;\n  updateUserPassword(userId: string, newPasswordHash: string): Promise<boolean>;\n  deleteUser(userId: string): Promise<boolean>;\n  createStaffUser(staff: { username: string; passwordHash: string }): Promise<User>;\n  \n  getAllExpenses(): Promise<Expense[]>;\n  getExpense(id: string): Promise<Expense | undefined>;\n  createExpense(expense: InsertExpense): Promise<Expense>;\n  updateExpense(id: string, expense: InsertExpense): Promise<Expense | undefined>;\n  deleteExpense(id: string): Promise<boolean>;\n  getExpensesByDateRange(startDate: Date, endDate: Date): Promise<Expense[]>;\n  \n  getAllActivityLogs(): Promise<ActivityLog[]>;\n  createActivityLog(log: InsertActivityLog): Promise<ActivityLog>;\n  getActivityLogsByDateRange(startDate: Date, endDate: Date): Promise<ActivityLog[]>;\n  \n  getGamingCenterInfo(): Promise<GamingCenterInfo | undefined>;\n  upsertGamingCenterInfo(info: InsertGamingCenterInfo): Promise<GamingCenterInfo>;\n  \n  getAllGalleryImages(): Promise<GalleryImage[]>;\n  getGalleryImage(id: string): Promise<GalleryImage | undefined>;\n  createGalleryImage(image: InsertGalleryImage): Promise<GalleryImage>;\n  updateGalleryImage(id: string, image: InsertGalleryImage): Promise<GalleryImage | undefined>;\n  deleteGalleryImage(id: string): Promise<boolean>;\n  \n  getAllFacilities(): Promise<Facility[]>;\n  getFacility(id: string): Promise<Facility | undefined>;\n  createFacility(facility: InsertFacility): Promise<Facility>;\n  updateFacility(id: string, facility: InsertFacility): Promise<Facility | undefined>;\n  deleteFacility(id: string): Promise<boolean>;\n  \n  getAllGames(): Promise<Game[]>;\n  getGamesByCategory(category: string): Promise<Game[]>;\n  getGame(id: string): Promise<Game | undefined>;\n  createGame(game: InsertGame): Promise<Game>;\n  updateGame(id: string, game: InsertGame): Promise<Game | undefined>;\n  deleteGame(id: string): Promise<boolean>;\n  \n  getAllLoadMetrics(): Promise<LoadMetric[]>;\n  getRecentLoadMetrics(limit: number): Promise<LoadMetric[]>;\n  createLoadMetric(metric: InsertLoadMetric): Promise<LoadMetric>;\n  getCurrentLoad(): Promise<LoadMetric | undefined>;\n  \n  getAllLoadPredictions(): Promise<LoadPrediction[]>;\n  getRecentLoadPredictions(limit: number): Promise<LoadPrediction[]>;\n  createLoadPrediction(prediction: InsertLoadPrediction): Promise<LoadPrediction>;\n  \n  deleteOldBookingHistory(olderThanDays: number): Promise<number>;\n  deleteOldActivityLogs(olderThanDays: number): Promise<number>;\n  deleteOldLoadMetrics(olderThanDays: number): Promise<number>;\n  deleteOldLoadPredictions(olderThanDays: number): Promise<number>;\n  deleteOldExpenses(olderThanDays: number): Promise<number>;\n  \n  getRetentionConfig(): Promise<RetentionConfig>;\n  updateRetentionConfig(config: Partial<InsertRetentionConfig>): Promise<RetentionConfig>;\n  \n  getAllDeviceMaintenance(): Promise<DeviceMaintenance[]>;\n  getDeviceMaintenance(category: string, seatName: string): Promise<DeviceMaintenance | undefined>;\n  upsertDeviceMaintenance(data: InsertDeviceMaintenance): Promise<DeviceMaintenance>;\n  updateDeviceMaintenanceStatus(category: string, seatName: string, status: string, notes?: string): Promise<DeviceMaintenance | undefined>;\n  \n  getAllNotifications(): Promise<Notification[]>;\n  getUnreadNotifications(): Promise<Notification[]>;\n  getNotificationById(id: string): Promise<Notification | undefined>;\n  createNotification(notification: InsertNotification): Promise<Notification>;\n  markNotificationAsRead(id: string): Promise<Notification | undefined>;\n  markAllNotificationsAsRead(): Promise<void>;\n  deleteNotification(id: string): Promise<boolean>;\n  getUnreadCount(): Promise<number>;\n  \n  createPaymentLog(log: InsertPaymentLog): Promise<PaymentLog>;\n  getPaymentLogs(date?: string): Promise<PaymentLog[]>;\n  \n  updatePaymentStatus(bookingIds: string[], paymentStatus: string, paymentMethod: string | null, userId: string): Promise<{ bookings: Booking[], count: number }>;\n  \n  getStaffVisibilitySettings(): Promise<StaffVisibilitySettings>;\n  updateStaffVisibilitySettings(pages: VisibilityPages, elements: VisibilityElements): Promise<StaffVisibilitySettings>;\n  \n  initializeDefaults(): Promise<void>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  async initializeDefaults(): Promise<void> {\n    // Check if defaults already exist\n    const existingDevices = await db.select().from(deviceConfigs);\n    const existingUsers = await db.select().from(users);\n    \n    // Initialize default device configs if not exist\n    if (existingDevices.length === 0) {\n      await db.insert(deviceConfigs).values([\n        {\n          category: \"PC\",\n          count: 5,\n          seats: [\"PC-1\", \"PC-2\", \"PC-3\", \"PC-4\", \"PC-5\"]\n        },\n        {\n          category: \"PS5\",\n          count: 3,\n          seats: [\"PS5-1\", \"PS5-2\", \"PS5-3\"]\n        }\n      ]);\n\n      // Initialize default pricing configs\n      await db.insert(pricingConfigs).values([\n        { category: \"PC\", duration: \"30 mins\", price: \"10\" },\n        { category: \"PC\", duration: \"1 hour\", price: \"18\" },\n        { category: \"PC\", duration: \"2 hours\", price: \"30\" },\n        { category: \"PS5\", duration: \"30 mins\", price: \"15\" },\n        { category: \"PS5\", duration: \"1 hour\", price: \"25\" },\n        { category: \"PS5\", duration: \"2 hours\", price: \"45\" }\n      ]);\n\n      // Initialize default food items\n      await db.insert(foodItems).values([\n        { name: \"Pizza\", price: \"8\" },\n        { name: \"Burger\", price: \"6\" },\n        { name: \"Fries\", price: \"3\" },\n        { name: \"Soda\", price: \"2\" },\n        { name: \"Water\", price: \"1\" },\n        { name: \"Sandwich\", price: \"5\" },\n        { name: \"Hot Dog\", price: \"4\" },\n        { name: \"Coffee\", price: \"3\" },\n        { name: \"Energy Drink\", price: \"4\" },\n        { name: \"Nachos\", price: \"5\" },\n      ]);\n    }\n\n    // Initialize default users if no users exist\n    if (existingUsers.length === 0) {\n      const adminUsername = process.env.ADMIN_USERNAME;\n      const adminPassword = process.env.ADMIN_PASSWORD;\n      const staffUsername = process.env.STAFF_USERNAME;\n      const staffPassword = process.env.STAFF_PASSWORD;\n      \n      if (!adminUsername || !adminPassword) {\n        console.error('‚ùå ERROR: No admin user exists and ADMIN_USERNAME/ADMIN_PASSWORD environment variables are not set!');\n        console.error('‚ùå Please set ADMIN_USERNAME and ADMIN_PASSWORD to create an admin user.');\n        console.error('‚ùå The application will continue without users.');\n        return;\n      }\n      \n      if (adminPassword.length < 8) {\n        console.error('‚ùå WARNING: ADMIN_PASSWORD must be at least 8 characters long. Admin user not created.');\n      } else {\n        // Create admin user (skip strict validation for initial setup)\n        await this.createUser({\n          username: adminUsername,\n          password: adminPassword,\n          role: \"admin\"\n        }, true);\n        console.log(`‚úÖ Admin user created with username: ${adminUsername}`);\n      }\n      \n      // Create staff user if credentials provided\n      if (staffUsername && staffPassword) {\n        if (staffPassword.length < 8) {\n          console.error('‚ùå WARNING: STAFF_PASSWORD must be at least 8 characters long. Staff user not created.');\n        } else {\n          await this.createUser({\n            username: staffUsername,\n            password: staffPassword,\n            role: \"staff\"\n          }, true);\n          console.log(`‚úÖ Staff user created with username: ${staffUsername}`);\n        }\n      } else {\n        console.log('‚ÑπÔ∏è  No staff user created. Set STAFF_USERNAME and STAFF_PASSWORD to create a staff user.');\n      }\n    } else {\n      // Check if staff user needs to be created (even if admin exists)\n      const staffUsername = process.env.STAFF_USERNAME;\n      const staffPassword = process.env.STAFF_PASSWORD;\n      \n      if (staffUsername && staffPassword) {\n        const staffUserExists = existingUsers.some(u => u.username === staffUsername);\n        \n        if (!staffUserExists) {\n          if (staffPassword.length < 8) {\n            console.error('‚ùå WARNING: STAFF_PASSWORD must be at least 8 characters long. Staff user not created.');\n          } else {\n            await this.createUser({\n              username: staffUsername,\n              password: staffPassword,\n              role: \"staff\"\n            }, true);\n            console.log(`‚úÖ Staff user created with username: ${staffUsername}`);\n          }\n        }\n      }\n    }\n\n    console.log('Database initialized with default data');\n  }\n\n  async getAllBookings(): Promise<Booking[]> {\n    return await db.select().from(bookings);\n  }\n\n  async getBooking(id: string): Promise<Booking | undefined> {\n    const [booking] = await db.select().from(bookings).where(eq(bookings.id, id));\n    return booking || undefined;\n  }\n\n  async getBookingsByIds(ids: string[]): Promise<Booking[]> {\n    if (ids.length === 0) return [];\n    return await db.select().from(bookings).where(inArray(bookings.id, ids));\n  }\n\n  async getActiveBookings(): Promise<Booking[]> {\n    return await db.select().from(bookings);\n  }\n\n  async createBooking(booking: InsertBooking): Promise<Booking> {\n    const [newBooking] = await db.insert(bookings).values({ \n      ...booking, \n      bookingCode: booking.bookingCode ?? null,\n      groupId: booking.groupId ?? null,\n      groupCode: booking.groupCode ?? null\n    } as any).returning();\n    return newBooking;\n  }\n\n  async updateBooking(id: string, data: Partial<InsertBooking>): Promise<Booking | undefined> {\n    const updateData: any = { ...data };\n    if (data.foodOrders !== undefined) {\n      updateData.foodOrders = data.foodOrders;\n    }\n    // Convert date strings to Date objects\n    if (data.startTime && typeof data.startTime === 'string') {\n      updateData.startTime = new Date(data.startTime);\n    }\n    if (data.endTime && typeof data.endTime === 'string') {\n      updateData.endTime = new Date(data.endTime);\n    }\n    const [updated] = await db\n      .update(bookings)\n      .set(updateData)\n      .where(eq(bookings.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async deleteBooking(id: string): Promise<boolean> {\n    const result = await db.delete(bookings).where(eq(bookings.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async getBookingStats(startDate: Date, endDate: Date): Promise<BookingStats> {\n    const completedBookings = await db\n      .select()\n      .from(bookingHistory)\n      .where(\n        and(\n          gte(bookingHistory.startTime, startDate),\n          lte(bookingHistory.startTime, endDate)\n        )\n      );\n\n    const cashRevenue = completedBookings\n      .reduce((sum, booking) => {\n        if (booking.paymentMethod === \"cash\") {\n          const sessionPrice = parseFloat(booking.price);\n          const foodPrice = booking.foodOrders && booking.foodOrders.length > 0\n            ? booking.foodOrders.reduce((foodSum, order) => \n                foodSum + parseFloat(order.price) * order.quantity, 0)\n            : 0;\n          return sum + sessionPrice + foodPrice;\n        } else if (booking.paymentMethod === \"split\" && booking.cashAmount) {\n          return sum + parseFloat(booking.cashAmount);\n        }\n        return sum;\n      }, 0);\n\n    const upiRevenue = completedBookings\n      .reduce((sum, booking) => {\n        if (booking.paymentMethod === \"upi_online\") {\n          const sessionPrice = parseFloat(booking.price);\n          const foodPrice = booking.foodOrders && booking.foodOrders.length > 0\n            ? booking.foodOrders.reduce((foodSum, order) => \n                foodSum + parseFloat(order.price) * order.quantity, 0)\n            : 0;\n          return sum + sessionPrice + foodPrice;\n        } else if (booking.paymentMethod === \"split\" && booking.upiAmount) {\n          return sum + parseFloat(booking.upiAmount);\n        }\n        return sum;\n      }, 0);\n\n    const paidBookings = completedBookings.filter(b => \n      b.paymentMethod === \"cash\" || b.paymentMethod === \"upi_online\" || b.paymentMethod === \"split\"\n    );\n\n    const totalRevenue = paidBookings.reduce((sum, booking) => {\n      return sum + parseFloat(booking.price);\n    }, 0);\n\n    const totalFoodRevenue = paidBookings.reduce((sum, booking) => {\n      if (booking.foodOrders && booking.foodOrders.length > 0) {\n        return sum + booking.foodOrders.reduce((foodSum, order) => \n          foodSum + parseFloat(order.price) * order.quantity, 0\n        );\n      }\n      return sum;\n    }, 0);\n\n    const totalSessions = completedBookings.length;\n\n    const totalMinutes = completedBookings.reduce((sum, booking) => {\n      const duration = booking.endTime.getTime() - booking.startTime.getTime();\n      return sum + (duration / 1000 / 60);\n    }, 0);\n\n    const avgSessionMinutes = totalSessions > 0 ? Math.round(totalMinutes / totalSessions) : 0;\n\n    return {\n      totalRevenue,\n      totalFoodRevenue,\n      totalSessions,\n      avgSessionMinutes,\n      cashRevenue,\n      upiRevenue\n    };\n  }\n\n  async getBookingHistory(startDate: Date, endDate: Date): Promise<BookingHistoryItem[]> {\n    const completedBookings = await db\n      .select()\n      .from(bookingHistory)\n      .where(\n        and(\n          gte(bookingHistory.startTime, startDate),\n          lte(bookingHistory.startTime, endDate)\n        )\n      );\n\n    const bookingItems: BookingHistoryItem[] = completedBookings.map(booking => {\n      const durationMs = booking.endTime.getTime() - booking.startTime.getTime();\n      const durationMinutes = Math.round(durationMs / 1000 / 60);\n      const hours = Math.floor(durationMinutes / 60);\n      const mins = durationMinutes % 60;\n      \n      let duration: string;\n      if (hours > 0 && mins > 0) {\n        duration = `${hours} hour${hours > 1 ? 's' : ''} ${mins} mins`;\n      } else if (hours > 0) {\n        duration = `${hours} hour${hours > 1 ? 's' : ''}`;\n      } else {\n        duration = `${mins} mins`;\n      }\n\n      const foodAmount = booking.foodOrders && booking.foodOrders.length > 0\n        ? booking.foodOrders.reduce((sum, order) => sum + parseFloat(order.price) * order.quantity, 0)\n        : 0;\n\n      const sessionPrice = parseFloat(booking.price);\n      const totalAmount = sessionPrice + foodAmount;\n\n      const dateObj = new Date(booking.startTime);\n      const formattedDate = dateObj.toLocaleDateString('en-US', { \n        month: 'short', \n        day: 'numeric', \n        year: 'numeric' \n      });\n\n      return {\n        id: booking.id,\n        date: formattedDate,\n        seatName: booking.seatName,\n        customerName: booking.customerName,\n        duration,\n        durationMinutes,\n        price: booking.price,\n        foodAmount,\n        totalAmount,\n        paymentMethod: booking.paymentMethod,\n        paymentStatus: booking.paymentStatus,\n        cashAmount: booking.cashAmount,\n        upiAmount: booking.upiAmount,\n        discount: booking.discount,\n        bonus: booking.bonus,\n        discountApplied: booking.discountApplied,\n        bonusHoursApplied: booking.bonusHoursApplied\n      };\n    });\n\n    return bookingItems.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\n  }\n\n  async getRetentionMetrics(startDate: Date, endDate: Date, period: 'daily' | 'weekly' | 'monthly'): Promise<RetentionMetrics> {\n    const allBookings = await db\n      .select()\n      .from(bookingHistory)\n      .where(\n        and(\n          gte(bookingHistory.startTime, startDate),\n          lte(bookingHistory.startTime, endDate)\n        )\n      );\n\n    const customerVisits = new Map<string, { firstVisit: Date; visits: Array<{ date: Date; revenue: number }>; totalRevenue: number }>();\n    \n    allBookings.forEach(booking => {\n      let customerId: string | null = null;\n      \n      if (booking.whatsappNumber && booking.whatsappNumber.trim()) {\n        customerId = booking.whatsappNumber.trim();\n      } else if (booking.customerName && booking.customerName.trim()) {\n        customerId = `name:${booking.customerName.trim().toLowerCase()}`;\n      }\n      \n      if (!customerId) {\n        return;\n      }\n      const foodRevenue = booking.foodOrders && booking.foodOrders.length > 0\n        ? booking.foodOrders.reduce((sum, order) => sum + parseFloat(order.price) * order.quantity, 0)\n        : 0;\n      const totalRevenue = parseFloat(booking.price) + foodRevenue;\n      \n      if (!customerVisits.has(customerId)) {\n        customerVisits.set(customerId, {\n          firstVisit: booking.startTime,\n          visits: [],\n          totalRevenue: 0\n        });\n      }\n      \n      const customer = customerVisits.get(customerId)!;\n      customer.visits.push({ date: booking.startTime, revenue: totalRevenue });\n      customer.totalRevenue += totalRevenue;\n      \n      if (booking.startTime < customer.firstVisit) {\n        customer.firstVisit = booking.startTime;\n      }\n    });\n\n    const periodBuckets = new Map<string, { newCustomers: Set<string>; returningCustomers: Set<string>; totalVisits: number; revenue: number }>();\n    \n    const getPeriodKey = (date: Date): string => {\n      if (period === 'daily') {\n        return date.toISOString().split('T')[0];\n      } else if (period === 'weekly') {\n        const year = date.getFullYear();\n        const week = Math.floor((date.getTime() - new Date(year, 0, 1).getTime()) / (7 * 24 * 60 * 60 * 1000));\n        return `${year}-W${week}`;\n      } else {\n        return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;\n      }\n    };\n\n    customerVisits.forEach((customerData, customerId) => {\n      customerData.visits.forEach(visit => {\n        const periodKey = getPeriodKey(visit.date);\n        \n        if (!periodBuckets.has(periodKey)) {\n          periodBuckets.set(periodKey, {\n            newCustomers: new Set(),\n            returningCustomers: new Set(),\n            totalVisits: 0,\n            revenue: 0\n          });\n        }\n        \n        const bucket = periodBuckets.get(periodKey)!;\n        bucket.totalVisits++;\n        bucket.revenue += visit.revenue;\n        \n        const isFirstVisitInPeriod = getPeriodKey(customerData.firstVisit) === periodKey;\n        if (isFirstVisitInPeriod) {\n          bucket.newCustomers.add(customerId);\n        } else {\n          bucket.returningCustomers.add(customerId);\n        }\n      });\n    });\n\n    const now = new Date();\n    const thirtyDaysAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);\n    const activeCustomers = Array.from(customerVisits.values()).filter(customer => {\n      const lastVisit = customer.visits[customer.visits.length - 1].date;\n      return lastVisit >= thirtyDaysAgo;\n    });\n    const churnedCustomers = customerVisits.size - activeCustomers.length;\n\n    const series = Array.from(periodBuckets.entries())\n      .map(([periodKey, data]) => ({\n        period: periodKey,\n        newCustomers: data.newCustomers.size,\n        returningCustomers: data.returningCustomers.size,\n        totalVisits: data.totalVisits,\n        retentionRate: data.newCustomers.size + data.returningCustomers.size > 0 \n          ? (data.returningCustomers.size / (data.newCustomers.size + data.returningCustomers.size)) * 100\n          : 0,\n        revenue: data.revenue\n      }))\n      .sort((a, b) => a.period.localeCompare(b.period));\n\n    const totalNewCustomers = customerVisits.size;\n    const totalReturningCustomers = Array.from(customerVisits.values()).filter(c => c.visits.length > 1).length;\n    const totalRevenue = Array.from(customerVisits.values()).reduce((sum, c) => sum + c.totalRevenue, 0);\n    const totalVisits = allBookings.length;\n\n    return {\n      summary: {\n        totalCustomers: customerVisits.size,\n        newCustomers: totalNewCustomers,\n        returningCustomers: totalReturningCustomers,\n        retentionRate: totalNewCustomers > 0 ? (totalReturningCustomers / totalNewCustomers) * 100 : 0,\n        churnRate: customerVisits.size > 0 ? (churnedCustomers / customerVisits.size) * 100 : 0,\n        avgVisitFrequency: customerVisits.size > 0 ? totalVisits / customerVisits.size : 0,\n        avgLifetimeValue: customerVisits.size > 0 ? totalRevenue / customerVisits.size : 0\n      },\n      series\n    };\n  }\n\n  async getAllDeviceConfigs(): Promise<DeviceConfig[]> {\n    return await db.select().from(deviceConfigs);\n  }\n\n  async getDeviceConfig(category: string): Promise<DeviceConfig | undefined> {\n    const [config] = await db\n      .select()\n      .from(deviceConfigs)\n      .where(eq(deviceConfigs.category, category));\n    return config || undefined;\n  }\n\n  async upsertDeviceConfig(config: InsertDeviceConfig): Promise<DeviceConfig> {\n    const existing = await this.getDeviceConfig(config.category);\n    \n    if (existing) {\n      const [updated] = await db\n        .update(deviceConfigs)\n        .set(config)\n        .where(eq(deviceConfigs.category, config.category))\n        .returning();\n      return updated;\n    } else {\n      const [newConfig] = await db.insert(deviceConfigs).values(config).returning();\n      return newConfig;\n    }\n  }\n\n  async deleteDeviceConfig(category: string): Promise<boolean> {\n    const result = await db.delete(deviceConfigs).where(eq(deviceConfigs.category, category));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async getAllPricingConfigs(): Promise<PricingConfig[]> {\n    return await db.select().from(pricingConfigs);\n  }\n\n  async getPricingConfigsByCategory(category: string): Promise<PricingConfig[]> {\n    return await db\n      .select()\n      .from(pricingConfigs)\n      .where(eq(pricingConfigs.category, category));\n  }\n\n  async upsertPricingConfigs(category: string, configs: InsertPricingConfig[]): Promise<PricingConfig[]> {\n    // Delete existing configs for this category\n    await db.delete(pricingConfigs).where(eq(pricingConfigs.category, category));\n    \n    if (configs.length === 0) {\n      return [];\n    }\n    \n    // Insert new configs\n    const result = await db.insert(pricingConfigs).values(configs).returning();\n    return result;\n  }\n\n  async deletePricingConfig(category: string): Promise<boolean> {\n    const result = await db.delete(pricingConfigs).where(eq(pricingConfigs.category, category));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async getAllHappyHoursConfigs(): Promise<HappyHoursConfig[]> {\n    return await db.select().from(happyHoursConfigs);\n  }\n\n  async getHappyHoursConfigsByCategory(category: string): Promise<HappyHoursConfig[]> {\n    return await db.select().from(happyHoursConfigs).where(eq(happyHoursConfigs.category, category));\n  }\n\n  async upsertHappyHoursConfigs(category: string, configs: InsertHappyHoursConfig[]): Promise<HappyHoursConfig[]> {\n    // Delete existing configs for this category\n    await db.delete(happyHoursConfigs).where(eq(happyHoursConfigs.category, category));\n    \n    if (configs.length === 0) {\n      return [];\n    }\n    \n    // Insert new configs\n    const result = await db.insert(happyHoursConfigs).values(configs).returning();\n    return result;\n  }\n\n  async deleteHappyHoursConfig(category: string): Promise<boolean> {\n    const result = await db.delete(happyHoursConfigs).where(eq(happyHoursConfigs.category, category));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async isHappyHoursActive(category: string): Promise<boolean> {\n    const configs = await this.getHappyHoursConfigsByCategory(category);\n    if (configs.length === 0) {\n      return false;\n    }\n\n    // Filter only enabled configs\n    const enabledConfigs = configs.filter(c => c.enabled === 1);\n    if (enabledConfigs.length === 0) {\n      return false;\n    }\n\n    // Get the configured timezone from gamingCenterInfo\n    const centerInfo = await this.getGamingCenterInfo();\n    const timezone = centerInfo?.timezone || 'Asia/Kolkata';\n\n    // Convert current UTC time to the configured timezone\n    const now = new Date();\n    const formatter = new Intl.DateTimeFormat('en-US', {\n      timeZone: timezone,\n      hour: '2-digit',\n      minute: '2-digit',\n      hour12: false,\n    });\n    \n    const parts = formatter.formatToParts(now);\n    const hour = parts.find(p => p.type === 'hour')?.value || '00';\n    const minute = parts.find(p => p.type === 'minute')?.value || '00';\n    const currentTime = `${hour}:${minute}`;\n    \n    for (const config of enabledConfigs) {\n      // Handle time slots that cross midnight (e.g., 22:00 to 02:00)\n      if (config.startTime <= config.endTime) {\n        // Normal case: start < end (e.g., 10:00 to 18:00)\n        if (currentTime >= config.startTime && currentTime < config.endTime) {\n          return true;\n        }\n      } else {\n        // Overnight case: start > end (e.g., 22:00 to 02:00)\n        // Current time is either >= start (e.g., 23:00) OR < end (e.g., 01:00)\n        if (currentTime >= config.startTime || currentTime < config.endTime) {\n          return true;\n        }\n      }\n    }\n    \n    return false;\n  }\n\n  async isHappyHoursActiveForTime(category: string, timeSlot: string): Promise<boolean> {\n    const configs = await this.getHappyHoursConfigsByCategory(category);\n    if (configs.length === 0) {\n      return false;\n    }\n\n    // Filter only enabled configs\n    const enabledConfigs = configs.filter(c => c.enabled === 1);\n    if (enabledConfigs.length === 0) {\n      return false;\n    }\n\n    // timeSlot is in format \"HH:MM\" (e.g., \"14:30\")\n    const slotTime = timeSlot;\n    \n    for (const config of enabledConfigs) {\n      // Handle time slots that cross midnight (e.g., 22:00 to 02:00)\n      if (config.startTime <= config.endTime) {\n        // Normal case: start < end (e.g., 10:00 to 18:00)\n        if (slotTime >= config.startTime && slotTime < config.endTime) {\n          return true;\n        }\n      } else {\n        // Overnight case: start > end (e.g., 22:00 to 02:00)\n        // Slot time is either >= start (e.g., 23:00) OR < end (e.g., 01:00)\n        if (slotTime >= config.startTime || slotTime < config.endTime) {\n          return true;\n        }\n      }\n    }\n    \n    return false;\n  }\n\n  async getAllHappyHoursPricing(): Promise<HappyHoursPricing[]> {\n    return await db.select().from(happyHoursPricing);\n  }\n\n  async getHappyHoursPricingByCategory(category: string): Promise<HappyHoursPricing[]> {\n    return await db\n      .select()\n      .from(happyHoursPricing)\n      .where(eq(happyHoursPricing.category, category));\n  }\n\n  async upsertHappyHoursPricing(category: string, configs: InsertHappyHoursPricing[]): Promise<HappyHoursPricing[]> {\n    // Delete existing configs for this category\n    await db.delete(happyHoursPricing).where(eq(happyHoursPricing.category, category));\n    \n    if (configs.length === 0) {\n      return [];\n    }\n    \n    // Insert new configs\n    const result = await db.insert(happyHoursPricing).values(configs).returning();\n    return result;\n  }\n\n  async deleteHappyHoursPricing(category: string): Promise<boolean> {\n    const result = await db.delete(happyHoursPricing).where(eq(happyHoursPricing.category, category));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n\n  async getAllFoodItems(): Promise<FoodItem[]> {\n    return await db.select().from(foodItems);\n  }\n\n  async getFoodItem(id: string): Promise<FoodItem | undefined> {\n    const [item] = await db.select().from(foodItems).where(eq(foodItems.id, id));\n    return item || undefined;\n  }\n\n  async createFoodItem(item: InsertFoodItem): Promise<FoodItem> {\n    const [newItem] = await db.insert(foodItems).values(item).returning();\n    return newItem;\n  }\n\n  async updateFoodItem(id: string, item: InsertFoodItem): Promise<FoodItem | undefined> {\n    const [updated] = await db\n      .update(foodItems)\n      .set(item)\n      .where(eq(foodItems.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async deleteFoodItem(id: string): Promise<boolean> {\n    const result = await db.delete(foodItems).where(eq(foodItems.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async adjustStock(foodId: string, quantity: number, type: 'add' | 'remove', batchData?: Partial<InsertStockBatch>): Promise<FoodItem | undefined> {\n    const item = await this.getFoodItem(foodId);\n    if (!item) {\n      return undefined;\n    }\n\n    const newStock = type === 'add' \n      ? item.currentStock + quantity \n      : Math.max(0, item.currentStock - quantity);\n\n    const [updated] = await db\n      .update(foodItems)\n      .set({ currentStock: newStock })\n      .where(eq(foodItems.id, foodId))\n      .returning();\n    \n    if (updated && type === 'add' && batchData) {\n      await this.createStockBatch({\n        foodItemId: foodId,\n        quantity,\n        costPrice: batchData.costPrice || item.costPrice || '0',\n        supplier: batchData.supplier || item.supplier,\n        expiryDate: batchData.expiryDate,\n        notes: batchData.notes,\n      });\n    }\n    \n    return updated || undefined;\n  }\n\n  async getLowStockItems(): Promise<FoodItem[]> {\n    const items = await db\n      .select()\n      .from(foodItems)\n      .where(lt(foodItems.currentStock, foodItems.minStockLevel));\n    return items;\n  }\n\n  async getInventoryItems(): Promise<FoodItem[]> {\n    return await db\n      .select()\n      .from(foodItems)\n      .where(eq(foodItems.inInventory, 1));\n  }\n\n  async addToInventory(id: string): Promise<FoodItem | undefined> {\n    const [updated] = await db\n      .update(foodItems)\n      .set({ inInventory: 1 })\n      .where(eq(foodItems.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async removeFromInventory(id: string): Promise<FoodItem | undefined> {\n    const [updated] = await db\n      .update(foodItems)\n      .set({ inInventory: 0 })\n      .where(eq(foodItems.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async getExpiringItems(daysAhead: number): Promise<FoodItem[]> {\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    \n    const futureDate = new Date();\n    futureDate.setDate(futureDate.getDate() + daysAhead);\n    futureDate.setHours(23, 59, 59, 999);\n    \n    const items = await db\n      .select()\n      .from(foodItems)\n      .where(\n        and(\n          eq(foodItems.inInventory, 1),\n          isNotNull(foodItems.expiryDate),\n          gte(foodItems.expiryDate, today),\n          lte(foodItems.expiryDate, futureDate)\n        )\n      );\n    return items;\n  }\n\n  async getReorderList(): Promise<FoodItem[]> {\n    const items = await db\n      .select()\n      .from(foodItems)\n      .where(\n        and(\n          eq(foodItems.inInventory, 1),\n          eq(foodItems.category, 'trackable'),\n          lt(foodItems.currentStock, foodItems.minStockLevel)\n        )\n      );\n    return items;\n  }\n\n  async createStockBatch(batch: InsertStockBatch): Promise<StockBatch> {\n    const [newBatch] = await db.insert(stockBatches).values(batch).returning();\n    return newBatch;\n  }\n\n  async getStockBatchesByFoodItem(foodItemId: string): Promise<StockBatch[]> {\n    return await db\n      .select()\n      .from(stockBatches)\n      .where(eq(stockBatches.foodItemId, foodItemId))\n      .orderBy(desc(stockBatches.purchaseDate));\n  }\n\n  async getAllStockBatches(): Promise<StockBatch[]> {\n    return await db\n      .select()\n      .from(stockBatches)\n      .orderBy(desc(stockBatches.purchaseDate));\n  }\n\n  async updatePaymentMethod(bookingIds: string[], paymentMethod: string): Promise<number> {\n    const result = await db\n      .update(bookings)\n      .set({ paymentMethod })\n      .where(inArray(bookings.id, bookingIds));\n    \n    return result.rowCount || 0;\n  }\n\n  async updatePaymentStatus(\n    bookingIds: string[], \n    paymentStatus: string, \n    paymentMethod: string | null,\n    userId: string\n  ): Promise<{ bookings: any[], count: number }> {\n    const existingBookings = await db\n      .select()\n      .from(bookings)\n      .where(inArray(bookings.id, bookingIds));\n    \n    const user = await db\n      .select()\n      .from(users)\n      .where(eq(users.id, userId))\n      .limit(1);\n    \n    const username = user.length > 0 ? (user[0].username || 'Unknown') : 'Unknown';\n    \n    const updatedBookings = [];\n    for (const booking of existingBookings) {\n      const lastPaymentAction = {\n        previousStatus: booking.paymentStatus,\n        previousMethod: booking.paymentMethod,\n        timestamp: new Date().toISOString(),\n        userId\n      };\n\n      const result = await db\n        .update(bookings)\n        .set({ \n          paymentStatus, \n          paymentMethod,\n          lastPaymentAction\n        })\n        .where(eq(bookings.id, booking.id))\n        .returning();\n      \n      if (result.length > 0) {\n        updatedBookings.push(result[0]);\n        \n        const totalAmount = parseFloat(booking.price) + \n          (booking.foodOrders || []).reduce((sum: number, order: any) => \n            sum + (parseFloat(order.price) * order.quantity), 0);\n        \n        await this.createPaymentLog({\n          bookingId: booking.id,\n          seatName: booking.seatName,\n          customerName: booking.customerName,\n          amount: totalAmount.toFixed(2),\n          paymentMethod: paymentMethod || 'unknown',\n          paymentStatus,\n          userId,\n          username,\n          previousStatus: booking.paymentStatus,\n          previousMethod: booking.paymentMethod\n        });\n      }\n    }\n    \n    return { bookings: updatedBookings, count: updatedBookings.length };\n  }\n\n  async createPaymentLog(log: InsertPaymentLog): Promise<PaymentLog> {\n    const [newLog] = await db.insert(paymentLogs).values(log).returning();\n    return newLog;\n  }\n\n  async getPaymentLogs(date?: string): Promise<PaymentLog[]> {\n    if (date) {\n      const startOfDay = new Date(date);\n      startOfDay.setHours(0, 0, 0, 0);\n      const endOfDay = new Date(date);\n      endOfDay.setHours(23, 59, 59, 999);\n      \n      return await db\n        .select()\n        .from(paymentLogs)\n        .where(\n          and(\n            gte(paymentLogs.createdAt, startOfDay),\n            lte(paymentLogs.createdAt, endOfDay)\n          )\n        )\n        .orderBy(desc(paymentLogs.createdAt));\n    }\n    \n    return await db\n      .select()\n      .from(paymentLogs)\n      .orderBy(desc(paymentLogs.createdAt))\n      .limit(100);\n  }\n\n  async moveBookingsToHistory(): Promise<number> {\n    const expiredBookings = await db\n      .select()\n      .from(bookings)\n      .where(and(\n        eq(bookings.status, \"expired\"),\n        eq(bookings.paymentStatus, \"paid\")\n      ));\n\n    const completedBookings = await db\n      .select()\n      .from(bookings)\n      .where(and(\n        eq(bookings.status, \"completed\"),\n        eq(bookings.paymentStatus, \"paid\")\n      ));\n\n    const bookingsToArchive = [...expiredBookings, ...completedBookings];\n\n    if (bookingsToArchive.length === 0) {\n      return 0;\n    }\n\n    const historyRecords = bookingsToArchive.map(booking => ({\n      bookingId: booking.id,\n      bookingCode: booking.bookingCode,\n      groupId: booking.groupId,\n      groupCode: booking.groupCode,\n      category: booking.category,\n      seatNumber: booking.seatNumber,\n      seatName: booking.seatName,\n      customerName: booking.customerName,\n      whatsappNumber: booking.whatsappNumber,\n      startTime: booking.startTime,\n      endTime: booking.endTime,\n      price: booking.price,\n      status: booking.status,\n      bookingType: booking.bookingType,\n      pausedRemainingTime: booking.pausedRemainingTime,\n      personCount: booking.personCount,\n      paymentMethod: booking.paymentMethod,\n      cashAmount: booking.cashAmount,\n      upiAmount: booking.upiAmount,\n      paymentStatus: booking.paymentStatus,\n      lastPaymentAction: booking.lastPaymentAction,\n      foodOrders: booking.foodOrders,\n      originalPrice: booking.originalPrice,\n      discountApplied: booking.discountApplied,\n      bonusHoursApplied: booking.bonusHoursApplied,\n      promotionDetails: booking.promotionDetails,\n      isPromotionalDiscount: booking.isPromotionalDiscount,\n      isPromotionalBonus: booking.isPromotionalBonus,\n      manualDiscountPercentage: booking.manualDiscountPercentage,\n      manualFreeHours: booking.manualFreeHours,\n      createdAt: booking.createdAt,\n    }));\n\n    await db.insert(bookingHistory).values(historyRecords as any);\n\n    const bookingIds = bookingsToArchive.map(b => b.id);\n    if (bookingIds.length > 0) {\n      await db.delete(bookings).where(inArray(bookings.id, bookingIds));\n    }\n\n    return bookingsToArchive.length;\n  }\n\n  async getAllBookingHistory(): Promise<BookingHistory[]> {\n    return await db.select().from(bookingHistory);\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.username, username));\n    return user || undefined;\n  }\n\n  async getUserById(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user || undefined;\n  }\n\n  async updateUserOnboarding(userId: string, completed: boolean): Promise<boolean> {\n    const result = await db.update(users)\n      .set({ onboardingCompleted: completed ? 1 : 0 })\n      .where(eq(users.id, userId));\n    return true;\n  }\n\n  async createUser(user: InsertUser, skipValidation: boolean = false): Promise<User> {\n    // Validate password strength (unless skipValidation is true for system initialization)\n    if (!skipValidation) {\n      const passwordValidation = validatePasswordStrength(user.password);\n      if (!passwordValidation.valid) {\n        throw new Error(`Password validation failed: ${passwordValidation.errors.join(', ')}`);\n      }\n    }\n    \n    const saltRounds = SecurityConfig.password.saltRounds;\n    const passwordHash = await bcrypt.hash(user.password, saltRounds);\n    \n    const [newUser] = await db.insert(users).values({\n      username: user.username,\n      passwordHash,\n      role: user.role || \"admin\",\n    }).returning();\n    \n    return newUser;\n  }\n\n  async validatePassword(username: string, password: string): Promise<User | null> {\n    const user = await this.getUserByUsername(username);\n    \n    if (!user || !user.passwordHash) {\n      // Use constant-time comparison to prevent timing attacks\n      // Even if user doesn't exist, still perform a hash comparison\n      await bcrypt.compare(password, '$2b$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewY5jtRu3WjJhvCu');\n      return null;\n    }\n    \n    const isValid = await bcrypt.compare(password, user.passwordHash);\n    \n    if (!isValid) {\n      return null;\n    }\n    \n    return user;\n  }\n\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user || undefined;\n  }\n\n  async upsertUser(userData: UpsertUser): Promise<User> {\n    const [user] = await db\n      .insert(users)\n      .values(userData)\n      .onConflictDoUpdate({\n        target: users.id,\n        set: {\n          ...userData,\n          updatedAt: new Date(),\n        },\n      })\n      .returning();\n    return user;\n  }\n\n  async getAllUsers(): Promise<User[]> {\n    return await db.select().from(users).orderBy(users.createdAt);\n  }\n\n  async getAllStaffUsers(): Promise<User[]> {\n    return await db.select().from(users).where(eq(users.role, 'staff')).orderBy(users.createdAt);\n  }\n\n  async updateUserProfile(userId: string, profile: { username?: string }): Promise<User | undefined> {\n    const updateData: any = {\n      updatedAt: new Date(),\n    };\n    \n    if (profile.username !== undefined) {\n      updateData.username = profile.username;\n    }\n\n    const [updatedUser] = await db\n      .update(users)\n      .set(updateData)\n      .where(eq(users.id, userId))\n      .returning();\n    \n    return updatedUser || undefined;\n  }\n\n  async updateUserPassword(userId: string, newPasswordHash: string): Promise<boolean> {\n    const result = await db\n      .update(users)\n      .set({ \n        passwordHash: newPasswordHash,\n        updatedAt: new Date(),\n      })\n      .where(eq(users.id, userId));\n    \n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async deleteUser(userId: string): Promise<boolean> {\n    const result = await db.delete(users).where(eq(users.id, userId));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async createStaffUser(staff: { username: string; passwordHash: string }): Promise<User> {\n    const [newUser] = await db.insert(users).values({\n      username: staff.username,\n      passwordHash: staff.passwordHash,\n      role: 'staff',\n    }).returning();\n    \n    return newUser;\n  }\n\n  async getAllExpenses(): Promise<Expense[]> {\n    return await db.select().from(expenses);\n  }\n\n  async getExpense(id: string): Promise<Expense | undefined> {\n    const [expense] = await db.select().from(expenses).where(eq(expenses.id, id));\n    return expense || undefined;\n  }\n\n  async createExpense(expense: InsertExpense): Promise<Expense> {\n    const [newExpense] = await db.insert(expenses).values(expense as any).returning();\n    return newExpense;\n  }\n\n  async updateExpense(id: string, expense: InsertExpense): Promise<Expense | undefined> {\n    const updateData: any = { ...expense };\n    if (expense.date && typeof expense.date === 'string') {\n      updateData.date = new Date(expense.date);\n    }\n    const [updated] = await db\n      .update(expenses)\n      .set(updateData)\n      .where(eq(expenses.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async deleteExpense(id: string): Promise<boolean> {\n    const result = await db.delete(expenses).where(eq(expenses.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async getExpensesByDateRange(startDate: Date, endDate: Date): Promise<Expense[]> {\n    return await db\n      .select()\n      .from(expenses)\n      .where(\n        and(\n          gte(expenses.date, startDate),\n          lte(expenses.date, endDate)\n        )\n      );\n  }\n\n  async getAllActivityLogs(): Promise<ActivityLog[]> {\n    return await db.select().from(activityLogs).orderBy(activityLogs.createdAt);\n  }\n\n  async createActivityLog(log: InsertActivityLog): Promise<ActivityLog> {\n    const [newLog] = await db.insert(activityLogs).values(log).returning();\n    return newLog;\n  }\n\n  async getActivityLogsByDateRange(startDate: Date, endDate: Date): Promise<ActivityLog[]> {\n    return await db\n      .select()\n      .from(activityLogs)\n      .where(\n        and(\n          gte(activityLogs.createdAt, startDate),\n          lte(activityLogs.createdAt, endDate)\n        )\n      )\n      .orderBy(activityLogs.createdAt);\n  }\n\n  async getGamingCenterInfo(): Promise<GamingCenterInfo | undefined> {\n    const [info] = await db.select().from(gamingCenterInfo).limit(1);\n    return info || undefined;\n  }\n\n  async upsertGamingCenterInfo(info: InsertGamingCenterInfo): Promise<GamingCenterInfo> {\n    const existing = await this.getGamingCenterInfo();\n    \n    if (existing) {\n      const [updated] = await db\n        .update(gamingCenterInfo)\n        .set({ ...info, updatedAt: new Date() })\n        .where(eq(gamingCenterInfo.id, existing.id))\n        .returning();\n      return updated;\n    } else {\n      const [newInfo] = await db.insert(gamingCenterInfo).values(info).returning();\n      return newInfo;\n    }\n  }\n\n  async getAllGalleryImages(): Promise<GalleryImage[]> {\n    return await db.select().from(galleryImages);\n  }\n\n  async getGalleryImage(id: string): Promise<GalleryImage | undefined> {\n    const [image] = await db.select().from(galleryImages).where(eq(galleryImages.id, id));\n    return image || undefined;\n  }\n\n  async createGalleryImage(image: InsertGalleryImage): Promise<GalleryImage> {\n    const [newImage] = await db.insert(galleryImages).values(image).returning();\n    return newImage;\n  }\n\n  async updateGalleryImage(id: string, image: InsertGalleryImage): Promise<GalleryImage | undefined> {\n    const [updated] = await db\n      .update(galleryImages)\n      .set(image)\n      .where(eq(galleryImages.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async deleteGalleryImage(id: string): Promise<boolean> {\n    const result = await db.delete(galleryImages).where(eq(galleryImages.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async getAllFacilities(): Promise<Facility[]> {\n    return await db.select().from(facilities);\n  }\n\n  async getFacility(id: string): Promise<Facility | undefined> {\n    const [facility] = await db.select().from(facilities).where(eq(facilities.id, id));\n    return facility || undefined;\n  }\n\n  async createFacility(facility: InsertFacility): Promise<Facility> {\n    const [newFacility] = await db.insert(facilities).values(facility).returning();\n    return newFacility;\n  }\n\n  async updateFacility(id: string, facility: InsertFacility): Promise<Facility | undefined> {\n    const [updated] = await db\n      .update(facilities)\n      .set(facility)\n      .where(eq(facilities.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async deleteFacility(id: string): Promise<boolean> {\n    const result = await db.delete(facilities).where(eq(facilities.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async getAllGames(): Promise<Game[]> {\n    return await db.select().from(games);\n  }\n\n  async getGamesByCategory(category: string): Promise<Game[]> {\n    return await db.select().from(games).where(eq(games.category, category));\n  }\n\n  async getGame(id: string): Promise<Game | undefined> {\n    const [game] = await db.select().from(games).where(eq(games.id, id));\n    return game || undefined;\n  }\n\n  async createGame(game: InsertGame): Promise<Game> {\n    const [newGame] = await db.insert(games).values(game).returning();\n    return newGame;\n  }\n\n  async updateGame(id: string, game: InsertGame): Promise<Game | undefined> {\n    const [updated] = await db\n      .update(games)\n      .set(game)\n      .where(eq(games.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async deleteGame(id: string): Promise<boolean> {\n    const result = await db.delete(games).where(eq(games.id, id));\n    return result.rowCount ? result.rowCount > 0 : false;\n  }\n\n  async getAllLoadMetrics(): Promise<LoadMetric[]> {\n    return await db.select().from(loadMetrics);\n  }\n\n  async getRecentLoadMetrics(limit: number): Promise<LoadMetric[]> {\n    return await db.select()\n      .from(loadMetrics)\n      .orderBy(desc(loadMetrics.timestamp))\n      .limit(limit);\n  }\n\n  async createLoadMetric(metric: InsertLoadMetric): Promise<LoadMetric> {\n    const [created] = await db.insert(loadMetrics).values(metric).returning();\n    return created;\n  }\n\n  async getCurrentLoad(): Promise<LoadMetric | undefined> {\n    const [metric] = await db.select()\n      .from(loadMetrics)\n      .orderBy(desc(loadMetrics.timestamp))\n      .limit(1);\n    return metric;\n  }\n\n  async getAllLoadPredictions(): Promise<LoadPrediction[]> {\n    return await db.select().from(loadPredictions);\n  }\n\n  async getRecentLoadPredictions(limit: number): Promise<LoadPrediction[]> {\n    return await db.select()\n      .from(loadPredictions)\n      .orderBy(desc(loadPredictions.timestamp))\n      .limit(limit);\n  }\n\n  async createLoadPrediction(prediction: InsertLoadPrediction): Promise<LoadPrediction> {\n    const [created] = await db.insert(loadPredictions).values(prediction).returning();\n    return created;\n  }\n\n  async deleteOldBookingHistory(olderThanDays: number): Promise<number> {\n    const cutoffDate = new Date();\n    cutoffDate.setDate(cutoffDate.getDate() - olderThanDays);\n    \n    const result = await db\n      .delete(bookingHistory)\n      .where(lt(bookingHistory.archivedAt, cutoffDate));\n    \n    return result.rowCount || 0;\n  }\n\n  async deleteOldActivityLogs(olderThanDays: number): Promise<number> {\n    const cutoffDate = new Date();\n    cutoffDate.setDate(cutoffDate.getDate() - olderThanDays);\n    \n    const result = await db\n      .delete(activityLogs)\n      .where(lt(activityLogs.createdAt, cutoffDate));\n    \n    return result.rowCount || 0;\n  }\n\n  async deleteOldLoadMetrics(olderThanDays: number): Promise<number> {\n    const cutoffDate = new Date();\n    cutoffDate.setDate(cutoffDate.getDate() - olderThanDays);\n    \n    const result = await db\n      .delete(loadMetrics)\n      .where(lt(loadMetrics.timestamp, cutoffDate));\n    \n    return result.rowCount || 0;\n  }\n\n  async deleteOldLoadPredictions(olderThanDays: number): Promise<number> {\n    const cutoffDate = new Date();\n    cutoffDate.setDate(cutoffDate.getDate() - olderThanDays);\n    \n    const result = await db\n      .delete(loadPredictions)\n      .where(lt(loadPredictions.timestamp, cutoffDate));\n    \n    return result.rowCount || 0;\n  }\n\n  async deleteOldExpenses(olderThanDays: number): Promise<number> {\n    const cutoffDate = new Date();\n    cutoffDate.setDate(cutoffDate.getDate() - olderThanDays);\n    \n    const result = await db\n      .delete(expenses)\n      .where(lt(expenses.date, cutoffDate));\n    \n    return result.rowCount || 0;\n  }\n\n  async getRetentionConfig(): Promise<RetentionConfig> {\n    const configs = await db.select().from(retentionConfig).limit(1);\n    \n    if (configs.length === 0) {\n      const [newConfig] = await db.insert(retentionConfig).values({\n        bookingHistoryDays: 730,\n        activityLogsDays: 180,\n        loadMetricsDays: 90,\n        loadPredictionsDays: 90,\n        expensesDays: 2555,\n      }).returning();\n      return newConfig;\n    }\n    \n    return configs[0];\n  }\n\n  async updateRetentionConfig(config: Partial<InsertRetentionConfig>): Promise<RetentionConfig> {\n    const current = await this.getRetentionConfig();\n    \n    const [updated] = await db\n      .update(retentionConfig)\n      .set({ ...config, updatedAt: new Date() })\n      .where(eq(retentionConfig.id, current.id))\n      .returning();\n    \n    return updated;\n  }\n\n  async getAllDeviceMaintenance(): Promise<DeviceMaintenance[]> {\n    return await db.select().from(deviceMaintenance);\n  }\n\n  async getDeviceMaintenance(category: string, seatName: string): Promise<DeviceMaintenance | undefined> {\n    const records = await db\n      .select()\n      .from(deviceMaintenance)\n      .where(and(\n        eq(deviceMaintenance.category, category),\n        eq(deviceMaintenance.seatName, seatName)\n      ))\n      .limit(1);\n    \n    return records[0];\n  }\n\n  async upsertDeviceMaintenance(data: InsertDeviceMaintenance): Promise<DeviceMaintenance> {\n    const existing = await this.getDeviceMaintenance(data.category, data.seatName);\n    \n    if (existing) {\n      const [updated] = await db\n        .update(deviceMaintenance)\n        .set({ ...data, updatedAt: new Date() })\n        .where(and(\n          eq(deviceMaintenance.category, data.category),\n          eq(deviceMaintenance.seatName, data.seatName)\n        ))\n        .returning();\n      return updated;\n    }\n    \n    const [created] = await db.insert(deviceMaintenance).values(data).returning();\n    return created;\n  }\n\n  async updateDeviceMaintenanceStatus(category: string, seatName: string, status: string, notes?: string): Promise<DeviceMaintenance | undefined> {\n    const existing = await this.getDeviceMaintenance(category, seatName);\n    \n    const updateData: any = {\n      status,\n      updatedAt: new Date(),\n    };\n    \n    if (notes !== undefined) {\n      updateData.maintenanceNotes = notes;\n    }\n    \n    if (status === \"healthy\") {\n      updateData.lastMaintenanceDate = new Date();\n    }\n    \n    if (existing) {\n      const [updated] = await db\n        .update(deviceMaintenance)\n        .set(updateData)\n        .where(and(\n          eq(deviceMaintenance.category, category),\n          eq(deviceMaintenance.seatName, seatName)\n        ))\n        .returning();\n      \n      return updated;\n    } else {\n      const newRecord = {\n        category,\n        seatName,\n        status,\n        maintenanceNotes: notes,\n        totalUsageHours: 0,\n        totalSessions: 0,\n        issuesReported: 0,\n        lastMaintenanceDate: status === \"healthy\" ? new Date() : null,\n      };\n      \n      const [created] = await db.insert(deviceMaintenance).values(newRecord).returning();\n      return created;\n    }\n  }\n\n  async getAllNotifications(): Promise<Notification[]> {\n    const result = await db.select().from(notifications).orderBy(desc(notifications.createdAt));\n    return result.filter(n => n.type !== \"booking\" && n.type !== \"payment\");\n  }\n\n  async getUnreadNotifications(): Promise<Notification[]> {\n    const result = await db\n      .select()\n      .from(notifications)\n      .where(eq(notifications.isRead, 0))\n      .orderBy(desc(notifications.createdAt));\n    return result.filter(n => n.type !== \"booking\" && n.type !== \"payment\");\n  }\n\n  async getNotificationById(id: string): Promise<Notification | undefined> {\n    const result = await db.select().from(notifications).where(eq(notifications.id, id));\n    return result[0];\n  }\n\n  async createNotification(notification: InsertNotification): Promise<Notification> {\n    const result = await db.insert(notifications).values(notification).returning();\n    return result[0];\n  }\n\n  async markNotificationAsRead(id: string): Promise<Notification | undefined> {\n    const result = await db\n      .update(notifications)\n      .set({ isRead: 1 })\n      .where(eq(notifications.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async markAllNotificationsAsRead(): Promise<void> {\n    await db.update(notifications).set({ isRead: 1 });\n  }\n\n  async deleteNotification(id: string): Promise<boolean> {\n    const result = await db.delete(notifications).where(eq(notifications.id, id)).returning();\n    return result.length > 0;\n  }\n\n  async getUnreadCount(): Promise<number> {\n    const result = await db\n      .select()\n      .from(notifications)\n      .where(eq(notifications.isRead, 0));\n    return result.filter(n => n.type !== \"booking\" && n.type !== \"payment\").length;\n  }\n\n  async getCustomerPromotionSummary(whatsappNumber: string): Promise<CustomerPromotionSummary> {\n    const activeBookings = await db\n      .select()\n      .from(bookings)\n      .where(eq(bookings.whatsappNumber, whatsappNumber));\n    \n    const historyBookings = await db\n      .select()\n      .from(bookingHistory)\n      .where(eq(bookingHistory.whatsappNumber, whatsappNumber));\n    \n    const allBookings = [...activeBookings, ...historyBookings];\n    \n    let discountCount = 0;\n    let bonusCount = 0;\n    let totalSavings = 0;\n    let totalBonusHours = 0;\n    \n    allBookings.forEach(booking => {\n      if (booking.discountApplied && booking.promotionDetails?.discountAmount) {\n        discountCount++;\n        totalSavings += parseFloat(booking.promotionDetails.discountAmount);\n      }\n      if (booking.bonusHoursApplied && booking.promotionDetails?.bonusHours) {\n        bonusCount++;\n        totalBonusHours += parseFloat(booking.promotionDetails.bonusHours);\n      }\n    });\n    \n    return {\n      discountCount,\n      bonusCount,\n      totalSavings,\n      totalBonusHours\n    };\n  }\n\n  async getPromotionHistoryByCustomer(whatsappNumber: string): Promise<PromotionHistoryItem[]> {\n    const activeBookings = await db\n      .select()\n      .from(bookings)\n      .where(eq(bookings.whatsappNumber, whatsappNumber));\n    \n    const historyBookings = await db\n      .select()\n      .from(bookingHistory)\n      .where(eq(bookingHistory.whatsappNumber, whatsappNumber));\n    \n    const allBookings = [...activeBookings, ...historyBookings];\n    \n    const promotionHistory: PromotionHistoryItem[] = [];\n    \n    allBookings.forEach(booking => {\n      if (booking.discountApplied && booking.promotionDetails?.discountAmount) {\n        promotionHistory.push({\n          bookingId: booking.id,\n          seatName: booking.seatName,\n          date: new Date(booking.startTime).toLocaleDateString('en-US', { \n            month: 'short', \n            day: 'numeric', \n            year: 'numeric',\n            hour: '2-digit',\n            minute: '2-digit'\n          }),\n          promotionType: 'discount',\n          discountPercentage: booking.promotionDetails.discountPercentage,\n          discountAmount: booking.promotionDetails.discountAmount,\n          originalPrice: booking.originalPrice || booking.price,\n          finalPrice: booking.price\n        });\n      }\n      \n      if (booking.bonusHoursApplied && booking.promotionDetails?.bonusHours) {\n        promotionHistory.push({\n          bookingId: booking.id,\n          seatName: booking.seatName,\n          date: new Date(booking.startTime).toLocaleDateString('en-US', { \n            month: 'short', \n            day: 'numeric', \n            year: 'numeric',\n            hour: '2-digit',\n            minute: '2-digit'\n          }),\n          promotionType: 'bonus',\n          bonusHours: booking.promotionDetails.bonusHours,\n          finalPrice: booking.price\n        });\n      }\n    });\n    \n    return promotionHistory.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\n  }\n\n  // Staff Visibility Settings\n  async getStaffVisibilitySettings(): Promise<StaffVisibilitySettings> {\n    const settings = await db.select().from(staffVisibilitySettings).limit(1);\n    \n    if (settings.length === 0) {\n      // Create default settings if none exist\n      const defaultPages = {\n        dashboard: true,\n        bookings: true,\n        history: true,\n        food: true,\n        inventory: false,\n        expenses: false,\n        ledger: false,\n        analytics: false,\n        maintenance: false,\n        settings: false,\n      };\n      const defaultElements = {\n        customerPhone: true,\n        paymentDetails: true,\n        revenueNumbers: false,\n        expenseAmounts: false,\n        profitLoss: false,\n        costPrices: false,\n      };\n      \n      const [newSettings] = await db.insert(staffVisibilitySettings).values({\n        pages: defaultPages,\n        elements: defaultElements,\n      }).returning();\n      \n      return newSettings;\n    }\n    \n    return settings[0];\n  }\n\n  async updateStaffVisibilitySettings(pages: VisibilityPages, elements: VisibilityElements): Promise<StaffVisibilitySettings> {\n    const existingSettings = await db.select().from(staffVisibilitySettings).limit(1);\n    \n    if (existingSettings.length === 0) {\n      const [newSettings] = await db.insert(staffVisibilitySettings).values({\n        pages,\n        elements,\n      }).returning();\n      return newSettings;\n    }\n    \n    const [updated] = await db.update(staffVisibilitySettings)\n      .set({ \n        pages, \n        elements,\n        updatedAt: new Date()\n      })\n      .where(eq(staffVisibilitySettings.id, existingSettings[0].id))\n      .returning();\n    \n    return updated;\n  }\n\n}\n\nexport const storage = new DatabaseStorage();\n","path":null,"size_bytes":65512,"size_tokens":null},"client/src/components/ui/datetime-picker.tsx":{"content":"import * as React from \"react\"\nimport { Calendar } from \"@/components/ui/calendar\"\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\"\nimport { Button } from \"@/components/ui/button\"\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\nimport { CalendarIcon, Clock } from \"lucide-react\"\nimport { format } from \"date-fns\"\nimport { cn } from \"@/lib/utils\"\n\ninterface DateTimePickerProps {\n  value?: Date\n  onChange: (date: Date | undefined) => void\n  placeholder?: string\n  disabled?: boolean\n  className?: string\n  \"data-testid\"?: string\n}\n\nexport function DateTimePicker({ \n  value, \n  onChange, \n  placeholder = \"Pick a date and time\",\n  disabled = false,\n  className,\n  \"data-testid\": testId\n}: DateTimePickerProps) {\n  const [open, setOpen] = React.useState(false)\n  const [selectedDate, setSelectedDate] = React.useState<Date | undefined>(value)\n  const [selectedHour, setSelectedHour] = React.useState<string>(\n    value ? format(value, \"HH\") : \"12\"\n  )\n  const [selectedMinute, setSelectedMinute] = React.useState<string>(\n    value ? format(value, \"mm\") : \"00\"\n  )\n\n  React.useEffect(() => {\n    if (value) {\n      setSelectedDate(value)\n      setSelectedHour(format(value, \"HH\"))\n      setSelectedMinute(format(value, \"mm\"))\n    }\n  }, [value])\n\n  const hours = Array.from({ length: 24 }, (_, i) => i.toString().padStart(2, \"0\"))\n  const minutes = Array.from({ length: 60 }, (_, i) => i.toString().padStart(2, \"0\"))\n\n  const handleDateSelect = (date: Date | undefined) => {\n    if (!date) {\n      setSelectedDate(undefined)\n      onChange(undefined)\n      return\n    }\n    \n    const newDate = new Date(date)\n    newDate.setHours(parseInt(selectedHour))\n    newDate.setMinutes(parseInt(selectedMinute))\n    setSelectedDate(newDate)\n  }\n\n  const handleTimeChange = (hour: string, minute: string) => {\n    if (!selectedDate) return\n    \n    const newDate = new Date(selectedDate)\n    newDate.setHours(parseInt(hour))\n    newDate.setMinutes(parseInt(minute))\n    setSelectedDate(newDate)\n    onChange(newDate)\n  }\n\n  const handleApply = () => {\n    if (selectedDate) {\n      const finalDate = new Date(selectedDate)\n      finalDate.setHours(parseInt(selectedHour))\n      finalDate.setMinutes(parseInt(selectedMinute))\n      onChange(finalDate)\n      setOpen(false)\n    }\n  }\n\n  return (\n    <Popover open={open} onOpenChange={setOpen}>\n      <PopoverTrigger asChild>\n        <Button\n          variant=\"outline\"\n          className={cn(\n            \"w-full justify-start text-left font-normal\",\n            !value && \"text-muted-foreground\",\n            className\n          )}\n          disabled={disabled}\n          data-testid={testId}\n        >\n          <CalendarIcon className=\"mr-2 h-4 w-4\" />\n          {value ? (\n            <span>{format(value, \"PPP 'at' HH:mm\")}</span>\n          ) : (\n            <span>{placeholder}</span>\n          )}\n        </Button>\n      </PopoverTrigger>\n      <PopoverContent className=\"w-auto p-0\" align=\"start\">\n        <div className=\"flex flex-col\">\n          <Calendar\n            mode=\"single\"\n            selected={selectedDate}\n            onSelect={handleDateSelect}\n            initialFocus\n          />\n          <div className=\"border-t p-4 space-y-4\">\n            <div className=\"flex items-center gap-2\">\n              <Clock className=\"h-4 w-4 text-muted-foreground\" />\n              <span className=\"text-sm font-medium\">Time</span>\n            </div>\n            <div className=\"flex gap-2\">\n              <Select\n                value={selectedHour}\n                onValueChange={(hour) => {\n                  setSelectedHour(hour)\n                  handleTimeChange(hour, selectedMinute)\n                }}\n              >\n                <SelectTrigger className=\"w-[100px]\" data-testid=\"select-hour\">\n                  <SelectValue placeholder=\"Hour\" />\n                </SelectTrigger>\n                <SelectContent className=\"max-h-[200px]\">\n                  {hours.map((hour) => (\n                    <SelectItem key={hour} value={hour}>\n                      {hour}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n              <span className=\"flex items-center text-xl font-semibold\">:</span>\n              <Select\n                value={selectedMinute}\n                onValueChange={(minute) => {\n                  setSelectedMinute(minute)\n                  handleTimeChange(selectedHour, minute)\n                }}\n              >\n                <SelectTrigger className=\"w-[100px]\" data-testid=\"select-minute\">\n                  <SelectValue placeholder=\"Minute\" />\n                </SelectTrigger>\n                <SelectContent className=\"max-h-[200px]\">\n                  {minutes.map((minute) => (\n                    <SelectItem key={minute} value={minute}>\n                      {minute}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <Button \n              onClick={handleApply} \n              className=\"w-full\" \n              disabled={!selectedDate}\n              data-testid=\"button-apply-datetime\"\n            >\n              Apply\n            </Button>\n          </div>\n        </div>\n      </PopoverContent>\n    </Popover>\n  )\n}\n","path":null,"size_bytes":5361,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"server/retention.ts":{"content":"import { storage } from \"./storage\";\n\nexport interface CleanupResult {\n  bookingHistory: number;\n  activityLogs: number;\n  loadMetrics: number;\n  loadPredictions: number;\n  expenses: number;\n  totalDeleted: number;\n}\n\nexport class RetentionService {\n  async runCleanup(): Promise<CleanupResult> {\n    console.log('üßπ Starting data retention cleanup...');\n    \n    const results: CleanupResult = {\n      bookingHistory: 0,\n      activityLogs: 0,\n      loadMetrics: 0,\n      loadPredictions: 0,\n      expenses: 0,\n      totalDeleted: 0,\n    };\n\n    try {\n      const config = await storage.getRetentionConfig();\n      \n      // Clean booking history older than retention period\n      results.bookingHistory = await storage.deleteOldBookingHistory(config.bookingHistoryDays);\n      console.log(`  ‚úì Deleted ${results.bookingHistory} old booking history records`);\n\n      // Clean activity logs\n      results.activityLogs = await storage.deleteOldActivityLogs(config.activityLogsDays);\n      console.log(`  ‚úì Deleted ${results.activityLogs} old activity logs`);\n\n      // Clean load metrics\n      results.loadMetrics = await storage.deleteOldLoadMetrics(config.loadMetricsDays);\n      console.log(`  ‚úì Deleted ${results.loadMetrics} old load metrics`);\n\n      // Clean load predictions\n      results.loadPredictions = await storage.deleteOldLoadPredictions(config.loadPredictionsDays);\n      console.log(`  ‚úì Deleted ${results.loadPredictions} old load predictions`);\n\n      // Clean old expenses\n      results.expenses = await storage.deleteOldExpenses(config.expensesDays);\n      console.log(`  ‚úì Deleted ${results.expenses} old expenses`);\n\n      results.totalDeleted = Object.values(results).reduce((sum, count) => \n        typeof count === 'number' ? sum + count : sum, 0\n      );\n\n      console.log(`‚úÖ Cleanup complete! Total records deleted: ${results.totalDeleted}`);\n      \n      return results;\n    } catch (error) {\n      console.error('‚ùå Error during cleanup:', error);\n      throw error;\n    }\n  }\n\n  async getConfig() {\n    return await storage.getRetentionConfig();\n  }\n\n  async updateConfig(newConfig: Partial<{ \n    bookingHistoryDays?: number;\n    activityLogsDays?: number;\n    loadMetricsDays?: number;\n    loadPredictionsDays?: number;\n    expensesDays?: number;\n  }>) {\n    const updated = await storage.updateRetentionConfig(newConfig);\n    console.log('üìù Retention config updated:', updated);\n    return updated;\n  }\n}\n\nexport const retentionService = new RetentionService();\n","path":null,"size_bytes":2515,"size_tokens":null},"NEON_6_DATABASE_SETUP.md":{"content":"# üóÑÔ∏è Neon 6-Database Setup Guide\n\n## Why 6 Databases?\n\nThe owner wants to keep **ALL business data forever** (no cleanup) for:\n- Tax records and compliance\n- Customer history and analytics  \n- Complete audit trails\n- Business insights\n\n**Solution:** Use 6 FREE Neon projects = **3 GB total storage** (6 √ó 512 MB)\n\n---\n\n## ‚úÖ What's Already Done\n\n1. ‚úÖ Automatic cleanup scheduler **DISABLED**\n2. ‚úÖ Retention config set to **36,500 days (100 years)** \n3. ‚úÖ All data will be kept permanently\n\n---\n\n## üìä Current Status (Single Database)\n\n**With 1 Neon database (512 MB):**\n- Good for **6-7 years** without cleanup\n- After that, you'll need to upgrade or split data\n\n---\n\n## üéØ Recommended Approach: START SIMPLE\n\n### Phase 1: Use 1 Database (Current Setup) ‚úÖ\n\n**Timeline:**\n- Year 1-6: Stay on **1 FREE database** (512 MB)\n- Monitor storage usage in Neon dashboard\n- No action needed for 6+ years!\n\n### Phase 2: When You Reach 400 MB (~Year 5-6)\n\n**Option A: Upgrade to Paid Neon**\n- Cost: **$5-7/month** for unlimited storage\n- Simplest solution - no code changes\n\n**Option B: Split to Multiple Databases** \n- Cost: **$0/month** (use 6 free projects)\n- Requires code changes (see below)\n\n---\n\n## üõ†Ô∏è How to Set Up 6 Neon Databases (When Needed)\n\n### Step 1: Create 6 Neon Projects\n\n1. Go to https://console.neon.tech/\n2. Create 6 separate projects:\n   - `airavoto-main` (512 MB)\n   - `airavoto-history` (512 MB)\n   - `airavoto-payments` (512 MB)\n   - `airavoto-expenses` (512 MB)\n   - `airavoto-logs` (512 MB)\n   - `airavoto-analytics` (512 MB)\n\n3. Copy connection string for each:\n   ```\n   DATABASE_URL_MAIN=postgresql://...\n   DATABASE_URL_HISTORY=postgresql://...\n   DATABASE_URL_PAYMENTS=postgresql://...\n   DATABASE_URL_EXPENSES=postgresql://...\n   DATABASE_URL_LOGS=postgresql://...\n   DATABASE_URL_ANALYTICS=postgresql://...\n   ```\n\n### Step 2: Data Distribution Strategy\n\n```\nDatabase 1 (MAIN): Active Operations\n‚îú‚îÄ bookings (current active sessions)\n‚îú‚îÄ foodItems\n‚îú‚îÄ deviceConfigs\n‚îú‚îÄ pricingConfigs\n‚îú‚îÄ happyHoursConfigs\n‚îú‚îÄ users\n‚îú‚îÄ gamingCenterInfo\n‚îî‚îÄ sessions\n\nDatabase 2 (HISTORY): Booking Archives\n‚îú‚îÄ bookingHistory (all completed bookings)\n‚îî‚îÄ deviceMaintenance\n\nDatabase 3 (PAYMENTS): Financial Records\n‚îú‚îÄ paymentLogs (all payment transactions)\n‚îî‚îÄ Essential for accounting/tax\n\nDatabase 4 (EXPENSES): Business Expenses\n‚îú‚îÄ expenses (all business costs)\n‚îî‚îÄ Tax deductible records\n\nDatabase 5 (LOGS): Audit Trail\n‚îú‚îÄ activityLogs (staff actions)\n‚îî‚îÄ notifications\n\nDatabase 6 (ANALYTICS): Business Intelligence\n‚îú‚îÄ loadMetrics\n‚îú‚îÄ loadPredictions\n‚îî‚îÄ Performance data\n```\n\n### Step 3: Code Changes Required\n\nYou'll need to modify `server/storage.ts` to:\n1. Create 6 database connections\n2. Route queries to the correct database\n3. Handle cross-database relationships\n\n**Example:**\n```typescript\n// Before (single database)\nawait db.select().from(bookingHistory);\n\n// After (routed to history database)\nawait historyDb.select().from(bookingHistory);\n```\n\n---\n\n## üí∞ Cost Comparison\n\n| Setup | Storage | Monthly Cost | Duration | Complexity |\n|-------|---------|--------------|----------|------------|\n| **1 Free DB (Current)** | 512 MB | **$0** | 6-7 years | ‚úÖ Simple |\n| **1 Paid DB** | 3 GB+ | $5-7 | Forever | ‚úÖ Simple |\n| **6 Free DBs** | 3 GB | **$0** | 41+ years | ‚ö†Ô∏è Complex |\n\n---\n\n## üéØ My Recommendation\n\n**For 70 customers/day:**\n\n1. **Now (Year 0-6):** Use 1 FREE database ‚úÖ\n   - Already configured to keep all data\n   - No action needed\n   - Monitor Neon dashboard\n\n2. **Year 5-6 (When ~400 MB full):** Choose:\n   - **Easy:** Upgrade to paid ($5-7/month)\n   - **Free:** Set up 6 databases (requires coding)\n\n3. **Long Term:** \n   - If business grows (100+ customers/day) ‚Üí Paid plan\n   - If staying small (70 customers/day) ‚Üí 6 free databases\n\n---\n\n## üìà Storage Timeline (70 customers/day, NO cleanup)\n\n```\nYear 1:   106 MB  (21% full) ‚úÖ FREE\nYear 3:   251 MB  (49% full) ‚úÖ FREE\nYear 5:   396 MB  (77% full) ‚ö†Ô∏è Plan upgrade\nYear 6:   469 MB  (92% full) üö® Need decision\nYear 7:   541 MB  ‚ùå Exceeds 512 MB\n```\n\n**Decision point:** Year 5-6 (you'll get reminders from Neon)\n\n---\n\n## üîç How to Monitor Storage\n\n1. **Neon Dashboard:** https://console.neon.tech/\n2. **Check monthly:** Look at storage usage graph\n3. **Set alert:** When you reach 400 MB (75% full)\n\n---\n\n## ‚úÖ Current System Status\n\n- ‚úÖ Cleanup disabled\n- ‚úÖ Data retention: 100 years  \n- ‚úÖ FREE for 6-7 years\n- ‚úÖ All business data preserved\n- ‚úÖ Owner's requirements met\n\n**No action needed now. Monitor and decide in 5-6 years!** üéÆ‚ú®\n\n---\n\n## üìû Need Help Later?\n\nWhen you're ready to implement 6 databases (in ~5 years):\n1. Create the 6 Neon projects\n2. Share the connection strings\n3. Request code modification assistance\n4. Test thoroughly before switching\n\n**For now, you're all set!** üéâ\n","path":null,"size_bytes":4922,"size_tokens":null},"client/src/components/AddFoodToBookingDialog.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport { Search, Plus, Minus, AlertCircle } from \"lucide-react\";\nimport type { FoodItem } from \"@shared/schema\";\n\ninterface FoodOrder {\n  foodId: string;\n  foodName: string;\n  price: string;\n  quantity: number;\n}\n\ninterface AddFoodToBookingDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  bookingId: string;\n  seatName: string;\n  customerName: string;\n  onConfirm: (bookingId: string, foodOrders: FoodOrder[]) => void;\n}\n\nexport function AddFoodToBookingDialog({\n  open,\n  onOpenChange,\n  bookingId,\n  seatName,\n  customerName,\n  onConfirm,\n}: AddFoodToBookingDialogProps) {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [selectedItems, setSelectedItems] = useState<Map<string, FoodOrder>>(new Map());\n\n  const { data: foodItems = [] } = useQuery<FoodItem[]>({\n    queryKey: [\"/api/food-items\"],\n  });\n\n  const filteredFoodItems = foodItems.filter((item) =>\n    item.name.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  const updateQuantity = (item: FoodItem, delta: number) => {\n    const availableStock = item.currentStock;\n    \n    setSelectedItems((prev) => {\n      const newMap = new Map(prev);\n      const existing = newMap.get(item.id);\n\n      if (existing) {\n        const newQuantity = existing.quantity + delta;\n        if (newQuantity <= 0) {\n          newMap.delete(item.id);\n        } else if (newQuantity <= availableStock) {\n          newMap.set(item.id, { ...existing, quantity: newQuantity });\n        }\n      } else if (delta > 0 && availableStock > 0) {\n        newMap.set(item.id, {\n          foodId: item.id,\n          foodName: item.name,\n          price: item.price,\n          quantity: 1,\n        });\n      }\n\n      return newMap;\n    });\n  };\n\n  const getQuantity = (itemId: string): number => {\n    return selectedItems.get(itemId)?.quantity || 0;\n  };\n\n  const calculateTotal = (): number => {\n    return Array.from(selectedItems.values()).reduce(\n      (sum, order) => sum + parseFloat(order.price) * order.quantity,\n      0\n    );\n  };\n\n  const handleConfirm = () => {\n    if (selectedItems.size === 0) return;\n    onConfirm(bookingId, Array.from(selectedItems.values()));\n    setSelectedItems(new Map());\n    setSearchTerm(\"\");\n    onOpenChange(false);\n  };\n\n  const handleClose = () => {\n    setSelectedItems(new Map());\n    setSearchTerm(\"\");\n    onOpenChange(false);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={handleClose}>\n      <DialogContent className=\"w-[95vw] sm:w-full max-w-2xl max-h-[85vh] sm:max-h-[85vh] p-3 sm:p-6 flex flex-col\" data-testid=\"dialog-add-food-to-booking\">\n        <DialogHeader className=\"flex-shrink-0\">\n          <DialogTitle className=\"text-base sm:text-xl\">Add Food to Booking</DialogTitle>\n          <DialogDescription className=\"text-xs sm:text-sm\">\n            {seatName} - {customerName}\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-3 sm:space-y-4 overflow-y-auto flex-1 min-h-0\">\n          <div className=\"space-y-2\">\n            <Label className=\"text-xs sm:text-sm\">Search Food Items</Label>\n            <div className=\"relative\">\n              <Search className=\"absolute left-2 sm:left-3 top-1/2 -translate-y-1/2 h-3.5 w-3.5 sm:h-4 sm:w-4 text-muted-foreground\" />\n              <Input\n                placeholder=\"Search for food items...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-8 sm:pl-9 text-xs sm:text-base h-8 sm:h-10\"\n                data-testid=\"input-search-food\"\n              />\n            </div>\n          </div>\n\n          <div className=\"border rounded-lg max-h-[180px] sm:max-h-[280px] overflow-y-auto\">\n            <div className=\"grid gap-1.5 sm:gap-2 p-2 sm:p-3\">\n              {filteredFoodItems.map((item) => {\n                const quantity = getQuantity(item.id);\n                const isOutOfStock = item.currentStock === 0;\n                const availableStock = item.currentStock;\n                const totalStock = item.currentStock + item.inInventory;\n                const isLowStock = item.currentStock > 0 && item.currentStock <= item.minStockLevel;\n                \n                return (\n                  <div\n                    key={item.id}\n                    className={`flex items-center gap-2 sm:gap-4 p-2 sm:p-3 border rounded-lg transition-colors ${\n                      isOutOfStock ? 'bg-red-50 dark:bg-red-950/20 border-red-200 dark:border-red-900' : 'hover:bg-accent/50'\n                    }`}\n                    data-testid={`food-item-${item.id}`}\n                  >\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-center gap-2\">\n                        <p className={`font-medium text-xs sm:text-base truncate ${isOutOfStock ? 'text-gray-400 dark:text-gray-600' : ''}`}>\n                          {item.name}\n                        </p>\n                        {isOutOfStock && (\n                          <AlertCircle className=\"h-3 w-3 sm:h-4 sm:w-4 text-red-600 flex-shrink-0\" />\n                        )}\n                      </div>\n                      <div className=\"flex items-center gap-2 flex-wrap\">\n                        <p className=\"text-[10px] sm:text-sm text-muted-foreground\">‚Çπ{item.price}</p>\n                        {isOutOfStock ? (\n                          <p className=\"text-[10px] sm:text-xs font-semibold text-red-600 dark:text-red-500\" data-testid={`stock-status-${item.id}`}>\n                            Unavailable - Out of Stock\n                          </p>\n                        ) : (\n                          <p className={`text-[10px] sm:text-xs font-medium ${isLowStock ? 'text-orange-600 dark:text-orange-500' : 'text-green-600 dark:text-green-500'}`} data-testid={`stock-status-${item.id}`}>\n                            {availableStock}/{totalStock} {isLowStock ? 'Low Stock' : 'Available'}\n                          </p>\n                        )}\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-1.5 sm:gap-2\">\n                      <Button\n                        variant=\"outline\"\n                        size=\"icon\"\n                        className=\"h-7 w-7 sm:h-9 sm:w-9\"\n                        onClick={() => updateQuantity(item, -1)}\n                        disabled={quantity === 0 || isOutOfStock}\n                        data-testid={`button-decrease-${item.id}`}\n                      >\n                        <Minus className=\"h-3 w-3 sm:h-4 sm:w-4\" />\n                      </Button>\n                      <span className=\"w-5 sm:w-7 text-center font-semibold text-xs sm:text-base\" data-testid={`quantity-${item.id}`}>\n                        {quantity}\n                      </span>\n                      <Button\n                        variant=\"outline\"\n                        size=\"icon\"\n                        className=\"h-7 w-7 sm:h-9 sm:w-9\"\n                        onClick={() => updateQuantity(item, 1)}\n                        disabled={isOutOfStock || quantity >= availableStock}\n                        data-testid={`button-increase-${item.id}`}\n                      >\n                        <Plus className=\"h-3 w-3 sm:h-4 sm:w-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          </div>\n\n          {selectedItems.size > 0 && (\n            <div className=\"space-y-2 p-2.5 sm:p-4 border rounded-lg bg-accent/20\">\n              <h4 className=\"font-semibold text-[11px] sm:text-sm\">Selected Items</h4>\n              <div className=\"space-y-0.5 sm:space-y-1 max-h-[80px] sm:max-h-[100px] overflow-y-auto\">\n                {Array.from(selectedItems.values()).map((order, index) => (\n                  <div\n                    key={index}\n                    className=\"flex justify-between text-[10px] sm:text-sm gap-2\"\n                    data-testid={`selected-item-${index}`}\n                  >\n                    <span className=\"truncate\">\n                      {order.foodName} √ó {order.quantity}\n                    </span>\n                    <span className=\"font-semibold whitespace-nowrap\">\n                      ‚Çπ{(parseFloat(order.price) * order.quantity).toFixed(0)}\n                    </span>\n                  </div>\n                ))}\n              </div>\n              <div className=\"pt-1.5 sm:pt-2 border-t flex justify-between items-center\">\n                <span className=\"font-bold text-[11px] sm:text-sm\">Total:</span>\n                <span className=\"text-sm sm:text-lg font-bold text-primary\" data-testid=\"text-total-amount\">\n                  ‚Çπ{calculateTotal().toFixed(0)}\n                </span>\n              </div>\n            </div>\n          )}\n        </div>\n\n        <DialogFooter className=\"flex-col sm:flex-row gap-2 flex-shrink-0 mt-3 sm:mt-4\">\n          <Button variant=\"outline\" onClick={handleClose} className=\"w-full sm:w-auto h-9 text-xs sm:text-sm\" data-testid=\"button-cancel-add-food-booking\">\n            Cancel\n          </Button>\n          <Button\n            onClick={handleConfirm}\n            disabled={selectedItems.size === 0}\n            className=\"w-full sm:w-auto h-9 text-xs sm:text-sm\"\n            data-testid=\"button-confirm-add-food-booking\"\n          >\n            Add Food (‚Çπ{calculateTotal().toFixed(0)})\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":9836,"size_tokens":null},"WHATSAPP_SETUP.md":{"content":"# WhatsApp Bot Setup Guide\n\n## Overview\nYour gaming center now has a WhatsApp bot that automatically responds to customer inquiries about device availability. When customers send messages asking about availability, the bot will instantly reply with real-time information about all your gaming devices.\n\n## How It Works\n\n### Customer Experience\nCustomers can message your WhatsApp business number with queries like:\n- \"How many PCs are available?\"\n- \"Check availability\"\n- \"Any PS5 free?\"\n- \"Available slots?\"\n\nThe bot will automatically respond with:\n```\nüìä Current Availability\n\n‚úÖ PC: 5/10 available (50%)\n‚úÖ PS5: 2/4 available (50%)\n‚ùå VR: 0/2 available (0%)\n‚úÖ Car Simulator: 1/1 available (100%)\n\nUpdated: 11/10/2025, 8:00:00 AM\n```\n\n### What Triggers the Bot\nThe bot responds to messages containing these keywords:\n- available\n- availability\n- how many\n- pc, ps5, vr (device names)\n- free\n- check\n\n## Setup Steps\n\n### 1. Twilio Configuration (Already Done ‚úÖ)\n- Twilio integration has been set up through Replit\n- Your Twilio account is connected and ready to use\n\n### 2. Configure Twilio Webhook\nYou need to tell Twilio where to send incoming WhatsApp messages:\n\n1. Go to [Twilio Console](https://console.twilio.com/)\n2. Navigate to **Messaging** ‚Üí **Settings** ‚Üí **WhatsApp Sandbox Settings** (for testing) or your WhatsApp Business number settings\n3. Find the **\"When a message comes in\"** webhook field\n4. Enter your webhook URL:\n   ```\n   https://your-replit-app-url.com/api/whatsapp/webhook\n   ```\n   Replace `your-replit-app-url.com` with your actual Replit app URL\n5. Set the HTTP method to **POST**\n6. Click **Save**\n\n### 3. Testing the Bot\n\n#### Option 1: Using Twilio WhatsApp Sandbox (for testing)\n1. In Twilio Console, go to **Messaging** ‚Üí **Try it out** ‚Üí **Send a WhatsApp message**\n2. Follow the instructions to join your sandbox (usually send a code like \"join <your-code>\" to the Twilio number)\n3. Once joined, send test messages like \"how many pc available?\"\n4. The bot should respond with availability information\n\n#### Option 2: Using Your WhatsApp Business Number (for production)\n1. Make sure you have a verified WhatsApp Business number in Twilio\n2. Configure the webhook as described above\n3. Customers can now message your business number directly\n\n## API Endpoints\n\n### GET /api/whatsapp/availability\nProgrammatic endpoint to get current availability (no authentication required for external queries)\n\n**Response:**\n```json\n[\n  {\n    \"category\": \"PC\",\n    \"total\": 10,\n    \"available\": 5,\n    \"occupied\": 5\n  },\n  {\n    \"category\": \"PS5\",\n    \"total\": 4,\n    \"available\": 2,\n    \"occupied\": 2\n  }\n]\n```\n\n### POST /api/whatsapp/webhook\nTwilio webhook endpoint that receives and processes incoming WhatsApp messages.\n\n## Important Notes\n\n1. **Read-Only**: The bot only provides availability information. Customers cannot make bookings through WhatsApp.\n\n2. **Real-Time Data**: The bot shows current availability based on active bookings (running and paused sessions).\n\n3. **All Devices**: The response includes availability for ALL device categories configured in your system.\n\n4. **No Authentication Required**: The WhatsApp webhook endpoints are public (no login required) so Twilio can access them.\n\n5. **Future Enhancement Ideas**:\n   - Add booking capability through WhatsApp\n   - Send notifications when devices become available\n   - Allow customers to check pricing\n   - Schedule reminders for upcoming bookings\n\n## Troubleshooting\n\n### Bot Not Responding\n1. Check that the webhook URL is correctly configured in Twilio\n2. Verify your app is running and accessible\n3. Check the server logs for any errors\n\n### Wrong Availability Shown\n1. Make sure bookings are properly updated in the dashboard\n2. Verify that expired/completed sessions are refreshed\n3. Check that device configurations are correct in Settings\n\n### Can't Receive Messages\n1. Verify Twilio sandbox is set up (for testing)\n2. Check that your WhatsApp Business number is verified (for production)\n3. Ensure webhook configuration is saved in Twilio console\n\n## Next Steps\n\n1. Deploy your app to get a permanent URL for the webhook\n2. Set up your WhatsApp Business number in Twilio (if not already done)\n3. Configure the webhook with your production URL\n4. Test with real customers!\n\n---\n\nFor technical support, check the application logs or contact your developer.\n","path":null,"size_bytes":4382,"size_tokens":null},"client/src/pages/Timeline.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card } from \"@/components/ui/card\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Calendar, Clock, ChevronLeft, ChevronRight } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useServerTime, getAdjustedTime } from \"@/hooks/useServerTime\";\n\ninterface FoodOrder {\n  foodId: string;\n  foodName: string;\n  price: string;\n  quantity: number;\n}\n\ninterface Booking {\n  id: string;\n  category: string;\n  seatNumber: number;\n  seatName: string;\n  customerName: string;\n  whatsappNumber?: string;\n  startTime: string;\n  endTime: string;\n  price: string;\n  status: string;\n  bookingType: string;\n  foodOrders?: FoodOrder[];\n  createdAt: string;\n}\n\nexport default function Timeline() {\n  const { getTime } = useServerTime();\n  const [selectedDate, setSelectedDate] = useState(getAdjustedTime());\n\n  const { data: bookings = [], isLoading } = useQuery<Booking[]>({\n    queryKey: [\"/api/bookings\"],\n  });\n\n  const formatTime = (date: Date) => {\n    const hours = date.getHours();\n    const minutes = date.getMinutes();\n    const ampm = hours >= 12 ? 'PM' : 'AM';\n    const displayHours = hours % 12 || 12;\n    return `${displayHours}:${minutes.toString().padStart(2, '0')} ${ampm}`;\n  };\n\n  const getTimePosition = (time: Date) => {\n    const hours = time.getHours();\n    const minutes = time.getMinutes();\n    return ((hours * 60 + minutes) / (24 * 60)) * 100;\n  };\n\n  const getDuration = (start: Date, end: Date) => {\n    const diff = end.getTime() - start.getTime();\n    return (diff / (24 * 60 * 60 * 1000)) * 100;\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'running':\n        return 'bg-gradient-to-r from-green-500 to-emerald-500 border-green-600 shadow-lg shadow-green-500/30';\n      case 'upcoming':\n        return 'bg-gradient-to-r from-blue-500 to-cyan-500 border-blue-600 shadow-lg shadow-blue-500/30';\n      case 'completed':\n        return 'bg-gradient-to-r from-gray-500 to-slate-500 border-gray-600 shadow-lg shadow-gray-500/20';\n      case 'expired':\n        return 'bg-gradient-to-r from-red-500 to-rose-500 border-red-600 shadow-lg shadow-red-500/30';\n      default:\n        return 'bg-gradient-to-r from-gray-500 to-slate-500 border-gray-600';\n    }\n  };\n\n  const groupedByCategory = bookings.reduce((acc, booking) => {\n    if (!acc[booking.category]) {\n      acc[booking.category] = {};\n    }\n    if (!acc[booking.category][booking.seatName]) {\n      acc[booking.category][booking.seatName] = [];\n    }\n    acc[booking.category][booking.seatName].push(booking);\n    return acc;\n  }, {} as Record<string, Record<string, Booking[]>>);\n\n  const timeMarkers = Array.from({ length: 25 }, (_, i) => i);\n  const majorTimeMarkers = [0, 6, 12, 18, 24];\n\n  const isToday = selectedDate.toDateString() === getTime().toDateString();\n\n  const changeDate = (days: number) => {\n    const newDate = new Date(selectedDate);\n    newDate.setDate(newDate.getDate() + days);\n    setSelectedDate(newDate);\n  };\n\n  const getCurrentTimePosition = () => {\n    if (!isToday) return null;\n    const now = getTime();\n    return getTimePosition(now);\n  };\n\n  const currentTimePos = getCurrentTimePosition();\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-foreground flex items-center gap-2\">\n            <Calendar className=\"h-8 w-8 text-primary\" />\n            Timeline View\n          </h1>\n          <p className=\"text-muted-foreground mt-1\">Visual schedule of all bookings</p>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <Button variant=\"outline\" size=\"icon\" onClick={() => changeDate(-1)} data-testid=\"button-prev-day\">\n            <ChevronLeft className=\"h-4 w-4\" />\n          </Button>\n          <Button variant=\"outline\" onClick={() => setSelectedDate(getTime())} disabled={isToday} data-testid=\"button-today\" className=\"min-w-[80px]\">\n            Today\n          </Button>\n          <Button variant=\"outline\" size=\"icon\" onClick={() => changeDate(1)} data-testid=\"button-next-day\">\n            <ChevronRight className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </div>\n\n      <Card className=\"p-6 glass-card\">\n        <div className=\"flex items-center gap-3 mb-6 pb-4 border-b\">\n          <div className=\"h-12 w-12 rounded-lg bg-primary/10 flex items-center justify-center\">\n            <Calendar className=\"h-6 w-6 text-primary\" />\n          </div>\n          <div>\n            <h2 className=\"font-bold text-2xl\">\n              {selectedDate.toLocaleDateString('en-IN', {\n                weekday: 'long',\n                month: 'long',\n                day: 'numeric',\n                timeZone: 'Asia/Kolkata'\n              })}\n            </h2>\n            <p className=\"text-sm text-muted-foreground\">\n              {selectedDate.getFullYear()}\n            </p>\n          </div>\n        </div>\n\n        {isLoading ? (\n          <div className=\"space-y-6\">\n            <Skeleton className=\"h-24 w-full\" />\n            <Skeleton className=\"h-24 w-full\" />\n            <Skeleton className=\"h-24 w-full\" />\n          </div>\n        ) : Object.keys(groupedByCategory).length === 0 ? (\n          <div className=\"text-center py-16 text-muted-foreground\">\n            <div className=\"h-20 w-20 mx-auto mb-4 rounded-full bg-muted flex items-center justify-center\">\n              <Clock className=\"h-10 w-10 opacity-50\" />\n            </div>\n            <p className=\"text-lg font-medium\">No bookings found</p>\n            <p className=\"text-sm mt-1\">Schedule is clear for this day</p>\n          </div>\n        ) : (\n          <div className=\"space-y-10\">\n            {Object.entries(groupedByCategory).map(([category, seats]) => (\n              <div key={category} className=\"space-y-4\">\n                <div className=\"flex items-center gap-2 mb-4\">\n                  <div className=\"h-8 w-1 bg-primary rounded-full\"></div>\n                  <h3 className=\"text-xl font-bold text-foreground\">{category}</h3>\n                </div>\n                \n                <div className=\"space-y-4\">\n                  {Object.entries(seats).map(([seatName, seatBookings]) => (\n                    <div key={seatName} className=\"group\" data-testid={`timeline-seat-${seatName}`}>\n                      <div className=\"flex items-start gap-4\">\n                        <div className=\"w-28 pt-4 flex-shrink-0\">\n                          <div className=\"bg-primary/10 border border-primary/20 rounded-lg px-3 py-2 text-center\">\n                            <div className=\"font-bold text-sm text-foreground\">{seatName}</div>\n                          </div>\n                        </div>\n                        \n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"relative bg-muted/40 rounded-lg border-2 border-border/50 overflow-hidden\" style={{ height: '80px' }}>\n                            <div className=\"absolute inset-0 flex\">\n                              {timeMarkers.map((hour) => (\n                                <div\n                                  key={hour}\n                                  className={`flex-1 ${hour < 24 ? 'border-r' : ''} ${\n                                    majorTimeMarkers.includes(hour) ? 'border-border' : 'border-border/20'\n                                  }`}\n                                  style={{ width: `${100 / 24}%` }}\n                                >\n                                  {majorTimeMarkers.includes(hour) && (\n                                    <div className=\"absolute top-0 left-0 -translate-x-1/2 -translate-y-full pb-2\">\n                                      <div className=\"text-xs font-semibold text-muted-foreground bg-background px-2 py-1 rounded border shadow-sm\">\n                                        {hour === 0 ? '12 AM' : hour === 12 ? '12 PM' : hour > 12 ? `${hour - 12} PM` : `${hour} AM`}\n                                      </div>\n                                    </div>\n                                  )}\n                                </div>\n                              ))}\n                            </div>\n\n                            {currentTimePos !== null && (\n                              <div\n                                className=\"absolute top-0 bottom-0 w-0.5 bg-red-500 z-20\"\n                                style={{ left: `${currentTimePos}%` }}\n                              >\n                                <div className=\"absolute top-0 left-1/2 -translate-x-1/2 -translate-y-full\">\n                                  <div className=\"bg-red-500 text-white text-xs font-bold px-2 py-0.5 rounded shadow-lg\">\n                                    NOW\n                                  </div>\n                                </div>\n                                <div className=\"absolute top-0 left-1/2 -translate-x-1/2 w-2 h-2 bg-red-500 rounded-full\"></div>\n                              </div>\n                            )}\n\n                            {seatBookings.map((booking) => {\n                              const start = new Date(booking.startTime);\n                              const end = new Date(booking.endTime);\n                              const left = getTimePosition(start);\n                              const width = getDuration(start, end);\n\n                              return (\n                                <div\n                                  key={booking.id}\n                                  className={`absolute top-2 bottom-2 rounded-lg border-2 ${getStatusColor(booking.status)} text-white px-3 py-2 overflow-hidden cursor-pointer hover:scale-105 hover:z-10 transition-all duration-200`}\n                                  style={{\n                                    left: `${left}%`,\n                                    width: `${width}%`,\n                                    minWidth: '120px'\n                                  }}\n                                  data-testid={`booking-block-${booking.id}`}\n                                  title={`${booking.customerName} - ${formatTime(start)} to ${formatTime(end)} - ‚Çπ${booking.price}`}\n                                >\n                                  <div className=\"flex flex-col h-full justify-center\">\n                                    <div className=\"text-sm font-bold truncate\">\n                                      {booking.customerName}\n                                    </div>\n                                    <div className=\"text-xs font-medium opacity-90 truncate\">\n                                      {formatTime(start)} - {formatTime(end)}\n                                    </div>\n                                  </div>\n                                </div>\n                              );\n                            })}\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </Card>\n\n      <Card className=\"p-6 glass-card\">\n        <h3 className=\"font-bold mb-4 flex items-center gap-2\">\n          <div className=\"h-6 w-1 bg-primary rounded-full\"></div>\n          Status Legend\n        </h3>\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-12 h-12 rounded-lg bg-gradient-to-r from-green-500 to-emerald-500 shadow-lg shadow-green-500/30 border-2 border-green-600\"></div>\n            <div>\n              <div className=\"font-semibold text-sm\">Running</div>\n              <div className=\"text-xs text-muted-foreground\">Active now</div>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-12 h-12 rounded-lg bg-gradient-to-r from-blue-500 to-cyan-500 shadow-lg shadow-blue-500/30 border-2 border-blue-600\"></div>\n            <div>\n              <div className=\"font-semibold text-sm\">Upcoming</div>\n              <div className=\"text-xs text-muted-foreground\">Scheduled</div>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-12 h-12 rounded-lg bg-gradient-to-r from-gray-500 to-slate-500 shadow-lg shadow-gray-500/20 border-2 border-gray-600\"></div>\n            <div>\n              <div className=\"font-semibold text-sm\">Completed</div>\n              <div className=\"text-xs text-muted-foreground\">Finished</div>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-3\">\n            <div className=\"w-12 h-12 rounded-lg bg-gradient-to-r from-red-500 to-rose-500 shadow-lg shadow-red-500/30 border-2 border-red-600\"></div>\n            <div>\n              <div className=\"font-semibold text-sm\">Expired</div>\n              <div className=\"text-xs text-muted-foreground\">Overdue</div>\n            </div>\n          </div>\n        </div>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":13146,"size_tokens":null},"client/src/pages/PublicStatus.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useEffect, useState } from \"react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Monitor, Gamepad2, Glasses, Car, Cpu, RefreshCw, Phone, MapPin, Clock, Mail, ChevronDown, ChevronUp, Wifi, Wind, Armchair, Pizza } from \"lucide-react\";\nimport {\n  Collapsible,\n  CollapsibleContent,\n  CollapsibleTrigger,\n} from \"@/components/ui/collapsible\";\nimport { getAdjustedTime } from \"@/hooks/useServerTime\";\n\ninterface DeviceAvailability {\n  category: string;\n  total: number;\n  available: number;\n  occupied: number;\n  percentage: number;\n}\n\ninterface PricingConfig {\n  id: string;\n  category: string;\n  duration: string;\n  price: string;\n}\n\ninterface Facility {\n  id: string;\n  name: string;\n  description: string;\n  icon: string;\n}\n\nconst getIconForCategory = (category: string) => {\n  const icons: Record<string, any> = {\n    \"PC\": Monitor,\n    \"PS5\": Gamepad2,\n    \"VR\": Glasses,\n    \"Car\": Car,\n    \"Xbox\": Gamepad2,\n    \"Nintendo\": Gamepad2,\n  };\n  return icons[category] || Cpu;\n};\n\nconst getFacilityIcon = (iconName: string) => {\n  const icons: Record<string, any> = {\n    \"wifi\": Wifi,\n    \"air-conditioning\": Wind,\n    \"gaming-chair\": Armchair,\n    \"refreshments\": Pizza,\n    \"monitor\": Monitor,\n    \"gamepad\": Gamepad2,\n  };\n  return icons[iconName] || Cpu;\n};\n\nconst getProgressBarColor = (percentage: number) => {\n  if (percentage >= 60) return \"#22c55e\";\n  if (percentage >= 40) return \"#eab308\";\n  return \"#ef4444\";\n};\n\nexport default function PublicStatus() {\n  const [lastUpdate, setLastUpdate] = useState(getAdjustedTime());\n  const [isPricingOpen, setIsPricingOpen] = useState(false);\n\n  const activeSettings = {\n    businessName: \"Airavoto Gaming\",\n    logoUrl: undefined,\n    headerTitle: \"Live Availability\",\n    headerSubtitle: \"Real-time status updated every 5 seconds\",\n    updateInterval: 5,\n    showPricing: 1,\n    showContactInfo: 1,\n    contactSectionTitle: \"Airavoto Gaming Center\",\n    address: \"123 Gaming Street, Tech District, City - 400001\",\n    phone: \"+91 98765 43210\",\n    hours: \"10:00 AM - 11:00 PM (Mon-Sun)\",\n    email: \"info@airavotogaming.com\",\n    showCallNowButton: 1,\n    showDirectionsButton: 1,\n    showFacilities: 1,\n    primaryColor: \"#a855f7\",\n    accentColor: \"#8b5cf6\"\n  };\n\n  const { data: availability = [], isLoading, refetch, dataUpdatedAt } = useQuery<DeviceAvailability[]>({\n    queryKey: [\"/api/public/status\"],\n    refetchInterval: (activeSettings.updateInterval || 5) * 1000,\n  });\n\n  const { data: pricing = [] } = useQuery<PricingConfig[]>({\n    queryKey: [\"/api/consumer/pricing\"],\n    enabled: activeSettings.showPricing === 1,\n  });\n\n  const { data: facilities = [] } = useQuery<Facility[]>({\n    queryKey: [\"/api/consumer/facilities\"],\n    enabled: activeSettings.showFacilities === 1,\n  });\n\n  useEffect(() => {\n    if (dataUpdatedAt) {\n      setLastUpdate(new Date(dataUpdatedAt));\n    }\n  }, [dataUpdatedAt]);\n\n  const primaryColor = activeSettings.primaryColor || \"#a855f7\";\n  const accentColor = activeSettings.accentColor || \"#8b5cf6\";\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 dark:bg-gray-50 flex items-center justify-center p-6\">\n        <div className=\"text-center\">\n          <RefreshCw className=\"h-12 w-12 animate-spin mx-auto mb-4\" style={{ color: primaryColor }} />\n          <p className=\"text-xl text-gray-600 dark:text-gray-600\">Loading availability...</p>\n        </div>\n      </div>\n    );\n  }\n\n  const groupedPricing = pricing.reduce((acc, item) => {\n    if (!acc[item.category]) {\n      acc[item.category] = [];\n    }\n    acc[item.category].push(item);\n    return acc;\n  }, {} as Record<string, PricingConfig[]>);\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-50 pb-8\">\n      <div className=\"max-w-md mx-auto px-4 py-6 space-y-6\">\n        <div className=\"flex items-center justify-between bg-white dark:bg-white rounded-2xl p-4 shadow-sm\">\n          <div className=\"flex items-center gap-3\">\n            {activeSettings.logoUrl ? (\n              <img src={activeSettings.logoUrl} alt=\"Logo\" className=\"w-10 h-10 rounded-lg\" />\n            ) : (\n              <div \n                className=\"w-10 h-10 rounded-lg flex items-center justify-center text-white dark:text-white font-bold\"\n                style={{ backgroundColor: primaryColor }}\n              >\n                {activeSettings.businessName.charAt(0)}\n              </div>\n            )}\n            <div>\n              <h2 className=\"font-bold text-gray-900 dark:text-gray-900\" data-testid=\"text-business-name\">\n                {activeSettings.businessName}\n              </h2>\n              <p className=\"text-sm text-gray-500 dark:text-gray-500\">\n                Updated {lastUpdate.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}\n              </p>\n            </div>\n          </div>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            onClick={() => refetch()}\n            className=\"rounded-full\"\n            data-testid=\"button-refresh\"\n          >\n            <RefreshCw className=\"h-5 w-5 text-gray-600 dark:text-gray-600\" />\n          </Button>\n        </div>\n\n        <div className=\"text-center space-y-2\">\n          <h1 \n            className=\"text-3xl font-bold\"\n            style={{ color: primaryColor }}\n            data-testid=\"text-header-title\"\n          >\n            {activeSettings.headerTitle}\n          </h1>\n          <p className=\"text-sm text-gray-600 dark:text-gray-600\" data-testid=\"text-header-subtitle\">\n            {activeSettings.headerSubtitle}\n          </p>\n        </div>\n\n        <div className=\"space-y-3\">\n          {availability.map((device) => {\n            const Icon = getIconForCategory(device.category);\n            const isAvailable = device.available > 0;\n            const progressColor = getProgressBarColor(device.percentage);\n            \n            return (\n              <Card \n                key={device.category}\n                className=\"bg-white dark:bg-white border-gray-200 dark:border-gray-200 rounded-2xl overflow-hidden\"\n                data-testid={`card-device-${device.category}`}\n              >\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-start justify-between mb-3\">\n                    <div className=\"flex items-center gap-3\">\n                      <div \n                        className=\"w-12 h-12 rounded-xl flex items-center justify-center\"\n                        style={{ backgroundColor: `${primaryColor}15` }}\n                      >\n                        <Icon className=\"w-6 h-6\" style={{ color: primaryColor }} />\n                      </div>\n                      <div>\n                        <h3 className=\"font-bold text-gray-900 dark:text-gray-900\" data-testid={`text-category-${device.category}`}>\n                          {device.category}\n                        </h3>\n                        <p className=\"text-sm text-gray-500 dark:text-gray-500\">\n                          {device.total} Total Stations\n                        </p>\n                      </div>\n                    </div>\n                    <div className=\"text-right\">\n                      <div className=\"text-3xl font-bold text-gray-900 dark:text-gray-900\" data-testid={`text-available-${device.category}`}>\n                        {device.available}\n                      </div>\n                      <div className=\"text-sm text-gray-500 dark:text-gray-500\">Available</div>\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <div className=\"flex justify-between text-sm\">\n                      <span className=\"text-gray-600 dark:text-gray-600\">Availability</span>\n                      <span className=\"font-semibold text-gray-900 dark:text-gray-900\">{device.percentage}%</span>\n                    </div>\n                    <div className=\"w-full bg-gray-200 dark:bg-gray-200 rounded-full h-2 overflow-hidden\">\n                      <div \n                        className=\"h-full transition-all duration-500 rounded-full\"\n                        style={{ \n                          width: `${device.percentage}%`,\n                          backgroundColor: progressColor\n                        }}\n                        data-testid={`progress-${device.category}`}\n                      />\n                    </div>\n                  </div>\n\n                  <div className=\"flex items-center gap-2 mt-3\">\n                    <div className=\"flex items-center gap-1\">\n                      <div className=\"w-2 h-2 rounded-full bg-green-500\" />\n                      <span className=\"text-xs text-gray-600 dark:text-gray-600\">Stations Available</span>\n                    </div>\n                    <Badge \n                      className=\"ml-auto text-xs\"\n                      style={{ \n                        backgroundColor: `${primaryColor}20`,\n                        color: primaryColor,\n                        border: 'none'\n                      }}\n                      data-testid={`badge-status-${device.category}`}\n                    >\n                      Live\n                    </Badge>\n                  </div>\n                </CardContent>\n              </Card>\n            );\n          })}\n        </div>\n\n        {activeSettings.showPricing === 1 && pricing.length > 0 && (\n          <Collapsible open={isPricingOpen} onOpenChange={setIsPricingOpen}>\n            <CollapsibleTrigger asChild>\n              <Button\n                variant=\"ghost\"\n                className=\"w-full flex items-center justify-between text-gray-900 dark:text-gray-900 hover:bg-gray-100 dark:hover:bg-gray-100 rounded-2xl py-6\"\n                data-testid=\"button-toggle-pricing\"\n              >\n                <span className=\"font-semibold\">View Pricing</span>\n                {isPricingOpen ? <ChevronUp className=\"h-5 w-5\" /> : <ChevronDown className=\"h-5 w-5\" />}\n              </Button>\n            </CollapsibleTrigger>\n            <CollapsibleContent className=\"space-y-3\">\n              {Object.entries(groupedPricing).map(([category, items]) => (\n                <Card key={category} className=\"bg-white dark:bg-white border-gray-200 dark:border-gray-200 rounded-2xl\">\n                  <CardContent className=\"p-4\">\n                    <h4 className=\"font-bold text-gray-900 dark:text-gray-900 mb-3\">{category}</h4>\n                    <div className=\"space-y-2\">\n                      {items.map((item) => (\n                        <div key={item.id} className=\"flex justify-between text-sm\">\n                          <span className=\"text-gray-600 dark:text-gray-600\">{item.duration}</span>\n                          <span className=\"font-semibold text-gray-900 dark:text-gray-900\">‚Çπ{item.price}</span>\n                        </div>\n                      ))}\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </CollapsibleContent>\n          </Collapsible>\n        )}\n\n        {activeSettings.showContactInfo === 1 && (\n          <Card className=\"bg-white dark:bg-white border-gray-200 dark:border-gray-200 rounded-2xl\">\n            <CardContent className=\"p-4 space-y-4\">\n              <h3 className=\"font-bold text-lg text-gray-900 dark:text-gray-900\" data-testid=\"text-contact-title\">\n                {activeSettings.contactSectionTitle}\n              </h3>\n\n              {activeSettings.address && (\n                <div className=\"flex items-start gap-3\">\n                  <MapPin className=\"w-5 h-5 mt-0.5\" style={{ color: primaryColor }} />\n                  <div>\n                    <p className=\"text-sm font-semibold text-gray-900 dark:text-gray-900\">Address</p>\n                    <p className=\"text-sm text-gray-600 dark:text-gray-600\" data-testid=\"text-address\">{activeSettings.address}</p>\n                  </div>\n                </div>\n              )}\n\n              {activeSettings.phone && (\n                <div className=\"flex items-start gap-3\">\n                  <Phone className=\"w-5 h-5 mt-0.5\" style={{ color: primaryColor }} />\n                  <div>\n                    <p className=\"text-sm font-semibold text-gray-900 dark:text-gray-900\">Phone</p>\n                    <p className=\"text-sm text-gray-600 dark:text-gray-600\" data-testid=\"text-phone\">{activeSettings.phone}</p>\n                  </div>\n                </div>\n              )}\n\n              {activeSettings.hours && (\n                <div className=\"flex items-start gap-3\">\n                  <Clock className=\"w-5 h-5 mt-0.5\" style={{ color: primaryColor }} />\n                  <div>\n                    <p className=\"text-sm font-semibold text-gray-900 dark:text-gray-900\">Hours</p>\n                    <p className=\"text-sm text-gray-600 dark:text-gray-600\" data-testid=\"text-hours\">{activeSettings.hours}</p>\n                  </div>\n                </div>\n              )}\n\n              {activeSettings.email && (\n                <div className=\"flex items-start gap-3\">\n                  <Mail className=\"w-5 h-5 mt-0.5\" style={{ color: primaryColor }} />\n                  <div>\n                    <p className=\"text-sm font-semibold text-gray-900 dark:text-gray-900\">Email</p>\n                    <p className=\"text-sm text-gray-600 dark:text-gray-600\" data-testid=\"text-email\">{activeSettings.email}</p>\n                  </div>\n                </div>\n              )}\n\n              <div className=\"flex gap-3 pt-2\">\n                {activeSettings.showCallNowButton === 1 && activeSettings.phone && (\n                  <Button\n                    className=\"flex-1 rounded-full text-white dark:text-white\"\n                    style={{ backgroundColor: primaryColor }}\n                    onClick={() => window.location.href = `tel:${activeSettings.phone}`}\n                    data-testid=\"button-call-now\"\n                  >\n                    <Phone className=\"w-4 h-4 mr-2\" />\n                    Call Now\n                  </Button>\n                )}\n                {activeSettings.showDirectionsButton === 1 && activeSettings.address && (\n                  <Button\n                    variant=\"outline\"\n                    className=\"flex-1 rounded-full border-gray-300 dark:border-gray-300\"\n                    onClick={() => window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(activeSettings.address || '')}`, '_blank')}\n                    data-testid=\"button-directions\"\n                  >\n                    <MapPin className=\"w-4 h-4 mr-2\" />\n                    Directions\n                  </Button>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {activeSettings.showFacilities === 1 && facilities.length > 0 && (\n          <div className=\"space-y-3\">\n            <h3 className=\"font-bold text-lg text-gray-900 dark:text-gray-900\">Facilities</h3>\n            <div className=\"grid grid-cols-2 gap-3\">\n              {facilities.map((facility) => {\n                const Icon = getFacilityIcon(facility.icon);\n                return (\n                  <Card \n                    key={facility.id}\n                    className=\"bg-white dark:bg-white border-gray-200 dark:border-gray-200 rounded-2xl\"\n                    data-testid={`card-facility-${facility.id}`}\n                  >\n                    <CardContent className=\"p-4 text-center\">\n                      <div \n                        className=\"w-12 h-12 rounded-xl flex items-center justify-center mx-auto mb-2\"\n                        style={{ backgroundColor: `${primaryColor}15` }}\n                      >\n                        <Icon className=\"w-6 h-6\" style={{ color: primaryColor }} />\n                      </div>\n                      <h4 className=\"font-semibold text-sm text-gray-900 dark:text-gray-900\">{facility.name}</h4>\n                      <p className=\"text-xs text-gray-500 dark:text-gray-500 mt-1\">{facility.description}</p>\n                    </CardContent>\n                  </Card>\n                );\n              })}\n            </div>\n          </div>\n        )}\n\n        <div className=\"text-center text-xs text-gray-500 dark:text-gray-500 pt-4\">\n          <p>¬© 2025 {activeSettings.businessName}. All rights reserved.</p>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":16496,"size_tokens":null},"client/src/contexts/ShortcutsContext.tsx":{"content":"import { createContext, useContext, useState, useCallback, useEffect } from 'react';\nimport type { KeyboardShortcut } from '@/hooks/useKeyboardShortcuts';\n\ninterface ShortcutsContextType {\n  shortcuts: KeyboardShortcut[];\n  registerShortcuts: (pageShortcuts: KeyboardShortcut[]) => void;\n  unregisterShortcuts: (pageShortcuts: KeyboardShortcut[]) => void;\n}\n\nconst ShortcutsContext = createContext<ShortcutsContextType | null>(null);\n\nexport function ShortcutsProvider({ \n  children, \n  globalShortcuts \n}: { \n  children: React.ReactNode;\n  globalShortcuts: KeyboardShortcut[];\n}) {\n  const [pageShortcuts, setPageShortcuts] = useState<KeyboardShortcut[]>([]);\n\n  const registerShortcuts = useCallback((shortcuts: KeyboardShortcut[]) => {\n    setPageShortcuts(prev => [...prev, ...shortcuts]);\n  }, []);\n\n  const unregisterShortcuts = useCallback((shortcuts: KeyboardShortcut[]) => {\n    setPageShortcuts(prev => \n      prev.filter(s => !shortcuts.some(rs => \n        rs.key === s.key && \n        rs.ctrlKey === s.ctrlKey && \n        rs.altKey === s.altKey &&\n        rs.shiftKey === s.shiftKey\n      ))\n    );\n  }, []);\n\n  const allShortcuts = [...globalShortcuts, ...pageShortcuts];\n\n  return (\n    <ShortcutsContext.Provider value={{ \n      shortcuts: allShortcuts, \n      registerShortcuts, \n      unregisterShortcuts \n    }}>\n      {children}\n    </ShortcutsContext.Provider>\n  );\n}\n\nexport function useShortcutsContext() {\n  const context = useContext(ShortcutsContext);\n  if (!context) {\n    throw new Error('useShortcutsContext must be used within ShortcutsProvider');\n  }\n  return context;\n}\n\nexport function useRegisterShortcuts(shortcuts: KeyboardShortcut[]) {\n  const { registerShortcuts, unregisterShortcuts } = useShortcutsContext();\n\n  useEffect(() => {\n    registerShortcuts(shortcuts);\n    return () => unregisterShortcuts(shortcuts);\n  }, [shortcuts, registerShortcuts, unregisterShortcuts]);\n}\n","path":null,"size_bytes":1913,"size_tokens":null},"client/src/components/BookingTable.tsx":{"content":"import { useState, useMemo, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Accordion,\n  AccordionContent,\n  AccordionItem,\n  AccordionTrigger,\n} from \"@/components/ui/accordion\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { StatusBadge } from \"./StatusBadge\";\nimport { SessionTimer } from \"./SessionTimer\";\nimport { Clock, X, Check, UtensilsCrossed, Search, Plus, MoreVertical, Trash2, Play, Pause, Gift, Percent, IndianRupee, ArrowRightLeft, Monitor, User, Phone, Users, Calendar, LayoutGrid, Table2 } from \"lucide-react\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\";\nimport { useAuth } from \"@/contexts/AuthContext\";\n\ntype BookingStatus = \"available\" | \"running\" | \"expired\" | \"upcoming\" | \"completed\" | \"paused\";\n\ninterface FoodOrder {\n  foodId: string;\n  foodName: string;\n  price: string;\n  quantity: number;\n}\n\ninterface Booking {\n  id: string;\n  bookingCode?: string;\n  groupId?: string;\n  groupCode?: string;\n  seatName: string;\n  customerName: string;\n  whatsappNumber?: string;\n  startTime: Date;\n  endTime: Date;\n  price: string;\n  personCount?: number;\n  status: BookingStatus;\n  bookingType?: string[];\n  foodOrders?: FoodOrder[];\n  pausedRemainingTime?: number | null;\n  originalPrice?: string;\n  discountApplied?: string;\n  bonusHoursApplied?: string;\n  promotionDetails?: {\n    discountPercentage?: number;\n    discountAmount?: string;\n    bonusHours?: string;\n  };\n  isPromotionalDiscount?: number;\n  isPromotionalBonus?: number;\n  manualDiscountPercentage?: number;\n  manualFreeHours?: string;\n}\n\ninterface BookingTableProps {\n  bookings: Booking[];\n  onExtend?: (id: string) => void;\n  onEnd?: (id: string) => void;\n  onComplete?: (id: string) => void;\n  onAddFood?: (id: string) => void;\n  onStopTimer?: (id: string) => void;\n  onDeleteFood?: (bookingId: string, foodIndex: number) => void;\n  showDateColumn?: boolean;\n  showTypeColumn?: boolean;\n  selectedBookings?: Set<string>;\n  onToggleSelection?: (bookingId: string) => void;\n}\n\nexport function BookingTable({ bookings, onExtend, onEnd, onComplete, onAddFood, onStopTimer, onDeleteFood, showDateColumn = false, showTypeColumn = false, selectedBookings, onToggleSelection }: BookingTableProps) {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const { isAdmin, canMakeChanges } = useAuth();\n  const { toast } = useToast();\n  const [seatChangeDialog, setSeatChangeDialog] = useState<{open: boolean, bookingId: string, currentSeat: string, category: string}>({open: false, bookingId: \"\", currentSeat: \"\", category: \"\"});\n  const [selectedNewSeat, setSelectedNewSeat] = useState(\"\");\n  const [showRefreshDialog, setShowRefreshDialog] = useState(false);\n\n  // View mode state with localStorage persistence and responsive defaults\n  const getDefaultViewMode = (): \"table\" | \"card\" => {\n    const saved = localStorage.getItem(\"booking-view-mode\");\n    if (saved === \"table\" || saved === \"card\") return saved;\n    // Responsive default: mobile=card, desktop=table\n    return window.matchMedia(\"(max-width: 768px)\").matches ? \"card\" : \"table\";\n  };\n  \n  const [viewMode, setViewMode] = useState<\"table\" | \"card\">(getDefaultViewMode);\n\n  useEffect(() => {\n    localStorage.setItem(\"booking-view-mode\", viewMode);\n  }, [viewMode]);\n\n  const { data: deviceConfigs = [] } = useQuery<any[]>({\n    queryKey: [\"/api/device-config\"],\n  });\n\n  const occupiedSeats = useMemo(() => {\n    return new Set(\n      bookings\n        .filter(b => b.status === 'running' || b.status === 'paused' || b.status === 'upcoming')\n        .map(b => b.seatName)\n    );\n  }, [bookings]);\n\n  const availableSeatsForChange = useMemo(() => {\n    return deviceConfigs.map(config => ({\n      category: config.category,\n      availableSeats: (config.seats || []).filter((seat: string) => !occupiedSeats.has(seat))\n    }));\n  }, [deviceConfigs, occupiedSeats]);\n\n  const changeSeatMutation = useMutation({\n    mutationFn: async (data: { bookingId: string; newSeatName: string }) => {\n      return await apiRequest(\"PATCH\", `/api/bookings/${data.bookingId}/change-seat`, { newSeatName: data.newSeatName });\n    },\n    onMutate: async (variables) => {\n      await queryClient.cancelQueries({ queryKey: [\"/api/bookings\"] });\n      \n      const previousBookings = queryClient.getQueryData([\"/api/bookings\"]);\n      \n      queryClient.setQueryData([\"/api/bookings\"], (old: any) => {\n        if (!old) return old;\n        return old.map((booking: any) => \n          booking.id === variables.bookingId \n            ? { ...booking, seatName: variables.newSeatName }\n            : booking\n        );\n      });\n      \n      setSeatChangeDialog({open: false, bookingId: \"\", currentSeat: \"\", category: \"\"});\n      \n      return { previousBookings };\n    },\n    onSuccess: () => {\n      setShowRefreshDialog(true);\n    },\n    onError: (error: any, variables, context: any) => {\n      if (context?.previousBookings) {\n        queryClient.setQueryData([\"/api/bookings\"], context.previousBookings);\n      }\n      toast({\n        title: \"Seat Change Failed\",\n        description: error.message || \"Failed to change seat. Changes reverted.\",\n        variant: \"destructive\",\n      });\n    },\n    onSettled: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/bookings\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/device-config\"] });\n    },\n  });\n\n  const filteredBookings = bookings.filter((booking) => {\n    const searchLower = searchTerm.toLowerCase();\n    return (\n      booking.seatName.toLowerCase().includes(searchLower) ||\n      booking.customerName.toLowerCase().includes(searchLower) ||\n      (booking.whatsappNumber && booking.whatsappNumber.includes(searchTerm))\n    );\n  });\n\n  // Group bookings by groupId first (for multi-device sessions), then by individual bookings\n  const groupedSessions = useMemo(() => {\n    const sessions: { key: string; bookings: Booking[]; isGrouped: boolean }[] = [];\n    const groupedByGroupId = new Map<string, Booking[]>();\n    const individualBookings: Booking[] = [];\n\n    filteredBookings.forEach(booking => {\n      if (booking.groupId) {\n        if (!groupedByGroupId.has(booking.groupId)) {\n          groupedByGroupId.set(booking.groupId, []);\n        }\n        groupedByGroupId.get(booking.groupId)!.push(booking);\n      } else {\n        individualBookings.push(booking);\n      }\n    });\n\n    // Add grouped sessions\n    groupedByGroupId.forEach((bookings, groupId) => {\n      sessions.push({ key: groupId, bookings, isGrouped: true });\n    });\n\n    // Add individual bookings as single-booking sessions\n    individualBookings.forEach(booking => {\n      sessions.push({ key: booking.id, bookings: [booking], isGrouped: false });\n    });\n\n    return sessions;\n  }, [filteredBookings]);\n\n\n  const formatTime = (date: Date) => {\n    const hours = date.getHours();\n    const minutes = date.getMinutes();\n    const period = hours < 12 ? 'AM' : 'PM';\n    const displayHour = hours === 0 ? 12 : hours > 12 ? hours - 12 : hours;\n    return `${displayHour}:${minutes.toString().padStart(2, '0')} ${period}`;\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center gap-2\">\n        <div className=\"relative flex-1\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n          <Input\n            placeholder=\"Search by seat, customer name, or phone...\"\n            value={searchTerm}\n            onChange={(e) => setSearchTerm(e.target.value)}\n            className=\"pl-9 glass-input\"\n            data-testid=\"input-search-bookings\"\n          />\n        </div>\n        <div className=\"flex items-center gap-1 bg-muted/50 rounded-lg p-1\">\n          <TooltipProvider>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Button\n                  variant={viewMode === \"table\" ? \"default\" : \"ghost\"}\n                  size=\"sm\"\n                  onClick={() => setViewMode(\"table\")}\n                  className=\"h-8 px-3\"\n                  data-testid=\"button-table-view\"\n                >\n                  <Table2 className=\"h-4 w-4 mr-2\" />\n                  Table\n                </Button>\n              </TooltipTrigger>\n              <TooltipContent>\n                <p>View bookings in detailed table format showing all information</p>\n              </TooltipContent>\n            </Tooltip>\n          </TooltipProvider>\n          <TooltipProvider>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Button\n                  variant={viewMode === \"card\" ? \"default\" : \"ghost\"}\n                  size=\"sm\"\n                  onClick={() => setViewMode(\"card\")}\n                  className=\"h-8 px-3\"\n                  data-testid=\"button-card-view\"\n                >\n                  <LayoutGrid className=\"h-4 w-4 mr-2\" />\n                  Cards\n                </Button>\n              </TooltipTrigger>\n              <TooltipContent>\n                <p>View bookings grouped by customer in card layout (better for mobile)</p>\n              </TooltipContent>\n            </Tooltip>\n          </TooltipProvider>\n        </div>\n      </div>\n\n      {filteredBookings.length === 0 ? (\n        <Card className=\"glass-card\">\n          <CardContent className=\"py-12 text-center text-muted-foreground\">\n            No bookings found\n          </CardContent>\n        </Card>\n      ) : viewMode === \"card\" ? (\n        <div className=\"space-y-3\">\n          {groupedSessions.map((session) => {\n            const sessionBookings = session.bookings;\n            const firstBooking = sessionBookings[0];\n            const sessionBookingIds = sessionBookings.map(b => b.id);\n            const allSelected = sessionBookingIds.every(id => selectedBookings?.has(id));\n            const someSelected = sessionBookingIds.some(id => selectedBookings?.has(id));\n            const sessionTotal = sessionBookings.reduce((sum, booking) => {\n              const foodTotal = booking.foodOrders \n                ? booking.foodOrders.reduce((fSum, order) => fSum + parseFloat(order.price) * order.quantity, 0)\n                : 0;\n              return sum + parseFloat(booking.price) + foodTotal;\n            }, 0);\n\n            const hasPromotionalDiscount = sessionBookings.some(b => b.isPromotionalDiscount === 1);\n            const hasManualDiscount = sessionBookings.some(b => b.manualDiscountPercentage && b.manualDiscountPercentage > 0);\n            const hasPromotionalBonus = sessionBookings.some(b => b.isPromotionalBonus === 1);\n            const hasManualBonus = sessionBookings.some(b => b.manualFreeHours);\n            const hasGenericDiscount = sessionBookings.some(b => b.discountApplied);\n            const hasGenericBonus = sessionBookings.some(b => b.bonusHoursApplied);\n            const showSpecificBadges = hasPromotionalDiscount || hasManualDiscount || hasPromotionalBonus || hasManualBonus;\n            const showGenericBadges = !showSpecificBadges && (hasGenericDiscount || hasGenericBonus);\n            const deviceNames = sessionBookings.map(b => b.seatName).join(\", \");\n\n            return (\n              <Card \n                key={session.key}\n                className={`glass-card border rounded-lg overflow-hidden ${allSelected ? \"bg-blue-50 dark:bg-blue-950/30 border-blue-300 dark:border-blue-700\" : \"\"}`}\n                data-testid={`session-card-${session.key}`}\n              >\n                <CardContent className=\"p-4\">\n                  <div className=\"space-y-4\">\n                    {/* Session Header */}\n                    <div className=\"flex items-start justify-between gap-4\">\n                      <div className=\"flex items-center gap-3\">\n                        <Checkbox\n                          checked={allSelected}\n                          onCheckedChange={() => {\n                            sessionBookingIds.forEach(id => {\n                              if (allSelected) {\n                                if (selectedBookings?.has(id)) onToggleSelection?.(id);\n                              } else {\n                                if (!selectedBookings?.has(id)) onToggleSelection?.(id);\n                              }\n                            });\n                          }}\n                          data-testid={`checkbox-session-${session.key}`}\n                        />\n                        <div className=\"space-y-1\">\n                          <div className=\"flex items-center gap-2 flex-wrap\">\n                            <Monitor className=\"h-5 w-5 text-primary\" />\n                            <span className=\"text-lg font-bold text-foreground\" data-testid={`text-device-${session.key}`}>\n                              {deviceNames}\n                            </span>\n                            <User className=\"h-4 w-4 text-muted-foreground ml-2\" />\n                            <span className=\"text-base text-foreground\" data-testid={`text-customer-${session.key}`}>\n                              {firstBooking.customerName}\n                            </span>\n                            <StatusBadge status={firstBooking.status} />\n                          </div>\n                          {/* Group ID Badge */}\n                          {session.isGrouped && firstBooking.groupCode && (\n                            <Badge variant=\"outline\" className=\"text-xs font-mono bg-purple-50 dark:bg-purple-950/30 text-purple-700 dark:text-purple-400 border-purple-200 dark:border-purple-800\" data-testid={`badge-group-${session.key}`}>\n                              <Users className=\"h-3 w-3 mr-1\" />\n                              Group: {firstBooking.groupCode}\n                            </Badge>\n                          )}\n                          {/* Manual Discount Tag */}\n                          {firstBooking.manualDiscountPercentage && firstBooking.manualDiscountPercentage > 0 && (\n                            <Badge className=\"text-xs bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400 border-green-200 dark:border-green-800\">\n                              <Percent className=\"h-3 w-3 mr-1\" />\n                              {firstBooking.manualDiscountPercentage}% Discount\n                            </Badge>\n                          )}\n                          {/* Manual Free Hours Tag */}\n                          {firstBooking.manualFreeHours && (\n                            <Badge className=\"text-xs bg-pink-100 text-pink-800 dark:bg-pink-900/30 dark:text-pink-400 border-pink-200 dark:border-pink-800\">\n                              <Gift className=\"h-3 w-3 mr-1\" />\n                              +{firstBooking.manualFreeHours} Free\n                            </Badge>\n                          )}\n                          {/* Happy Hour / Bonus Hours Tag */}\n                          {firstBooking.bonusHoursApplied && (\n                            <Badge className=\"text-xs bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400 border-blue-200 dark:border-blue-800\">\n                              <Clock className=\"h-3 w-3 mr-1\" />\n                              Happy Hour\n                            </Badge>\n                          )}\n                        </div>\n                      </div>\n                      <div className=\"flex flex-col items-end gap-2\">\n                        <span className=\"text-lg font-bold text-primary\" data-testid={`text-total-${session.key}`}>Total: ‚Çπ{sessionTotal.toFixed(0)}</span>\n                        <DropdownMenu>\n                          <DropdownMenuTrigger asChild>\n                            <Button variant=\"ghost\" size=\"icon\" data-testid={`button-actions-${session.key}`}>\n                              <MoreVertical className=\"h-4 w-4\" />\n                            </Button>\n                          </DropdownMenuTrigger>\n                          <DropdownMenuContent align=\"end\">\n                            {firstBooking.status === \"running\" && onExtend && (\n                              <DropdownMenuItem onClick={() => sessionBookingIds.forEach(id => onExtend(id))}>\n                                <Clock className=\"mr-2 h-4 w-4\" />\n                                Extend Time (All)\n                              </DropdownMenuItem>\n                            )}\n                            {firstBooking.status === \"running\" && onStopTimer && (\n                              <DropdownMenuItem onClick={() => sessionBookingIds.forEach(id => onStopTimer(id))}>\n                                <Pause className=\"mr-2 h-4 w-4\" />\n                                Pause (All)\n                              </DropdownMenuItem>\n                            )}\n                            {firstBooking.status === \"running\" && onEnd && (\n                              <DropdownMenuItem onClick={() => sessionBookingIds.forEach(id => onEnd(id))} className=\"text-destructive\">\n                                <X className=\"mr-2 h-4 w-4\" />\n                                End Session (All)\n                              </DropdownMenuItem>\n                            )}\n                            {onAddFood && (\n                              <DropdownMenuItem onClick={() => onAddFood(firstBooking.id)}>\n                                <UtensilsCrossed className=\"mr-2 h-4 w-4\" />\n                                Add Food\n                              </DropdownMenuItem>\n                            )}\n                          </DropdownMenuContent>\n                        </DropdownMenu>\n                      </div>\n                    </div>\n\n                    {/* Devices Table - Shows each PC with its own details */}\n                    <div className=\"rounded-lg border overflow-hidden\">\n                      <Table>\n                        <TableHeader>\n                          <TableRow className=\"bg-muted/50\">\n                            <TableHead className=\"font-semibold\">Device</TableHead>\n                            <TableHead className=\"font-semibold\">Customer</TableHead>\n                            <TableHead className=\"font-semibold\">Persons</TableHead>\n                            <TableHead className=\"font-semibold\">WhatsApp</TableHead>\n                            <TableHead className=\"font-semibold\">Date</TableHead>\n                            <TableHead className=\"font-semibold\">Type</TableHead>\n                          </TableRow>\n                        </TableHeader>\n                        <TableBody>\n                          {sessionBookings.map((booking) => (\n                            <TableRow key={booking.id} data-testid={`row-booking-${booking.id}`}>\n                              <TableCell>\n                                <Badge variant=\"outline\" className=\"text-sm font-bold\" data-testid={`badge-device-${booking.id}`}>\n                                  {booking.seatName}\n                                </Badge>\n                              </TableCell>\n                              <TableCell className=\"font-medium\">{booking.customerName}</TableCell>\n                              <TableCell>{booking.personCount || 1}</TableCell>\n                              <TableCell>{booking.whatsappNumber || '-'}</TableCell>\n                              <TableCell>\n                                {booking.startTime.toLocaleDateString('en-GB', { \n                                  day: '2-digit', \n                                  month: 'short', \n                                  year: 'numeric',\n                                  timeZone: 'Asia/Kolkata'\n                                })}\n                              </TableCell>\n                              <TableCell>\n                                {booking.bookingType && booking.bookingType.length > 0 ? (\n                                  <Badge variant=\"secondary\" className=\"text-xs\">\n                                    {booking.bookingType[0]}\n                                  </Badge>\n                                ) : '-'}\n                              </TableCell>\n                            </TableRow>\n                          ))}\n                        </TableBody>\n                      </Table>\n                    </div>\n\n                    {/* Timer */}\n                    <div className=\"flex items-center justify-between bg-muted/50 rounded-lg p-3\">\n                      <div className=\"flex items-center gap-2\">\n                        <Clock className=\"h-4 w-4 text-muted-foreground\" />\n                        <span className=\"text-sm text-muted-foreground\">\n                          {formatTime(firstBooking.startTime)} - {formatTime(firstBooking.endTime)}\n                        </span>\n                      </div>\n                      {firstBooking.status === \"running\" && (\n                        <SessionTimer\n                          endTime={firstBooking.endTime}\n                        />\n                      )}\n                    </div>\n\n                    {/* Promotion Badges */}\n                    {(showSpecificBadges || showGenericBadges) && (\n                      <div className=\"flex items-center gap-1.5 flex-wrap\">\n                        {hasPromotionalDiscount && (\n                          <Badge variant=\"outline\" className=\"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-700 dark:text-emerald-400 border-emerald-200 dark:border-emerald-800 text-xs\">\n                            <Percent className=\"h-3 w-3 mr-1\" />\n                            Promo Discount\n                          </Badge>\n                        )}\n                        {hasManualDiscount && (\n                          <Badge variant=\"outline\" className=\"bg-blue-50 dark:bg-blue-950/30 text-blue-700 dark:text-blue-400 border-blue-200 dark:border-blue-800 text-xs\">\n                            <IndianRupee className=\"h-3 w-3 mr-1\" />\n                            Discount\n                          </Badge>\n                        )}\n                        {hasPromotionalBonus && (\n                          <Badge variant=\"outline\" className=\"bg-violet-50 dark:bg-violet-950/30 text-violet-700 dark:text-violet-400 border-violet-200 dark:border-violet-800 text-xs\">\n                            <Gift className=\"h-3 w-3 mr-1\" />\n                            Promo Bonus\n                          </Badge>\n                        )}\n                        {hasManualBonus && (\n                          <Badge variant=\"outline\" className=\"bg-amber-50 dark:bg-amber-950/30 text-amber-700 dark:text-amber-400 border-amber-200 dark:border-amber-800 text-xs\">\n                            <Clock className=\"h-3 w-3 mr-1\" />\n                            Bonus\n                          </Badge>\n                        )}\n                      </div>\n                    )}\n\n                    {/* Food Orders */}\n                    {sessionBookings.some(b => b.foodOrders && b.foodOrders.length > 0) && (\n                      <div className=\"space-y-2\">\n                        <div className=\"flex items-center gap-2 text-sm font-medium\">\n                          <UtensilsCrossed className=\"h-4 w-4\" />\n                          Food Orders\n                        </div>\n                        {sessionBookings.map(booking => \n                          booking.foodOrders?.map((order, idx) => (\n                            <div key={`${booking.id}-food-${idx}`} className=\"flex items-center justify-between text-sm bg-muted/30 rounded px-2 py-1\">\n                              <span>{order.foodName} x{order.quantity}</span>\n                              <div className=\"flex items-center gap-2\">\n                                <span>‚Çπ{(parseFloat(order.price) * order.quantity).toFixed(0)}</span>\n                                {onDeleteFood && canMakeChanges && (\n                                  <Button\n                                    variant=\"ghost\"\n                                    size=\"icon\"\n                                    className=\"h-6 w-6\"\n                                    onClick={() => onDeleteFood(booking.id, idx)}\n                                  >\n                                    <Trash2 className=\"h-3 w-3 text-destructive\" />\n                                  </Button>\n                                )}\n                              </div>\n                            </div>\n                          ))\n                        )}\n                      </div>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n            );\n          })}\n        </div>\n      ) : (\n        <div className=\"space-y-3\">\n          {groupedSessions.map((session) => {\n            const sessionBookings = session.bookings;\n            const sessionBookingIds = sessionBookings.map(b => b.id);\n            const allSelected = sessionBookingIds.every(id => selectedBookings?.has(id));\n            const pcCount = sessionBookings.length;\n            const firstBooking = sessionBookings[0];\n            \n            const baseTotal = sessionBookings.reduce((sum, booking) => \n              sum + parseFloat(booking.price), 0);\n            \n            const foodTotal = sessionBookings.reduce((sum, booking) => {\n              return sum + (booking.foodOrders?.reduce((fSum, order) => \n                fSum + parseFloat(order.price) * order.quantity, 0) || 0);\n            }, 0);\n            \n            const grandTotal = baseTotal + foodTotal;\n            const deviceNames = sessionBookings.map(b => b.seatName).join(\", \");\n\n            const headerLabel = session.isGrouped && firstBooking.groupCode \n              ? `Group: ${firstBooking.groupCode}` \n              : session.isGrouped \n                ? `Group Session` \n                : firstBooking.seatName;\n\n            return (\n              <div \n                key={session.key} \n                className={`rounded-lg border glass-card overflow-hidden ${allSelected ? \"border-blue-400 dark:border-blue-600\" : \"\"}`}\n                data-testid={`session-group-${session.key}`}\n              >\n                <div className={`flex items-center justify-between gap-4 px-4 py-3 bg-muted/50 border-b ${allSelected ? \"bg-blue-50 dark:bg-blue-950/30\" : \"\"}`}>\n                  <div className=\"flex items-center gap-3\">\n                    <Checkbox\n                      checked={allSelected}\n                      onCheckedChange={() => {\n                        sessionBookingIds.forEach(id => {\n                          if (allSelected) {\n                            if (selectedBookings?.has(id)) onToggleSelection?.(id);\n                          } else {\n                            if (!selectedBookings?.has(id)) onToggleSelection?.(id);\n                          }\n                        });\n                      }}\n                      data-testid={`checkbox-session-${session.key}`}\n                    />\n                    <div className=\"flex items-center gap-3 flex-wrap\">\n                      {session.isGrouped ? (\n                        <Users className=\"h-5 w-5 text-purple-600 dark:text-purple-400\" />\n                      ) : (\n                        <Monitor className=\"h-5 w-5 text-primary\" />\n                      )}\n                      <span className=\"text-lg font-bold text-foreground\" data-testid={`text-header-${session.key}`}>\n                        {headerLabel}\n                      </span>\n                      {session.isGrouped && (\n                        <Badge variant=\"outline\" className=\"text-xs bg-purple-50 dark:bg-purple-950/30 text-purple-700 dark:text-purple-400 border-purple-200 dark:border-purple-800\">\n                          {pcCount} {pcCount === 1 ? 'Device' : 'Devices'}: {deviceNames}\n                        </Badge>\n                      )}\n                      <Badge variant=\"secondary\" className=\"text-xs\">\n                        <User className=\"h-3 w-3 mr-1\" />\n                        {firstBooking.customerName}\n                      </Badge>\n                      <StatusBadge status={firstBooking.status} />\n                      {/* Manual Discount Tag */}\n                      {firstBooking.manualDiscountPercentage && firstBooking.manualDiscountPercentage > 0 && (\n                        <Badge className=\"text-xs bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400 border-green-200 dark:border-green-800\">\n                          <Percent className=\"h-3 w-3 mr-1\" />\n                          {firstBooking.manualDiscountPercentage}% Discount\n                        </Badge>\n                      )}\n                      {/* Manual Free Hours Tag */}\n                      {firstBooking.manualFreeHours && (\n                        <Badge className=\"text-xs bg-pink-100 text-pink-800 dark:bg-pink-900/30 dark:text-pink-400 border-pink-200 dark:border-pink-800\">\n                          <Gift className=\"h-3 w-3 mr-1\" />\n                          +{firstBooking.manualFreeHours} Free\n                        </Badge>\n                      )}\n                      {/* Happy Hour / Bonus Hours Tag */}\n                      {firstBooking.bonusHoursApplied && (\n                        <Badge className=\"text-xs bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400 border-blue-200 dark:border-blue-800\">\n                          <Clock className=\"h-3 w-3 mr-1\" />\n                          Happy Hour\n                        </Badge>\n                      )}\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-4\">\n                    <span className=\"text-lg font-bold text-primary\" data-testid={`text-total-${session.key}`}>\n                      Total: ‚Çπ{grandTotal.toFixed(0)}\n                    </span>\n                    <DropdownMenu>\n                      <DropdownMenuTrigger asChild>\n                        <Button variant=\"ghost\" size=\"icon\" data-testid={`button-actions-session-${session.key}`}>\n                          <MoreVertical className=\"h-4 w-4\" />\n                        </Button>\n                      </DropdownMenuTrigger>\n                      <DropdownMenuContent align=\"end\">\n                        {firstBooking.status === \"running\" && onExtend && (\n                          <DropdownMenuItem onClick={() => sessionBookingIds.forEach(id => onExtend(id))}>\n                            <Clock className=\"mr-2 h-4 w-4\" />\n                            Extend All\n                          </DropdownMenuItem>\n                        )}\n                        {firstBooking.status === \"running\" && onStopTimer && (\n                          <DropdownMenuItem onClick={() => sessionBookingIds.forEach(id => onStopTimer(id))}>\n                            <Pause className=\"mr-2 h-4 w-4\" />\n                            Pause All\n                          </DropdownMenuItem>\n                        )}\n                        {firstBooking.status === \"running\" && onEnd && (\n                          <DropdownMenuItem onClick={() => sessionBookingIds.forEach(id => onEnd(id))} className=\"text-destructive\">\n                            <X className=\"mr-2 h-4 w-4\" />\n                            End All\n                          </DropdownMenuItem>\n                        )}\n                        {onAddFood && (\n                          <DropdownMenuItem onClick={() => onAddFood(firstBooking.id)}>\n                            <UtensilsCrossed className=\"mr-2 h-4 w-4\" />\n                            Add Food\n                          </DropdownMenuItem>\n                        )}\n                      </DropdownMenuContent>\n                    </DropdownMenu>\n                  </div>\n                </div>\n                \n                <div className=\"overflow-x-auto\">\n                  <Table>\n                    <TableHeader>\n                      <TableRow className=\"bg-muted/20\">\n                        <TableHead className=\"w-8\"></TableHead>\n                        <TableHead className=\"whitespace-nowrap\">Device</TableHead>\n                        <TableHead className=\"whitespace-nowrap\">Customer</TableHead>\n                        <TableHead className=\"whitespace-nowrap\">Persons</TableHead>\n                        <TableHead className=\"whitespace-nowrap\">WhatsApp</TableHead>\n                        {showDateColumn && <TableHead className=\"whitespace-nowrap\">Date</TableHead>}\n                        {showTypeColumn && <TableHead className=\"whitespace-nowrap\">Type</TableHead>}\n                        <TableHead className=\"whitespace-nowrap\">Start</TableHead>\n                        <TableHead className=\"whitespace-nowrap\">End</TableHead>\n                        <TableHead className=\"whitespace-nowrap\">Time Left</TableHead>\n                        <TableHead className=\"whitespace-nowrap\">Status</TableHead>\n                        <TableHead className=\"whitespace-nowrap\">Food</TableHead>\n                        <TableHead className=\"whitespace-nowrap\">Price</TableHead>\n                        <TableHead className=\"text-right whitespace-nowrap\">Actions</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {sessionBookings.map((booking) => {\n                        const bookingFoodTotal = booking.foodOrders?.reduce((sum, order) => \n                          sum + parseFloat(order.price) * order.quantity, 0) || 0;\n                        const bookingTotal = parseFloat(booking.price) + bookingFoodTotal;\n                        const isSelected = selectedBookings?.has(booking.id);\n                        \n                        return (\n                          <TableRow \n                            key={booking.id}\n                            className={isSelected ? \"bg-blue-50 dark:bg-blue-950/30\" : \"\"}\n                          >\n                            <TableCell>\n                              <Checkbox\n                                checked={isSelected}\n                                onCheckedChange={() => onToggleSelection?.(booking.id)}\n                                data-testid={`checkbox-booking-${booking.id}`}\n                              />\n                            </TableCell>\n                            <TableCell>\n                              <div className=\"flex items-center gap-2\">\n                                <Badge variant=\"outline\" className=\"text-sm font-bold\" data-testid={`badge-device-${booking.id}`}>\n                                  {booking.seatName}\n                                </Badge>\n                                {booking.bookingCode && (\n                                  <Badge variant=\"secondary\" className=\"text-xs font-mono\">\n                                    {booking.bookingCode}\n                                  </Badge>\n                                )}\n                              </div>\n                            </TableCell>\n                            <TableCell className=\"font-medium\">{booking.customerName}</TableCell>\n                            <TableCell>{booking.personCount || 1}</TableCell>\n                            <TableCell>{booking.whatsappNumber || '-'}</TableCell>\n                            {showDateColumn && (\n                              <TableCell>\n                                {booking.startTime.toLocaleDateString('en-GB', { \n                                  day: '2-digit', \n                                  month: 'short',\n                                  year: 'numeric',\n                                  timeZone: 'Asia/Kolkata'\n                                })}\n                              </TableCell>\n                            )}\n                            {showTypeColumn && (\n                              <TableCell>\n                                {booking.bookingType?.includes(\"walk-in\") && (\n                                  <Badge className=\"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400 text-xs\">Walk-in</Badge>\n                                )}\n                              </TableCell>\n                            )}\n                            <TableCell>{formatTime(booking.startTime)}</TableCell>\n                            <TableCell>{formatTime(booking.endTime)}</TableCell>\n                            <TableCell>\n                              {booking.status === \"running\" && <SessionTimer endTime={booking.endTime} />}\n                              {booking.status === \"paused\" && (\n                                <div className=\"flex items-center gap-1 text-amber-600\">\n                                  <Pause className=\"h-3 w-3\" />\n                                  <span className=\"text-xs\">Paused</span>\n                                </div>\n                              )}\n                            </TableCell>\n                            <TableCell><StatusBadge status={booking.status} /></TableCell>\n                            <TableCell>\n                              {booking.foodOrders && booking.foodOrders.length > 0 ? (\n                                <Popover>\n                                  <PopoverTrigger asChild>\n                                    <Button \n                                      variant=\"ghost\" \n                                      size=\"icon\" \n                                      className=\"h-8 w-8 relative\"\n                                      data-testid={`button-food-${booking.id}`}\n                                    >\n                                      <UtensilsCrossed className=\"h-4 w-4 text-orange-500\" />\n                                      <span className=\"absolute -top-1 -right-1 bg-orange-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center font-bold\">\n                                        {booking.foodOrders.length}\n                                      </span>\n                                    </Button>\n                                  </PopoverTrigger>\n                                  <PopoverContent className=\"w-80\" align=\"start\">\n                                    <div className=\"space-y-3\">\n                                      <div className=\"flex items-center gap-2 border-b pb-2\">\n                                        <UtensilsCrossed className=\"h-5 w-5 text-orange-500\" />\n                                        <h4 className=\"font-semibold\">Food Orders</h4>\n                                        <Badge variant=\"secondary\" className=\"ml-auto\">\n                                          {booking.foodOrders.length} {booking.foodOrders.length === 1 ? 'item' : 'items'}\n                                        </Badge>\n                                      </div>\n                                      <div className=\"space-y-2 max-h-60 overflow-y-auto\">\n                                        {booking.foodOrders.map((order, idx) => (\n                                          <div \n                                            key={idx} \n                                            className=\"flex items-center justify-between p-2 bg-muted/50 rounded-lg\"\n                                            data-testid={`food-item-${booking.id}-${idx}`}\n                                          >\n                                            <div className=\"flex-1\">\n                                              <p className=\"font-medium text-sm\">{order.foodName}</p>\n                                              <p className=\"text-xs text-muted-foreground\">\n                                                ‚Çπ{order.price} x {order.quantity}\n                                              </p>\n                                            </div>\n                                            <div className=\"flex items-center gap-2\">\n                                              <span className=\"font-bold text-sm\">\n                                                ‚Çπ{(parseFloat(order.price) * order.quantity).toFixed(0)}\n                                              </span>\n                                              {onDeleteFood && canMakeChanges && (\n                                                <Button\n                                                  variant=\"ghost\"\n                                                  size=\"icon\"\n                                                  className=\"h-6 w-6\"\n                                                  onClick={() => onDeleteFood(booking.id, idx)}\n                                                  data-testid={`button-delete-food-${booking.id}-${idx}`}\n                                                >\n                                                  <Trash2 className=\"h-3 w-3 text-destructive\" />\n                                                </Button>\n                                              )}\n                                            </div>\n                                          </div>\n                                        ))}\n                                      </div>\n                                      <div className=\"flex items-center justify-between border-t pt-2\">\n                                        <span className=\"font-medium\">Total Food</span>\n                                        <span className=\"font-bold text-orange-600\">\n                                          ‚Çπ{bookingFoodTotal.toFixed(0)}\n                                        </span>\n                                      </div>\n                                    </div>\n                                  </PopoverContent>\n                                </Popover>\n                              ) : (\n                                <span className=\"text-muted-foreground text-xs\">-</span>\n                              )}\n                            </TableCell>\n                            <TableCell className=\"font-medium\">‚Çπ{bookingTotal.toFixed(0)}</TableCell>\n                            <TableCell className=\"text-right\">\n                              <DropdownMenu>\n                                <DropdownMenuTrigger asChild>\n                                  <Button variant=\"ghost\" size=\"icon\" data-testid={`button-actions-booking-${booking.id}`}>\n                                    <MoreVertical className=\"h-4 w-4\" />\n                                  </Button>\n                                </DropdownMenuTrigger>\n                                <DropdownMenuContent align=\"end\">\n                                  {booking.status === \"running\" && onExtend && (\n                                    <DropdownMenuItem onClick={() => onExtend(booking.id)}>\n                                      <Clock className=\"mr-2 h-4 w-4\" />\n                                      Extend\n                                    </DropdownMenuItem>\n                                  )}\n                                  {booking.status === \"running\" && onStopTimer && (\n                                    <DropdownMenuItem onClick={() => onStopTimer(booking.id)}>\n                                      <Pause className=\"mr-2 h-4 w-4\" />\n                                      Pause\n                                    </DropdownMenuItem>\n                                  )}\n                                  {booking.status === \"running\" && onEnd && (\n                                    <DropdownMenuItem onClick={() => onEnd(booking.id)} className=\"text-destructive\">\n                                      <X className=\"mr-2 h-4 w-4\" />\n                                      End\n                                    </DropdownMenuItem>\n                                  )}\n                                  {onAddFood && (\n                                    <DropdownMenuItem onClick={() => onAddFood(booking.id)}>\n                                      <UtensilsCrossed className=\"mr-2 h-4 w-4\" />\n                                      Add Food\n                                    </DropdownMenuItem>\n                                  )}\n                                </DropdownMenuContent>\n                              </DropdownMenu>\n                            </TableCell>\n                          </TableRow>\n                        );\n                      })}\n                    </TableBody>\n                  </Table>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      )}\n\n      <Dialog open={seatChangeDialog.open} onOpenChange={(open) => setSeatChangeDialog({...seatChangeDialog, open})}>\n        <DialogContent className=\"max-w-2xl\" data-testid=\"dialog-seat-change\">\n          <DialogHeader className=\"space-y-3\">\n            <DialogTitle className=\"flex items-center gap-3 text-2xl\">\n              <div className=\"p-2 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg\">\n                <ArrowRightLeft className=\"h-6 w-6 text-white\" />\n              </div>\n              Change Seat\n            </DialogTitle>\n            <DialogDescription className=\"text-base\">\n              Select a new available seat from {seatChangeDialog.category} category\n            </DialogDescription>\n          </DialogHeader>\n\n          <div className=\"space-y-6 py-2\">\n            <div className=\"relative overflow-hidden p-5 bg-gradient-to-br from-indigo-50 to-purple-50 dark:from-indigo-950/50 dark:to-purple-950/50 rounded-xl border-2 border-indigo-200 dark:border-indigo-800 shadow-sm\">\n              <div className=\"absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-blue-400/20 to-purple-400/20 rounded-full blur-2xl\"></div>\n              <div className=\"relative flex items-center justify-between\">\n                <div className=\"space-y-1\">\n                  <p className=\"text-sm font-medium text-indigo-600 dark:text-indigo-400 uppercase tracking-wide\">Current Seat</p>\n                  <p className=\"text-3xl font-bold text-indigo-900 dark:text-indigo-100\">{seatChangeDialog.currentSeat}</p>\n                  <p className=\"text-sm text-indigo-600 dark:text-indigo-400\">{seatChangeDialog.category}</p>\n                </div>\n                <div className=\"p-3 bg-white/80 dark:bg-gray-900/80 rounded-full backdrop-blur-sm\">\n                  <Monitor className=\"h-8 w-8 text-indigo-600 dark:text-indigo-400\" />\n                </div>\n              </div>\n            </div>\n\n            <div className=\"space-y-3\">\n              <div className=\"flex items-center justify-between\">\n                <p className=\"text-lg font-semibold text-foreground flex items-center gap-2\">\n                  <span className=\"w-2 h-2 bg-green-500 rounded-full animate-pulse\"></span>\n                  Available Seats\n                </p>\n                <Badge variant=\"secondary\" className=\"text-xs\">\n                  {availableSeatsForChange\n                    .filter((seat: any) => seat.category === seatChangeDialog.category)\n                    .flatMap((seat: any) => seat.availableSeats)\n                    .filter((seatName: string) => seatName !== seatChangeDialog.currentSeat).length} seats\n                </Badge>\n              </div>\n              \n              <div className=\"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-3 max-h-[300px] overflow-y-auto p-1\">\n                {availableSeatsForChange\n                  .filter((seat: any) => seat.category === seatChangeDialog.category)\n                  .flatMap((seat: any) => seat.availableSeats)\n                  .filter((seatName: string) => seatName !== seatChangeDialog.currentSeat)\n                  .map((seatName: string) => (\n                    <Button\n                      key={seatName}\n                      variant={selectedNewSeat === seatName ? \"default\" : \"outline\"}\n                      className={`h-auto py-4 text-lg font-bold transition-all ${\n                        selectedNewSeat === seatName \n                          ? \"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white shadow-lg scale-105\"\n                          : \"border-2 hover:border-blue-400\"\n                      }`}\n                      onClick={() => setSelectedNewSeat(seatName)}\n                      data-testid={`button-select-seat-${seatName}`}\n                    >\n                      {seatName}\n                    </Button>\n                  ))}\n              </div>\n            </div>\n          </div>\n          \n          <DialogFooter className=\"gap-3\">\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setSeatChangeDialog({ open: false, bookingId: \"\", currentSeat: \"\", category: \"\" });\n                setSelectedNewSeat(\"\");\n              }}\n              className=\"px-6\"\n              data-testid=\"button-cancel-seat-change\"\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={() => {\n                if (selectedNewSeat && seatChangeDialog.bookingId) {\n                  changeSeatMutation.mutate({ bookingId: seatChangeDialog.bookingId, newSeatName: selectedNewSeat });\n                }\n              }}\n              disabled={!selectedNewSeat || changeSeatMutation?.isPending}\n              className=\"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-8 shadow-lg\"\n              data-testid=\"button-confirm-seat-change\"\n            >\n              {changeSeatMutation?.isPending ? (\n                <span className=\"flex items-center gap-2\">\n                  <div className=\"h-4 w-4 border-2 border-white/30 border-t-white rounded-full animate-spin\"></div>\n                  Changing...\n                </span>\n              ) : (\n                <span className=\"flex items-center gap-2\">\n                  <Check className=\"h-4 w-4\" />\n                  Change to {selectedNewSeat || \"...\"}\n                </span>\n              )}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={showRefreshDialog} onOpenChange={setShowRefreshDialog}>\n        <DialogContent data-testid=\"dialog-refresh-prompt\">\n          <DialogHeader>\n            <DialogTitle>Seat Changed Successfully</DialogTitle>\n            <DialogDescription>\n              The seat has been updated. Please refresh the page to see the changes reflected in the seat availability.\n            </DialogDescription>\n          </DialogHeader>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => setShowRefreshDialog(false)}\n              data-testid=\"button-close-refresh\"\n            >\n              Close\n            </Button>\n            <Button\n              onClick={() => window.location.reload()}\n              data-testid=\"button-refresh-page\"\n            >\n              Refresh Now\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":51559,"size_tokens":null},"shared/schema.ts":{"content":"import { z } from \"zod\";\nimport { sql } from \"drizzle-orm\";\nimport { pgTable, varchar, integer, timestamp, text, jsonb, real, index, boolean } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\n\n// Session storage table for Replit Auth\n// IMPORTANT: This table is mandatory for Replit Auth, don't drop it.\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)],\n);\n\n// Session groups table - for grouping multiple devices into one booking session\nexport const sessionGroups = pgTable(\"session_groups\", {\n  id: varchar(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  groupCode: varchar(\"group_code\").unique(), // Human-readable group code like \"GRP-1234\" (nullable for legacy groups)\n  groupName: varchar(\"group_name\").notNull(), // e.g., \"Group 1\", \"Rajesh's Party\", etc.\n  category: varchar(\"category\").notNull(),\n  bookingType: text(\"booking_type\").array().notNull(),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertSessionGroupSchema = createInsertSchema(sessionGroups).omit({ id: true, createdAt: true });\nexport type InsertSessionGroup = z.infer<typeof insertSessionGroupSchema>;\nexport type SessionGroup = typeof sessionGroups.$inferSelect;\n\n// Drizzle table definitions\nexport const bookings = pgTable(\"bookings\", {\n  id: varchar(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  bookingCode: varchar(\"booking_code\").unique(), // Human-readable booking code like \"BK-1234\" (nullable for legacy bookings)\n  groupId: varchar(\"group_id\"), // Links this booking to a session group (null for single device bookings)\n  groupCode: varchar(\"group_code\"), // Human-readable group code for display (null for single device bookings)\n  category: varchar(\"category\").notNull(),\n  seatNumber: integer(\"seat_number\").notNull(),\n  seatName: varchar(\"seat_name\").notNull(),\n  customerName: varchar(\"customer_name\").notNull(),\n  whatsappNumber: varchar(\"whatsapp_number\"),\n  startTime: timestamp(\"start_time\").notNull(),\n  endTime: timestamp(\"end_time\").notNull(),\n  price: varchar(\"price\").notNull(),\n  status: varchar(\"status\").notNull(),\n  bookingType: text(\"booking_type\").array().notNull(),\n  pausedRemainingTime: integer(\"paused_remaining_time\"),\n  personCount: integer(\"person_count\").notNull().default(1),\n  paymentMethod: varchar(\"payment_method\"),\n  cashAmount: varchar(\"cash_amount\"),\n  upiAmount: varchar(\"upi_amount\"),\n  paymentStatus: varchar(\"payment_status\").notNull().default(\"unpaid\"),\n  lastPaymentAction: jsonb(\"last_payment_action\").$type<{\n    previousStatus?: string;\n    previousMethod?: string | null;\n    timestamp?: string;\n    userId?: string;\n  } | null>(),\n  foodOrders: jsonb(\"food_orders\").$type<Array<{\n    foodId: string;\n    foodName: string;\n    price: string;\n    quantity: number;\n  }>>().default([]),\n  originalPrice: varchar(\"original_price\"),\n  discountApplied: varchar(\"discount_applied\"),\n  bonusHoursApplied: varchar(\"bonus_hours_applied\"),\n  promotionDetails: jsonb(\"promotion_details\").$type<{\n    discountPercentage?: number;\n    discountAmount?: string;\n    bonusHours?: string;\n  }>(),\n  isPromotionalDiscount: integer(\"is_promotional_discount\").default(0),\n  isPromotionalBonus: integer(\"is_promotional_bonus\").default(0),\n  manualDiscountPercentage: integer(\"manual_discount_percentage\"),\n  manualFreeHours: varchar(\"manual_free_hours\"),\n  discount: varchar(\"discount\"),\n  bonus: varchar(\"bonus\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertBookingSchema = createInsertSchema(bookings).omit({ id: true, createdAt: true }).extend({\n  bookingCode: z.string().optional().nullable(),\n  groupId: z.string().optional().nullable(),\n  groupCode: z.string().optional().nullable(),\n  startTime: z.union([z.string(), z.date()]).transform(val => typeof val === 'string' ? new Date(val) : val),\n  endTime: z.union([z.string(), z.date()]).transform(val => typeof val === 'string' ? new Date(val) : val),\n  pausedRemainingTime: z.number().nullable().optional(),\n});\nexport type InsertBooking = z.infer<typeof insertBookingSchema>;\nexport type Booking = typeof bookings.$inferSelect;\n\nexport const foodItems = pgTable(\"food_items\", {\n  id: varchar(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  name: varchar(\"name\").notNull(),\n  price: varchar(\"price\").notNull(),\n  costPrice: varchar(\"cost_price\"),\n  currentStock: integer(\"current_stock\").notNull().default(0),\n  minStockLevel: integer(\"min_stock_level\").notNull().default(10),\n  inInventory: integer(\"in_inventory\").notNull().default(0),\n  category: varchar(\"category\").notNull().default(\"trackable\"),\n  supplier: varchar(\"supplier\"),\n  expiryDate: timestamp(\"expiry_date\"),\n});\n\nexport const insertFoodItemSchema = createInsertSchema(foodItems).omit({ id: true }).extend({\n  expiryDate: z.union([z.string(), z.date(), z.null(), z.undefined()]).transform(val => {\n    if (!val) return undefined;\n    return typeof val === 'string' ? new Date(val) : val;\n  }).optional(),\n});\nexport type InsertFoodItem = z.infer<typeof insertFoodItemSchema>;\nexport type FoodItem = typeof foodItems.$inferSelect;\n\nexport const stockBatches = pgTable(\"stock_batches\", {\n  id: varchar(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  foodItemId: varchar(\"food_item_id\").notNull(),\n  quantity: integer(\"quantity\").notNull(),\n  costPrice: varchar(\"cost_price\").notNull(),\n  supplier: varchar(\"supplier\"),\n  purchaseDate: timestamp(\"purchase_date\").notNull().defaultNow(),\n  expiryDate: timestamp(\"expiry_date\"),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertStockBatchSchema = createInsertSchema(stockBatches).omit({ id: true, createdAt: true }).extend({\n  purchaseDate: z.union([z.string(), z.date()]).transform(val => typeof val === 'string' ? new Date(val) : val).optional(),\n  expiryDate: z.union([z.string(), z.date(), z.null(), z.undefined()]).transform(val => {\n    if (!val) return undefined;\n    return typeof val === 'string' ? new Date(val) : val;\n  }).optional(),\n});\nexport type InsertStockBatch = z.infer<typeof insertStockBatchSchema>;\nexport type StockBatch = typeof stockBatches.$inferSelect;\n\nexport const stockAdjustmentSchema = z.object({\n  foodId: z.string(),\n  quantity: z.number().int(),\n  type: z.enum([\"add\", \"remove\"]),\n  costPrice: z.string().optional(),\n  supplier: z.string().optional(),\n  expiryDate: z.union([z.string(), z.date(), z.null(), z.undefined()]).transform(val => {\n    if (!val) return undefined;\n    return typeof val === 'string' ? new Date(val) : val;\n  }).optional(),\n  notes: z.string().optional(),\n});\n\nexport const deviceConfigs = pgTable(\"device_configs\", {\n  id: varchar(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  category: varchar(\"category\").notNull().unique(),\n  count: integer(\"count\").notNull().default(0),\n  seats: text(\"seats\").array().notNull().default([]),\n});\n\nexport const insertDeviceConfigSchema = createInsertSchema(deviceConfigs).omit({ id: true });\nexport type InsertDeviceConfig = z.infer<typeof insertDeviceConfigSchema>;\nexport type DeviceConfig = typeof deviceConfigs.$inferSelect;\n\nexport const pricingConfigs = pgTable(\"pricing_configs\", {\n  id: varchar(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  category: varchar(\"category\").notNull(),\n  duration: varchar(\"duration\").notNull(),\n  price: varchar(\"price\").notNull(),\n  personCount: integer(\"person_count\").notNull().default(1),\n});\n\nexport const insertPricingConfigSchema = createInsertSchema(pricingConfigs).omit({ id: true }).refine(\n  (data) => {\n    // Only PS5 category can have personCount > 1, all others must be 1\n    if (data.category !== \"PS5\" && data.personCount && data.personCount > 1) {\n      return false;\n    }\n    return true;\n  },\n  {\n    message: \"Only PS5 category can have person count greater than 1\",\n    path: [\"personCount\"],\n  }\n);\nexport type InsertPricingConfig = z.infer<typeof insertPricingConfigSchema>;\nexport type PricingConfig = typeof pricingConfigs.$inferSelect;\n\nexport const happyHoursConfigs = pgTable(\"happy_hours_configs\", {\n  id: varchar(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  category: varchar(\"category\").notNull(),\n  startTime: varchar(\"start_time\").notNull(), // e.g., \"14:00\"\n  endTime: varchar(\"end_time\").notNull(), // e.g., \"18:00\"\n  enabled: integer(\"enabled\").notNull().default(1), // 1 = enabled, 0 = disabled\n});\n\nexport const insertHappyHoursConfigSchema = createInsertSchema(happyHoursConfigs).omit({ id: true });\nexport type InsertHappyHoursConfig = z.infer<typeof insertHappyHoursConfigSchema>;\nexport type HappyHoursConfig = typeof happyHoursConfigs.$inferSelect;\n\nexport const happyHoursPricing = pgTable(\"happy_hours_pricing\", {\n  id: varchar(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  category: varchar(\"category\").notNull(),\n  duration: varchar(\"duration\").notNull(),\n  price: varchar(\"price\").notNull(),\n  personCount: integer(\"person_count\").notNull().default(1),\n});\n\nexport const insertHappyHoursPricingSchema = createInsertSchema(happyHoursPricing).omit({ id: true }).refine(\n  (data) => {\n    // Only PS5 category can have personCount > 1, all others must be 1\n    if (data.category !== \"PS5\" && data.personCount && data.personCount > 1) {\n      return false;\n    }\n    return true;\n  },\n  {\n    message: \"Only PS5 category can have person count greater than 1\",\n    path: [\"personCount\"],\n  }\n);\nexport type InsertHappyHoursPricing = z.infer<typeof insertHappyHoursPricingSchema>;\nexport type HappyHoursPricing = typeof happyHoursPricing.$inferSelect;\n\n\nexport const bookingHistory = pgTable(\"booking_history\", {\n  id: varchar(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  bookingId: varchar(\"booking_id\").notNull(),\n  bookingCode: varchar(\"booking_code\"), // Human-readable booking code\n  groupId: varchar(\"group_id\"), // Group reference\n  groupCode: varchar(\"group_code\"), // Human-readable group code\n  category: varchar(\"category\").notNull(),\n  seatNumber: integer(\"seat_number\").notNull(),\n  seatName: varchar(\"seat_name\").notNull(),\n  customerName: varchar(\"customer_name\").notNull(),\n  whatsappNumber: varchar(\"whatsapp_number\"),\n  startTime: timestamp(\"start_time\").notNull(),\n  endTime: timestamp(\"end_time\").notNull(),\n  price: varchar(\"price\").notNull(),\n  status: varchar(\"status\").notNull(),\n  bookingType: text(\"booking_type\").array().notNull(),\n  pausedRemainingTime: integer(\"paused_remaining_time\"),\n  personCount: integer(\"person_count\").notNull().default(1),\n  paymentMethod: varchar(\"payment_method\"),\n  cashAmount: varchar(\"cash_amount\"),\n  upiAmount: varchar(\"upi_amount\"),\n  paymentStatus: varchar(\"payment_status\").notNull().default(\"unpaid\"),\n  lastPaymentAction: jsonb(\"last_payment_action\").$type<{\n    previousStatus?: string;\n    previousMethod?: string | null;\n    timestamp?: string;\n    userId?: string;\n  } | null>(),\n  foodOrders: jsonb(\"food_orders\").$type<Array<{\n    foodId: string;\n    foodName: string;\n    price: string;\n    quantity: number;\n  }>>().default([]),\n  originalPrice: varchar(\"original_price\"),\n  discountApplied: varchar(\"discount_applied\"),\n  bonusHoursApplied: varchar(\"bonus_hours_applied\"),\n  promotionDetails: jsonb(\"promotion_details\").$type<{\n    discountPercentage?: number;\n    discountAmount?: string;\n    bonusHours?: string;\n  }>(),\n  isPromotionalDiscount: integer(\"is_promotional_discount\").default(0),\n  isPromotionalBonus: integer(\"is_promotional_bonus\").default(0),\n  manualDiscountPercentage: integer(\"manual_discount_percentage\"),\n  manualFreeHours: varchar(\"manual_free_hours\"),\n  discount: varchar(\"discount\"),\n  bonus: varchar(\"bonus\"),\n  createdAt: timestamp(\"created_at\").notNull(),\n  archivedAt: timestamp(\"archived_at\").notNull().defaultNow(),\n});\n\nexport const insertBookingHistorySchema = createInsertSchema(bookingHistory).omit({ id: true, archivedAt: true });\nexport type InsertBookingHistory = z.infer<typeof insertBookingHistorySchema>;\nexport type BookingHistory = typeof bookingHistory.$inferSelect;\n\n// User storage table - supports staff/admin authentication\nexport const users = pgTable(\"users\", {\n  // IMPORTANT: Keep default() for existing ID compatibility\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  \n  // Staff/Admin auth fields\n  username: varchar(\"username\").unique(),\n  passwordHash: varchar(\"password_hash\"),\n  role: varchar(\"role\"),\n  onboardingCompleted: integer(\"onboarding_completed\").default(0),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  \n  // Timestamps\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Insert schema for staff/admin users (with username/password)\nexport const insertUserSchema = createInsertSchema(users).omit({ id: true, createdAt: true, updatedAt: true, passwordHash: true }).extend({\n  password: z.string()\n    .min(8, \"Password must be at least 8 characters\")\n    .regex(/[A-Za-z]/, \"Password must contain at least one letter\")\n    .regex(/[0-9]/, \"Password must contain at least one number\"),\n  username: z.string()\n    .min(3, \"Username must be at least 3 characters\")\n    .max(50, \"Username must be at most 50 characters\")\n    .regex(/^[a-zA-Z0-9_-]+$/, \"Username can only contain letters, numbers, underscores, and hyphens\"),\n});\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\n\n// UpsertUser type for Replit Auth (upserts user on login)\nexport type UpsertUser = typeof users.$inferInsert;\n\nexport const loginSchema = z.object({\n  username: z.string().min(1, \"Username is required\"),\n  password: z.string().min(1, \"Password is required\"),\n});\n\nexport const updateProfileSchema = z.object({\n  username: z.string()\n    .min(3, \"Username must be at least 3 characters\")\n    .max(50, \"Username must be at most 50 characters\")\n    .regex(/^[a-zA-Z0-9_-]+$/, \"Username can only contain letters, numbers, underscores, and hyphens\")\n    .optional(),\n});\n\nexport const updatePasswordSchema = z.object({\n  currentPassword: z.string().min(1, \"Current password is required\"),\n  newPassword: z.string()\n    .min(8, \"Password must be at least 8 characters\")\n    .regex(/[A-Za-z]/, \"Password must contain at least one letter\")\n    .regex(/[0-9]/, \"Password must contain at least one number\"),\n  confirmPassword: z.string().min(1, \"Please confirm your password\"),\n}).refine((data) => data.newPassword === data.confirmPassword, {\n  message: \"Passwords don't match\",\n  path: [\"confirmPassword\"],\n});\n\nexport const createStaffSchema = z.object({\n  username: z.string()\n    .min(3, \"Username must be at least 3 characters\")\n    .max(50, \"Username must be at most 50 characters\")\n    .regex(/^[a-zA-Z0-9_-]+$/, \"Username can only contain letters, numbers, underscores, and hyphens\"),\n  password: z.string()\n    .min(8, \"Password must be at least 8 characters\")\n    .regex(/[A-Za-z]/, \"Password must contain at least one letter\")\n    .regex(/[0-9]/, \"Password must contain at least one number\"),\n});\n\nexport type UpdateProfile = z.infer<typeof updateProfileSchema>;\nexport type UpdatePassword = z.infer<typeof updatePasswordSchema>;\nexport type CreateStaff = z.infer<typeof createStaffSchema>;\n\nexport const expenses = pgTable(\"expenses\", {\n  id: varchar(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  category: varchar(\"category\").notNull(),\n  description: text(\"description\").notNull(),\n  amount: varchar(\"amount\").notNull(),\n  date: timestamp(\"date\").notNull(),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertExpenseSchema = createInsertSchema(expenses).omit({ id: true, createdAt: true }).extend({\n  date: z.union([z.string(), z.date()]).transform(val => typeof val === 'string' ? new Date(val) : val),\n  amount: z.string().refine(val => !isNaN(parseFloat(val)) && parseFloat(val) > 0, {\n    message: \"Amount must be a valid positive number\"\n  }),\n});\nexport type InsertExpense = z.infer<typeof insertExpenseSchema>;\nexport type Expense = typeof expenses.$inferSelect;\n\nexport const activityLogs = pgTable(\"activity_logs\", {\n  id: varchar(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  userId: varchar(\"user_id\").notNull(),\n  username: varchar(\"username\").notNull(),\n  userRole: varchar(\"user_role\").notNull(),\n  action: varchar(\"action\").notNull(), // 'create', 'update', 'delete', 'login'\n  entityType: varchar(\"entity_type\"), // 'booking', 'food', 'config', etc.\n  entityId: varchar(\"entity_id\"),\n  details: text(\"details\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertActivityLogSchema = createInsertSchema(activityLogs).omit({ id: true, createdAt: true });\nexport type InsertActivityLog = z.infer<typeof insertActivityLogSchema>;\nexport type ActivityLog = typeof activityLogs.$inferSelect;\n\nexport const notifications = pgTable(\"notifications\", {\n  id: varchar(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  type: varchar(\"type\").notNull(),\n  title: varchar(\"title\").notNull(),\n  message: text(\"message\").notNull(),\n  entityType: varchar(\"entity_type\"),\n  entityId: varchar(\"entity_id\"),\n  activityLogId: varchar(\"activity_log_id\"),\n  isRead: integer(\"is_read\").notNull().default(0),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertNotificationSchema = createInsertSchema(notifications).omit({ id: true, createdAt: true });\nexport type InsertNotification = z.infer<typeof insertNotificationSchema>;\nexport type Notification = typeof notifications.$inferSelect;\n\nexport const gamingCenterInfo = pgTable(\"gaming_center_info\", {\n  id: varchar(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  name: varchar(\"name\").notNull(),\n  description: text(\"description\").notNull(),\n  address: text(\"address\").notNull(),\n  phone: varchar(\"phone\").notNull(),\n  email: varchar(\"email\"),\n  hours: text(\"hours\").notNull(),\n  timezone: varchar(\"timezone\").notNull().default(\"Asia/Kolkata\"),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const insertGamingCenterInfoSchema = createInsertSchema(gamingCenterInfo).omit({ id: true, updatedAt: true });\nexport type InsertGamingCenterInfo = z.infer<typeof insertGamingCenterInfoSchema>;\nexport type GamingCenterInfo = typeof gamingCenterInfo.$inferSelect;\n\nexport const galleryImages = pgTable(\"gallery_images\", {\n  id: varchar(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  title: varchar(\"title\").notNull(),\n  imageUrl: text(\"image_url\").notNull(),\n  description: text(\"description\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertGalleryImageSchema = createInsertSchema(galleryImages).omit({ id: true, createdAt: true });\nexport type InsertGalleryImage = z.infer<typeof insertGalleryImageSchema>;\nexport type GalleryImage = typeof galleryImages.$inferSelect;\n\nexport const facilities = pgTable(\"facilities\", {\n  id: varchar(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  name: varchar(\"name\").notNull(),\n  description: text(\"description\").notNull(),\n  icon: varchar(\"icon\").notNull(),\n});\n\nexport const insertFacilitySchema = createInsertSchema(facilities).omit({ id: true });\nexport type InsertFacility = z.infer<typeof insertFacilitySchema>;\nexport type Facility = typeof facilities.$inferSelect;\n\nexport const games = pgTable(\"games\", {\n  id: varchar(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  name: varchar(\"name\").notNull(),\n  description: text(\"description\"),\n  imageUrl: text(\"image_url\"),\n  category: varchar(\"category\").notNull(),\n});\n\nexport const insertGameSchema = createInsertSchema(games).omit({ id: true });\nexport type InsertGame = z.infer<typeof insertGameSchema>;\nexport type Game = typeof games.$inferSelect;\n\nexport const loadMetrics = pgTable(\"load_metrics\", {\n  id: varchar(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  timestamp: timestamp(\"timestamp\").notNull().defaultNow(),\n  activeSessions: integer(\"active_sessions\").notNull().default(0),\n  avgSessionLength: integer(\"avg_session_length\").notNull().default(0),\n  foodOrders: integer(\"food_orders\").notNull().default(0),\n  capacityUtilization: integer(\"capacity_utilization\").notNull().default(0),\n});\n\nexport const insertLoadMetricSchema = createInsertSchema(loadMetrics).omit({ id: true, timestamp: true });\nexport type InsertLoadMetric = z.infer<typeof insertLoadMetricSchema>;\nexport type LoadMetric = typeof loadMetrics.$inferSelect;\n\nexport const loadPredictions = pgTable(\"load_predictions\", {\n  id: varchar(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  timestamp: timestamp(\"timestamp\").notNull().defaultNow(),\n  horizon: varchar(\"horizon\").notNull(),\n  predictedLoad: integer(\"predicted_load\").notNull(),\n  modelVersion: varchar(\"model_version\").notNull(),\n  features: jsonb(\"features\").$type<Record<string, any>>().default({}),\n});\n\nexport const insertLoadPredictionSchema = createInsertSchema(loadPredictions).omit({ id: true, timestamp: true });\nexport type InsertLoadPrediction = z.infer<typeof insertLoadPredictionSchema>;\nexport type LoadPrediction = typeof loadPredictions.$inferSelect;\n\nexport const retentionConfig = pgTable(\"retention_config\", {\n  id: varchar(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  // ALL DATA KEPT FOREVER - Owner requirement for business records\n  // 36500 days = 100 years (effectively permanent storage)\n  bookingHistoryDays: integer(\"booking_history_days\").notNull().default(36500),\n  activityLogsDays: integer(\"activity_logs_days\").notNull().default(36500),\n  loadMetricsDays: integer(\"load_metrics_days\").notNull().default(36500),\n  loadPredictionsDays: integer(\"load_predictions_days\").notNull().default(36500),\n  expensesDays: integer(\"expenses_days\").notNull().default(36500),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const insertRetentionConfigSchema = createInsertSchema(retentionConfig).omit({ id: true, updatedAt: true });\nexport type InsertRetentionConfig = z.infer<typeof insertRetentionConfigSchema>;\nexport type RetentionConfig = typeof retentionConfig.$inferSelect;\n\nexport const deviceMaintenance = pgTable(\"device_maintenance\", {\n  id: varchar(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  category: varchar(\"category\").notNull(),\n  seatName: varchar(\"seat_name\").notNull(),\n  lastMaintenanceDate: timestamp(\"last_maintenance_date\"),\n  totalUsageHours: real(\"total_usage_hours\").notNull().default(0),\n  totalSessions: integer(\"total_sessions\").notNull().default(0),\n  issuesReported: integer(\"issues_reported\").notNull().default(0),\n  maintenanceNotes: text(\"maintenance_notes\"),\n  status: varchar(\"status\").notNull().default(\"healthy\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const insertDeviceMaintenanceSchema = createInsertSchema(deviceMaintenance).omit({ id: true, createdAt: true, updatedAt: true });\nexport type InsertDeviceMaintenance = z.infer<typeof insertDeviceMaintenanceSchema>;\nexport type DeviceMaintenance = typeof deviceMaintenance.$inferSelect;\n\n// Staff visibility settings - controls what staff members can see\nexport const staffVisibilitySettings = pgTable(\"staff_visibility_settings\", {\n  id: varchar(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  // Page visibility - which pages staff can access\n  pages: jsonb(\"pages\").$type<{\n    dashboard: boolean;\n    bookings: boolean;\n    history: boolean;\n    food: boolean;\n    inventory: boolean;\n    expenses: boolean;\n    ledger: boolean;\n    analytics: boolean;\n    maintenance: boolean;\n    settings: boolean;\n  }>().notNull().default({\n    dashboard: true,\n    bookings: true,\n    history: true,\n    food: true,\n    inventory: false,\n    expenses: false,\n    ledger: false,\n    analytics: false,\n    maintenance: false,\n    settings: false,\n  }),\n  // Element visibility - which UI elements staff can see\n  elements: jsonb(\"elements\").$type<{\n    customerPhone: boolean;\n    paymentDetails: boolean;\n    revenueNumbers: boolean;\n    expenseAmounts: boolean;\n    profitLoss: boolean;\n    costPrices: boolean;\n  }>().notNull().default({\n    customerPhone: true,\n    paymentDetails: true,\n    revenueNumbers: false,\n    expenseAmounts: false,\n    profitLoss: false,\n    costPrices: false,\n  }),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\nexport const insertStaffVisibilitySettingsSchema = createInsertSchema(staffVisibilitySettings).omit({ id: true, updatedAt: true });\nexport type InsertStaffVisibilitySettings = z.infer<typeof insertStaffVisibilitySettingsSchema>;\nexport type StaffVisibilitySettings = typeof staffVisibilitySettings.$inferSelect;\n\n// Type for the visibility pages\nexport type VisibilityPages = NonNullable<StaffVisibilitySettings['pages']>;\nexport type VisibilityElements = NonNullable<StaffVisibilitySettings['elements']>;\n\nexport const paymentLogs = pgTable(\"payment_logs\", {\n  id: varchar(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  bookingId: varchar(\"booking_id\").notNull(),\n  seatName: varchar(\"seat_name\").notNull(),\n  customerName: varchar(\"customer_name\").notNull(),\n  amount: varchar(\"amount\").notNull(),\n  paymentMethod: varchar(\"payment_method\").notNull(),\n  paymentStatus: varchar(\"payment_status\").notNull(),\n  userId: varchar(\"user_id\").notNull(),\n  username: varchar(\"username\").notNull(),\n  previousStatus: varchar(\"previous_status\"),\n  previousMethod: varchar(\"previous_method\"),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\nexport const insertPaymentLogSchema = createInsertSchema(paymentLogs).omit({ id: true, createdAt: true });\nexport type InsertPaymentLog = z.infer<typeof insertPaymentLogSchema>;\nexport type PaymentLog = typeof paymentLogs.$inferSelect;\n\n\n","path":null,"size_bytes":25966,"size_tokens":null},"client/src/components/ParallelogramCard.tsx":{"content":"import { ReactNode } from \"react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface ParallelogramCardProps {\n  icon: ReactNode;\n  title: string;\n  description: string;\n  className?: string;\n  iconColor?: string;\n  testId?: string;\n}\n\nexport function ParallelogramCard({\n  icon,\n  title,\n  description,\n  className,\n  iconColor = \"text-primary\",\n  testId\n}: ParallelogramCardProps) {\n  return (\n    <div \n      className={cn(\n        \"relative group overflow-hidden\",\n        className\n      )}\n      data-testid={testId}\n    >\n      <div className=\"absolute inset-0 bg-gradient-to-br from-card/90 to-card/60 backdrop-blur-sm border border-border/50 transform skew-x-[-2deg] group-hover:border-primary/50 transition-all duration-300 group-hover:shadow-lg group-hover:shadow-primary/20\"></div>\n      \n      <div className=\"relative p-6 md:p-8 flex flex-col gap-4\">\n        <div className={cn(\"w-12 h-12 md:w-14 md:h-14\", iconColor)}>\n          {icon}\n        </div>\n        \n        <div className=\"space-y-2\">\n          <h3 className=\"text-xl md:text-2xl font-bold tracking-tight uppercase\">\n            {title}\n          </h3>\n          <p className=\"text-sm md:text-base text-muted-foreground leading-relaxed\">\n            {description}\n          </p>\n        </div>\n      </div>\n\n      <div className=\"absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-primary/10 to-transparent blur-2xl group-hover:from-primary/20 transition-all duration-300\"></div>\n    </div>\n  );\n}","path":null,"size_bytes":1472,"size_tokens":null},"client/src/components/EndSessionDialog.tsx":{"content":"import {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\n\ninterface EndSessionDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  seatName: string;\n  customerName?: string;\n  onConfirm?: () => void;\n}\n\nexport function EndSessionDialog({\n  open,\n  onOpenChange,\n  seatName,\n  customerName,\n  onConfirm,\n}: EndSessionDialogProps) {\n  const handleConfirm = () => {\n    if (onConfirm) {\n      onConfirm();\n    }\n    onOpenChange(false);\n  };\n\n  return (\n    <AlertDialog open={open} onOpenChange={onOpenChange}>\n      <AlertDialogContent className=\"w-[95vw] sm:w-full max-w-md p-4 sm:p-6\" data-testid=\"dialog-end-session\">\n        <AlertDialogHeader>\n          <AlertDialogTitle className=\"text-base sm:text-lg\">End Session</AlertDialogTitle>\n          <AlertDialogDescription className=\"text-xs sm:text-sm\">\n            Are you sure you want to end the session for {seatName}\n            {customerName && ` (${customerName})`}? This action cannot be undone.\n          </AlertDialogDescription>\n        </AlertDialogHeader>\n        <AlertDialogFooter className=\"flex-col-reverse sm:flex-row gap-2 sm:gap-0\">\n          <AlertDialogCancel data-testid=\"button-cancel-end\" className=\"w-full sm:w-auto mt-0\">Cancel</AlertDialogCancel>\n          <AlertDialogAction onClick={handleConfirm} data-testid=\"button-confirm-end\" className=\"w-full sm:w-auto\">\n            End Session\n          </AlertDialogAction>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  );\n}\n","path":null,"size_bytes":1660,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card glass-card text-card-foreground\",\n      !className?.includes('shape-') && 'rounded-2xl',\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","path":null,"size_bytes":1915,"size_tokens":null},"client/src/components/StatusBadge.tsx":{"content":"import { Badge } from \"@/components/ui/badge\";\nimport { Circle } from \"lucide-react\";\n\ntype Status = \"available\" | \"running\" | \"expired\" | \"upcoming\" | \"completed\" | \"paused\";\n\ninterface StatusBadgeProps {\n  status: Status;\n}\n\nconst statusConfig = {\n  available: {\n    label: \"Available\",\n    className: \"bg-chart-4/20 text-chart-4 border-chart-4/30\",\n    dotClassName: \"text-chart-4\",\n  },\n  running: {\n    label: \"Running\",\n    className: \"bg-chart-5/20 text-chart-5 border-chart-5/30\",\n    dotClassName: \"text-chart-5\",\n  },\n  paused: {\n    label: \"Paused\",\n    className: \"bg-yellow-500/20 text-yellow-600 border-yellow-500/30\",\n    dotClassName: \"text-yellow-600\",\n  },\n  expired: {\n    label: \"Expired\",\n    className: \"bg-destructive/20 text-destructive border-destructive/30\",\n    dotClassName: \"text-destructive\",\n  },\n  upcoming: {\n    label: \"Upcoming\",\n    className: \"bg-chart-2/20 text-chart-2 border-chart-2/30\",\n    dotClassName: \"text-chart-2\",\n  },\n  completed: {\n    label: \"Completed\",\n    className: \"bg-green-500/20 text-green-600 border-green-500/30\",\n    dotClassName: \"text-green-600\",\n  },\n};\n\nexport function StatusBadge({ status }: StatusBadgeProps) {\n  const config = statusConfig[status];\n\n  return (\n    <Badge variant=\"outline\" className={config.className} data-testid={`badge-${status}`}>\n      <Circle className={`mr-1 h-2 w-2 fill-current ${config.dotClassName}`} />\n      {config.label}\n    </Badge>\n  );\n}\n","path":null,"size_bytes":1443,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"server/security.ts":{"content":"import { storage } from \"./storage\";\nimport type { Request, Response, NextFunction } from \"express\";\n\nexport interface SecurityEvent {\n  userId?: string;\n  username?: string;\n  action: string;\n  resource: string;\n  ip?: string;\n  userAgent?: string;\n  success: boolean;\n  details?: string;\n}\n\nexport async function logSecurityEvent(event: SecurityEvent) {\n  const timestamp = new Date().toISOString();\n  console.log(`[SECURITY] ${timestamp} - ${event.action} on ${event.resource} by ${event.username || 'anonymous'} from IP ${event.ip} - ${event.success ? 'SUCCESS' : 'FAILED'}${event.details ? ` - ${event.details}` : ''}`);\n  \n  if (event.userId && event.username) {\n    try {\n      await storage.createActivityLog({\n        userId: event.userId,\n        username: event.username,\n        userRole: 'staff',\n        action: event.action,\n        entityType: event.resource,\n        entityId: null,\n        details: `${event.action} on ${event.resource} from IP ${event.ip} - ${event.success ? 'SUCCESS' : 'FAILED'}${event.details ? ` - ${event.details}` : ''}`\n      });\n    } catch (error) {\n      console.error('Failed to log security event to database:', error);\n    }\n  }\n}\n\nexport function securityAuditMiddleware(action: string, resource: string) {\n  return async (req: Request, res: Response, next: NextFunction) => {\n    const originalJson = res.json.bind(res);\n    let responseSent = false;\n\n    res.json = function (body: any) {\n      if (!responseSent) {\n        responseSent = true;\n        const success = res.statusCode >= 200 && res.statusCode < 300;\n        \n        logSecurityEvent({\n          userId: req.session?.userId,\n          username: req.session?.username || 'anonymous',\n          action,\n          resource,\n          ip: req.ip || req.socket.remoteAddress,\n          userAgent: req.headers['user-agent'],\n          success,\n          details: success ? undefined : body.message\n        }).catch(err => console.error('Security audit error:', err));\n      }\n      return originalJson(body);\n    };\n\n    next();\n  };\n}\n\n// Validate SESSION_SECRET at module load time\nif (!process.env.SESSION_SECRET) {\n  if (process.env.NODE_ENV === 'production') {\n    throw new Error('SESSION_SECRET environment variable is required in production');\n  }\n  console.warn('‚ö†Ô∏è  WARNING: SESSION_SECRET not set - using insecure default. Set SESSION_SECRET for production!');\n}\n\nexport const SecurityConfig = {\n  session: {\n    secret: process.env.SESSION_SECRET || 'insecure-dev-secret-change-in-production',\n    maxAge: 7 * 24 * 60 * 60 * 1000, // 1 week\n    secure: process.env.NODE_ENV === 'production',\n    httpOnly: true,\n    sameSite: 'strict' as const,\n  },\n  \n  rateLimit: {\n    login: {\n      windowMs: 15 * 60 * 1000,\n      max: 5,\n    },\n    webhook: {\n      windowMs: 1 * 60 * 1000,\n      max: 30,\n    },\n    publicApi: {\n      windowMs: 1 * 60 * 1000,\n      max: 60,\n    },\n    sensitiveOps: {\n      windowMs: 1 * 60 * 1000,\n      max: 20,\n    },\n    dataExport: {\n      windowMs: 5 * 60 * 1000,\n      max: 10,\n    },\n  },\n  \n  password: {\n    minLength: 12,\n    requireUppercase: true,\n    requireLowercase: true,\n    requireNumbers: true,\n    requireSpecialChars: true,\n    saltRounds: 12,\n    maxLoginAttempts: 5,\n    lockoutDurationMinutes: 15,\n  },\n  \n  cors: {\n    allowedOrigins: process.env.ALLOWED_ORIGINS?.split(',') || ['http://localhost:5000'],\n    credentials: true,\n  },\n  \n  security: {\n    enforceHttps: process.env.NODE_ENV === 'production',\n    requestSizeLimit: '1mb',\n    sessionRegenerationOnLogin: true,\n    logFailedAttempts: true,\n  },\n};\n\n// Password validation function\nexport function validatePasswordStrength(password: string): { valid: boolean; errors: string[] } {\n  const errors: string[] = [];\n  const config = SecurityConfig.password;\n  \n  if (password.length < config.minLength) {\n    errors.push(`Password must be at least ${config.minLength} characters long`);\n  }\n  \n  if (config.requireUppercase && !/[A-Z]/.test(password)) {\n    errors.push('Password must contain at least one uppercase letter');\n  }\n  \n  if (config.requireLowercase && !/[a-z]/.test(password)) {\n    errors.push('Password must contain at least one lowercase letter');\n  }\n  \n  if (config.requireNumbers && !/\\d/.test(password)) {\n    errors.push('Password must contain at least one number');\n  }\n  \n  if (config.requireSpecialChars && !/[!@#$%^&*()_+\\-=\\[\\]{};':\"\\\\|,.<>\\/?]/.test(password)) {\n    errors.push('Password must contain at least one special character');\n  }\n  \n  return {\n    valid: errors.length === 0,\n    errors\n  };\n}\n\n// Input sanitization to prevent XSS\nexport function sanitizeInput(input: string): string {\n  if (typeof input !== 'string') return '';\n  \n  return input\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#x27;')\n    .replace(/\\//g, '&#x2F;')\n    .trim();\n}\n\n// Validate email format\nexport function isValidEmail(email: string): boolean {\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n  return emailRegex.test(email);\n}\n\n// Sanitize SQL-like inputs (additional layer on top of parameterized queries)\nexport function sanitizeSQLInput(input: string): string {\n  if (typeof input !== 'string') return '';\n  \n  // Remove common SQL injection patterns\n  return input\n    .replace(/;/g, '')\n    .replace(/--/g, '')\n    .replace(/\\/\\*/g, '')\n    .replace(/\\*\\//g, '')\n    .replace(/xp_/gi, '')\n    .replace(/sp_/gi, '')\n    .trim();\n}\n\nexport default SecurityConfig;\n","path":null,"size_bytes":5487,"size_tokens":null},"DOCUMENTATION.md":{"content":"# ANKYLO GAMING\n## Gaming Center POS System - Complete Feature Documentation\n\n---\n\n## üìã Overview\n\n**Ankylo Gaming POS** is a comprehensive local admin panel web application designed for managing gaming centers. It provides real-time tracking of gaming sessions, handles bookings, manages inventory, tracks expenses, and improves customer service in a gaming center environment.\n\n---\n\n## üõ† Technology Stack\n\n### Frontend\n- **React 18+** with TypeScript\n- **Vite** for development and build\n- **Wouter** for client-side routing\n- **TanStack React Query** for server state management\n- **Radix UI & shadcn/ui** components\n- **Tailwind CSS** with gaming-themed dark mode\n- **React Hook Form** with Zod validation\n\n### Backend\n- **Express.js** with TypeScript\n- **PostgreSQL** via Neon serverless\n- **Drizzle ORM** for type-safe database\n- **RESTful API** design\n- **Bcrypt** for password hashing\n- **Express-session** for authentication\n\n---\n\n## üéÆ Core Features\n\n### 1. Real-time Session Management\n- ‚úÖ Live tracking of gaming sessions across multiple device types (PC, PS5, VR, car simulators)\n- ‚úÖ Real-time countdown timers for active sessions\n- ‚úÖ Visual and audio notifications for expired sessions\n- ‚úÖ Dynamic seat availability display\n- ‚úÖ Category-based device organization\n- ‚úÖ Session pause and resume functionality\n- ‚úÖ Automatic session status updates\n\n### 2. Booking Management\n- ‚úÖ Walk-in booking creation with instant seat allocation\n- ‚úÖ Advance booking system with date/time selection\n- ‚úÖ Smart conflict detection to prevent double bookings\n- ‚úÖ Customer information management (name, WhatsApp number)\n- ‚úÖ Booking extension during active sessions\n- ‚úÖ Bulk booking operations (complete, delete multiple)\n- ‚úÖ Session history archival for completed bookings\n- ‚úÖ Filter and search capabilities\n\n### 3. Inventory & Food Management\n- ‚úÖ Food and beverage item catalog\n- ‚úÖ Dynamic pricing configuration\n- ‚úÖ Add food orders to active bookings\n- ‚úÖ Order quantity and price tracking\n- ‚úÖ Real-time order total calculation\n- ‚úÖ Food revenue analytics\n- ‚úÖ Item creation, editing, and deletion\n\n### 4. Financial Management\n- ‚úÖ Comprehensive expense tracking system\n- ‚úÖ Multiple expense categories:\n  - Rent\n  - Utilities\n  - Maintenance\n  - Food & Beverages\n  - Marketing\n  - Equipment\n  - Staff\n  - Miscellaneous\n- ‚úÖ Date-based expense recording\n- ‚úÖ Expense filtering by category and date range\n- ‚úÖ CSV export for accounting integration\n- ‚úÖ PDF export for expense reports\n- ‚úÖ Monthly and yearly expense summaries\n- ‚úÖ Revenue tracking from bookings and food orders\n\n---\n\n## üöÄ Advanced Features\n\n### 5. Analytics & Reporting\n- üìä Real-time occupancy monitoring\n- üìä Category-wise usage statistics\n- üìä Hourly booking patterns and trends\n- üìä Daily, weekly, and monthly revenue reports\n- üìä Unique customer tracking\n- üìä Average session duration analysis\n- üìä Food order statistics\n- üìä Capacity utilization metrics\n- üìä Interactive charts and visualizations\n- üìä Historical data comparison\n\n### 6. Loyalty Program\n- üéÅ Customer loyalty tier system (Bronze, Silver, Gold, Platinum)\n- üéÅ Points accumulation based on spending\n- üéÅ Automatic tier upgrades\n- üéÅ Redemption history tracking\n- üéÅ Visit count monitoring\n- üéÅ Total spend tracking per member\n- üéÅ WhatsApp-based member identification\n- üéÅ Configurable points per currency ratio\n- üéÅ Customizable tier thresholds\n- üéÅ Member analytics and insights\n\n### 7. Device Configuration & Pricing\n- ‚öôÔ∏è Dynamic device category management\n- ‚öôÔ∏è Custom seat naming (e.g., \"PC-1\", \"PS5-Pro\", \"VR-1\")\n- ‚öôÔ∏è Flexible pricing rules per category\n- ‚öôÔ∏è Duration-based pricing (30 min, 1 hour, 2 hours, etc.)\n- ‚öôÔ∏è Real-time seat availability updates\n- ‚öôÔ∏è Category-wise capacity configuration\n- ‚öôÔ∏è Pricing rule updates without downtime\n\n---\n\n## üë• Customer-Facing Features\n\n### 8. Public Status Board\n- üì∫ Real-time device availability display\n- üì∫ No authentication required (accessible at `/status`)\n- üì∫ Auto-refresh every 10 seconds\n- üì∫ Visual indicators (available/occupied)\n- üì∫ Category-wise seat counts\n- üì∫ Large display format for customer screens\n- üì∫ Gaming-themed interface\n\n### 9. WhatsApp Bot Integration\n- üí¨ Automated device availability queries\n- üí¨ Twilio WhatsApp API integration\n- üí¨ Real-time availability responses\n- üí¨ Customer inquiry handling\n- üí¨ Webhook-based message processing\n- üí¨ 24/7 automated customer service\n\n### 10. Consumer Website Pages\n- üè† Home page with gaming center information\n- üñºÔ∏è Photo gallery showcase\n- üéØ Facilities and amenities display\n- üéÆ Available games catalog\n- üìû Contact information and hours\n- üé® Gaming-themed UI design\n\n---\n\n## üîí Security & Access Control\n\n### 11. Authentication & Authorization\n- üîê Secure user authentication system\n- üîê Role-based access control (Admin and Staff roles)\n- üîê Bcrypt password hashing\n- üîê Session-based authentication\n- üîê Password strength validation\n- üîê Username uniqueness enforcement\n- üîê Secure login/logout functionality\n\n### 12. Device-Based Access Control\n- üíª **PC/Desktop**: Full access with all editing capabilities\n- üì± **Mobile/Tablet** (< 1024px): View-only mode for security\n- üíª Automatic device detection\n- üíª Visual alerts for restricted access\n- üíª Prevents accidental changes from mobile devices\n- üíª Optimized UX for different screen sizes\n\n### 13. Security Features\n- üõ°Ô∏è Rate limiting on public APIs\n- üõ°Ô∏è Helmet.js security headers\n- üõ°Ô∏è CORS configuration\n- üõ°Ô∏è SQL injection prevention via ORM\n- üõ°Ô∏è XSS protection\n- üõ°Ô∏è Secure session storage\n- üõ°Ô∏è Environment variable protection for secrets\n\n---\n\n## üë®‚Äçüíº Administrative Features\n\n### 14. User Management\n- üë§ Admin user creation and management\n- üë§ Staff user creation and management\n- üë§ Role assignment (Admin/Staff)\n- üë§ User activity logging\n- üë§ Login history tracking\n\n### 15. Activity Logging & Audit Trail\n- üìù Comprehensive activity logging system\n- üìù User action tracking (create, update, delete, login)\n- üìù Entity-specific logging (bookings, food items, configs)\n- üìù Timestamp recording for all activities\n- üìù User role and username tracking\n- üìù Audit trail for accountability\n\n---\n\n## üé® User Interface & Experience\n\n### 17. UI/UX Features\n- üåô Gaming-themed dark mode with cyan/teal accents\n- ‚òÄÔ∏è Light/dark theme toggle with persistence\n- üì± Responsive design for all screen sizes\n- ‚ôø Accessible components via Radix UI\n- ‚ú® Smooth animations and transitions\n- üîî Toast notifications for user feedback\n- ‚è≥ Loading states and skeleton screens\n- üß≠ Intuitive navigation with sidebar\n- üé® Status-based color coding (running, paused, expired)\n- üî£ Icon-based visual cues (Lucide icons)\n\n### 18. Data Visualization\n- üìà Real-time charts and graphs (Recharts)\n- üìà Occupancy rate visualizations\n- üìà Revenue trend analysis\n- üìà Category usage breakdown\n- üìà Hourly booking patterns\n- üìà Interactive data exploration\n- üìà Export capabilities (CSV, PDF)\n\n---\n\n## üóÑÔ∏è Database Schema\n\nThe application uses PostgreSQL with the following main entities:\n\n| Table | Description |\n|-------|-------------|\n| **Bookings** | Active gaming sessions with status, timing, pricing, and food orders |\n| **Booking History** | Archived bookings for historical analysis |\n| **Users** | Admin and staff user accounts with role-based access |\n| **Device Configs** | Dynamic device categories and seat configurations |\n| **Pricing Configs** | Pricing rules per category and duration |\n| **Food Items** | Available food and beverage catalog |\n| **Expenses** | Operational cost tracking by category |\n| **Activity Logs** | User action audit trail |\n| **Loyalty Members** | Customer loyalty program participants |\n| **Loyalty Events** | Points and tier change history |\n| **Loyalty Config** | Loyalty program settings and thresholds |\n| **Game Updates** | Latest game news and updates |\n| **Gaming Center Info** | Center details and contact information |\n| **Gallery Images** | Photo gallery for consumer website |\n| **Facilities** | Amenities and facilities information |\n| **Games** | Available games catalog |\n\n---\n\n## üîå API Endpoints Overview\n\n### Authentication\n- `POST /api/auth/login`\n- `POST /api/auth/logout`\n- `GET /api/auth/me`\n\n### Bookings\n- `GET /api/bookings`\n- `POST /api/bookings`\n- `PATCH /api/bookings/:id`\n- `DELETE /api/bookings/:id`\n- `GET /api/bookings/available-seats`\n- `POST /api/bookings/archive`\n\n### Analytics\n- `GET /api/analytics/usage`\n- `GET /api/reports/stats`\n- `GET /api/reports/history`\n\n### Configuration\n- `GET /api/device-config`\n- `POST /api/device-config`\n- `DELETE /api/device-config/:category`\n- `GET /api/pricing-config`\n- `POST /api/pricing-config`\n\n### Food & Inventory\n- `GET /api/food-items`\n- `POST /api/food-items`\n- `PATCH /api/food-items/:id`\n- `DELETE /api/food-items/:id`\n\n### Expenses\n- `GET /api/expenses`\n- `POST /api/expenses`\n- `PATCH /api/expenses/:id`\n- `DELETE /api/expenses/:id`\n\n### Loyalty Program\n- `GET /api/loyalty/members`\n- `POST /api/loyalty/members`\n- `GET /api/loyalty/config`\n- `POST /api/loyalty/config`\n\n### Public APIs\n- `GET /api/public/status`\n- `GET /api/whatsapp/availability`\n- `POST /api/whatsapp/webhook`\n\n---\n\n## üöÄ Deployment & Setup\n\n### Environment Requirements\n- Node.js 20+\n- PostgreSQL database (via Replit/Neon)\n- Environment variables:\n  - `ADMIN_USERNAME`\n  - `ADMIN_PASSWORD`\n  - `DATABASE_URL`\n\n### Running the Application\n```bash\n# Development\nnpm run dev          # Runs on port 5000\n\n# Build\nnpm run build\n\n# Production\nnpm run start\n\n# Database Push\nnpm run db:push\n```\n\n---\n\n## üí° Key Benefits\n\n‚ú® **Streamlined Operations** - Centralized management of all gaming center activities\n\nüìä **Real-time Monitoring** - Live tracking of sessions and availability\n\nüí∞ **Financial Control** - Comprehensive expense and revenue tracking\n\nüòä **Customer Satisfaction** - Automated WhatsApp bot and public status board\n\nüìà **Data-Driven Decisions** - Analytics and reporting for business insights\n\n‚ö° **Scalability** - Flexible device and pricing configuration\n\nüîí **Security** - Role-based access and device-based restrictions\n\nüéÅ **Loyalty Building** - Integrated customer loyalty program\n\nüé® **Professional Interface** - Modern, gaming-themed UI/UX\n\nüõ°Ô∏è **Type Safety** - Full-stack TypeScript for reliable code\n\n---\n\n## üìù Conclusion\n\n**Ankylo Gaming POS** is a comprehensive, modern solution for gaming center management. Built with cutting-edge technologies and following best practices, it provides all the tools necessary to run a successful gaming center efficiently.\n\nFrom real-time session tracking to financial management, customer loyalty programs, and automated customer service, this application covers every aspect of gaming center operations.\n\nThe application is designed to be user-friendly for staff while providing powerful administrative capabilities for management. With its responsive design, security features, and extensive analytics, Ankylo Gaming POS empowers gaming center owners to make data-driven decisions and provide exceptional customer experiences.\n\n---\n\n**Generated on:** October 13, 2025\n","path":null,"size_bytes":11341,"size_tokens":null},"client/src/components/HappyHoursPricing.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Pencil, Check, X, Plus, Trash2 } from \"lucide-react\";\n\ninterface PriceSlot {\n  duration: string;\n  price: number;\n  personCount?: number;\n}\n\ninterface HappyHoursPricingProps {\n  category: string;\n  slots: PriceSlot[];\n  onUpdateSlots?: (slots: PriceSlot[]) => void;\n}\n\nexport function HappyHoursPricing({ category, slots, onUpdateSlots }: HappyHoursPricingProps) {\n  const [editingIndex, setEditingIndex] = useState<number | null>(null);\n  const [editValue, setEditValue] = useState(\"\");\n  const [editDurationHours, setEditDurationHours] = useState(0);\n  const [editDurationMins, setEditDurationMins] = useState(0);\n  const [editPersonCount, setEditPersonCount] = useState(1);\n\n  const startEdit = (index: number) => {\n    setEditingIndex(index);\n    setEditValue(slots[index].price.toString());\n    const totalMins = getDurationMinutes(slots[index].duration);\n    setEditDurationHours(Math.floor(totalMins / 60));\n    setEditDurationMins(totalMins % 60);\n    setEditPersonCount(slots[index].personCount || 1);\n  };\n\n  const saveEdit = () => {\n    if (editingIndex !== null) {\n      const newSlots = [...slots];\n      const totalMins = editDurationHours * 60 + editDurationMins;\n      newSlots[editingIndex].price = parseInt(editValue) || 0;\n      newSlots[editingIndex].duration = getDurationString(totalMins);\n      // Only PS5 category can have personCount > 1, force others to 1\n      newSlots[editingIndex].personCount = category === \"PS5\" ? editPersonCount : 1;\n      onUpdateSlots?.(newSlots);\n      setEditingIndex(null);\n    }\n  };\n\n  const cancelEdit = () => {\n    setEditingIndex(null);\n    setEditValue(\"\");\n    setEditDurationHours(0);\n    setEditDurationMins(0);\n    setEditPersonCount(1);\n  };\n\n  const getDurationMinutes = (duration: string): number => {\n    const match = duration.match(/(\\d+)\\s*(mins?|hours?)/i);\n    if (!match) return 30;\n    const value = parseInt(match[1]);\n    const unit = match[2].toLowerCase();\n    return unit.startsWith('hour') ? value * 60 : value;\n  };\n\n  const getDurationString = (mins: number): string => {\n    if (mins < 60) return `${mins} mins`;\n    const hours = Math.floor(mins / 60);\n    const remainingMins = mins % 60;\n    if (remainingMins === 0) return hours === 1 ? \"1 hour\" : `${hours} hours`;\n    return `${hours} hour${hours > 1 ? 's' : ''} ${remainingMins} mins`;\n  };\n\n  const addSlot = () => {\n    if (slots.length === 0) {\n      const newSlots = [{ duration: \"30 mins\", price: 0, personCount: 1 }];\n      onUpdateSlots?.(newSlots);\n      return;\n    }\n    const lastSlot = slots[slots.length - 1];\n    const lastMins = getDurationMinutes(lastSlot.duration);\n    const newMins = lastMins + 30;\n    const newSlots = [...slots, { duration: getDurationString(newMins), price: 0, personCount: 1 }];\n    onUpdateSlots?.(newSlots);\n  };\n\n  const removeSlot = (index: number) => {\n    if (slots.length > 1) {\n      const newSlots = slots.filter((_, i) => i !== index);\n      onUpdateSlots?.(newSlots);\n    }\n  };\n\n  return (\n    <Card className=\"glass-card\" data-testid={`card-happy-hours-pricing-${category.toLowerCase()}`}>\n      <CardHeader>\n        <CardTitle>{category} Happy Hours Pricing</CardTitle>\n        <CardDescription>Set happy hours pricing for different time slots</CardDescription>\n      </CardHeader>\n      <CardContent>\n        <div className=\"space-y-2\">\n          {slots.map((slot, index) => (\n            <div\n              key={index}\n              className=\"rounded-md border p-3 lg:p-4 hover-elevate transition-all\"\n              data-testid={`row-happy-hours-pricing-${category.toLowerCase()}-${index}`}\n            >\n              {editingIndex === index ? (\n                <div className=\"flex flex-col gap-3\">\n                  <div className=\"flex flex-wrap items-center gap-2 lg:gap-3\">\n                    <div className=\"flex items-center gap-1.5\">\n                      <Input\n                        type=\"number\"\n                        min=\"0\"\n                        value={editDurationHours}\n                        onChange={(e) => setEditDurationHours(Math.max(0, parseInt(e.target.value) || 0))}\n                        className=\"w-16 lg:w-20 h-9 lg:h-10 text-center text-sm lg:text-base\"\n                        data-testid={`input-hh-duration-hours-${category.toLowerCase()}-${index}`}\n                      />\n                      <span className=\"text-xs lg:text-sm text-muted-foreground font-medium\">hr</span>\n                    </div>\n                    <div className=\"flex items-center gap-1.5\">\n                      <Input\n                        type=\"number\"\n                        min=\"0\"\n                        step=\"30\"\n                        value={editDurationMins}\n                        onChange={(e) => {\n                          const value = parseInt(e.target.value) || 0;\n                          setEditDurationMins(value >= 30 ? 30 : 0);\n                        }}\n                        className=\"w-16 lg:w-20 h-9 lg:h-10 text-center text-sm lg:text-base\"\n                        data-testid={`input-hh-duration-mins-${category.toLowerCase()}-${index}`}\n                      />\n                      <span className=\"text-xs lg:text-sm text-muted-foreground font-medium\">min</span>\n                    </div>\n                    {category === \"PS5\" && (\n                      <>\n                        <span className=\"text-xs lg:text-sm text-muted-foreground\">+</span>\n                        <div className=\"flex items-center gap-1.5\">\n                          <Input\n                            type=\"number\"\n                            min=\"1\"\n                            value={editPersonCount}\n                            onChange={(e) => setEditPersonCount(Math.max(1, parseInt(e.target.value) || 1))}\n                            className=\"w-16 lg:w-20 h-9 lg:h-10 text-center text-sm lg:text-base\"\n                            data-testid={`input-hh-person-count-${category.toLowerCase()}-${index}`}\n                          />\n                          <span className=\"text-xs lg:text-sm text-muted-foreground font-medium\">person</span>\n                        </div>\n                      </>\n                    )}\n                  </div>\n                  <div className=\"flex items-center gap-2 lg:gap-3\">\n                    <div className=\"flex items-center gap-1.5 lg:gap-2 flex-1\">\n                      <span className=\"text-sm lg:text-base text-muted-foreground font-semibold\">‚Çπ</span>\n                      <Input\n                        type=\"number\"\n                        value={editValue}\n                        onChange={(e) => setEditValue(e.target.value)}\n                        className=\"w-full max-w-[200px] h-9 lg:h-10 text-sm lg:text-base\"\n                        placeholder=\"Price\"\n                        data-testid={`input-hh-price-${category.toLowerCase()}-${index}`}\n                      />\n                    </div>\n                    <Button size=\"icon\" variant=\"ghost\" className=\"h-9 w-9 lg:h-10 lg:w-10 shrink-0 hover:bg-green-100 dark:hover:bg-green-900\" onClick={saveEdit} data-testid={`button-hh-save-${index}`}>\n                      <Check className=\"h-4 w-4 lg:h-5 lg:w-5\" />\n                    </Button>\n                    <Button size=\"icon\" variant=\"ghost\" className=\"h-9 w-9 lg:h-10 lg:w-10 shrink-0 hover:bg-red-100 dark:hover:bg-red-900\" onClick={cancelEdit} data-testid={`button-hh-cancel-${index}`}>\n                      <X className=\"h-4 w-4 lg:h-5 lg:w-5\" />\n                    </Button>\n                  </div>\n                </div>\n              ) : (\n                <div className=\"flex items-center justify-between gap-3\">\n                  <div className=\"text-sm lg:text-base font-medium flex-1\">\n                    {slot.duration}{category === \"PS5\" ? ` + ${slot.personCount || 1} person` : ''}\n                  </div>\n                  <div className=\"flex items-center gap-2 lg:gap-3\">\n                    <span className=\"font-bold text-primary text-lg lg:text-xl\" data-testid={`text-hh-price-${category.toLowerCase()}-${index}`}>\n                      ‚Çπ{slot.price}\n                    </span>\n                    <Button\n                      size=\"icon\"\n                      variant=\"ghost\"\n                      className=\"h-9 w-9 lg:h-10 lg:w-10 shrink-0 hover:bg-blue-100 dark:hover:bg-blue-900\"\n                      onClick={() => startEdit(index)}\n                      data-testid={`button-hh-edit-${category.toLowerCase()}-${index}`}\n                    >\n                      <Pencil className=\"h-4 w-4 lg:h-5 lg:w-5\" />\n                    </Button>\n                    {slots.length > 1 && (\n                      <Button\n                        size=\"icon\"\n                        variant=\"ghost\"\n                        className=\"h-9 w-9 lg:h-10 lg:w-10 shrink-0 hover:bg-red-100 dark:hover:bg-red-900\"\n                        onClick={() => removeSlot(index)}\n                        data-testid={`button-hh-remove-${category.toLowerCase()}-${index}`}\n                      >\n                        <Trash2 className=\"h-4 w-4 lg:h-5 lg:w-5\" />\n                      </Button>\n                    )}\n                  </div>\n                </div>\n              )}\n            </div>\n          ))}\n          <Button\n            variant=\"outline\"\n            className=\"w-full\"\n            onClick={addSlot}\n            data-testid={`button-hh-add-slot-${category.toLowerCase()}`}\n          >\n            <Plus className=\"mr-2 h-4 w-4\" />\n            Add Time Slot (+30 mins)\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":9843,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5741,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"client/src/hooks/useInstallPrompt.ts":{"content":"import { useState, useEffect } from 'react';\n\ninterface BeforeInstallPromptEvent extends Event {\n  prompt: () => Promise<void>;\n  userChoice: Promise<{ outcome: 'accepted' | 'dismissed' }>;\n}\n\nexport function useInstallPrompt() {\n  const [installPromptEvent, setInstallPromptEvent] = useState<BeforeInstallPromptEvent | null>(null);\n  const [isInstalled, setIsInstalled] = useState(false);\n\n  useEffect(() => {\n    // Check if app is already installed\n    const checkInstalled = () => {\n      // Check if running in standalone mode\n      if (window.matchMedia('(display-mode: standalone)').matches) {\n        setIsInstalled(true);\n        return true;\n      }\n      \n      // Check for iOS standalone\n      if ((window.navigator as any).standalone === true) {\n        setIsInstalled(true);\n        return true;\n      }\n      \n      return false;\n    };\n\n    if (checkInstalled()) {\n      return;\n    }\n\n    // Listen for the beforeinstallprompt event\n    const handleBeforeInstallPrompt = (e: Event) => {\n      // Prevent the mini-infobar from appearing on mobile\n      e.preventDefault();\n      // Save the event so it can be triggered later\n      setInstallPromptEvent(e as BeforeInstallPromptEvent);\n    };\n\n    // Listen for app installed event\n    const handleAppInstalled = () => {\n      setIsInstalled(true);\n      setInstallPromptEvent(null);\n    };\n\n    window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\n    window.addEventListener('appinstalled', handleAppInstalled);\n\n    return () => {\n      window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);\n      window.removeEventListener('appinstalled', handleAppInstalled);\n    };\n  }, []);\n\n  const promptToInstall = async () => {\n    if (!installPromptEvent) {\n      return false;\n    }\n\n    // Show the install prompt\n    installPromptEvent.prompt();\n\n    // Wait for the user to respond to the prompt\n    const { outcome } = await installPromptEvent.userChoice;\n\n    // Clear the saved prompt since it can't be used again\n    setInstallPromptEvent(null);\n\n    return outcome === 'accepted';\n  };\n\n  return {\n    installPromptEvent,\n    isInstalled,\n    canInstall: !!installPromptEvent && !isInstalled,\n    promptToInstall,\n  };\n}\n","path":null,"size_bytes":2238,"size_tokens":null},"client/src/hooks/useToastWithSound.ts":{"content":"import { useToast } from \"@/hooks/use-toast\";\nimport { useSoundAlert, type SoundType } from \"@/hooks/useSoundAlert\";\nimport { useCallback } from \"react\";\n\nexport function useToastWithSound() {\n  const { toast: originalToast } = useToast();\n  const { playSound } = useSoundAlert();\n\n  const toast = useCallback(\n    (props: Parameters<typeof originalToast>[0]) => {\n      // Determine sound type based on toast variant\n      let soundType: SoundType = 'info';\n      \n      const titleStr = typeof props.title === 'string' ? props.title : '';\n      const descStr = typeof props.description === 'string' ? props.description : '';\n      \n      if (props.variant === 'destructive') {\n        soundType = 'error';\n      } else if (titleStr.toLowerCase().includes('success') || \n                 descStr.toLowerCase().includes('success') ||\n                 titleStr.toLowerCase().includes('added') ||\n                 titleStr.toLowerCase().includes('created') ||\n                 titleStr.toLowerCase().includes('updated')) {\n        soundType = 'success';\n      } else if (titleStr.toLowerCase().includes('warning') || \n                 descStr.toLowerCase().includes('warning') ||\n                 titleStr.toLowerCase().includes('low stock')) {\n        soundType = 'warning';\n      }\n\n      // Play sound based on type\n      playSound(soundType);\n\n      // Call original toast\n      return originalToast(props);\n    },\n    [originalToast, playSound]\n  );\n\n  return { toast };\n}\n","path":null,"size_bytes":1476,"size_tokens":null},"electron/preload.ts":{"content":"import { contextBridge, ipcRenderer } from 'electron';\n\ncontextBridge.exposeInMainWorld('electronAPI', {\n  getAppVersion: () => ipcRenderer.invoke('get-app-version'),\n  getAppPath: () => ipcRenderer.invoke('get-app-path'),\n  showMessageBox: (options: any) => ipcRenderer.invoke('show-message-box', options),\n  showOpenDialog: (options: any) => ipcRenderer.invoke('show-open-dialog', options),\n  showSaveDialog: (options: any) => ipcRenderer.invoke('show-save-dialog', options),\n  platform: process.platform,\n  isElectron: true,\n});\n\ndeclare global {\n  interface Window {\n    electronAPI: {\n      getAppVersion: () => Promise<string>;\n      getAppPath: () => Promise<string>;\n      showMessageBox: (options: any) => Promise<any>;\n      showOpenDialog: (options: any) => Promise<any>;\n      showSaveDialog: (options: any) => Promise<any>;\n      platform: string;\n      isElectron: boolean;\n    };\n  }\n}\n","path":null,"size_bytes":901,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"client/src/lib/api.ts":{"content":"import type { Booking, InsertBooking, DeviceConfig, PricingConfig } from \"@shared/schema\";\nimport { localDb, isTauri } from './tauri-db';\n\nasync function parseErrorResponse(response: Response, fallbackMessage: string): Promise<string> {\n  try {\n    const contentType = response.headers.get(\"content-type\");\n    if (contentType && contentType.includes(\"application/json\")) {\n      const errorData = await response.json();\n      return errorData.message || fallbackMessage;\n    } else {\n      const text = await response.text();\n      return text || fallbackMessage;\n    }\n  } catch {\n    return fallbackMessage;\n  }\n}\n\nexport function getApiMode(): 'web' | 'tauri' {\n  return isTauri() ? 'tauri' : 'web';\n}\n\nexport async function fetchBookings(): Promise<Booking[]> {\n  if (isTauri()) {\n    return localDb.getAllBookings() as Promise<Booking[]>;\n  }\n  const response = await fetch(\"/api/bookings\", {\n    credentials: \"include\"\n  });\n  if (!response.ok) {\n    const message = await parseErrorResponse(response, \"Failed to fetch bookings\");\n    throw new Error(message);\n  }\n  return response.json();\n}\n\nexport async function fetchActiveBookings(): Promise<Booking[]> {\n  if (isTauri()) {\n    return localDb.getActiveBookings() as Promise<Booking[]>;\n  }\n  const response = await fetch(\"/api/bookings/active\", {\n    credentials: \"include\"\n  });\n  if (!response.ok) {\n    const message = await parseErrorResponse(response, \"Failed to fetch active bookings\");\n    throw new Error(message);\n  }\n  return response.json();\n}\n\nexport async function createBooking(booking: InsertBooking): Promise<Booking> {\n  if (isTauri()) {\n    return localDb.createBooking(booking) as Promise<Booking>;\n  }\n  const response = await fetch(\"/api/bookings\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify(booking),\n    credentials: \"include\"\n  });\n  if (!response.ok) {\n    const message = await parseErrorResponse(response, \"Failed to create booking\");\n    throw new Error(message);\n  }\n  return response.json();\n}\n\nexport async function updateBooking(id: string, data: Partial<InsertBooking>): Promise<Booking> {\n  if (isTauri()) {\n    return localDb.updateBooking(id, data) as Promise<Booking>;\n  }\n  const response = await fetch(`/api/bookings/${id}`, {\n    method: \"PATCH\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify(data),\n    credentials: \"include\"\n  });\n  if (!response.ok) {\n    const message = await parseErrorResponse(response, \"Failed to update booking\");\n    throw new Error(message);\n  }\n  return response.json();\n}\n\nexport async function deleteBooking(id: string): Promise<void> {\n  if (isTauri()) {\n    return localDb.deleteBooking(id);\n  }\n  const response = await fetch(`/api/bookings/${id}`, {\n    method: \"DELETE\",\n    credentials: \"include\"\n  });\n  if (!response.ok) {\n    const message = await parseErrorResponse(response, \"Failed to delete booking\");\n    throw new Error(message);\n  }\n}\n\nexport async function fetchDeviceConfigs(): Promise<DeviceConfig[]> {\n  if (isTauri()) {\n    return localDb.getAllDeviceConfigs() as Promise<DeviceConfig[]>;\n  }\n  const response = await fetch(\"/api/device-config\", {\n    credentials: \"include\"\n  });\n  if (!response.ok) {\n    const message = await parseErrorResponse(response, \"Failed to fetch device configs\");\n    throw new Error(message);\n  }\n  return response.json();\n}\n\nexport async function fetchPricingConfigs(): Promise<PricingConfig[]> {\n  if (isTauri()) {\n    return localDb.getAllPricingConfigs() as Promise<PricingConfig[]>;\n  }\n  const response = await fetch(\"/api/pricing-config\", {\n    credentials: \"include\"\n  });\n  if (!response.ok) {\n    const message = await parseErrorResponse(response, \"Failed to fetch pricing configs\");\n    throw new Error(message);\n  }\n  return response.json();\n}\n\nexport async function getServerTime(): Promise<Date> {\n  if (isTauri()) {\n    return new Date();\n  }\n  const response = await fetch(\"/api/server-time\", {\n    credentials: \"include\"\n  });\n  if (!response.ok) {\n    const message = await parseErrorResponse(response, \"Failed to fetch server time\");\n    throw new Error(message);\n  }\n  const data = await response.json();\n  return new Date(data.serverTime);\n}\n\nexport async function fetchFoodItems() {\n  if (isTauri()) {\n    return localDb.getAllFoodItems();\n  }\n  const response = await fetch(\"/api/food\", {\n    credentials: \"include\"\n  });\n  if (!response.ok) {\n    const message = await parseErrorResponse(response, \"Failed to fetch food items\");\n    throw new Error(message);\n  }\n  return response.json();\n}\n\nexport async function fetchExpenses() {\n  if (isTauri()) {\n    return localDb.getAllExpenses();\n  }\n  const response = await fetch(\"/api/expenses\", {\n    credentials: \"include\"\n  });\n  if (!response.ok) {\n    const message = await parseErrorResponse(response, \"Failed to fetch expenses\");\n    throw new Error(message);\n  }\n  return response.json();\n}\n\nexport async function fetchBookingHistory() {\n  if (isTauri()) {\n    return localDb.getBookingHistory();\n  }\n  const response = await fetch(\"/api/history\", {\n    credentials: \"include\"\n  });\n  if (!response.ok) {\n    const message = await parseErrorResponse(response, \"Failed to fetch booking history\");\n    throw new Error(message);\n  }\n  return response.json();\n}\n\nexport async function fetchActivityLogs() {\n  if (isTauri()) {\n    return localDb.getActivityLogs();\n  }\n  const response = await fetch(\"/api/activity-logs\", {\n    credentials: \"include\"\n  });\n  if (!response.ok) {\n    const message = await parseErrorResponse(response, \"Failed to fetch activity logs\");\n    throw new Error(message);\n  }\n  return response.json();\n}\n\nexport async function fetchNotifications() {\n  if (isTauri()) {\n    return localDb.getNotifications();\n  }\n  const response = await fetch(\"/api/notifications\", {\n    credentials: \"include\"\n  });\n  if (!response.ok) {\n    const message = await parseErrorResponse(response, \"Failed to fetch notifications\");\n    throw new Error(message);\n  }\n  return response.json();\n}\n\nexport async function fetchUnreadNotifications() {\n  if (isTauri()) {\n    return localDb.getUnreadNotifications();\n  }\n  const response = await fetch(\"/api/notifications/unread\", {\n    credentials: \"include\"\n  });\n  if (!response.ok) {\n    const message = await parseErrorResponse(response, \"Failed to fetch unread notifications\");\n    throw new Error(message);\n  }\n  return response.json();\n}\n\nexport async function fetchHappyHoursConfigs() {\n  if (isTauri()) {\n    return localDb.getAllHappyHoursConfigs();\n  }\n  const response = await fetch(\"/api/happy-hours-config\", {\n    credentials: \"include\"\n  });\n  if (!response.ok) {\n    const message = await parseErrorResponse(response, \"Failed to fetch happy hours configs\");\n    throw new Error(message);\n  }\n  return response.json();\n}\n\nexport async function fetchHappyHoursPricing() {\n  if (isTauri()) {\n    return localDb.getAllHappyHoursPricing();\n  }\n  const response = await fetch(\"/api/happy-hours-pricing\", {\n    credentials: \"include\"\n  });\n  if (!response.ok) {\n    const message = await parseErrorResponse(response, \"Failed to fetch happy hours pricing\");\n    throw new Error(message);\n  }\n  return response.json();\n}\n\nexport async function fetchGamingCenterInfo() {\n  if (isTauri()) {\n    return localDb.getGamingCenterInfo();\n  }\n  const response = await fetch(\"/api/gaming-center-info\", {\n    credentials: \"include\"\n  });\n  if (!response.ok) {\n    const message = await parseErrorResponse(response, \"Failed to fetch gaming center info\");\n    throw new Error(message);\n  }\n  return response.json();\n}\n\nexport { isTauri };\n","path":null,"size_bytes":7626,"size_tokens":null},"client/src/components/HappyHoursTable.tsx":{"content":"import { useState } from \"react\";\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Button } from \"@/components/ui/button\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Plus, Trash2 } from \"lucide-react\";\nimport { useAuth } from \"@/contexts/AuthContext\";\n\ninterface HappyHoursSlot {\n  startTime: string;\n  endTime: string;\n}\n\ninterface HappyHoursData {\n  enabled: boolean;\n  slots: HappyHoursSlot[];\n}\n\ninterface HappyHoursTableProps {\n  category: string;\n  enabled: boolean;\n  slots: HappyHoursSlot[];\n  onUpdate: (data: HappyHoursData) => void;\n}\n\nexport function HappyHoursTable({\n  category,\n  enabled: initialEnabled,\n  slots: initialSlots,\n  onUpdate,\n}: HappyHoursTableProps) {\n  const { isAdmin } = useAuth();\n  const [enabled, setEnabled] = useState(initialEnabled);\n  const [slots, setSlots] = useState<HappyHoursSlot[]>(\n    initialSlots.length > 0 ? initialSlots : [{ startTime: \"10:00\", endTime: \"12:00\" }]\n  );\n\n  const formatTimeToAMPM = (time: string) => {\n    const [hours, minutes] = time.split(':').map(Number);\n    const period = hours < 12 ? 'AM' : 'PM';\n    const displayHour = hours === 0 ? 12 : hours > 12 ? hours - 12 : hours;\n    return `${displayHour}:${minutes.toString().padStart(2, '0')} ${period}`;\n  };\n\n  const handleSlotChange = (index: number, field: keyof HappyHoursSlot, value: string) => {\n    const newSlots = [...slots];\n    newSlots[index] = { ...newSlots[index], [field]: value };\n    setSlots(newSlots);\n    onUpdate({ enabled, slots: newSlots });\n  };\n\n  const addSlot = () => {\n    const newSlots = [...slots, { startTime: \"10:00\", endTime: \"12:00\" }];\n    setSlots(newSlots);\n    onUpdate({ enabled, slots: newSlots });\n  };\n\n  const removeSlot = (index: number) => {\n    const newSlots = slots.filter((_, i) => i !== index);\n    setSlots(newSlots);\n    onUpdate({ enabled, slots: newSlots });\n  };\n\n  const handleEnabledChange = (checked: boolean) => {\n    setEnabled(checked);\n    onUpdate({ enabled: checked, slots });\n  };\n\n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <CardTitle data-testid={`text-happy-hours-${category.toLowerCase()}`}>{category}</CardTitle>\n            <CardDescription>Configure happy hours time slots and pricing</CardDescription>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Label htmlFor={`enabled-${category}`} className=\"text-sm font-medium\">\n              Enabled\n            </Label>\n            <Switch\n              id={`enabled-${category}`}\n              checked={enabled}\n              onCheckedChange={handleEnabledChange}\n              disabled={!isAdmin}\n              data-testid={`switch-happy-hours-enabled-${category.toLowerCase()}`}\n            />\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent>\n        <div className=\"space-y-4\">\n          {slots.map((slot, index) => (\n            <div key={index} className=\"flex flex-col gap-3 p-3 border rounded-lg bg-muted/50\">\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor={`start-${category}-${index}`} className=\"text-sm\">\n                    Start Time\n                  </Label>\n                  <div className=\"space-y-1\">\n                    <Input\n                      id={`start-${category}-${index}`}\n                      type=\"time\"\n                      value={slot.startTime}\n                      onChange={(e) => handleSlotChange(index, \"startTime\", e.target.value)}\n                      disabled={!isAdmin}\n                      data-testid={`input-happy-hours-start-${category.toLowerCase()}-${index}`}\n                    />\n                    <div className=\"text-xs text-muted-foreground font-medium px-1\">\n                      {formatTimeToAMPM(slot.startTime)}\n                    </div>\n                  </div>\n                </div>\n                <div className=\"space-y-2\">\n                  <Label htmlFor={`end-${category}-${index}`} className=\"text-sm\">\n                    End Time\n                  </Label>\n                  <div className=\"flex gap-2\">\n                    <div className=\"flex-1 space-y-1\">\n                      <Input\n                        id={`end-${category}-${index}`}\n                        type=\"time\"\n                        value={slot.endTime}\n                        onChange={(e) => handleSlotChange(index, \"endTime\", e.target.value)}\n                        disabled={!isAdmin}\n                        data-testid={`input-happy-hours-end-${category.toLowerCase()}-${index}`}\n                      />\n                      <div className=\"text-xs text-muted-foreground font-medium px-1\">\n                        {formatTimeToAMPM(slot.endTime)}\n                      </div>\n                    </div>\n                    {isAdmin && slots.length > 1 && (\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        onClick={() => removeSlot(index)}\n                        data-testid={`button-remove-happy-hours-slot-${category.toLowerCase()}-${index}`}\n                        className=\"mt-0\"\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    )}\n                  </div>\n                </div>\n              </div>\n            </div>\n          ))}\n          {isAdmin && (\n            <Button\n              variant=\"outline\"\n              onClick={addSlot}\n              className=\"w-full\"\n              data-testid={`button-add-happy-hours-slot-${category.toLowerCase()}`}\n            >\n              <Plus className=\"mr-2 h-4 w-4\" />\n              Add Time Slot\n            </Button>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":6033,"size_tokens":null},"client/src/components/MergeSessionDialog.tsx":{"content":"import {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { AlertTriangle } from \"lucide-react\";\n\ninterface MergeSessionDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  customerName: string;\n  existingSeat: string;\n  onMerge: () => void;\n  onSeparate: () => void;\n}\n\nexport function MergeSessionDialog({\n  open,\n  onOpenChange,\n  customerName,\n  existingSeat,\n  onMerge,\n  onSeparate,\n}: MergeSessionDialogProps) {\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-md\" data-testid=\"dialog-merge-session\">\n        <DialogHeader>\n          <div className=\"flex items-center gap-2\">\n            <AlertTriangle className=\"h-5 w-5 text-yellow-600 dark:text-yellow-400\" />\n            <DialogTitle>Username Match Found</DialogTitle>\n          </div>\n          <DialogDescription className=\"pt-2 space-y-3\">\n            <div>\n              The username \"<span className=\"font-semibold text-foreground\">{customerName}</span>\" matches an existing session at{\" \"}\n              <span className=\"font-semibold text-foreground\">{existingSeat}</span>.\n            </div>\n            <div className=\"p-3 bg-muted rounded-md text-sm\">\n              <div className=\"font-medium mb-2\">What would you like to do?</div>\n              <ul className=\"space-y-1 text-muted-foreground\">\n                <li>‚Ä¢ <span className=\"font-medium\">Merge:</span> Combine the new booking with the existing session (same customer)</li>\n                <li>‚Ä¢ <span className=\"font-medium\">Separate:</span> Create independent session (different customer with same name)</li>\n              </ul>\n            </div>\n          </DialogDescription>\n        </DialogHeader>\n\n        <DialogFooter className=\"flex-col sm:flex-row gap-2\">\n          <Button\n            variant=\"outline\"\n            onClick={() => {\n              onSeparate();\n              onOpenChange(false);\n            }}\n            data-testid=\"button-separate-session\"\n            className=\"w-full sm:w-auto\"\n          >\n            Keep Separate\n          </Button>\n          <Button\n            onClick={() => {\n              onMerge();\n              onOpenChange(false);\n            }}\n            data-testid=\"button-merge-session\"\n            className=\"w-full sm:w-auto\"\n          >\n            Merge Sessions\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":2555,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport helmet from \"helmet\";\nimport cors from \"cors\";\nimport cookieParser from \"cookie-parser\";\nimport { registerRoutes } from \"./routes\";\nimport { registerAuthRoutes } from \"./auth\";\nimport { setupGoogleAuth, getSession } from \"./googleAuth\";\nimport { setupVite, serveStatic, log } from \"./vite\";\nimport { storage } from \"./storage\";\nimport { cleanupScheduler } from \"./scheduler\";\nimport { csrfProtectionInit, getCsrfToken } from \"./csrf\";\nimport passport from \"passport\";\n\nconst app = express();\n\n// Trust proxy - required for rate limiting behind reverse proxy\napp.set('trust proxy', 1);\n\n// CORS Configuration\nconst allowedOrigins = process.env.ALLOWED_ORIGINS \n  ? process.env.ALLOWED_ORIGINS.split(',')\n  : ['http://localhost:5000', 'http://localhost:3000'];\n\napp.use(cors({\n  origin: (origin, callback) => {\n    // Allow requests with no origin (mobile apps, curl, etc.)\n    if (!origin) return callback(null, true);\n    \n    // In development, allow all origins\n    if (process.env.NODE_ENV !== 'production') {\n      return callback(null, true);\n    }\n    \n    // In production, check against allowed origins OR allow same-origin requests\n    if (allowedOrigins.indexOf(origin) !== -1) {\n      return callback(null, true);\n    }\n    \n    // Allow same-origin requests (frontend and backend on same domain)\n    // This handles cases like Render where both are served from the same URL\n    const requestHost = origin.replace(/^https?:\\/\\//, '');\n    const serverHost = process.env.RENDER_EXTERNAL_URL?.replace(/^https?:\\/\\//, '') || '';\n    \n    if (serverHost && requestHost === serverHost) {\n      return callback(null, true);\n    }\n    \n    // In production, reject if not in allowed list\n    console.warn(`CORS blocked request from origin: ${origin}`);\n    callback(new Error('Not allowed by CORS'));\n  },\n  credentials: true,\n  methods: ['GET', 'POST', 'PUT', 'DELETE', 'PATCH'],\n  allowedHeaders: ['Content-Type', 'Authorization']\n}));\n\n// Security headers with enhanced CSP\napp.use(\n  helmet({\n    contentSecurityPolicy: process.env.NODE_ENV === 'production' ? {\n      directives: {\n        defaultSrc: [\"'self'\"],\n        scriptSrc: [\"'self'\"],\n        styleSrc: [\"'self'\", \"https://fonts.googleapis.com\"],\n        fontSrc: [\"'self'\", \"https://fonts.gstatic.com\", \"data:\"],\n        imgSrc: [\"'self'\", \"data:\", \"https:\", \"blob:\"],\n        connectSrc: [\"'self'\"],\n        frameSrc: [\"'none'\"],\n        objectSrc: [\"'none'\"],\n        upgradeInsecureRequests: [],\n      },\n    } : false, // Disable CSP in development for Vite HMR\n    hsts: {\n      maxAge: 31536000,\n      includeSubDomains: true,\n      preload: true\n    },\n    frameguard: {\n      action: 'deny'\n    },\n    noSniff: true,\n    xssFilter: true,\n    referrerPolicy: {\n      policy: 'strict-origin-when-cross-origin'\n    }\n  })\n);\n\n// Request size limits to prevent DOS attacks\napp.use(express.json({ limit: '1mb' }));\napp.use(express.urlencoded({ extended: false, limit: '1mb' }));\n\n// Cookie parser for CSRF protection\napp.use(cookieParser());\n\n// HTTPS enforcement in production (after body parsers, only for HTML requests)\nif (process.env.NODE_ENV === 'production') {\n  app.use((req, res, next) => {\n    // Skip for API requests and assets\n    if (req.path.startsWith('/api/') || req.path.startsWith('/assets/')) {\n      return next();\n    }\n    \n    // Check if request is already HTTPS\n    const proto = req.headers['x-forwarded-proto'] || req.protocol;\n    if (proto === 'https' || req.secure) {\n      return next();\n    }\n    \n    // Only redirect GET requests to avoid losing POST data\n    if (req.method === 'GET' || req.method === 'HEAD') {\n      return res.redirect(301, `https://${req.headers.host}${req.url}`);\n    }\n    \n    next();\n  });\n}\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"‚Ä¶\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  // Initialize database with defaults\n  await storage.initializeDefaults();\n  \n  // AUTOMATIC CLEANUP DISABLED - Owner wants to keep ALL data forever\n  // Data is valuable for tax records, customer history, and business analytics\n  // Using multiple Neon free projects (6 √ó 512 MB = 3 GB) to store all data\n  // cleanupScheduler.start();\n  \n  // Setup session middleware\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n  app.use(passport.initialize());\n  app.use(passport.session());\n  \n  // Setup Google OAuth (independent of Replit)\n  await setupGoogleAuth(app);\n  \n  // Register staff/admin authentication routes\n  registerAuthRoutes(app);\n  \n  const server = await registerRoutes(app);\n\n  app.use((err: any, req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    \n    // Log error details for debugging (but don't expose to client)\n    console.error('Error occurred:', {\n      path: req.path,\n      method: req.method,\n      error: err.message,\n      stack: process.env.NODE_ENV === 'development' ? err.stack : undefined,\n      userId: req.session?.userId,\n      ip: req.ip\n    });\n    \n    // Send generic error message to prevent information leakage\n    const message = status === 500 \n      ? \"An internal error occurred. Please try again later.\"\n      : err.message || \"An error occurred\";\n\n    res.status(status).json({ \n      message,\n      ...(process.env.NODE_ENV === 'development' ? { stack: err.stack } : {})\n    });\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","path":null,"size_bytes":6804,"size_tokens":null},"server/googleAuth.ts":{"content":"import passport from \"passport\";\nimport { Strategy as GoogleStrategy } from \"passport-google-oauth20\";\nimport session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport connectPg from \"connect-pg-simple\";\nimport { storage } from \"./storage\";\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  return session({\n    secret: process.env.SESSION_SECRET!,\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: process.env.NODE_ENV === \"production\",\n      sameSite: \"lax\", // CSRF protection (lax required for OAuth flows)\n      maxAge: sessionTtl,\n    },\n  });\n}\n\nexport async function setupGoogleAuth(app: Express) {\n  // Check if Google OAuth credentials are provided\n  if (!process.env.GOOGLE_CLIENT_ID || !process.env.GOOGLE_CLIENT_SECRET) {\n    console.warn(\"‚ö†Ô∏è  Google OAuth not configured - GOOGLE_CLIENT_ID and GOOGLE_CLIENT_SECRET required\");\n    console.log(\"‚ÑπÔ∏è  Use staff/admin login with username and password instead\");\n    return;\n  }\n\n  const callbackURL = process.env.GOOGLE_CALLBACK_URL || \n    (process.env.NODE_ENV === \"production\" \n      ? `${process.env.RENDER_EXTERNAL_URL}/api/auth/google/callback`\n      : \"http://localhost:5000/api/auth/google/callback\");\n\n  console.log(\"‚úÖ Setting up Google OAuth authentication...\");\n  console.log(`üìç Callback URL: ${callbackURL}`);\n\n  // Configure Google OAuth Strategy\n  passport.use(\n    new GoogleStrategy(\n      {\n        clientID: process.env.GOOGLE_CLIENT_ID,\n        clientSecret: process.env.GOOGLE_CLIENT_SECRET,\n        callbackURL: callbackURL,\n        scope: [\"profile\", \"email\"],\n      },\n      async (accessToken, refreshToken, profile, done) => {\n        try {\n          const email = profile.emails?.[0]?.value;\n          if (!email) {\n            return done(new Error(\"No email found in Google profile\"), undefined);\n          }\n\n          // Check if email whitelist is enabled\n          const allowedEmail = process.env.ALLOWED_EMAIL;\n          if (allowedEmail && email !== allowedEmail) {\n            console.log(`Access denied for email: ${email}. Only ${allowedEmail} is allowed.`);\n            return done(new Error(\"Access denied. Your email is not authorized to use this application.\"), undefined);\n          }\n\n          // Upsert user in database\n          await storage.upsertUser({\n            id: profile.id,\n            email: email,\n            firstName: profile.name?.givenName || profile.displayName || \"\",\n            lastName: profile.name?.familyName || \"\",\n            profileImageUrl: profile.photos?.[0]?.value,\n          });\n\n          // Return user object for session\n          return done(null, {\n            id: profile.id,\n            email: email,\n            firstName: profile.name?.givenName || profile.displayName,\n            lastName: profile.name?.familyName,\n            profileImageUrl: profile.photos?.[0]?.value,\n          });\n        } catch (error) {\n          return done(error as Error, undefined);\n        }\n      }\n    )\n  );\n\n  // Serialize user to session\n  passport.serializeUser((user: any, done) => {\n    done(null, user.id);\n  });\n\n  // Deserialize user from session\n  passport.deserializeUser(async (id: string, done) => {\n    try {\n      const user = await storage.getUser(id);\n      done(null, user);\n    } catch (error) {\n      done(error, null);\n    }\n  });\n\n  // Google OAuth routes\n  app.get(\n    \"/api/auth/google\",\n    passport.authenticate(\"google\", { scope: [\"profile\", \"email\"] })\n  );\n\n  app.get(\n    \"/api/auth/google/callback\",\n    passport.authenticate(\"google\", {\n      failureRedirect: \"/?error=google_auth_failed\",\n    }),\n    (req, res) => {\n      // Check if authentication was successful\n      if (!req.user) {\n        return res.redirect(\"/?error=authentication_failed\");\n      }\n      \n      // Set Google verification in session\n      const googleUser = req.user as any;\n      req.session.googleVerified = true;\n      req.session.googleUserId = googleUser.id;\n      req.session.googleEmail = googleUser.email;\n      \n      // Redirect to show staff/admin login form\n      res.redirect(\"/?google_verified=true\");\n    }\n  );\n\n  // Handle authentication errors\n  app.use((err: any, req: any, res: any, next: any) => {\n    if (err.message && err.message.includes(\"Access denied\")) {\n      return res.redirect(\"/?error=access_denied\");\n    }\n    next(err);\n  });\n\n  app.get(\"/api/auth/google/logout\", (req, res) => {\n    req.logout((err) => {\n      if (err) {\n        return res.status(500).json({ message: \"Failed to logout\" });\n      }\n      res.redirect(\"/\");\n    });\n  });\n}\n\nexport const isGoogleAuthenticated: RequestHandler = (req, res, next) => {\n  if (req.isAuthenticated()) {\n    return next();\n  }\n  res.status(401).json({ message: \"Not authenticated\" });\n};\n","path":null,"size_bytes":5080,"size_tokens":null},"RENDER_ENVIRONMENT_SETUP.md":{"content":"# üöÄ How to Add 6 Neon Databases in Render\n\n## When You Need This\n\nWhen your storage reaches ~400-500 MB (in 5-6 years), you'll want to use 6 free Neon databases = 3 GB total storage.\n\n---\n\n## Step 1: Create 6 Neon Databases\n\n1. Go to **https://console.neon.tech/**\n2. Click **\"New Project\"** 6 times\n3. Name them clearly:\n   ```\n   airavoto-main\n   airavoto-history\n   airavoto-payments\n   airavoto-expenses\n   airavoto-logs\n   airavoto-analytics\n   ```\n\n4. For **each project**, copy the connection string:\n   - Click on your project\n   - Go to **\"Connection Details\"**\n   - Copy the **connection string** (starts with `postgresql://`)\n\nYou'll have 6 connection strings like:\n```\npostgresql://user:pass@host1.neon.tech/dbname1?sslmode=require\npostgresql://user:pass@host2.neon.tech/dbname2?sslmode=require\npostgresql://user:pass@host3.neon.tech/dbname3?sslmode=require\npostgresql://user:pass@host4.neon.tech/dbname4?sslmode=require\npostgresql://user:pass@host5.neon.tech/dbname5?sslmode=require\npostgresql://user:pass@host6.neon.tech/dbname6?sslmode=require\n```\n\n---\n\n## Step 2: Add to Render Environment Variables\n\n### If Using Render.com for Deployment:\n\n1. **Go to your Render dashboard:** https://dashboard.render.com/\n2. **Select your web service** (your Airavoto app)\n3. **Click \"Environment\"** tab in the left sidebar\n4. **Click \"Add Environment Variable\"** button\n\n5. **Add these 6 variables one by one:**\n\n| Key | Value |\n|-----|-------|\n| `DATABASE_URL_MAIN` | `postgresql://user:pass@host1.neon.tech/dbname1?sslmode=require` |\n| `DATABASE_URL_HISTORY` | `postgresql://user:pass@host2.neon.tech/dbname2?sslmode=require` |\n| `DATABASE_URL_PAYMENTS` | `postgresql://user:pass@host3.neon.tech/dbname3?sslmode=require` |\n| `DATABASE_URL_EXPENSES` | `postgresql://user:pass@host4.neon.tech/dbname4?sslmode=require` |\n| `DATABASE_URL_LOGS` | `postgresql://user:pass@host5.neon.tech/dbname5?sslmode=require` |\n| `DATABASE_URL_ANALYTICS` | `postgresql://user:pass@host6.neon.tech/dbname6?sslmode=require` |\n\n6. **Click \"Save Changes\"**\n7. Render will **automatically redeploy** your app with the new environment variables\n\n---\n\n## Step 3: Add to Replit (For Development)\n\n### In Replit:\n\n1. **Click \"Tools\"** in the left sidebar\n2. **Click \"Secrets\"** \n3. **Add each secret:**\n\n**For each database:**\n- Click **\"+ New Secret\"**\n- Enter **Key:** `DATABASE_URL_MAIN`\n- Enter **Value:** `postgresql://user:pass@host1.neon.tech/dbname1?sslmode=require`\n- Click **\"Add Secret\"**\n\n**Repeat for all 6 databases:**\n- `DATABASE_URL_MAIN`\n- `DATABASE_URL_HISTORY`\n- `DATABASE_URL_PAYMENTS`\n- `DATABASE_URL_EXPENSES`\n- `DATABASE_URL_LOGS`\n- `DATABASE_URL_ANALYTICS`\n\n---\n\n## Step 4: Access in Your Code\n\nOnce environment variables are set, access them in your code:\n\n```typescript\n// server/storage.ts (future implementation)\nconst mainDb = drizzle(process.env.DATABASE_URL_MAIN!);\nconst historyDb = drizzle(process.env.DATABASE_URL_HISTORY!);\nconst paymentsDb = drizzle(process.env.DATABASE_URL_PAYMENTS!);\nconst expensesDb = drizzle(process.env.DATABASE_URL_EXPENSES!);\nconst logsDb = drizzle(process.env.DATABASE_URL_LOGS!);\nconst analyticsDb = drizzle(process.env.DATABASE_URL_ANALYTICS!);\n```\n\n---\n\n## üì∏ Visual Guide for Render\n\n### Adding Environment Variables in Render:\n\n```\n1. Render Dashboard\n   ‚îî‚îÄ‚îÄ Your App (airavoto-gaming)\n       ‚îî‚îÄ‚îÄ Environment Tab\n           ‚îî‚îÄ‚îÄ Environment Variables Section\n               ‚îî‚îÄ‚îÄ [+ Add Environment Variable]\n                   ‚îú‚îÄ‚îÄ Key: DATABASE_URL_MAIN\n                   ‚îî‚îÄ‚îÄ Value: postgresql://...\n```\n\n**Screenshot locations:**\n- Top right: **\"Add Environment Variable\"** button\n- Each variable has:\n  - **Key** field (left)\n  - **Value** field (right)\n  - **Delete** icon (far right)\n\n---\n\n## üîí Security Notes\n\n‚úÖ **DO:**\n- Keep connection strings secret\n- Use environment variables (never hardcode)\n- Copy-paste carefully (one wrong character breaks everything)\n\n‚ùå **DON'T:**\n- Share connection strings publicly\n- Commit them to Git\n- Post them in screenshots\n\n---\n\n## ‚úÖ Verification\n\n**After adding environment variables:**\n\n1. **In Render:**\n   - Check \"Environment\" tab\n   - Should see all 6 `DATABASE_URL_*` variables\n\n2. **In Replit:**\n   - Check \"Secrets\" tool\n   - Should see all 6 secrets listed\n\n3. **Test in Code:**\n   ```typescript\n   console.log('Main DB:', process.env.DATABASE_URL_MAIN ? 'Connected' : 'Missing');\n   console.log('History DB:', process.env.DATABASE_URL_HISTORY ? 'Connected' : 'Missing');\n   // ... etc\n   ```\n\n---\n\n## üÜò Troubleshooting\n\n### \"Environment variable not found\"\n- ‚úÖ Check spelling (exact match required)\n- ‚úÖ Restart app after adding variables\n- ‚úÖ Make sure no extra spaces\n\n### \"Connection refused\"\n- ‚úÖ Check connection string format\n- ‚úÖ Verify Neon database is active\n- ‚úÖ Check if `?sslmode=require` is at the end\n\n### \"Password authentication failed\"\n- ‚úÖ Copy connection string again from Neon\n- ‚úÖ Make sure you copied the FULL string\n- ‚úÖ Check for special characters that might break\n\n---\n\n## üìÖ When to Do This\n\n**NOT NOW!** You have 6-7 years before needing this.\n\n**Do this when:**\n- Your single database reaches ~400 MB (75% full)\n- Neon sends you storage warnings\n- Around Year 5-6 of operation\n\n**For now:**\n- Keep using the single `DATABASE_URL`\n- Monitor storage in Neon dashboard\n- Relax and run your business! üéÆ\n\n---\n\n## üí° Current Setup (Simple)\n\n**Right now you only have:**\n```\nDATABASE_URL = postgresql://... (one database)\n```\n\n**This is perfect for the next 6-7 years!**\n\nWhen you need to scale to 6 databases, come back to this guide.\n\n---\n\n## üìû Need Help?\n\nWhen the time comes (in 5-6 years):\n1. Create the 6 Neon projects\n2. Copy the 6 connection strings\n3. Add them to Render/Replit environment\n4. Request code modification help\n\n**But for now, enjoy your free 512 MB!** ‚ú®\n","path":null,"size_bytes":5869,"size_tokens":null},"shared/schema-sqlite.ts":{"content":"import { z } from \"zod\";\nimport { sql } from \"drizzle-orm\";\nimport { sqliteTable, text, integer, real } from \"drizzle-orm/sqlite-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\n\nexport const sessions = sqliteTable(\"sessions\", {\n  sid: text(\"sid\").primaryKey(),\n  sess: text(\"sess\").notNull(),\n  expire: integer(\"expire\", { mode: \"timestamp\" }).notNull(),\n});\n\nexport const sessionGroups = sqliteTable(\"session_groups\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  groupCode: text(\"group_code\").unique(),\n  groupName: text(\"group_name\").notNull(),\n  category: text(\"category\").notNull(),\n  bookingType: text(\"booking_type\").notNull(),\n  createdAt: integer(\"created_at\", { mode: \"timestamp\" }).notNull().$defaultFn(() => new Date()),\n});\n\nexport const insertSessionGroupSchema = createInsertSchema(sessionGroups).omit({ id: true, createdAt: true });\nexport type InsertSessionGroup = z.infer<typeof insertSessionGroupSchema>;\nexport type SessionGroup = typeof sessionGroups.$inferSelect;\n\nexport const bookings = sqliteTable(\"bookings\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  bookingCode: text(\"booking_code\").unique(),\n  groupId: text(\"group_id\"),\n  groupCode: text(\"group_code\"),\n  category: text(\"category\").notNull(),\n  seatNumber: integer(\"seat_number\").notNull(),\n  seatName: text(\"seat_name\").notNull(),\n  customerName: text(\"customer_name\").notNull(),\n  whatsappNumber: text(\"whatsapp_number\"),\n  startTime: integer(\"start_time\", { mode: \"timestamp\" }).notNull(),\n  endTime: integer(\"end_time\", { mode: \"timestamp\" }).notNull(),\n  price: text(\"price\").notNull(),\n  status: text(\"status\").notNull(),\n  bookingType: text(\"booking_type\").notNull(),\n  pausedRemainingTime: integer(\"paused_remaining_time\"),\n  personCount: integer(\"person_count\").notNull().default(1),\n  paymentMethod: text(\"payment_method\"),\n  cashAmount: text(\"cash_amount\"),\n  upiAmount: text(\"upi_amount\"),\n  paymentStatus: text(\"payment_status\").notNull().default(\"unpaid\"),\n  lastPaymentAction: text(\"last_payment_action\"),\n  foodOrders: text(\"food_orders\").default(\"[]\"),\n  originalPrice: text(\"original_price\"),\n  discountApplied: text(\"discount_applied\"),\n  bonusHoursApplied: text(\"bonus_hours_applied\"),\n  promotionDetails: text(\"promotion_details\"),\n  isPromotionalDiscount: integer(\"is_promotional_discount\").default(0),\n  isPromotionalBonus: integer(\"is_promotional_bonus\").default(0),\n  manualDiscountPercentage: integer(\"manual_discount_percentage\"),\n  manualFreeHours: text(\"manual_free_hours\"),\n  discount: text(\"discount\"),\n  bonus: text(\"bonus\"),\n  createdAt: integer(\"created_at\", { mode: \"timestamp\" }).notNull().$defaultFn(() => new Date()),\n});\n\nexport const insertBookingSchema = createInsertSchema(bookings).omit({ id: true, createdAt: true }).extend({\n  bookingCode: z.string().optional().nullable(),\n  groupId: z.string().optional().nullable(),\n  groupCode: z.string().optional().nullable(),\n  startTime: z.union([z.string(), z.date()]).transform(val => typeof val === 'string' ? new Date(val) : val),\n  endTime: z.union([z.string(), z.date()]).transform(val => typeof val === 'string' ? new Date(val) : val),\n  pausedRemainingTime: z.number().nullable().optional(),\n});\nexport type InsertBooking = z.infer<typeof insertBookingSchema>;\nexport type Booking = typeof bookings.$inferSelect;\n\nexport const foodItems = sqliteTable(\"food_items\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  name: text(\"name\").notNull(),\n  price: text(\"price\").notNull(),\n  costPrice: text(\"cost_price\"),\n  currentStock: integer(\"current_stock\").notNull().default(0),\n  minStockLevel: integer(\"min_stock_level\").notNull().default(10),\n  inInventory: integer(\"in_inventory\").notNull().default(0),\n  category: text(\"category\").notNull().default(\"trackable\"),\n  supplier: text(\"supplier\"),\n  expiryDate: integer(\"expiry_date\", { mode: \"timestamp\" }),\n});\n\nexport const insertFoodItemSchema = createInsertSchema(foodItems).omit({ id: true }).extend({\n  expiryDate: z.union([z.string(), z.date(), z.null(), z.undefined()]).transform(val => {\n    if (!val) return undefined;\n    return typeof val === 'string' ? new Date(val) : val;\n  }).optional(),\n});\nexport type InsertFoodItem = z.infer<typeof insertFoodItemSchema>;\nexport type FoodItem = typeof foodItems.$inferSelect;\n\nexport const stockBatches = sqliteTable(\"stock_batches\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  foodItemId: text(\"food_item_id\").notNull(),\n  quantity: integer(\"quantity\").notNull(),\n  costPrice: text(\"cost_price\").notNull(),\n  supplier: text(\"supplier\"),\n  purchaseDate: integer(\"purchase_date\", { mode: \"timestamp\" }).notNull().$defaultFn(() => new Date()),\n  expiryDate: integer(\"expiry_date\", { mode: \"timestamp\" }),\n  notes: text(\"notes\"),\n  createdAt: integer(\"created_at\", { mode: \"timestamp\" }).notNull().$defaultFn(() => new Date()),\n});\n\nexport const insertStockBatchSchema = createInsertSchema(stockBatches).omit({ id: true, createdAt: true }).extend({\n  purchaseDate: z.union([z.string(), z.date()]).transform(val => typeof val === 'string' ? new Date(val) : val).optional(),\n  expiryDate: z.union([z.string(), z.date(), z.null(), z.undefined()]).transform(val => {\n    if (!val) return undefined;\n    return typeof val === 'string' ? new Date(val) : val;\n  }).optional(),\n});\nexport type InsertStockBatch = z.infer<typeof insertStockBatchSchema>;\nexport type StockBatch = typeof stockBatches.$inferSelect;\n\nexport const stockAdjustmentSchema = z.object({\n  foodId: z.string(),\n  quantity: z.number().int(),\n  type: z.enum([\"add\", \"remove\"]),\n  costPrice: z.string().optional(),\n  supplier: z.string().optional(),\n  expiryDate: z.union([z.string(), z.date(), z.null(), z.undefined()]).transform(val => {\n    if (!val) return undefined;\n    return typeof val === 'string' ? new Date(val) : val;\n  }).optional(),\n  notes: z.string().optional(),\n});\n\nexport const deviceConfigs = sqliteTable(\"device_configs\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  category: text(\"category\").notNull().unique(),\n  count: integer(\"count\").notNull().default(0),\n  seats: text(\"seats\").notNull().default(\"[]\"),\n});\n\nexport const insertDeviceConfigSchema = createInsertSchema(deviceConfigs).omit({ id: true });\nexport type InsertDeviceConfig = z.infer<typeof insertDeviceConfigSchema>;\nexport type DeviceConfig = typeof deviceConfigs.$inferSelect;\n\nexport const pricingConfigs = sqliteTable(\"pricing_configs\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  category: text(\"category\").notNull(),\n  duration: text(\"duration\").notNull(),\n  price: text(\"price\").notNull(),\n  personCount: integer(\"person_count\").notNull().default(1),\n});\n\nexport const insertPricingConfigSchema = createInsertSchema(pricingConfigs).omit({ id: true }).refine(\n  (data) => {\n    if (data.category !== \"PS5\" && data.personCount && data.personCount > 1) {\n      return false;\n    }\n    return true;\n  },\n  {\n    message: \"Only PS5 category can have person count greater than 1\",\n    path: [\"personCount\"],\n  }\n);\nexport type InsertPricingConfig = z.infer<typeof insertPricingConfigSchema>;\nexport type PricingConfig = typeof pricingConfigs.$inferSelect;\n\nexport const happyHoursConfigs = sqliteTable(\"happy_hours_configs\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  category: text(\"category\").notNull(),\n  startTime: text(\"start_time\").notNull(),\n  endTime: text(\"end_time\").notNull(),\n  enabled: integer(\"enabled\").notNull().default(1),\n});\n\nexport const insertHappyHoursConfigSchema = createInsertSchema(happyHoursConfigs).omit({ id: true });\nexport type InsertHappyHoursConfig = z.infer<typeof insertHappyHoursConfigSchema>;\nexport type HappyHoursConfig = typeof happyHoursConfigs.$inferSelect;\n\nexport const happyHoursPricing = sqliteTable(\"happy_hours_pricing\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  category: text(\"category\").notNull(),\n  duration: text(\"duration\").notNull(),\n  price: text(\"price\").notNull(),\n  personCount: integer(\"person_count\").notNull().default(1),\n});\n\nexport const insertHappyHoursPricingSchema = createInsertSchema(happyHoursPricing).omit({ id: true }).refine(\n  (data) => {\n    if (data.category !== \"PS5\" && data.personCount && data.personCount > 1) {\n      return false;\n    }\n    return true;\n  },\n  {\n    message: \"Only PS5 category can have person count greater than 1\",\n    path: [\"personCount\"],\n  }\n);\nexport type InsertHappyHoursPricing = z.infer<typeof insertHappyHoursPricingSchema>;\nexport type HappyHoursPricing = typeof happyHoursPricing.$inferSelect;\n\nexport const bookingHistory = sqliteTable(\"booking_history\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  bookingId: text(\"booking_id\").notNull(),\n  bookingCode: text(\"booking_code\"),\n  groupId: text(\"group_id\"),\n  groupCode: text(\"group_code\"),\n  category: text(\"category\").notNull(),\n  seatNumber: integer(\"seat_number\").notNull(),\n  seatName: text(\"seat_name\").notNull(),\n  customerName: text(\"customer_name\").notNull(),\n  whatsappNumber: text(\"whatsapp_number\"),\n  startTime: integer(\"start_time\", { mode: \"timestamp\" }).notNull(),\n  endTime: integer(\"end_time\", { mode: \"timestamp\" }).notNull(),\n  price: text(\"price\").notNull(),\n  status: text(\"status\").notNull(),\n  bookingType: text(\"booking_type\").notNull(),\n  pausedRemainingTime: integer(\"paused_remaining_time\"),\n  personCount: integer(\"person_count\").notNull().default(1),\n  paymentMethod: text(\"payment_method\"),\n  cashAmount: text(\"cash_amount\"),\n  upiAmount: text(\"upi_amount\"),\n  paymentStatus: text(\"payment_status\").notNull().default(\"unpaid\"),\n  lastPaymentAction: text(\"last_payment_action\"),\n  foodOrders: text(\"food_orders\").default(\"[]\"),\n  originalPrice: text(\"original_price\"),\n  discountApplied: text(\"discount_applied\"),\n  bonusHoursApplied: text(\"bonus_hours_applied\"),\n  promotionDetails: text(\"promotion_details\"),\n  isPromotionalDiscount: integer(\"is_promotional_discount\").default(0),\n  isPromotionalBonus: integer(\"is_promotional_bonus\").default(0),\n  manualDiscountPercentage: integer(\"manual_discount_percentage\"),\n  manualFreeHours: text(\"manual_free_hours\"),\n  discount: text(\"discount\"),\n  bonus: text(\"bonus\"),\n  createdAt: integer(\"created_at\", { mode: \"timestamp\" }).notNull(),\n  archivedAt: integer(\"archived_at\", { mode: \"timestamp\" }).notNull().$defaultFn(() => new Date()),\n});\n\nexport const insertBookingHistorySchema = createInsertSchema(bookingHistory).omit({ id: true, archivedAt: true });\nexport type InsertBookingHistory = z.infer<typeof insertBookingHistorySchema>;\nexport type BookingHistory = typeof bookingHistory.$inferSelect;\n\nexport const users = sqliteTable(\"users\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  username: text(\"username\").unique(),\n  passwordHash: text(\"password_hash\"),\n  role: text(\"role\"),\n  onboardingCompleted: integer(\"onboarding_completed\").default(0),\n  profileImageUrl: text(\"profile_image_url\"),\n  createdAt: integer(\"created_at\", { mode: \"timestamp\" }).$defaultFn(() => new Date()),\n  updatedAt: integer(\"updated_at\", { mode: \"timestamp\" }).$defaultFn(() => new Date()),\n});\n\nexport const insertUserSchema = createInsertSchema(users).omit({ id: true, createdAt: true, updatedAt: true, passwordHash: true }).extend({\n  password: z.string()\n    .min(8, \"Password must be at least 8 characters\")\n    .regex(/[A-Za-z]/, \"Password must contain at least one letter\")\n    .regex(/[0-9]/, \"Password must contain at least one number\"),\n  username: z.string()\n    .min(3, \"Username must be at least 3 characters\")\n    .max(50, \"Username must be at most 50 characters\")\n    .regex(/^[a-zA-Z0-9_-]+$/, \"Username can only contain letters, numbers, underscores, and hyphens\"),\n});\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\nexport type UpsertUser = typeof users.$inferInsert;\n\nexport const loginSchema = z.object({\n  username: z.string().min(1, \"Username is required\"),\n  password: z.string().min(1, \"Password is required\"),\n});\n\nexport const updateProfileSchema = z.object({\n  username: z.string()\n    .min(3, \"Username must be at least 3 characters\")\n    .max(50, \"Username must be at most 50 characters\")\n    .regex(/^[a-zA-Z0-9_-]+$/, \"Username can only contain letters, numbers, underscores, and hyphens\")\n    .optional(),\n});\n\nexport const updatePasswordSchema = z.object({\n  currentPassword: z.string().min(1, \"Current password is required\"),\n  newPassword: z.string()\n    .min(8, \"Password must be at least 8 characters\")\n    .regex(/[A-Za-z]/, \"Password must contain at least one letter\")\n    .regex(/[0-9]/, \"Password must contain at least one number\"),\n  confirmPassword: z.string().min(1, \"Please confirm your password\"),\n}).refine((data) => data.newPassword === data.confirmPassword, {\n  message: \"Passwords don't match\",\n  path: [\"confirmPassword\"],\n});\n\nexport const createStaffSchema = z.object({\n  username: z.string()\n    .min(3, \"Username must be at least 3 characters\")\n    .max(50, \"Username must be at most 50 characters\")\n    .regex(/^[a-zA-Z0-9_-]+$/, \"Username can only contain letters, numbers, underscores, and hyphens\"),\n  password: z.string()\n    .min(8, \"Password must be at least 8 characters\")\n    .regex(/[A-Za-z]/, \"Password must contain at least one letter\")\n    .regex(/[0-9]/, \"Password must contain at least one number\"),\n});\n\nexport type UpdateProfile = z.infer<typeof updateProfileSchema>;\nexport type UpdatePassword = z.infer<typeof updatePasswordSchema>;\nexport type CreateStaff = z.infer<typeof createStaffSchema>;\n\nexport const expenses = sqliteTable(\"expenses\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  category: text(\"category\").notNull(),\n  description: text(\"description\").notNull(),\n  amount: text(\"amount\").notNull(),\n  date: integer(\"date\", { mode: \"timestamp\" }).notNull(),\n  createdAt: integer(\"created_at\", { mode: \"timestamp\" }).notNull().$defaultFn(() => new Date()),\n});\n\nexport const insertExpenseSchema = createInsertSchema(expenses).omit({ id: true, createdAt: true }).extend({\n  date: z.union([z.string(), z.date()]).transform(val => typeof val === 'string' ? new Date(val) : val),\n  amount: z.string().refine(val => !isNaN(parseFloat(val)) && parseFloat(val) > 0, {\n    message: \"Amount must be a valid positive number\"\n  }),\n});\nexport type InsertExpense = z.infer<typeof insertExpenseSchema>;\nexport type Expense = typeof expenses.$inferSelect;\n\nexport const activityLogs = sqliteTable(\"activity_logs\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  userId: text(\"user_id\").notNull(),\n  username: text(\"username\").notNull(),\n  userRole: text(\"user_role\").notNull(),\n  action: text(\"action\").notNull(),\n  entityType: text(\"entity_type\"),\n  entityId: text(\"entity_id\"),\n  details: text(\"details\"),\n  createdAt: integer(\"created_at\", { mode: \"timestamp\" }).notNull().$defaultFn(() => new Date()),\n});\n\nexport const insertActivityLogSchema = createInsertSchema(activityLogs).omit({ id: true, createdAt: true });\nexport type InsertActivityLog = z.infer<typeof insertActivityLogSchema>;\nexport type ActivityLog = typeof activityLogs.$inferSelect;\n\nexport const notifications = sqliteTable(\"notifications\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  type: text(\"type\").notNull(),\n  title: text(\"title\").notNull(),\n  message: text(\"message\").notNull(),\n  entityType: text(\"entity_type\"),\n  entityId: text(\"entity_id\"),\n  activityLogId: text(\"activity_log_id\"),\n  isRead: integer(\"is_read\").notNull().default(0),\n  createdAt: integer(\"created_at\", { mode: \"timestamp\" }).notNull().$defaultFn(() => new Date()),\n});\n\nexport const insertNotificationSchema = createInsertSchema(notifications).omit({ id: true, createdAt: true });\nexport type InsertNotification = z.infer<typeof insertNotificationSchema>;\nexport type Notification = typeof notifications.$inferSelect;\n\nexport const gamingCenterInfo = sqliteTable(\"gaming_center_info\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  name: text(\"name\").notNull(),\n  description: text(\"description\").notNull(),\n  address: text(\"address\").notNull(),\n  phone: text(\"phone\").notNull(),\n  email: text(\"email\"),\n  hours: text(\"hours\").notNull(),\n  timezone: text(\"timezone\").notNull().default(\"Asia/Kolkata\"),\n  updatedAt: integer(\"updated_at\", { mode: \"timestamp\" }).notNull().$defaultFn(() => new Date()),\n});\n\nexport const insertGamingCenterInfoSchema = createInsertSchema(gamingCenterInfo).omit({ id: true, updatedAt: true });\nexport type InsertGamingCenterInfo = z.infer<typeof insertGamingCenterInfoSchema>;\nexport type GamingCenterInfo = typeof gamingCenterInfo.$inferSelect;\n\nexport const galleryImages = sqliteTable(\"gallery_images\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  title: text(\"title\").notNull(),\n  imageUrl: text(\"image_url\").notNull(),\n  description: text(\"description\"),\n  createdAt: integer(\"created_at\", { mode: \"timestamp\" }).notNull().$defaultFn(() => new Date()),\n});\n\nexport const insertGalleryImageSchema = createInsertSchema(galleryImages).omit({ id: true, createdAt: true });\nexport type InsertGalleryImage = z.infer<typeof insertGalleryImageSchema>;\nexport type GalleryImage = typeof galleryImages.$inferSelect;\n\nexport const facilities = sqliteTable(\"facilities\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  name: text(\"name\").notNull(),\n  description: text(\"description\").notNull(),\n  icon: text(\"icon\").notNull(),\n});\n\nexport const insertFacilitySchema = createInsertSchema(facilities).omit({ id: true });\nexport type InsertFacility = z.infer<typeof insertFacilitySchema>;\nexport type Facility = typeof facilities.$inferSelect;\n\nexport const games = sqliteTable(\"games\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  name: text(\"name\").notNull(),\n  description: text(\"description\"),\n  imageUrl: text(\"image_url\"),\n  category: text(\"category\").notNull(),\n});\n\nexport const insertGameSchema = createInsertSchema(games).omit({ id: true });\nexport type InsertGame = z.infer<typeof insertGameSchema>;\nexport type Game = typeof games.$inferSelect;\n\nexport const loadMetrics = sqliteTable(\"load_metrics\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  timestamp: integer(\"timestamp\", { mode: \"timestamp\" }).notNull().$defaultFn(() => new Date()),\n  activeSessions: integer(\"active_sessions\").notNull().default(0),\n  avgSessionLength: integer(\"avg_session_length\").notNull().default(0),\n  foodOrders: integer(\"food_orders\").notNull().default(0),\n  capacityUtilization: integer(\"capacity_utilization\").notNull().default(0),\n});\n\nexport const insertLoadMetricSchema = createInsertSchema(loadMetrics).omit({ id: true, timestamp: true });\nexport type InsertLoadMetric = z.infer<typeof insertLoadMetricSchema>;\nexport type LoadMetric = typeof loadMetrics.$inferSelect;\n\nexport const loadPredictions = sqliteTable(\"load_predictions\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  timestamp: integer(\"timestamp\", { mode: \"timestamp\" }).notNull().$defaultFn(() => new Date()),\n  horizon: text(\"horizon\").notNull(),\n  predictedLoad: integer(\"predicted_load\").notNull(),\n  modelVersion: text(\"model_version\").notNull(),\n  features: text(\"features\").default(\"{}\"),\n});\n\nexport const insertLoadPredictionSchema = createInsertSchema(loadPredictions).omit({ id: true, timestamp: true });\nexport type InsertLoadPrediction = z.infer<typeof insertLoadPredictionSchema>;\nexport type LoadPrediction = typeof loadPredictions.$inferSelect;\n\nexport const retentionConfig = sqliteTable(\"retention_config\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  bookingHistoryDays: integer(\"booking_history_days\").notNull().default(36500),\n  activityLogsDays: integer(\"activity_logs_days\").notNull().default(36500),\n  loadMetricsDays: integer(\"load_metrics_days\").notNull().default(36500),\n  loadPredictionsDays: integer(\"load_predictions_days\").notNull().default(36500),\n  expensesDays: integer(\"expenses_days\").notNull().default(36500),\n  updatedAt: integer(\"updated_at\", { mode: \"timestamp\" }).notNull().$defaultFn(() => new Date()),\n});\n\nexport const insertRetentionConfigSchema = createInsertSchema(retentionConfig).omit({ id: true, updatedAt: true });\nexport type InsertRetentionConfig = z.infer<typeof insertRetentionConfigSchema>;\nexport type RetentionConfig = typeof retentionConfig.$inferSelect;\n\nexport const deviceMaintenance = sqliteTable(\"device_maintenance\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  category: text(\"category\").notNull(),\n  seatName: text(\"seat_name\").notNull(),\n  lastMaintenanceDate: integer(\"last_maintenance_date\", { mode: \"timestamp\" }),\n  totalUsageHours: real(\"total_usage_hours\").notNull().default(0),\n  totalSessions: integer(\"total_sessions\").notNull().default(0),\n  issuesReported: integer(\"issues_reported\").notNull().default(0),\n  maintenanceNotes: text(\"maintenance_notes\"),\n  status: text(\"status\").notNull().default(\"healthy\"),\n  createdAt: integer(\"created_at\", { mode: \"timestamp\" }).notNull().$defaultFn(() => new Date()),\n  updatedAt: integer(\"updated_at\", { mode: \"timestamp\" }).notNull().$defaultFn(() => new Date()),\n});\n\nexport const insertDeviceMaintenanceSchema = createInsertSchema(deviceMaintenance).omit({ id: true, createdAt: true, updatedAt: true });\nexport type InsertDeviceMaintenance = z.infer<typeof insertDeviceMaintenanceSchema>;\nexport type DeviceMaintenance = typeof deviceMaintenance.$inferSelect;\n\nexport const staffVisibilitySettings = sqliteTable(\"staff_visibility_settings\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  pages: text(\"pages\").notNull().default(JSON.stringify({\n    dashboard: true,\n    bookings: true,\n    history: true,\n    food: true,\n    inventory: false,\n    expenses: false,\n    ledger: false,\n    analytics: false,\n    maintenance: false,\n    settings: false,\n  })),\n  elements: text(\"elements\").notNull().default(JSON.stringify({\n    customerPhone: true,\n    paymentDetails: true,\n    revenueNumbers: false,\n    expenseAmounts: false,\n    profitLoss: false,\n    costPrices: false,\n  })),\n  updatedAt: integer(\"updated_at\", { mode: \"timestamp\" }).notNull().$defaultFn(() => new Date()),\n});\n\nexport const insertStaffVisibilitySettingsSchema = createInsertSchema(staffVisibilitySettings).omit({ id: true, updatedAt: true });\nexport type InsertStaffVisibilitySettings = z.infer<typeof insertStaffVisibilitySettingsSchema>;\nexport type StaffVisibilitySettings = typeof staffVisibilitySettings.$inferSelect;\n\nexport type VisibilityPages = {\n  dashboard: boolean;\n  bookings: boolean;\n  history: boolean;\n  food: boolean;\n  inventory: boolean;\n  expenses: boolean;\n  ledger: boolean;\n  analytics: boolean;\n  maintenance: boolean;\n  settings: boolean;\n};\n\nexport type VisibilityElements = {\n  customerPhone: boolean;\n  paymentDetails: boolean;\n  revenueNumbers: boolean;\n  expenseAmounts: boolean;\n  profitLoss: boolean;\n  costPrices: boolean;\n};\n\nexport const paymentLogs = sqliteTable(\"payment_logs\", {\n  id: text(\"id\").primaryKey().$defaultFn(() => crypto.randomUUID()),\n  bookingId: text(\"booking_id\").notNull(),\n  seatName: text(\"seat_name\").notNull(),\n  customerName: text(\"customer_name\").notNull(),\n  amount: text(\"amount\").notNull(),\n  paymentMethod: text(\"payment_method\").notNull(),\n  paymentStatus: text(\"payment_status\").notNull(),\n  userId: text(\"user_id\").notNull(),\n  username: text(\"username\").notNull(),\n  previousStatus: text(\"previous_status\"),\n  previousMethod: text(\"previous_method\"),\n  createdAt: integer(\"created_at\", { mode: \"timestamp\" }).notNull().$defaultFn(() => new Date()),\n});\n\nexport const insertPaymentLogSchema = createInsertSchema(paymentLogs).omit({ id: true, createdAt: true });\nexport type InsertPaymentLog = z.infer<typeof insertPaymentLogSchema>;\nexport type PaymentLog = typeof paymentLogs.$inferSelect;\n","path":null,"size_bytes":24072,"size_tokens":null},"client/src/pages/Analytics.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { AreaChart, Area, BarChart, Bar, PieChart, Pie, Cell, LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, ComposedChart } from \"recharts\";\nimport { Activity, TrendingUp, Users, IndianRupee, Zap, RefreshCw, Calendar, Clock, ShoppingBag, UserCheck, Sparkles, Brain, Download } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { saveChartAsImage } from \"@/lib/chartUtils\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { useAuth } from \"@/contexts/AuthContext\";\n\ninterface UsageStats {\n  currentOccupancy: number;\n  totalCapacity: number;\n  occupancyRate: number;\n  activeBookings: number;\n  categoryUsage: Array<{\n    category: string;\n    occupied: number;\n    total: number;\n    percentage: number;\n  }>;\n  hourlyUsage: Array<{\n    hour: string;\n    bookings: number;\n    revenue: number;\n  }>;\n  realtimeData: Array<{\n    timestamp: string;\n    occupancy: number;\n    capacity: number;\n  }>;\n  uniqueCustomers: number;\n  avgSessionDuration: number;\n  totalFoodOrders: number;\n  foodRevenue: number;\n}\n\ninterface TrafficPrediction {\n  predictions: Array<{\n    hour: string;\n    predictedVisitors: number;\n    confidence: \"low\" | \"medium\" | \"high\";\n  }>;\n  summary: {\n    peakHour: string;\n    peakVisitors: number;\n    totalPredictedVisitors: number;\n    averageVisitors: number;\n    insights: string[];\n  };\n  generatedAt: string;\n}\n\nconst COLORS = ['#8b5cf6', '#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#ec4899'];\n\nexport default function Analytics() {\n  const [timeRange, setTimeRange] = useState<string>(\"today\");\n  const [activeTab, setActiveTab] = useState<string>(\"overview\");\n  const { isStaff } = useAuth();\n\n  const { data: stats, isLoading, refetch, isFetching } = useQuery<UsageStats>({\n    queryKey: [`/api/analytics/usage?timeRange=${timeRange}`],\n  });\n\n  const { data: trafficPrediction, isLoading: isLoadingPrediction } = useQuery<TrafficPrediction>({\n    queryKey: [\"/api/ai/traffic/predictions\"],\n    enabled: timeRange === \"today\",\n  });\n\n  // Convert UTC time to India Standard Time (Asia/Kolkata)\n  const convertToIST = (utcTimeString: string, isHourFormat: boolean = false): string => {\n    if (isHourFormat) {\n      // For hour format like \"14:00\", create a date object and convert to IST\n      const [hour] = utcTimeString.split(':').map(Number);\n      const utcDate = new Date();\n      utcDate.setUTCHours(hour, 0, 0, 0);\n      const istHour = utcDate.toLocaleString('en-IN', { \n        timeZone: 'Asia/Kolkata',\n        hour: '2-digit',\n        minute: '2-digit',\n        hour12: false\n      });\n      return istHour;\n    } else {\n      // For timestamp format, parse and convert to IST\n      const now = new Date();\n      const [time] = utcTimeString.split(' ');\n      const [hours, minutes, seconds] = time.split(':').map(Number);\n      now.setUTCHours(hours, minutes, seconds || 0, 0);\n      return now.toLocaleString('en-IN', {\n        timeZone: 'Asia/Kolkata',\n        hour: '2-digit',\n        minute: '2-digit',\n        second: '2-digit',\n        hour12: false\n      });\n    }\n  };\n\n  // Transform data with IST timezone conversion\n  const transformedStats = useMemo(() => {\n    if (!stats) return null;\n\n    return {\n      ...stats,\n      hourlyUsage: stats.hourlyUsage?.map(item => ({\n        ...item,\n        hour: convertToIST(item.hour, true)\n      })) || [],\n      realtimeData: stats.realtimeData?.map(item => ({\n        ...item,\n        timestamp: convertToIST(item.timestamp, false)\n      })) || []\n    };\n  }, [stats]);\n\n  const metrics = useMemo(() => {\n    if (!transformedStats) return null;\n\n    const totalRevenue = transformedStats.hourlyUsage?.reduce((sum, item) => sum + (item.revenue || 0), 0) || 0;\n    const avgBookingsPerHour = transformedStats.hourlyUsage && transformedStats.hourlyUsage.length > 0\n      ? Math.round(transformedStats.hourlyUsage.reduce((sum, item) => sum + item.bookings, 0) / transformedStats.hourlyUsage.length)\n      : 0;\n\n    const peakHours = [...(transformedStats.hourlyUsage || [])]\n      .sort((a, b) => b.bookings - a.bookings)\n      .slice(0, 3);\n\n    return {\n      totalRevenue,\n      avgBookingsPerHour,\n      peakHours,\n      occupancyPercentage: Math.round(transformedStats.occupancyRate || 0),\n      availableSeats: (transformedStats.totalCapacity || 0) - (transformedStats.currentOccupancy || 0)\n    };\n  }, [transformedStats]);\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center space-y-4\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto\"></div>\n          <p className=\"text-muted-foreground\">Loading analytics...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background p-4 md:p-6 space-y-6\">\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"relative\">\n            <Brain className=\"h-8 w-8 text-blue-500 animate-pulse\" />\n            <Sparkles className=\"h-5 w-5 text-blue-400 absolute -top-1 -right-1 animate-bounce\" />\n          </div>\n          <div>\n            <h1 className=\"text-3xl font-bold tracking-tight\" data-testid=\"heading-analytics\">\n              Analytics Dashboard\n            </h1>\n            <p className=\"text-muted-foreground mt-1\">\n              Real-time insights and performance metrics\n            </p>\n          </div>\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <Select value={timeRange} onValueChange={setTimeRange}>\n            <SelectTrigger className=\"w-[160px]\" data-testid=\"select-timerange\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"today\">Today</SelectItem>\n              <SelectItem value=\"week\">This Week</SelectItem>\n              <SelectItem value=\"month\">This Month</SelectItem>\n              <SelectItem value=\"all\">All Time</SelectItem>\n            </SelectContent>\n          </Select>\n          <Button \n            onClick={() => refetch()} \n            disabled={isFetching}\n            variant=\"outline\"\n            size=\"sm\"\n            data-testid=\"button-refresh\"\n          >\n            <RefreshCw className={`h-4 w-4 mr-2 ${isFetching ? 'animate-spin' : ''}`} />\n            Refresh\n          </Button>\n        </div>\n      </div>\n\n      {/* Key Metrics Grid */}\n      <div className={`grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 ${isStaff ? 'xl:grid-cols-4' : 'xl:grid-cols-5'}`}>\n        <Card className=\"hover:shadow-lg transition-shadow shape-diagonal-rounded\">\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Occupancy</CardTitle>\n            <Users className=\"h-4 w-4 text-violet-500\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"text-current-occupancy\">\n              {transformedStats?.currentOccupancy || 0}/{transformedStats?.totalCapacity || 0}\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              {metrics?.occupancyPercentage}% capacity\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card className=\"hover:shadow-lg transition-shadow shape-diagonal-rounded\">\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Occupancy Rate</CardTitle>\n            <TrendingUp className=\"h-4 w-4 text-blue-500\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"text-occupancy-rate\">\n              {metrics?.occupancyPercentage}%\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Real-time utilization\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card className=\"hover:shadow-lg transition-shadow shape-diagonal-rounded\">\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Active Sessions</CardTitle>\n            <Activity className=\"h-4 w-4 text-green-500\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"text-active-bookings\">\n              {transformedStats?.activeBookings || 0}\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Running now\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card className=\"hover:shadow-lg transition-shadow shape-diagonal-rounded\">\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Available</CardTitle>\n            <Calendar className=\"h-4 w-4 text-orange-500\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"text-available-seats\">\n              {metrics?.availableSeats || 0}\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Seats ready\n            </p>\n          </CardContent>\n        </Card>\n\n        {!isStaff && (\n          <Card className=\"hover:shadow-lg transition-shadow shape-diagonal-rounded\">\n            <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Revenue</CardTitle>\n              <IndianRupee className=\"h-4 w-4 text-emerald-500\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\" data-testid=\"text-total-revenue\">\n                ‚Çπ{metrics?.totalRevenue.toFixed(2) || \"0.00\"}\n              </div>\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                {timeRange === \"today\" ? \"Today\" : \"Period total\"}\n              </p>\n            </CardContent>\n          </Card>\n        )}\n\n        <Card className=\"hover:shadow-lg transition-shadow shape-diagonal-rounded\">\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Customers</CardTitle>\n            <UserCheck className=\"h-4 w-4 text-pink-500\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"text-unique-customers\">\n              {transformedStats?.uniqueCustomers || 0}\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Unique walk-ins\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Additional Metrics Grid */}\n      <div className={`grid gap-4 grid-cols-1 sm:grid-cols-2 ${isStaff ? 'lg:grid-cols-3' : 'lg:grid-cols-4'}`}>\n        <Card className=\"hover:shadow-lg transition-shadow shape-diagonal-rounded\">\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Avg Session</CardTitle>\n            <Clock className=\"h-4 w-4 text-blue-500\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"text-avg-session\">\n              {transformedStats?.avgSessionDuration || 0} min\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Per customer\n            </p>\n          </CardContent>\n        </Card>\n\n        <Card className=\"hover:shadow-lg transition-shadow shape-diagonal-rounded\">\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Food Orders</CardTitle>\n            <ShoppingBag className=\"h-4 w-4 text-orange-500\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"text-food-orders\">\n              {transformedStats?.totalFoodOrders || 0}\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Total orders\n            </p>\n          </CardContent>\n        </Card>\n\n        {!isStaff && (\n          <Card className=\"hover:shadow-lg transition-shadow shape-diagonal-rounded\">\n            <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Food Revenue</CardTitle>\n              <IndianRupee className=\"h-4 w-4 text-green-500\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\" data-testid=\"text-food-revenue\">\n                ‚Çπ{transformedStats?.foodRevenue?.toFixed(2) || \"0.00\"}\n              </div>\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                From food sales\n              </p>\n            </CardContent>\n          </Card>\n        )}\n\n        <Card className=\"hover:shadow-lg transition-shadow shape-diagonal-rounded\">\n          <CardHeader className=\"flex flex-row items-center justify-between pb-2\">\n            <CardTitle className=\"text-sm font-medium\">Avg/Hour</CardTitle>\n            <Zap className=\"h-4 w-4 text-purple-500\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\" data-testid=\"text-avg-bookings\">\n              {metrics?.avgBookingsPerHour || 0}\n            </div>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Bookings/hr\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Tabs for Different Views */}\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-3 lg:w-[400px]\">\n          <TabsTrigger value=\"overview\">Overview</TabsTrigger>\n          <TabsTrigger value=\"performance\">Performance</TabsTrigger>\n          <TabsTrigger value=\"insights\">Insights</TabsTrigger>\n        </TabsList>\n\n        {/* Overview Tab */}\n        <TabsContent value=\"overview\" className=\"space-y-4 mt-6\">\n          <Card id=\"occupancy-trend-chart\" className=\"shape-diagonal-rounded\">\n            <CardHeader className=\"flex flex-row items-center justify-between\">\n              <div>\n                <CardTitle>Occupancy Trend</CardTitle>\n                <CardDescription>Real-time seat utilization over time</CardDescription>\n              </div>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => saveChartAsImage(\"occupancy-trend-chart\", \"occupancy-trend\")}\n                data-testid=\"button-save-occupancy-trend\"\n              >\n                <Download className=\"h-4 w-4 mr-2\" />\n                Save as Image\n              </Button>\n            </CardHeader>\n            <CardContent>\n              {transformedStats?.realtimeData && transformedStats.realtimeData.length > 0 ? (\n                <ResponsiveContainer width=\"100%\" height={300}>\n                  <AreaChart data={transformedStats.realtimeData}>\n                    <defs>\n                      <linearGradient id=\"occupancyGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                        <stop offset=\"5%\" stopColor=\"#8b5cf6\" stopOpacity={0.8}/>\n                        <stop offset=\"95%\" stopColor=\"#8b5cf6\" stopOpacity={0.1}/>\n                      </linearGradient>\n                    </defs>\n                    <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                    <XAxis dataKey=\"timestamp\" className=\"text-xs\" />\n                    <YAxis className=\"text-xs\" />\n                    <Tooltip contentStyle={{ backgroundColor: 'hsl(var(--card))', border: '1px solid hsl(var(--border))' }} />\n                    <Legend />\n                    <Area type=\"monotone\" dataKey=\"occupancy\" stroke=\"#8b5cf6\" fill=\"url(#occupancyGradient)\" name=\"Occupied\" />\n                    <Area type=\"monotone\" dataKey=\"capacity\" stroke=\"#3b82f6\" fill=\"transparent\" strokeDasharray=\"5 5\" name=\"Capacity\" />\n                  </AreaChart>\n                </ResponsiveContainer>\n              ) : (\n                <div className=\"h-[300px] flex items-center justify-center border-2 border-dashed rounded-lg\">\n                  <div className=\"text-center p-6\">\n                    <Activity className=\"h-12 w-12 mx-auto mb-3 text-muted-foreground\" />\n                    <p className=\"font-semibold\">No Data Available</p>\n                    <p className=\"text-sm text-muted-foreground mt-1\">Create bookings to see trends</p>\n                  </div>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          <div className=\"grid gap-4 md:grid-cols-2\">\n            <Card id=\"category-distribution-chart\" className=\"shape-diagonal-rounded\">\n              <CardHeader className=\"flex flex-row items-center justify-between\">\n                <div>\n                  <CardTitle>Category Distribution</CardTitle>\n                  <CardDescription>Usage by device category</CardDescription>\n                </div>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => saveChartAsImage(\"category-distribution-chart\", \"category-distribution\")}\n                  data-testid=\"button-save-category-distribution\"\n                >\n                  <Download className=\"h-4 w-4 mr-2\" />\n                  Save as Image\n                </Button>\n              </CardHeader>\n              <CardContent>\n                {transformedStats?.categoryUsage && transformedStats.categoryUsage.length > 0 ? (\n                  <ResponsiveContainer width=\"100%\" height={250}>\n                    <PieChart>\n                      <Pie\n                        data={transformedStats.categoryUsage}\n                        cx=\"50%\"\n                        cy=\"50%\"\n                        labelLine={false}\n                        label={({ category, percentage }) => `${category}: ${percentage}%`}\n                        outerRadius={80}\n                        dataKey=\"occupied\"\n                      >\n                        {transformedStats.categoryUsage.map((_, index) => (\n                          <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\n                        ))}\n                      </Pie>\n                      <Tooltip />\n                    </PieChart>\n                  </ResponsiveContainer>\n                ) : (\n                  <div className=\"h-[250px] flex items-center justify-center border-2 border-dashed rounded-lg\">\n                    <div className=\"text-center p-4\">\n                      <Users className=\"h-12 w-12 mx-auto mb-3 text-muted-foreground\" />\n                      <p className=\"text-sm\">Configure categories in Settings</p>\n                    </div>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            <Card id=\"hourly-activity-chart\" className=\"shape-diagonal-rounded\">\n              <CardHeader className=\"flex flex-row items-center justify-between\">\n                <div>\n                  <CardTitle>Hourly Activity</CardTitle>\n                  <CardDescription>Bookings throughout the day</CardDescription>\n                </div>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => saveChartAsImage(\"hourly-activity-chart\", \"hourly-activity\")}\n                  data-testid=\"button-save-hourly-activity\"\n                >\n                  <Download className=\"h-4 w-4 mr-2\" />\n                  Save as Image\n                </Button>\n              </CardHeader>\n              <CardContent>\n                {transformedStats?.hourlyUsage && transformedStats.hourlyUsage.length > 0 ? (\n                  <ResponsiveContainer width=\"100%\" height={250}>\n                    <BarChart data={transformedStats.hourlyUsage}>\n                      <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                      <XAxis dataKey=\"hour\" className=\"text-xs\" />\n                      <YAxis className=\"text-xs\" />\n                      <Tooltip contentStyle={{ backgroundColor: 'hsl(var(--card))', border: '1px solid hsl(var(--border))' }} />\n                      <Bar dataKey=\"bookings\" fill=\"#8b5cf6\" radius={[6, 6, 0, 0]} />\n                    </BarChart>\n                  </ResponsiveContainer>\n                ) : (\n                  <div className=\"h-[250px] flex items-center justify-center border-2 border-dashed rounded-lg\">\n                    <div className=\"text-center p-4\">\n                      <Activity className=\"h-12 w-12 mx-auto mb-3 text-muted-foreground\" />\n                      <p className=\"text-sm\">No bookings yet</p>\n                    </div>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n\n        {/* Performance Tab */}\n        <TabsContent value=\"performance\" className=\"space-y-4 mt-6\">\n          <Card id=\"revenue-bookings-chart\" className=\"shape-diagonal-rounded\">\n            <CardHeader className=\"flex flex-row items-center justify-between\">\n              <div>\n                <CardTitle>Revenue & Bookings</CardTitle>\n                <CardDescription>Combined performance metrics</CardDescription>\n              </div>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => saveChartAsImage(\"revenue-bookings-chart\", \"revenue-bookings\")}\n                data-testid=\"button-save-revenue-bookings\"\n              >\n                <Download className=\"h-4 w-4 mr-2\" />\n                Save as Image\n              </Button>\n            </CardHeader>\n            <CardContent>\n              {transformedStats?.hourlyUsage && transformedStats.hourlyUsage.length > 0 ? (\n                <ResponsiveContainer width=\"100%\" height={350}>\n                  <ComposedChart data={transformedStats.hourlyUsage}>\n                    <CartesianGrid strokeDasharray=\"3 3\" />\n                    <XAxis dataKey=\"hour\" />\n                    <YAxis yAxisId=\"left\" />\n                    <YAxis yAxisId=\"right\" orientation=\"right\" />\n                    <Tooltip />\n                    <Legend />\n                    <Bar yAxisId=\"left\" dataKey=\"revenue\" fill=\"#10b981\" name=\"Revenue (‚Çπ)\" radius={[6, 6, 0, 0]} />\n                    <Line yAxisId=\"right\" type=\"monotone\" dataKey=\"bookings\" stroke=\"#8b5cf6\" strokeWidth={2} name=\"Bookings\" />\n                  </ComposedChart>\n                </ResponsiveContainer>\n              ) : (\n                <div className=\"h-[350px] flex items-center justify-center border-2 border-dashed rounded-lg\">\n                  <div className=\"text-center p-6\">\n                    <IndianRupee className=\"h-12 w-12 mx-auto mb-3 text-muted-foreground\" />\n                    <p className=\"text-sm\">Create bookings to see performance data</p>\n                  </div>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Insights Tab */}\n        <TabsContent value=\"insights\" className=\"space-y-4 mt-6\">\n          <Card id=\"peak-hours-chart\" className=\"shape-diagonal-rounded\">\n            <CardHeader className=\"flex flex-row items-center justify-between\">\n              <div>\n                <CardTitle>Peak Hours</CardTitle>\n                <CardDescription>Top 3 busiest hours</CardDescription>\n              </div>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => saveChartAsImage(\"peak-hours-chart\", \"peak-hours\")}\n                data-testid=\"button-save-peak-hours\"\n              >\n                <Download className=\"h-4 w-4 mr-2\" />\n                Save as Image\n              </Button>\n            </CardHeader>\n            <CardContent>\n              {metrics?.peakHours && metrics.peakHours.length > 0 ? (\n                <div className=\"space-y-4\">\n                  {metrics.peakHours.map((peak, index) => (\n                    <div key={peak.hour} className=\"flex items-center gap-4\">\n                      <div className=\"flex items-center justify-center w-10 h-10 rounded-full bg-primary/10 text-primary font-bold\">\n                        #{index + 1}\n                      </div>\n                      <div className=\"flex-1\">\n                        <div className=\"flex justify-between mb-1\">\n                          <span className=\"font-semibold\">{peak.hour}</span>\n                          <span className=\"text-sm text-muted-foreground\">{peak.bookings} bookings</span>\n                        </div>\n                        <div className=\"w-full bg-secondary rounded-full h-2\">\n                          <div \n                            className=\"bg-primary h-2 rounded-full transition-all\"\n                            style={{ width: `${(peak.bookings / (metrics.peakHours[0]?.bookings || 1)) * 100}%` }}\n                          />\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                  <div className=\"mt-6 p-4 bg-muted/50 rounded-lg\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <Zap className=\"h-5 w-5 text-primary\" />\n                      <span className=\"font-semibold\">Peak Insight</span>\n                    </div>\n                    <p className=\"text-sm text-muted-foreground\">\n                      {metrics.peakHours[0]?.hour} is your busiest hour with {metrics.peakHours[0]?.bookings} bookings\n                      {metrics.peakHours[0]?.revenue ? ` generating ‚Çπ${Number(metrics.peakHours[0].revenue).toFixed(2)}` : ''}\n                    </p>\n                  </div>\n                </div>\n              ) : (\n                <div className=\"h-[250px] flex items-center justify-center border-2 border-dashed rounded-lg\">\n                  <div className=\"text-center p-6\">\n                    <TrendingUp className=\"h-12 w-12 mx-auto mb-3 text-muted-foreground\" />\n                    <p className=\"text-sm\">No peak hours data available</p>\n                  </div>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          {/* Traffic Prediction Card */}\n          {timeRange === \"today\" && (\n            <Card id=\"ai-traffic-prediction-chart\" className=\"shape-diagonal-rounded border-blue-500/20\">\n              <CardHeader className=\"flex flex-row items-center justify-between\">\n                <div>\n                  <div className=\"flex items-center gap-2\">\n                    <Brain className=\"h-5 w-5 text-blue-500\" />\n                    <CardTitle>Visitor Traffic Prediction</CardTitle>\n                  </div>\n                  <CardDescription>Predicted visitor count by hour for today</CardDescription>\n                </div>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => saveChartAsImage(\"ai-traffic-prediction-chart\", \"traffic-prediction\")}\n                  data-testid=\"button-save-traffic-prediction\"\n                >\n                  <Download className=\"h-4 w-4 mr-2\" />\n                  Save as Image\n                </Button>\n              </CardHeader>\n              <CardContent>\n                {isLoadingPrediction ? (\n                  <div className=\"h-[400px] flex items-center justify-center\">\n                    <div className=\"text-center space-y-4\">\n                      <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto\"></div>\n                      <p className=\"text-sm text-muted-foreground\">Generating predictions...</p>\n                    </div>\n                  </div>\n                ) : trafficPrediction?.predictions && trafficPrediction.predictions.length > 0 ? (\n                  <div className=\"space-y-6\">\n                    {/* Summary Insights */}\n                    <div className=\"grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-4\">\n                      <div className=\"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg\">\n                        <div className=\"flex items-center gap-2 mb-1\">\n                          <TrendingUp className=\"h-4 w-4 text-blue-500\" />\n                          <span className=\"text-sm font-medium\">Peak Hour</span>\n                        </div>\n                        <p className=\"text-2xl font-bold text-blue-600 dark:text-blue-400\">\n                          {(() => {\n                            const [hour] = trafficPrediction.summary.peakHour.split(':').map(Number);\n                            const isPM = hour >= 12;\n                            const displayHour = hour === 0 ? 12 : hour > 12 ? hour - 12 : hour;\n                            return `${displayHour} ${isPM ? 'PM' : 'AM'}`;\n                          })()}\n                        </p>\n                      </div>\n                      <div className=\"p-4 bg-purple-50 dark:bg-purple-950/20 rounded-lg\">\n                        <div className=\"flex items-center gap-2 mb-1\">\n                          <Users className=\"h-4 w-4 text-purple-500\" />\n                          <span className=\"text-sm font-medium\">Peak Visitors</span>\n                        </div>\n                        <p className=\"text-2xl font-bold text-purple-600 dark:text-purple-400\">\n                          {trafficPrediction.summary.peakVisitors}\n                        </p>\n                      </div>\n                      <div className=\"p-4 bg-green-50 dark:bg-green-950/20 rounded-lg\">\n                        <div className=\"flex items-center gap-2 mb-1\">\n                          <Activity className=\"h-4 w-4 text-green-500\" />\n                          <span className=\"text-sm font-medium\">Total Predicted</span>\n                        </div>\n                        <p className=\"text-2xl font-bold text-green-600 dark:text-green-400\">\n                          {trafficPrediction.summary.totalPredictedVisitors}\n                        </p>\n                      </div>\n                      <div className=\"p-4 bg-orange-50 dark:bg-orange-950/20 rounded-lg\">\n                        <div className=\"flex items-center gap-2 mb-1\">\n                          <Zap className=\"h-4 w-4 text-orange-500\" />\n                          <span className=\"text-sm font-medium\">Avg/Hour</span>\n                        </div>\n                        <p className=\"text-2xl font-bold text-orange-600 dark:text-orange-400\">\n                          {trafficPrediction.summary.averageVisitors}\n                        </p>\n                      </div>\n                    </div>\n\n                    {/* Chart */}\n                    <ResponsiveContainer width=\"100%\" height={400}>\n                      <ComposedChart data={trafficPrediction.predictions.map(p => ({\n                        ...p,\n                        displayHour: (() => {\n                          const [hour] = p.hour.split(':').map(Number);\n                          const isPM = hour >= 12;\n                          const displayHour = hour === 0 ? 12 : hour > 12 ? hour - 12 : hour;\n                          return `${displayHour} ${isPM ? 'PM' : 'AM'}`;\n                        })(),\n                        originalHour: p.hour\n                      }))}>\n                        <defs>\n                          <linearGradient id=\"trafficGradient\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                            <stop offset=\"5%\" stopColor=\"#3b82f6\" stopOpacity={0.8}/>\n                            <stop offset=\"95%\" stopColor=\"#3b82f6\" stopOpacity={0.1}/>\n                          </linearGradient>\n                        </defs>\n                        <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-muted\" />\n                        <XAxis \n                          dataKey=\"displayHour\" \n                          className=\"text-xs\"\n                          angle={-45}\n                          textAnchor=\"end\"\n                          height={80}\n                        />\n                        <YAxis className=\"text-xs\" label={{ value: 'Visitors', angle: -90, position: 'insideLeft' }} />\n                        <Tooltip \n                          contentStyle={{ \n                            backgroundColor: 'hsl(var(--card))', \n                            border: '1px solid hsl(var(--border))',\n                            borderRadius: '8px'\n                          }}\n                          content={({ active, payload }) => {\n                            if (active && payload && payload.length) {\n                              const data = payload[0].payload;\n                              return (\n                                <div className=\"bg-card border border-border p-3 rounded-lg shadow-lg\">\n                                  <p className=\"font-semibold mb-1\">{data.displayHour}</p>\n                                  <p className=\"text-sm text-blue-600 dark:text-blue-400\">\n                                    Predicted: {data.predictedVisitors} visitors\n                                  </p>\n                                  <p className=\"text-xs text-muted-foreground mt-1\">\n                                    Confidence: {data.confidence}\n                                  </p>\n                                </div>\n                              );\n                            }\n                            return null;\n                          }}\n                        />\n                        <Legend />\n                        <Area \n                          type=\"monotone\" \n                          dataKey=\"predictedVisitors\" \n                          stroke=\"#3b82f6\" \n                          fill=\"url(#trafficGradient)\" \n                          name=\"Predicted Visitors\"\n                          strokeWidth={2}\n                        />\n                        <Line \n                          type=\"monotone\" \n                          dataKey=\"predictedVisitors\" \n                          stroke=\"#8b5cf6\" \n                          strokeWidth={3}\n                          dot={{ r: 4, fill: '#8b5cf6' }}\n                          name=\"Trend\"\n                        />\n                      </ComposedChart>\n                    </ResponsiveContainer>\n\n                    {/* Insights */}\n                    {trafficPrediction.summary.insights && trafficPrediction.summary.insights.length > 0 && (\n                      <div className=\"p-4 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-950/20 dark:to-purple-950/20 rounded-lg\">\n                        <div className=\"flex items-center gap-2 mb-3\">\n                          <Sparkles className=\"h-5 w-5 text-blue-500\" />\n                          <span className=\"font-semibold text-foreground\">Insights</span>\n                        </div>\n                        <ul className=\"space-y-2\">\n                          {trafficPrediction.summary.insights.map((insight, index) => (\n                            <li key={index} className=\"flex items-start gap-2 text-sm\">\n                              <div className=\"h-1.5 w-1.5 rounded-full bg-blue-500 mt-1.5 flex-shrink-0\"></div>\n                              <span className=\"text-muted-foreground\">{insight}</span>\n                            </li>\n                          ))}\n                        </ul>\n                        <p className=\"text-xs text-muted-foreground mt-3\">\n                          Generated at: {new Date(trafficPrediction.generatedAt).toLocaleString()}\n                        </p>\n                      </div>\n                    )}\n                  </div>\n                ) : (\n                  <div className=\"h-[400px] flex items-center justify-center border-2 border-dashed rounded-lg\">\n                    <div className=\"text-center p-6\">\n                      <Brain className=\"h-12 w-12 mx-auto mb-3 text-muted-foreground\" />\n                      <p className=\"font-semibold\">No Prediction Available</p>\n                      <p className=\"text-sm text-muted-foreground mt-1\">\n                        Historical data is needed to make predictions\n                      </p>\n                    </div>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          )}\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","path":null,"size_bytes":36844,"size_tokens":null},"client/src/contexts/AuthContext.tsx":{"content":"import { createContext, useContext, ReactNode } from \"react\";\n\ninterface User {\n  id: string;\n  username: string;\n  role: \"admin\" | \"staff\";\n  onboardingCompleted?: boolean;\n}\n\ninterface AuthContextType {\n  user: User | null;\n  isAdmin: boolean;\n  isStaff: boolean;\n  canMakeChanges: boolean;\n  deviceRestricted: boolean;\n  onboardingCompleted: boolean;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport function AuthProvider({ children, user }: { children: ReactNode; user: User | null }) {\n  const isAdmin = user?.role === \"admin\";\n  const isStaff = user?.role === \"staff\";\n  \n  const isStaffOrAdmin = user?.role === \"admin\" || user?.role === \"staff\";\n  const canMakeChanges = isStaffOrAdmin ? true : true;\n  const deviceRestricted = false;\n  const onboardingCompleted = user?.onboardingCompleted ?? true;\n\n  return (\n    <AuthContext.Provider value={{ user, isAdmin, isStaff, canMakeChanges, deviceRestricted, onboardingCompleted }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error(\"useAuth must be used within an AuthProvider\");\n  }\n  return context;\n}\n","path":null,"size_bytes":1220,"size_tokens":null},"server/seed.ts":{"content":"import { db } from \"./db\";\nimport { bookings, deviceConfigs, pricingConfigs } from \"@shared/schema\";\nimport { sql } from \"drizzle-orm\";\n\nasync function seed() {\n  try {\n    console.log(\"üå± Seeding database with fake walk-in data...\");\n\n    // Clear existing bookings\n    await db.delete(bookings);\n    console.log(\"‚úÖ Cleared existing bookings\");\n\n    // Get device configs\n    const configs = await db.select().from(deviceConfigs);\n    if (configs.length === 0) {\n      console.log(\"‚ùå No device configs found. Please initialize the database first.\");\n      process.exit(1);\n    }\n\n    // Get pricing configs\n    const pricing = await db.select().from(pricingConfigs);\n    if (pricing.length === 0) {\n      console.log(\"‚ùå No pricing configs found. Please initialize the database first.\");\n      process.exit(1);\n    }\n\n    const now = new Date();\n    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n\n    // Create fake walk-in bookings for today\n    const fakeBookings = [];\n\n    // Active PC bookings\n    fakeBookings.push({\n      category: \"PC\",\n      seatNumber: 1,\n      seatName: \"PC-1\",\n      customerName: \"John Doe\",\n      whatsappNumber: \"+1234567890\",\n      startTime: new Date(today.getTime() + 8 * 60 * 60 * 1000), // 8 AM\n      endTime: new Date(today.getTime() + 10 * 60 * 60 * 1000), // 10 AM\n      price: \"30\",\n      status: \"running\",\n      bookingType: \"walk-in\",\n      foodOrders: [\n        { foodId: \"1\", foodName: \"Pizza\", price: \"8\", quantity: 1 },\n        { foodId: \"2\", foodName: \"Soda\", price: \"2\", quantity: 2 }\n      ]\n    });\n\n    fakeBookings.push({\n      category: \"PC\",\n      seatNumber: 2,\n      seatName: \"PC-2\",\n      customerName: \"Jane Smith\",\n      startTime: new Date(today.getTime() + 9 * 60 * 60 * 1000), // 9 AM\n      endTime: new Date(today.getTime() + 10 * 60 * 60 * 1000), // 10 AM\n      price: \"18\",\n      status: \"running\",\n      bookingType: \"walk-in\"\n    });\n\n    // Active PS5 booking\n    fakeBookings.push({\n      category: \"PS5\",\n      seatNumber: 1,\n      seatName: \"PS5-1\",\n      customerName: \"Mike Johnson\",\n      whatsappNumber: \"+1234567891\",\n      startTime: new Date(today.getTime() + 10 * 60 * 60 * 1000), // 10 AM\n      endTime: new Date(today.getTime() + 12 * 60 * 60 * 1000), // 12 PM\n      price: \"45\",\n      status: \"running\",\n      bookingType: \"walk-in\",\n      foodOrders: [\n        { foodId: \"3\", foodName: \"Burger\", price: \"6\", quantity: 1 }\n      ]\n    });\n\n    // Paused booking\n    fakeBookings.push({\n      category: \"PC\",\n      seatNumber: 3,\n      seatName: \"PC-3\",\n      customerName: \"Sarah Williams\",\n      startTime: new Date(today.getTime() + 11 * 60 * 60 * 1000), // 11 AM\n      endTime: new Date(today.getTime() + 13 * 60 * 60 * 1000), // 1 PM\n      price: \"30\",\n      status: \"paused\",\n      pausedRemainingTime: 45,\n      bookingType: \"walk-in\"\n    });\n\n    // Earlier completed bookings (different hours for hourly analytics)\n    fakeBookings.push({\n      category: \"PC\",\n      seatNumber: 4,\n      seatName: \"PC-4\",\n      customerName: \"Robert Brown\",\n      startTime: new Date(today.getTime() + 6 * 60 * 60 * 1000), // 6 AM\n      endTime: new Date(today.getTime() + 7 * 60 * 60 * 1000), // 7 AM\n      price: \"18\",\n      status: \"expired\",\n      bookingType: \"walk-in\"\n    });\n\n    fakeBookings.push({\n      category: \"PS5\",\n      seatNumber: 2,\n      seatName: \"PS5-2\",\n      customerName: \"Emily Davis\",\n      startTime: new Date(today.getTime() + 7 * 60 * 60 * 1000), // 7 AM\n      endTime: new Date(today.getTime() + 8 * 60 * 60 * 1000), // 8 AM\n      price: \"25\",\n      status: \"expired\",\n      bookingType: \"walk-in\",\n      foodOrders: [\n        { foodId: \"4\", foodName: \"Fries\", price: \"3\", quantity: 2 }\n      ]\n    });\n\n    fakeBookings.push({\n      category: \"PC\",\n      seatNumber: 5,\n      seatName: \"PC-5\",\n      customerName: \"David Wilson\",\n      startTime: new Date(today.getTime() + 12 * 60 * 60 * 1000), // 12 PM\n      endTime: new Date(today.getTime() + 14 * 60 * 60 * 1000), // 2 PM\n      price: \"30\",\n      status: \"expired\",\n      bookingType: \"walk-in\"\n    });\n\n    // Add an upcoming booking (this should NOT appear in analytics)\n    fakeBookings.push({\n      category: \"PS5\",\n      seatNumber: 3,\n      seatName: \"PS5-3\",\n      customerName: \"Lisa Anderson\",\n      whatsappNumber: \"+1234567892\",\n      startTime: new Date(today.getTime() + 18 * 60 * 60 * 1000), // 6 PM\n      endTime: new Date(today.getTime() + 20 * 60 * 60 * 1000), // 8 PM\n      price: \"45\",\n      status: \"upcoming\",\n      bookingType: \"walk-in\"\n    });\n\n    // Insert all fake bookings\n    for (const booking of fakeBookings) {\n      await db.insert(bookings).values(booking);\n    }\n\n    console.log(`‚úÖ Created ${fakeBookings.length} fake walk-in bookings`);\n    console.log(\"üéâ Seeding completed successfully!\");\n    console.log(\"\\nBookings created:\");\n    console.log(`- Active/Paused: ${fakeBookings.filter(b => b.status === \"running\" || b.status === \"paused\").length}`);\n    console.log(`- Expired: ${fakeBookings.filter(b => b.status === \"expired\").length}`);\n    console.log(`- Upcoming (should NOT show in analytics): ${fakeBookings.filter(b => b.status === \"upcoming\").length}`);\n    \n    process.exit(0);\n  } catch (error) {\n    console.error(\"‚ùå Seeding failed:\", error);\n    process.exit(1);\n  }\n}\n\nseed();\n","path":null,"size_bytes":5338,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"client/src/hooks/use-device-type.tsx":{"content":"import * as React from \"react\"\n\nexport type DeviceType = \"desktop\" | \"tablet\" | \"mobile\"\n\nconst MOBILE_BREAKPOINT = 768\nconst TABLET_BREAKPOINT = 1024\n\nexport function useDeviceType(): DeviceType {\n  const [deviceType, setDeviceType] = React.useState<DeviceType>(() => {\n    if (typeof window === \"undefined\") return \"desktop\"\n    \n    const width = window.innerWidth\n    if (width < MOBILE_BREAKPOINT) return \"mobile\"\n    if (width < TABLET_BREAKPOINT) return \"tablet\"\n    return \"desktop\"\n  })\n\n  React.useEffect(() => {\n    const handleResize = () => {\n      const width = window.innerWidth\n      if (width < MOBILE_BREAKPOINT) {\n        setDeviceType(\"mobile\")\n      } else if (width < TABLET_BREAKPOINT) {\n        setDeviceType(\"tablet\")\n      } else {\n        setDeviceType(\"desktop\")\n      }\n    }\n\n    window.addEventListener(\"resize\", handleResize)\n    handleResize()\n\n    return () => window.removeEventListener(\"resize\", handleResize)\n  }, [])\n\n  return deviceType\n}\n\nexport function useIsDesktop(): boolean {\n  const deviceType = useDeviceType()\n  return deviceType === \"desktop\"\n}\n\nexport function useIsMobileOrTablet(): boolean {\n  const deviceType = useDeviceType()\n  return deviceType === \"mobile\" || deviceType === \"tablet\"\n}\n","path":null,"size_bytes":1243,"size_tokens":null},"client/src/pages/AIMaintenance.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Sparkles, Brain, AlertTriangle, CheckCircle2, Clock, Wrench, RefreshCw, TrendingUp, AlertCircle, Bug, Zap, Info } from \"lucide-react\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Progress } from \"@/components/ui/progress\";\n\ninterface MaintenancePrediction {\n  category: string;\n  seatName: string;\n  riskLevel: \"low\" | \"medium\" | \"high\";\n  recommendedAction: string;\n  estimatedDaysUntilMaintenance: number;\n  reasoning: string;\n  metrics: {\n    usageHours: number;\n    totalSessions: number;\n    issuesReported: number;\n    daysSinceLastMaintenance: number | null;\n  };\n}\n\ninterface MaintenanceInsights {\n  predictions: MaintenancePrediction[];\n  summary: {\n    highRiskDevices: number;\n    mediumRiskDevices: number;\n    lowRiskDevices: number;\n    totalDevices: number;\n    recommendedActions: string[];\n  };\n  generatedAt: string;\n}\n\n\nexport default function AIMaintenance() {\n  const { toast } = useToast();\n  const [activeTab, setActiveTab] = useState(\"overview\");\n  const [loadingProgress, setLoadingProgress] = useState(0);\n\n  const { data: insights, isLoading, refetch } = useQuery<MaintenanceInsights>({\n    queryKey: [\"/api/ai/maintenance/predictions\"],\n  });\n\n\n  useEffect(() => {\n    if (isLoading) {\n      setLoadingProgress(0);\n      const interval = setInterval(() => {\n        setLoadingProgress((prev) => {\n          if (prev >= 90) return prev;\n          return prev + 10;\n        });\n      }, 200);\n      return () => clearInterval(interval);\n    } else {\n      setLoadingProgress(100);\n    }\n  }, [isLoading]);\n\n  const updateStatusMutation = useMutation({\n    mutationFn: async ({ category, seatName, status, notes }: { category: string; seatName: string; status: string; notes?: string }) => {\n      const response = await fetch(`/api/maintenance/${category}/${encodeURIComponent(seatName)}/status`, {\n        method: \"PUT\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ status, notes }),\n      });\n      if (!response.ok) throw new Error(\"Failed to update status\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/ai/maintenance/predictions\"] });\n      toast({\n        title: \"Status Updated\",\n        description: \"Device maintenance status has been updated successfully.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Update Failed\",\n        description: error.message || \"Failed to update device status.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const reportIssueMutation = useMutation({\n    mutationFn: async ({ category, seatName, issueType }: { category: string; seatName: string; issueType: string }) => {\n      const response = await fetch(`/api/maintenance/${category}/${encodeURIComponent(seatName)}/report-issue`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ issueType }),\n      });\n      if (!response.ok) throw new Error(\"Failed to report issue\");\n      return response.json();\n    },\n    onSuccess: (data: any) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/ai/maintenance/predictions\"] });\n      toast({\n        title: \"Issue Reported\",\n        description: data.aiSuggestion || \"Issue has been recorded for analysis.\",\n      });\n      refetch();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Report Failed\",\n        description: error.message || \"Failed to report issue.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const getRiskBadge = (riskLevel: string) => {\n    switch (riskLevel) {\n      case \"high\":\n        return <Badge variant=\"destructive\" className=\"gap-1\"><AlertTriangle className=\"h-3 w-3\" />High Risk</Badge>;\n      case \"medium\":\n        return <Badge className=\"bg-yellow-600 hover:bg-yellow-700 gap-1\"><Clock className=\"h-3 w-3\" />Medium Risk</Badge>;\n      case \"low\":\n        return <Badge variant=\"secondary\" className=\"gap-1\"><CheckCircle2 className=\"h-3 w-3\" />Low Risk</Badge>;\n      default:\n        return <Badge variant=\"outline\">{riskLevel}</Badge>;\n    }\n  };\n\n  const getRiskColor = (riskLevel: string) => {\n    switch (riskLevel) {\n      case \"high\": return \"border-red-500 dark:border-red-900 bg-red-50 dark:bg-red-950/20\";\n      case \"medium\": return \"border-yellow-500 dark:border-yellow-900 bg-yellow-50 dark:bg-yellow-950/20\";\n      case \"low\": return \"border-green-500 dark:border-green-900 bg-green-50 dark:bg-green-950/20\";\n      default: return \"\";\n    }\n  };\n\n  const highRiskDevices = insights?.predictions.filter(p => p.riskLevel === \"high\") || [];\n  const mediumRiskDevices = insights?.predictions.filter(p => p.riskLevel === \"medium\") || [];\n  const lowRiskDevices = insights?.predictions.filter(p => p.riskLevel === \"low\") || [];\n\n  if (isLoading) {\n    return (\n      <div className=\"p-4 md:p-6 space-y-6\">\n        <div>\n          <h1 className=\"text-2xl md:text-3xl font-bold tracking-tight flex items-center gap-2\">\n            <Brain className=\"h-8 w-8 text-purple-600\" />\n            Predictive Maintenance\n          </h1>\n          <p className=\"text-muted-foreground mb-4\">Analyzing device usage and generating predictions...</p>\n          <div className=\"space-y-2\">\n            <Progress value={loadingProgress} className=\"h-2\" />\n            <p className=\"text-xs text-muted-foreground\">Processing {loadingProgress}%</p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-4 md:p-6 space-y-4 md:space-y-6\" data-testid=\"page-ai-maintenance\">\n      <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl md:text-3xl font-bold tracking-tight flex items-center gap-2\" data-testid=\"text-page-title\">\n            <Brain className=\"h-8 w-8 text-purple-600\" />\n            Predictive Maintenance\n          </h1>\n          <p className=\"text-sm md:text-base text-muted-foreground flex items-center gap-2 mt-1\">\n            <Sparkles className=\"h-4 w-4 text-purple-500\" />\n            Custom calculation-based device health analysis and predictions\n          </p>\n        </div>\n        <Button\n          onClick={() => refetch()}\n          variant=\"outline\"\n          className=\"gap-2\"\n          data-testid=\"button-refresh-predictions\"\n        >\n          <RefreshCw className=\"h-4 w-4\" />\n          Refresh Predictions\n        </Button>\n      </div>\n\n      {/* Prediction System Info */}\n      <Alert className=\"border-cyan-500/50 bg-cyan-50 dark:bg-cyan-950/20\">\n        <Zap className=\"h-4 w-4 text-cyan-600\" />\n        <AlertDescription className=\"text-sm\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <strong className=\"font-semibold text-cyan-900 dark:text-cyan-100\">Prediction System:</strong>\n              <span className=\"ml-2 text-cyan-800 dark:text-cyan-200\">\n                Using calculations based on your real gaming center data\n              </span>\n            </div>\n            <Badge className=\"ml-2 bg-cyan-600 hover:bg-cyan-700\">\n              <CheckCircle2 className=\"h-3 w-3 mr-1\" />\n              Active\n            </Badge>\n          </div>\n          <p className=\"text-xs text-cyan-700 dark:text-cyan-300 mt-2\">\n            Predictions using mathematical formulas based on usage hours, sessions, issues, and maintenance history\n          </p>\n        </AlertDescription>\n      </Alert>\n\n      {/* Summary Cards */}\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground\">Total Devices</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold\">{insights?.summary.totalDevices || 0}</div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-red-500/50 dark:border-red-900/50\">\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-red-600 dark:text-red-400 flex items-center gap-1\">\n              <AlertTriangle className=\"h-4 w-4\" />\n              High Risk\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-red-600 dark:text-red-400\">\n              {insights?.summary.highRiskDevices || 0}\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-yellow-500/50 dark:border-yellow-900/50\">\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-yellow-600 dark:text-yellow-400 flex items-center gap-1\">\n              <Clock className=\"h-4 w-4\" />\n              Medium Risk\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-yellow-600 dark:text-yellow-400\">\n              {insights?.summary.mediumRiskDevices || 0}\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-green-500/50 dark:border-green-900/50\">\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-green-600 dark:text-green-400 flex items-center gap-1\">\n              <CheckCircle2 className=\"h-4 w-4\" />\n              Healthy\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"text-2xl font-bold text-green-600 dark:text-green-400\">\n              {insights?.summary.lowRiskDevices || 0}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Recommendations */}\n      {insights && insights.summary.recommendedActions.length > 0 && (\n        <Alert className=\"border-purple-500/50 bg-purple-50 dark:bg-purple-950/20\">\n          <TrendingUp className=\"h-4 w-4 text-purple-600\" />\n          <AlertDescription className=\"text-sm\">\n            <strong className=\"font-semibold text-purple-900 dark:text-purple-100\">Recommendations:</strong>\n            <ul className=\"mt-2 space-y-1 list-disc list-inside\">\n              {insights.summary.recommendedActions.map((action, idx) => (\n                <li key={idx} className=\"text-purple-800 dark:text-purple-200\">{action}</li>\n              ))}\n            </ul>\n          </AlertDescription>\n        </Alert>\n      )}\n\n      {/* Device Predictions Tabs */}\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-4\">\n          <TabsTrigger value=\"overview\">Overview</TabsTrigger>\n          <TabsTrigger value=\"high\" className=\"data-[state=active]:bg-red-500 data-[state=active]:text-white\">\n            High Risk ({highRiskDevices.length})\n          </TabsTrigger>\n          <TabsTrigger value=\"medium\" className=\"data-[state=active]:bg-yellow-600 data-[state=active]:text-white\">\n            Medium ({mediumRiskDevices.length})\n          </TabsTrigger>\n          <TabsTrigger value=\"low\">Healthy ({lowRiskDevices.length})</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"overview\" className=\"space-y-4 mt-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle>All Devices</CardTitle>\n              <CardDescription>Complete overview of all device health predictions</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <ScrollArea className=\"h-[600px] w-full\">\n                <div className=\"space-y-3\">\n                  {insights?.predictions.map((prediction, idx) => (\n                    <DevicePredictionCard\n                      key={idx}\n                      prediction={prediction}\n                      getRiskBadge={getRiskBadge}\n                      getRiskColor={getRiskColor}\n                      updateStatusMutation={updateStatusMutation}\n                      reportIssueMutation={reportIssueMutation}\n                    />\n                  ))}\n                </div>\n              </ScrollArea>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"high\" className=\"space-y-4 mt-4\">\n          <ScrollArea className=\"h-[600px] w-full\">\n            <div className=\"space-y-3\">\n              {highRiskDevices.length === 0 ? (\n                <p className=\"text-center text-muted-foreground py-8\">No high-risk devices found</p>\n              ) : (\n                highRiskDevices.map((prediction, idx) => (\n                  <DevicePredictionCard\n                    key={idx}\n                    prediction={prediction}\n                    getRiskBadge={getRiskBadge}\n                    getRiskColor={getRiskColor}\n                    updateStatusMutation={updateStatusMutation}\n                    reportIssueMutation={reportIssueMutation}\n                  />\n                ))\n              )}\n            </div>\n          </ScrollArea>\n        </TabsContent>\n\n        <TabsContent value=\"medium\" className=\"space-y-4 mt-4\">\n          <ScrollArea className=\"h-[600px] w-full\">\n            <div className=\"space-y-3\">\n              {mediumRiskDevices.length === 0 ? (\n                <p className=\"text-center text-muted-foreground py-8\">No medium-risk devices found</p>\n              ) : (\n                mediumRiskDevices.map((prediction, idx) => (\n                  <DevicePredictionCard\n                    key={idx}\n                    prediction={prediction}\n                    getRiskBadge={getRiskBadge}\n                    getRiskColor={getRiskColor}\n                    updateStatusMutation={updateStatusMutation}\n                    reportIssueMutation={reportIssueMutation}\n                  />\n                ))\n              )}\n            </div>\n          </ScrollArea>\n        </TabsContent>\n\n        <TabsContent value=\"low\" className=\"space-y-4 mt-4\">\n          <ScrollArea className=\"h-[600px] w-full\">\n            <div className=\"space-y-3\">\n              {lowRiskDevices.length === 0 ? (\n                <p className=\"text-center text-muted-foreground py-8\">No healthy devices found</p>\n              ) : (\n                lowRiskDevices.map((prediction, idx) => (\n                  <DevicePredictionCard\n                    key={idx}\n                    prediction={prediction}\n                    getRiskBadge={getRiskBadge}\n                    getRiskColor={getRiskColor}\n                    updateStatusMutation={updateStatusMutation}\n                    reportIssueMutation={reportIssueMutation}\n                  />\n                ))\n              )}\n            </div>\n          </ScrollArea>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n\nfunction DevicePredictionCard({\n  prediction,\n  getRiskBadge,\n  getRiskColor,\n  updateStatusMutation,\n  reportIssueMutation,\n}: {\n  prediction: MaintenancePrediction;\n  getRiskBadge: (level: string) => JSX.Element;\n  getRiskColor: (level: string) => string;\n  updateStatusMutation: any;\n  reportIssueMutation: any;\n}) {\n  return (\n    <Card className={`${getRiskColor(prediction.riskLevel)} border-2`} data-testid={`card-device-${prediction.category}-${prediction.seatName}`}>\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-start justify-between\">\n          <div>\n            <CardTitle className=\"text-lg flex items-center gap-2\">\n              {prediction.category} - {prediction.seatName}\n            </CardTitle>\n            <CardDescription className=\"mt-1\">{getRiskBadge(prediction.riskLevel)}</CardDescription>\n          </div>\n          {prediction.riskLevel === \"high\" && (\n            <AlertTriangle className=\"h-6 w-6 text-red-600 dark:text-red-400 animate-pulse\" />\n          )}\n        </div>\n      </CardHeader>\n      <CardContent className=\"space-y-3\">\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-2 text-sm\">\n          <div>\n            <p className=\"text-muted-foreground text-xs\">Usage Hours</p>\n            <p className=\"font-semibold\">{prediction.metrics.usageHours.toFixed(1)}h</p>\n          </div>\n          <div>\n            <p className=\"text-muted-foreground text-xs\">Sessions</p>\n            <p className=\"font-semibold\">{prediction.metrics.totalSessions}</p>\n          </div>\n          <div>\n            <p className=\"text-muted-foreground text-xs\">Issues</p>\n            <p className=\"font-semibold\">{prediction.metrics.issuesReported}</p>\n          </div>\n          <div>\n            <p className=\"text-muted-foreground text-xs\">Last Service</p>\n            <p className=\"font-semibold\">\n              {prediction.metrics.daysSinceLastMaintenance ? `${prediction.metrics.daysSinceLastMaintenance}d ago` : 'Never'}\n            </p>\n          </div>\n        </div>\n\n        <div className=\"bg-background/50 dark:bg-background/30 p-3 rounded-lg\">\n          <p className=\"text-sm font-medium mb-1\">Analysis:</p>\n          <p className=\"text-sm text-muted-foreground\">{prediction.reasoning}</p>\n        </div>\n\n        <div className=\"space-y-3\">\n          <div className=\"flex-1\">\n            <p className=\"text-sm font-medium text-foreground\">{prediction.recommendedAction}</p>\n            <p className=\"text-xs text-muted-foreground mt-1\">\n              Est. {prediction.estimatedDaysUntilMaintenance} days until next service\n            </p>\n          </div>\n          \n          <div className=\"flex flex-wrap gap-2\">\n            <Button\n              size=\"sm\"\n              variant=\"outline\"\n              className=\"gap-2 flex-1 min-w-[140px]\"\n              onClick={() =>\n                updateStatusMutation.mutate({\n                  category: prediction.category,\n                  seatName: prediction.seatName,\n                  status: \"healthy\",\n                  notes: \"Maintenance completed via predictions\",\n                })\n              }\n              data-testid={`button-mark-maintained-${prediction.category}-${prediction.seatName}`}\n            >\n              <Wrench className=\"h-4 w-4\" />\n              Mark Maintained\n            </Button>\n            \n            <Button\n              size=\"sm\"\n              variant=\"outline\"\n              className=\"gap-2 flex-1 min-w-[140px] border-orange-500 text-orange-600 hover:bg-orange-50 dark:hover:bg-orange-950/20\"\n              onClick={() =>\n                reportIssueMutation.mutate({\n                  category: prediction.category,\n                  seatName: prediction.seatName,\n                  issueType: \"repair\",\n                })\n              }\n              disabled={reportIssueMutation.isPending}\n              data-testid={`button-report-repair-${prediction.category}-${prediction.seatName}`}\n            >\n              <AlertCircle className=\"h-4 w-4\" />\n              Needs Repair\n            </Button>\n            \n            <Button\n              size=\"sm\"\n              variant=\"outline\"\n              className=\"gap-2 flex-1 min-w-[140px] border-purple-500 text-purple-600 hover:bg-purple-50 dark:hover:bg-purple-950/20\"\n              onClick={() =>\n                reportIssueMutation.mutate({\n                  category: prediction.category,\n                  seatName: prediction.seatName,\n                  issueType: \"glitch\",\n                })\n              }\n              disabled={reportIssueMutation.isPending}\n              data-testid={`button-report-glitch-${prediction.category}-${prediction.seatName}`}\n            >\n              <Bug className=\"h-4 w-4\" />\n              Has Glitch\n            </Button>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":20056,"size_tokens":null},"client/src/hooks/useKeyboardShortcuts.ts":{"content":"import { useEffect } from 'react';\n\nexport interface KeyboardShortcut {\n  key: string;\n  ctrlKey?: boolean;\n  altKey?: boolean;\n  shiftKey?: boolean;\n  metaKey?: boolean;\n  description: string;\n  action: () => void;\n  category?: string;\n}\n\nexport const useKeyboardShortcut = (shortcut: KeyboardShortcut) => {\n  useEffect(() => {\n    const handleKeyPress = (event: KeyboardEvent) => {\n      const isModifierMatch = \n        (shortcut.ctrlKey === undefined || event.ctrlKey === shortcut.ctrlKey) &&\n        (shortcut.altKey === undefined || event.altKey === shortcut.altKey) &&\n        (shortcut.shiftKey === undefined || event.shiftKey === shortcut.shiftKey) &&\n        (shortcut.metaKey === undefined || event.metaKey === shortcut.metaKey);\n\n      if (event.key.toLowerCase() === shortcut.key.toLowerCase() && isModifierMatch) {\n        // Prevent default only if not typing in an input\n        const target = event.target as HTMLElement;\n        if (target.tagName !== 'INPUT' && target.tagName !== 'TEXTAREA' && !target.isContentEditable) {\n          event.preventDefault();\n          shortcut.action();\n        }\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyPress);\n    return () => window.removeEventListener('keydown', handleKeyPress);\n  }, [shortcut]);\n};\n\nexport const useKeyboardShortcuts = (shortcuts: KeyboardShortcut[]) => {\n  useEffect(() => {\n    const handleKeyPress = (event: KeyboardEvent) => {\n      // Prevent shortcuts when typing in inputs\n      const target = event.target as HTMLElement;\n      if (target.tagName === 'INPUT' || target.tagName === 'TEXTAREA' || target.isContentEditable) {\n        return;\n      }\n\n      for (const shortcut of shortcuts) {\n        const isModifierMatch = \n          (shortcut.ctrlKey === undefined || event.ctrlKey === shortcut.ctrlKey) &&\n          (shortcut.altKey === undefined || event.altKey === shortcut.altKey) &&\n          (shortcut.shiftKey === undefined || event.shiftKey === shortcut.shiftKey) &&\n          (shortcut.metaKey === undefined || event.metaKey === shortcut.metaKey);\n\n        if (event.key.toLowerCase() === shortcut.key.toLowerCase() && isModifierMatch) {\n          event.preventDefault();\n          shortcut.action();\n          break; // Only execute the first matching shortcut\n        }\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyPress);\n    return () => window.removeEventListener('keydown', handleKeyPress);\n  }, [shortcuts]);\n};\n\nexport const formatShortcut = (shortcut: KeyboardShortcut): string => {\n  const parts: string[] = [];\n  \n  if (shortcut.ctrlKey) parts.push('Ctrl');\n  if (shortcut.altKey) parts.push('Alt');\n  if (shortcut.shiftKey) parts.push('Shift');\n  if (shortcut.metaKey) parts.push('‚åò');\n  \n  parts.push(shortcut.key.toUpperCase());\n  \n  return parts.join(' + ');\n};\n","path":null,"size_bytes":2814,"size_tokens":null},"client/src/pages/History.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Clock, User, Phone, IndianRupee, Calendar, Search, FileText, Percent, Gift, UtensilsCrossed } from \"lucide-react\";\nimport { useState, useMemo } from \"react\";\nimport { format, isValid, isSameDay } from \"date-fns\";\nimport type { BookingHistory } from \"@shared/schema\";\nimport { getAdjustedTime } from \"@/hooks/useServerTime\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport {\n  Accordion,\n  AccordionContent,\n  AccordionItem,\n  AccordionTrigger,\n} from \"@/components/ui/accordion\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\n\ninterface DateGroup {\n  date: string;\n  bookings: BookingHistory[];\n}\n\nexport default function History() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [selectedDate, setSelectedDate] = useState<string>(\"\");\n  const [selectedDateBookings, setSelectedDateBookings] = useState<BookingHistory[] | null>(null);\n  const { isStaff } = useAuth();\n\n  const { data: bookings = [], isLoading } = useQuery<BookingHistory[]>({\n    queryKey: [\"/api/booking-history\"],\n  });\n\n  const filteredBookings = bookings.filter(booking => {\n    const query = searchQuery.toLowerCase();\n    const matchesSearch = \n      booking.customerName.toLowerCase().includes(query) ||\n      booking.seatName.toLowerCase().includes(query) ||\n      booking.whatsappNumber?.toLowerCase().includes(query) ||\n      booking.category.toLowerCase().includes(query);\n    \n    if (!matchesSearch) return false;\n    \n    if (selectedDate) {\n      const bookingDate = typeof booking.startTime === 'string' ? new Date(booking.startTime) : booking.startTime;\n      const filterDate = new Date(selectedDate);\n      return isValid(bookingDate) && isValid(filterDate) && isSameDay(bookingDate, filterDate);\n    }\n    \n    return true;\n  });\n\n  const groupedByCustomerAndDate = useMemo(() => {\n    const customerGroups = new Map<string, DateGroup[]>();\n    \n    filteredBookings.forEach(booking => {\n      const customerName = booking.customerName;\n      const bookingDate = typeof booking.startTime === 'string' ? new Date(booking.startTime) : booking.startTime;\n      const dateKey = isValid(bookingDate) ? format(bookingDate, 'yyyy-MM-dd') : 'Invalid Date';\n      \n      if (!customerGroups.has(customerName)) {\n        customerGroups.set(customerName, []);\n      }\n      \n      const customerDateGroups = customerGroups.get(customerName)!;\n      let dateGroup = customerDateGroups.find(dg => dg.date === dateKey);\n      \n      if (!dateGroup) {\n        dateGroup = { date: dateKey, bookings: [] };\n        customerDateGroups.push(dateGroup);\n      }\n      \n      dateGroup.bookings.push(booking);\n    });\n    \n    customerGroups.forEach(dateGroups => {\n      dateGroups.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\n    });\n    \n    return customerGroups;\n  }, [filteredBookings]);\n\n  const formatDate = (date: Date | string) => {\n    const d = typeof date === 'string' ? new Date(date) : date;\n    return isValid(d) ? format(d, 'MMM dd, yyyy hh:mm a') : 'N/A';\n  };\n\n  const formatDateShort = (date: Date | string) => {\n    const d = typeof date === 'string' ? new Date(date) : date;\n    return isValid(d) ? format(d, 'dd MMM yyyy') : 'N/A';\n  };\n\n  const calculateDuration = (startTime: Date | string, endTime: Date | string) => {\n    const start = typeof startTime === 'string' ? new Date(startTime) : startTime;\n    const end = typeof endTime === 'string' ? new Date(endTime) : endTime;\n    \n    if (!isValid(start) || !isValid(end)) return 'N/A';\n    \n    const diffMs = end.getTime() - start.getTime();\n    const diffMins = Math.round(diffMs / 60000);\n    const hours = Math.floor(diffMins / 60);\n    const mins = diffMins % 60;\n    \n    if (hours === 0) return `${mins}m`;\n    if (mins === 0) return `${hours}h`;\n    return `${hours}h ${mins}m`;\n  };\n\n  const calculateTotal = (booking: BookingHistory) => {\n    const basePrice = parseFloat(booking.price);\n    const foodTotal = booking.foodOrders?.reduce((sum, order) => sum + (parseFloat(order.price) * order.quantity), 0) || 0;\n    return basePrice + foodTotal;\n  };\n\n  const calculateGroupTotal = (bookings: BookingHistory[]) => {\n    return bookings.reduce((sum, booking) => sum + calculateTotal(booking), 0);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">Booking History</h1>\n          <p className=\"text-muted-foreground mt-2\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-2\">\n        <div>\n          <h1 className=\"text-3xl font-bold\" data-testid=\"heading-history\">Booking History</h1>\n          <p className=\"text-muted-foreground mt-2\">View all completed bookings grouped by customer and date</p>\n        </div>\n        <div className=\"text-sm text-muted-foreground\" data-testid=\"text-current-date\">\n          {getAdjustedTime().toLocaleDateString('en-IN', { \n            weekday: 'short', \n            year: 'numeric', \n            month: 'short', \n            day: 'numeric' \n          })}\n        </div>\n      </div>\n\n      <div className=\"flex gap-4 flex-col lg:flex-row lg:items-center lg:justify-between\">\n        <div className=\"flex gap-2 flex-col sm:flex-row flex-1\">\n          <Input\n            placeholder=\"Search by customer, seat, phone, or category...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"flex-1 sm:max-w-xs\"\n            data-testid=\"input-search-history\"\n          />\n          <div className=\"flex gap-2\">\n            <Input\n              type=\"date\"\n              value={selectedDate}\n              onChange={(e) => setSelectedDate(e.target.value)}\n              className=\"w-full sm:w-auto\"\n              data-testid=\"input-date-filter\"\n            />\n            {selectedDate && (\n              <Button\n                variant=\"outline\"\n                onClick={() => setSelectedDate(\"\")}\n                data-testid=\"button-clear-date\"\n              >\n                Clear\n              </Button>\n            )}\n          </div>\n        </div>\n        <div className=\"text-sm text-muted-foreground whitespace-nowrap\" data-testid=\"text-booking-count\">\n          Total: {filteredBookings.length} bookings\n        </div>\n      </div>\n\n      <ScrollArea className=\"h-[calc(100vh-280px)]\">\n        {groupedByCustomerAndDate.size === 0 ? (\n          <Card className=\"glass-card\">\n            <CardContent className=\"flex items-center justify-center py-12\">\n              <p className=\"text-muted-foreground\" data-testid=\"text-no-history\">\n                {searchQuery ? \"No bookings found matching your search\" : \"No booking history yet. Click 'Refresh List' on the Dashboard to archive completed/expired bookings.\"}\n              </p>\n            </CardContent>\n          </Card>\n        ) : (\n          <Accordion type=\"multiple\" className=\"space-y-4\">\n            {Array.from(groupedByCustomerAndDate.entries()).map(([customerName, dateGroups]) => {\n              const totalAmount = dateGroups.reduce((sum, dg) => sum + calculateGroupTotal(dg.bookings), 0);\n              const totalBookings = dateGroups.reduce((sum, dg) => sum + dg.bookings.length, 0);\n              \n              return (\n                <AccordionItem \n                  key={customerName} \n                  value={customerName}\n                  className=\"border rounded-md px-4 bg-card\"\n                  data-testid={`accordion-customer-${customerName}`}\n                >\n                  <AccordionTrigger className=\"hover:no-underline py-4\">\n                    <div className=\"flex items-center justify-between w-full pr-4\">\n                      <div className=\"flex items-center gap-3\">\n                        <User className=\"h-5 w-5 text-muted-foreground\" />\n                        <div className=\"text-left\">\n                          <div className=\"font-semibold text-base\" data-testid={`text-customer-name-${customerName}`}>\n                            {customerName}\n                          </div>\n                          <div className=\"text-sm text-muted-foreground\">\n                            {totalBookings} booking{totalBookings > 1 ? 's' : ''} across {dateGroups.length} date{dateGroups.length > 1 ? 's' : ''}\n                          </div>\n                        </div>\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <Badge variant=\"secondary\" className=\"text-sm\">\n                          ‚Çπ{totalAmount}\n                        </Badge>\n                      </div>\n                    </div>\n                  </AccordionTrigger>\n                  <AccordionContent className=\"pt-4 pb-4\">\n                    <div className=\"grid gap-4 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3\">\n                      {dateGroups.map((dateGroup, idx) => {\n                        const groupTotal = calculateGroupTotal(dateGroup.bookings);\n                        const firstBooking = dateGroup.bookings[0];\n                        const allSeats = dateGroup.bookings.map(b => b.seatName);\n                        const allCategories = Array.from(new Set(dateGroup.bookings.map(b => b.category)));\n                        const hasDiscounts = dateGroup.bookings.some(b => b.discountApplied);\n                        const hasBonusHours = dateGroup.bookings.some(b => b.bonusHoursApplied);\n                        const totalFoodItems = dateGroup.bookings.reduce((sum, b) => \n                          sum + (b.foodOrders?.length || 0), 0\n                        );\n                        \n                        return (\n                          <Card key={idx} className=\"glass-card\" data-testid={`card-date-${dateGroup.date}`}>\n                            <CardHeader className=\"pb-3\">\n                              <div className=\"flex items-start justify-between\">\n                                <div className=\"flex-1\">\n                                  <CardTitle className=\"text-lg flex items-center gap-2\" data-testid={`text-date-${dateGroup.date}`}>\n                                    <Calendar className=\"h-4 w-4 text-muted-foreground\" />\n                                    {formatDateShort(dateGroup.date)}\n                                  </CardTitle>\n                                  <CardDescription className=\"mt-2 flex gap-1 flex-wrap\">\n                                    {allCategories.map((category, catIdx) => (\n                                      <Badge key={catIdx} variant=\"secondary\" className=\"text-xs\">\n                                        {category}\n                                      </Badge>\n                                    ))}\n                                  </CardDescription>\n                                </div>\n                                <Badge variant=\"outline\" className=\"bg-green-50 dark:bg-green-950 text-green-700 dark:text-green-300\">\n                                  {dateGroup.bookings.length} PC{dateGroup.bookings.length > 1 ? 's' : ''}\n                                </Badge>\n                              </div>\n                            </CardHeader>\n                            <CardContent className=\"space-y-3 text-sm\">\n                              <div className=\"flex flex-wrap gap-1\" data-testid={`seats-${dateGroup.date}`}>\n                                {allSeats.map((seat, seatIdx) => (\n                                  <Badge \n                                    key={seatIdx} \n                                    variant=\"outline\" \n                                    className=\"bg-blue-50 dark:bg-blue-950 text-blue-700 dark:text-blue-300 border-blue-300 dark:border-blue-700\"\n                                  >\n                                    {seat}\n                                  </Badge>\n                                ))}\n                              </div>\n\n                              {!isStaff && firstBooking.whatsappNumber && (\n                                <div className=\"flex items-center gap-2\" data-testid={`text-phone-${dateGroup.date}`}>\n                                  <Phone className=\"h-4 w-4 text-muted-foreground\" />\n                                  <span className=\"text-muted-foreground\">{firstBooking.whatsappNumber}</span>\n                                </div>\n                              )}\n\n                              {(hasDiscounts || hasBonusHours) && (\n                                <div className=\"flex flex-wrap gap-2 pt-2 border-t\">\n                                  {hasDiscounts && (\n                                    <Badge \n                                      variant=\"outline\" \n                                      className=\"bg-green-50 dark:bg-green-950 text-green-700 dark:text-green-300 border-green-300 dark:border-green-700\"\n                                      data-testid={`badge-discount-${dateGroup.date}`}\n                                    >\n                                      <Percent className=\"h-3 w-3 mr-1\" />\n                                      Discount\n                                    </Badge>\n                                  )}\n                                  {hasBonusHours && (\n                                    <Badge \n                                      variant=\"outline\" \n                                      className=\"bg-yellow-50 dark:bg-yellow-950 text-yellow-700 dark:text-yellow-300 border-yellow-300 dark:border-yellow-700\"\n                                      data-testid={`badge-bonus-${dateGroup.date}`}\n                                    >\n                                      <Gift className=\"h-3 w-3 mr-1\" />\n                                      Free Hours\n                                    </Badge>\n                                  )}\n                                </div>\n                              )}\n\n                              {totalFoodItems > 0 && (\n                                <div className=\"pt-2 border-t\">\n                                  <div className=\"flex items-center gap-2\">\n                                    <UtensilsCrossed className=\"h-4 w-4 text-muted-foreground\" />\n                                    <p className=\"text-xs font-medium\">\n                                      {totalFoodItems} food item{totalFoodItems > 1 ? 's' : ''}\n                                    </p>\n                                  </div>\n                                </div>\n                              )}\n                              \n                              <div className=\"flex items-center justify-between pt-2 border-t\" data-testid={`text-total-${dateGroup.date}`}>\n                                <div className=\"flex items-center gap-2\">\n                                  <IndianRupee className=\"h-4 w-4 text-muted-foreground\" />\n                                  <span className=\"font-semibold\">Total</span>\n                                </div>\n                                <span className=\"font-bold text-lg\">‚Çπ{groupTotal}</span>\n                              </div>\n                              \n                              <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                className=\"w-full mt-2\"\n                                onClick={() => setSelectedDateBookings(dateGroup.bookings)}\n                                data-testid={`button-view-detail-${dateGroup.date}`}\n                              >\n                                <FileText className=\"h-4 w-4 mr-2\" />\n                                View Detail\n                              </Button>\n                            </CardContent>\n                          </Card>\n                        );\n                      })}\n                    </div>\n                  </AccordionContent>\n                </AccordionItem>\n              );\n            })}\n          </Accordion>\n        )}\n      </ScrollArea>\n\n      {/* Booking Detail Dialog with Table */}\n      <Dialog open={!!selectedDateBookings} onOpenChange={() => setSelectedDateBookings(null)}>\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\" data-testid=\"dialog-booking-detail\">\n          <DialogHeader>\n            <DialogTitle>Booking Details</DialogTitle>\n            <DialogDescription>\n              Complete information for all bookings on this date\n            </DialogDescription>\n          </DialogHeader>\n          \n          {selectedDateBookings && selectedDateBookings.length > 0 && (\n            <div className=\"space-y-6\">\n              {/* Summary */}\n              <div className=\"grid grid-cols-2 gap-4 p-4 bg-muted/50 rounded-md\">\n                <div>\n                  <p className=\"text-xs text-muted-foreground\">Customer Name</p>\n                  <p className=\"font-semibold\" data-testid=\"detail-customer-name\">{selectedDateBookings[0].customerName}</p>\n                </div>\n                <div>\n                  <p className=\"text-xs text-muted-foreground\">Date</p>\n                  <p className=\"font-semibold\" data-testid=\"detail-date\">\n                    {formatDateShort(selectedDateBookings[0].startTime)}\n                  </p>\n                </div>\n                <div>\n                  <p className=\"text-xs text-muted-foreground\">Total PCs</p>\n                  <p className=\"font-semibold\">{selectedDateBookings.length}</p>\n                </div>\n                <div>\n                  <p className=\"text-xs text-muted-foreground\">Status</p>\n                  <Badge variant=\"outline\" className=\"bg-green-50 dark:bg-green-950 text-green-700 dark:text-green-300\">\n                    Completed\n                  </Badge>\n                </div>\n              </div>\n\n              {/* Bookings Table */}\n              <div>\n                <h3 className=\"font-semibold mb-3\">Booking Information</h3>\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Seat</TableHead>\n                      <TableHead>Category</TableHead>\n                      <TableHead>Start Time</TableHead>\n                      <TableHead>End Time</TableHead>\n                      <TableHead>Duration</TableHead>\n                      <TableHead className=\"text-right\">Price</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {selectedDateBookings.map((booking, idx) => (\n                      <TableRow key={idx}>\n                        <TableCell className=\"font-medium\" data-testid={`detail-seat-${idx}`}>{booking.seatName}</TableCell>\n                        <TableCell>\n                          <Badge variant=\"secondary\" className=\"text-xs\">{booking.category}</Badge>\n                        </TableCell>\n                        <TableCell className=\"text-xs\" data-testid={`detail-start-${idx}`}>\n                          {format(typeof booking.startTime === 'string' ? new Date(booking.startTime) : booking.startTime, 'hh:mm a')}\n                        </TableCell>\n                        <TableCell className=\"text-xs\" data-testid={`detail-end-${idx}`}>\n                          {format(typeof booking.endTime === 'string' ? new Date(booking.endTime) : booking.endTime, 'hh:mm a')}\n                        </TableCell>\n                        <TableCell data-testid={`detail-duration-${idx}`}>\n                          {calculateDuration(booking.startTime, booking.endTime)}\n                        </TableCell>\n                        <TableCell className=\"text-right font-medium\" data-testid={`detail-price-${idx}`}>‚Çπ{booking.price}</TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </div>\n\n              {/* Discounts and Bonuses */}\n              {selectedDateBookings.some(b => b.discountApplied || b.bonusHoursApplied) && (\n                <div>\n                  <h3 className=\"font-semibold mb-3\">Promotions Applied</h3>\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Seat</TableHead>\n                        <TableHead>Type</TableHead>\n                        <TableHead>Details</TableHead>\n                        <TableHead className=\"text-right\">Benefit</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {selectedDateBookings.map((booking, idx) => {\n                        const promos = [];\n                        if (booking.discountApplied) {\n                          promos.push({\n                            type: 'Discount',\n                            details: booking.manualDiscountPercentage ? `${booking.manualDiscountPercentage}% off` : 'Applied',\n                            benefit: booking.promotionDetails?.discountAmount ? `Saved ‚Çπ${booking.promotionDetails.discountAmount}` : '-'\n                          });\n                        }\n                        if (booking.bonusHoursApplied) {\n                          promos.push({\n                            type: 'Free Hours',\n                            details: booking.manualFreeHours ? `+${booking.manualFreeHours}` : 'Applied',\n                            benefit: 'Extra Time'\n                          });\n                        }\n                        return promos.map((promo, promoIdx) => (\n                          <TableRow key={`${idx}-${promoIdx}`}>\n                            <TableCell className=\"font-medium\">{booking.seatName}</TableCell>\n                            <TableCell>\n                              <Badge \n                                variant=\"outline\" \n                                className={promo.type === 'Discount' \n                                  ? 'bg-green-50 dark:bg-green-950 text-green-700 dark:text-green-300'\n                                  : 'bg-yellow-50 dark:bg-yellow-950 text-yellow-700 dark:text-yellow-300'\n                                }\n                              >\n                                {promo.type === 'Discount' ? <Percent className=\"h-3 w-3 mr-1\" /> : <Gift className=\"h-3 w-3 mr-1\" />}\n                                {promo.type}\n                              </Badge>\n                            </TableCell>\n                            <TableCell>{promo.details}</TableCell>\n                            <TableCell className=\"text-right\">{promo.benefit}</TableCell>\n                          </TableRow>\n                        ));\n                      })}\n                    </TableBody>\n                  </Table>\n                </div>\n              )}\n\n              {/* Food Orders Table */}\n              {selectedDateBookings.some(b => b.foodOrders && b.foodOrders.length > 0) && (\n                <div>\n                  <h3 className=\"font-semibold mb-3\">Food Orders</h3>\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Seat</TableHead>\n                        <TableHead>Item</TableHead>\n                        <TableHead className=\"text-center\">Quantity</TableHead>\n                        <TableHead className=\"text-right\">Price</TableHead>\n                        <TableHead className=\"text-right\">Total</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {selectedDateBookings.map((booking, bookingIdx) => \n                        booking.foodOrders?.map((order, orderIdx) => (\n                          <TableRow key={`${bookingIdx}-${orderIdx}`}>\n                            <TableCell className=\"font-medium\">{booking.seatName}</TableCell>\n                            <TableCell data-testid={`detail-food-name-${bookingIdx}-${orderIdx}`}>{order.foodName}</TableCell>\n                            <TableCell className=\"text-center\" data-testid={`detail-food-quantity-${bookingIdx}-${orderIdx}`}>{order.quantity}</TableCell>\n                            <TableCell className=\"text-right\">‚Çπ{parseFloat(order.price)}</TableCell>\n                            <TableCell className=\"text-right font-medium\" data-testid={`detail-food-total-${bookingIdx}-${orderIdx}`}>\n                              ‚Çπ{(parseFloat(order.price) * order.quantity).toFixed(2)}\n                            </TableCell>\n                          </TableRow>\n                        ))\n                      )}\n                    </TableBody>\n                  </Table>\n                </div>\n              )}\n\n              {/* Grand Total */}\n              <div className=\"flex items-center justify-between pt-4 border-t\">\n                <span className=\"font-bold text-lg\">Grand Total</span>\n                <span className=\"font-bold text-2xl text-primary\" data-testid=\"detail-grand-total\">\n                  ‚Çπ{calculateGroupTotal(selectedDateBookings)}\n                </span>\n              </div>\n\n              {/* Payment Methods */}\n              <div className=\"pt-2 border-t\">\n                <h3 className=\"font-semibold mb-3\">Payment Methods</h3>\n                <div className=\"flex flex-wrap gap-2\">\n                  {selectedDateBookings.some(b => b.paymentMethod === 'split') && (\n                    <Badge variant=\"secondary\">Split Payment</Badge>\n                  )}\n                  {selectedDateBookings.map((booking, idx) => \n                    booking.paymentMethod && booking.paymentMethod !== 'split' && (\n                      <div key={idx} className=\"flex items-center gap-2 text-sm\">\n                        <span className=\"text-muted-foreground\">{booking.seatName}:</span>\n                        <Badge variant=\"secondary\">\n                          {booking.paymentMethod === 'cash' ? 'Cash' : \n                           booking.paymentMethod === 'upi_online' ? 'UPI/Online' :\n                           booking.paymentMethod === 'card' ? 'Card' :\n                           'UPI/Online'}\n                        </Badge>\n                      </div>\n                    )\n                  )}\n                </div>\n              </div>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":26883,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/components/ThemeToggle.tsx":{"content":"import { Moon, Sun } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useTheme } from \"@/components/ThemeProvider\";\n\nexport function ThemeToggle() {\n  const { theme, toggleTheme } = useTheme();\n\n  return (\n    <Button\n      variant=\"outline\"\n      size=\"icon\"\n      onClick={toggleTheme}\n      data-testid=\"button-toggle-theme\"\n      className=\"h-9 w-9\"\n    >\n      {theme === \"light\" ? (\n        <Moon className=\"h-4 w-4\" />\n      ) : (\n        <Sun className=\"h-4 w-4\" />\n      )}\n      <span className=\"sr-only\">Toggle theme</span>\n    </Button>\n  );\n}\n","path":null,"size_bytes":586,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 transition-all duration-300\" +\n  \" hover:scale-105 active:scale-95\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"glass bg-primary text-primary-foreground glow\",\n        destructive:\n          \"glass bg-destructive text-destructive-foreground\",\n        outline:\n          \"glass border border-white/20 shadow-lg hover:shadow-xl\",\n        secondary: \"glass bg-secondary/80 text-secondary-foreground\",\n        ghost: \"hover:glass border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2068,"size_tokens":null},"client/src/pages/Home.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Phone, Mail, MapPin, Clock, Gamepad2, Monitor, Zap, Gift, Lock, Crown } from \"lucide-react\";\nimport type { GamingCenterInfo } from \"@shared/schema\";\nimport { ParallelogramCard } from \"@/components/ParallelogramCard\";\n\ninterface Availability {\n  category: string;\n  total: number;\n  available: number;\n  occupied: number;\n  percentage: number;\n}\n\nexport default function Home() {\n  const { data: centerInfo, isLoading: infoLoading } = useQuery<GamingCenterInfo>({\n    queryKey: [\"/api/consumer/center-info\"],\n  });\n\n  const { data: availability, isLoading: availabilityLoading } = useQuery<Availability[]>({\n    queryKey: [\"/api/consumer/availability\"],\n    refetchInterval: 5000,\n  });\n\n  if (infoLoading || availabilityLoading) {\n    return (\n      <div className=\"container mx-auto p-6 space-y-6\">\n        <Skeleton className=\"h-12 w-3/4\" />\n        <Skeleton className=\"h-64 w-full\" />\n        <Skeleton className=\"h-48 w-full\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-6 space-y-12\">\n      <div className=\"text-center space-y-4\">\n        <h1 className=\"text-4xl md:text-6xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent\" data-testid=\"text-center-name\">\n          {centerInfo?.name || \"Airavoto Gaming Center\"}\n        </h1>\n        <p className=\"text-lg md:text-xl text-muted-foreground max-w-3xl mx-auto\" data-testid=\"text-center-description\">\n          {centerInfo?.description || \"Experience the ultimate gaming destination\"}\n        </p>\n      </div>\n\n      <section className=\"py-8\">\n        <div className=\"text-center mb-8\">\n          <h2 className=\"text-3xl md:text-4xl font-bold mb-3\">\n            Join <span className=\"bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent\">The Pantheon</span>\n          </h2>\n          <p className=\"text-muted-foreground text-lg\">Power Comes to Those Who Wait.</p>\n        </div>\n\n        <div className=\"grid md:grid-cols-2 gap-6 max-w-6xl mx-auto\">\n          <ParallelogramCard\n            icon={<Zap className=\"w-full h-full\" />}\n            title=\"Early Access to the App\"\n            description=\"Be the first to book arenas and dominate leaderboards.\"\n            iconColor=\"text-green-500\"\n            testId=\"card-early-access\"\n          />\n          \n          <ParallelogramCard\n            icon={<Gift className=\"w-full h-full\" />}\n            title=\"Exclusive Hashdrop Rewards\"\n            description=\"Get limited-edition merch, coins, and tournament invites.\"\n            iconColor=\"text-purple-500\"\n            testId=\"card-rewards\"\n          />\n          \n          <ParallelogramCard\n            icon={<Crown className=\"w-full h-full\" />}\n            title=\"Founding Member Badge\"\n            description=\"Your tag will carry legacy. Forever.\"\n            iconColor=\"text-yellow-500\"\n            testId=\"card-badge\"\n          />\n          \n          <ParallelogramCard\n            icon={<Lock className=\"w-full h-full\" />}\n            title=\"Private Discord Access\"\n            description=\"Strategize with top gamers and influencers before launch.\"\n            iconColor=\"text-cyan-500\"\n            testId=\"card-discord\"\n          />\n        </div>\n      </section>\n\n      <div className=\"grid md:grid-cols-2 gap-6\">\n        <Card data-testid=\"card-availability\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Gamepad2 className=\"h-5 w-5\" />\n              Real-Time Availability\n            </CardTitle>\n            <CardDescription>Check what's available right now</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {availability?.map((item) => (\n              <div key={item.category} className=\"space-y-2\" data-testid={`availability-${item.category.toLowerCase()}`}>\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-2\">\n                    {item.category === \"PC\" ? (\n                      <Monitor className=\"h-5 w-5 text-blue-500\" />\n                    ) : (\n                      <Gamepad2 className=\"h-5 w-5 text-purple-500\" />\n                    )}\n                    <span className=\"font-semibold text-lg\">{item.category}</span>\n                  </div>\n                  <Badge variant={item.available > 0 ? \"default\" : \"destructive\"} data-testid={`badge-${item.category.toLowerCase()}-status`}>\n                    {item.available}/{item.total} Available\n                  </Badge>\n                </div>\n                <div className=\"w-full bg-secondary rounded-full h-3 overflow-hidden\">\n                  <div\n                    className={`h-full transition-all duration-500 ${\n                      item.percentage > 50\n                        ? \"bg-green-500\"\n                        : item.percentage > 20\n                        ? \"bg-yellow-500\"\n                        : \"bg-red-500\"\n                    }`}\n                    style={{ width: `${item.percentage}%` }}\n                    data-testid={`progress-${item.category.toLowerCase()}`}\n                  />\n                </div>\n                <p className=\"text-sm text-muted-foreground\" data-testid={`text-${item.category.toLowerCase()}-percentage`}>\n                  {item.percentage}% capacity available\n                </p>\n              </div>\n            ))}\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-contact-info\">\n          <CardHeader>\n            <CardTitle>Contact Information</CardTitle>\n            <CardDescription>Get in touch with us</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {centerInfo?.address && (\n              <div className=\"flex items-start gap-3\" data-testid=\"info-address\">\n                <MapPin className=\"h-5 w-5 mt-0.5 text-primary\" />\n                <div>\n                  <p className=\"font-medium\">Address</p>\n                  <p className=\"text-sm text-muted-foreground\">{centerInfo.address}</p>\n                </div>\n              </div>\n            )}\n            {centerInfo?.phone && (\n              <div className=\"flex items-start gap-3\" data-testid=\"info-phone\">\n                <Phone className=\"h-5 w-5 mt-0.5 text-primary\" />\n                <div>\n                  <p className=\"font-medium\">Phone</p>\n                  <a href={`tel:${centerInfo.phone}`} className=\"text-sm text-muted-foreground hover:text-primary transition-colors\">\n                    {centerInfo.phone}\n                  </a>\n                </div>\n              </div>\n            )}\n            {centerInfo?.email && (\n              <div className=\"flex items-start gap-3\" data-testid=\"info-email\">\n                <Mail className=\"h-5 w-5 mt-0.5 text-primary\" />\n                <div>\n                  <p className=\"font-medium\">Email</p>\n                  <a href={`mailto:${centerInfo.email}`} className=\"text-sm text-muted-foreground hover:text-primary transition-colors\">\n                    {centerInfo.email}\n                  </a>\n                </div>\n              </div>\n            )}\n            {centerInfo?.hours && (\n              <div className=\"flex items-start gap-3\" data-testid=\"info-hours\">\n                <Clock className=\"h-5 w-5 mt-0.5 text-primary\" />\n                <div>\n                  <p className=\"font-medium\">Hours</p>\n                  <p className=\"text-sm text-muted-foreground whitespace-pre-line\">{centerInfo.hours}</p>\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":7897,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"ELECTRON_BUILD_GUIDE.md":{"content":"# Airavoto Gaming POS - Desktop Application Build & Installation Guide\n\n## Overview\nThis guide explains how to build the Airavoto Gaming POS as an offline desktop application and how to distribute it to gaming cafes.\n\n---\n\n## Building the Desktop Application\n\n### Prerequisites (For Building)\nYou need a computer with:\n- **Windows 10/11** (for building Windows installer)\n- **Node.js 18+** installed\n- **Git** installed\n\n### Step 1: Download the Project\n1. Download this entire project folder to your computer\n2. Open Command Prompt or Terminal\n3. Navigate to the project folder:\n   ```bash\n   cd path/to/airavoto-gaming-pos\n   ```\n\n### Step 2: Install Dependencies\n```bash\nnpm install\n```\n\n### Step 3: Build for Windows\nTo create a Windows installer (.exe):\n```bash\nnpm run electron:dist-win\n```\n\n**Output Files** (found in `release/` folder):\n- `Airavoto Gaming POS-1.0.0-Setup.exe` - Installer file\n- `Airavoto Gaming POS-1.0.0.exe` - Portable version (no installation needed)\n\n### Step 4: Build for Linux (Optional)\n```bash\nnpm run electron:dist-linux\n```\n\n### Step 5: Build for All Platforms\n```bash\nnpm run electron:dist-all\n```\n\n---\n\n## Installing on Gaming Cafe Computers\n\n### For Windows PCs\n\n#### Option A: Using the Installer (Recommended)\n1. Copy `Airavoto Gaming POS-1.0.0-Setup.exe` to a USB drive\n2. Insert USB into the gaming cafe computer\n3. Double-click the installer\n4. Choose installation location (default: C:\\Program Files\\Airavoto Gaming POS)\n5. Click \"Install\"\n6. A desktop shortcut will be created automatically\n\n#### Option B: Portable Version (No Installation)\n1. Copy `Airavoto Gaming POS-1.0.0.exe` to the gaming cafe computer\n2. Double-click to run - no installation needed\n3. Data is stored in: `C:\\Users\\[Username]\\AppData\\Roaming\\Airavoto Gaming POS`\n\n### First-Time Setup\n1. Launch the application\n2. Default admin login:\n   - Username: `admin`\n   - Password: `admin123`\n3. **IMPORTANT**: Change the admin password immediately after first login!\n\n---\n\n## Features for Gaming Cafes\n\n### What This Software Does\n- Manage gaming PC bookings (hourly/session-based)\n- Track customer information\n- Process payments (Cash/UPI)\n- Generate receipts and reports\n- Manage food/snack orders\n- Track staff and multiple users\n- Run promotions and discounts\n- Customer loyalty program\n- Tournament management\n\n**Note:** This offline version does not include cloud-based SMS/WhatsApp notifications. All features work locally without internet.\n\n### Key Benefits for Gaming Cafes\n1. **Works Offline** - No internet required for daily operations\n2. **Easy to Use** - Simple interface designed for staff\n3. **All-in-One** - Booking, payments, food orders in one app\n4. **Reports** - Daily/weekly/monthly business reports\n5. **Multi-User** - Different access levels for staff and admin\n\n---\n\n## Selling to Other Gaming Cafes\n\n### Pricing Suggestions\n\n| License Type | Price (INR) | Description |\n|-------------|-------------|-------------|\n| Single Cafe | ‚Çπ15,000 - ‚Çπ25,000 | One-time purchase for 1 location |\n| Multi-Location | ‚Çπ40,000 - ‚Çπ60,000 | Up to 5 locations |\n| Enterprise | Custom | Unlimited locations + support |\n\n### What to Include in Your Package\n\n#### Basic Package (‚Çπ15,000)\n- Software installer\n- Installation support (remote)\n- User manual\n- 30 days email support\n\n#### Standard Package (‚Çπ20,000)\n- Everything in Basic\n- On-site installation\n- Staff training (2 hours)\n- 90 days support\n- Minor customizations\n\n#### Premium Package (‚Çπ30,000)\n- Everything in Standard\n- Custom branding (cafe logo/name)\n- 1 year support\n- Free updates\n- Priority support via phone/WhatsApp\n\n### How to Customize for Each Cafe\n\n1. **Change Branding**\n   - Edit `client/src/pages/Login.tsx` - Update cafe name and branding\n   - Replace `attached_assets/airavoto_logo.png` with client's logo\n   - Rebuild: `npm run electron:dist-win`\n\n2. **Configure Pricing**\n   - Log into admin panel\n   - Go to Settings > Pricing Configuration\n   - Set hourly rates for different PC categories\n\n3. **Set Up Categories**\n   - Admin Panel > Settings > PC Categories\n   - Add: Gaming PC, VR Station, Racing Simulator, etc.\n\n---\n\n## Technical Support Guide\n\n### Common Issues & Solutions\n\n| Issue | Solution |\n|-------|----------|\n| App won't start | Right-click > Run as Administrator |\n| Data not saving | Check if antivirus is blocking the app |\n| Slow performance | Restart the computer |\n| Login not working | Use admin/admin123 to reset |\n\n### Database Location\n- Windows: `C:\\Users\\[Username]\\AppData\\Roaming\\Airavoto Gaming POS\\airavoto-gaming.db`\n- This SQLite file contains all data - back it up regularly!\n\n### Backup Procedure\n1. Close the application\n2. Copy the `airavoto-gaming.db` file to a safe location\n3. To restore: Replace the db file and restart the app\n\n---\n\n## Updating the Software\n\n### To Send Updates to Clients\n1. Make changes to the code\n2. Update version in `package.json`\n3. Build new installer\n4. Send to client with instructions:\n   - Backup their data first\n   - Uninstall old version\n   - Install new version\n   - Data will be preserved\n\n---\n\n## Legal Considerations\n\n### Before Selling\n1. Register your business\n2. Create a Terms of Service document\n3. Create a License Agreement\n4. Consider GST registration for India\n\n### License Agreement Template Points\n- Software is licensed, not sold\n- No resale without permission\n- Support terms and limitations\n- Data ownership (client owns their data)\n- Liability limitations\n\n---\n\n## Contact & Support\n\nFor development support:\n- Email: support@airavotogaming.com\n- Website: www.airavotogaming.com\n\n---\n\n## Quick Reference Commands\n\n```bash\n# Development mode\nnpm run dev\n\n# Build all Electron files\nnpm run electron:build\n\n# Create Windows installer\nnpm run electron:dist-win\n\n# Create Linux installer\nnpm run electron:dist-linux\n\n# Create all platform installers\nnpm run electron:dist-all\n\n# Test Electron app locally\nnpm run electron:dev\n```\n\n---\n\n## Folder Structure After Build\n\n```\nrelease/\n‚îú‚îÄ‚îÄ Airavoto Gaming POS-1.0.0-Setup.exe    (Windows Installer)\n‚îú‚îÄ‚îÄ Airavoto Gaming POS-1.0.0.exe          (Windows Portable)\n‚îú‚îÄ‚îÄ Airavoto Gaming POS-1.0.0.AppImage     (Linux)\n‚îú‚îÄ‚îÄ Airavoto Gaming POS-1.0.0.deb          (Linux Debian)\n‚îî‚îÄ‚îÄ ... other platform files\n```\n\n---\n\n**Last Updated: November 2024**\n**Version: 1.0.0**\n","path":null,"size_bytes":6340,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"client/src/pages/ActivityLogs.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useState, useMemo } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { format } from \"date-fns\";\nimport { Search, Filter, X, Calendar, ChevronDown, ChevronUp, Percent, Gift } from \"lucide-react\";\nimport type { ActivityLog } from \"@shared/schema\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\n\nexport default function ActivityLogs() {\n  const { data: logs, isLoading } = useQuery<ActivityLog[]>({\n    queryKey: [\"/api/activity-logs\"],\n  });\n\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [roleFilter, setRoleFilter] = useState<string>(\"all\");\n  const [actionFilter, setActionFilter] = useState<string>(\"all\");\n  const [entityFilter, setEntityFilter] = useState<string>(\"all\");\n  const [expandedRows, setExpandedRows] = useState<Set<string>>(new Set());\n\n  const toggleRowExpansion = (logId: string) => {\n    setExpandedRows(prev => {\n      const newSet = new Set(prev);\n      if (newSet.has(logId)) {\n        newSet.delete(logId);\n      } else {\n        newSet.add(logId);\n      }\n      return newSet;\n    });\n  };\n\n  const getActionBadge = (action: string, role: string) => {\n    if (action === \"login\") {\n      return <Badge variant=\"outline\" className=\"bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200\">Login</Badge>;\n    }\n    if (action === \"create\") {\n      return <Badge variant=\"outline\" className=\"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200\">Created</Badge>;\n    }\n    if (action === \"update\") {\n      return <Badge variant=\"outline\" className=\"bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200\">Updated</Badge>;\n    }\n    if (action === \"delete\") {\n      return <Badge variant=\"outline\" className=\"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200\">Deleted</Badge>;\n    }\n    return <Badge variant=\"outline\">{action}</Badge>;\n  };\n\n  const parsePromotionDetails = (details: string | null) => {\n    if (!details) return null;\n    \n    const discountMatch = details.match(/Discount:\\s*(\\d+)%.*?(-‚Çπ[\\d.]+)/);\n    const bonusMatch = details.match(/Bonus Hours:\\s*\\+?([\\d.]+)h/);\n    \n    return {\n      hasDiscount: !!discountMatch,\n      hasBonus: !!bonusMatch,\n      discountPercentage: discountMatch ? discountMatch[1] : null,\n      discountAmount: discountMatch ? discountMatch[2] : null,\n      bonusHours: bonusMatch ? bonusMatch[1] : null,\n    };\n  };\n\n  const getRoleBadge = (role: string) => {\n    if (role === \"admin\") {\n      return <Badge className=\"bg-purple-600 dark:bg-purple-700\">Admin</Badge>;\n    }\n    return <Badge variant=\"secondary\">Staff</Badge>;\n  };\n\n  const uniqueActions = useMemo(() => {\n    if (!logs) return [];\n    return Array.from(new Set(logs.map(log => log.action)));\n  }, [logs]);\n\n  const uniqueEntities = useMemo(() => {\n    if (!logs) return [];\n    return Array.from(new Set(logs.map(log => log.entityType).filter(Boolean))) as string[];\n  }, [logs]);\n\n  const filteredLogs = useMemo(() => {\n    if (!logs) return [];\n    \n    return logs.filter(log => {\n      const matchesSearch = searchQuery === \"\" || \n        log.username.toLowerCase().includes(searchQuery.toLowerCase()) ||\n        log.details?.toLowerCase().includes(searchQuery.toLowerCase()) ||\n        log.entityType?.toLowerCase().includes(searchQuery.toLowerCase());\n      \n      const matchesRole = roleFilter === \"all\" || log.userRole === roleFilter;\n      const matchesAction = actionFilter === \"all\" || log.action === actionFilter;\n      const matchesEntity = entityFilter === \"all\" || (log.entityType || \"\") === entityFilter;\n      \n      return matchesSearch && matchesRole && matchesAction && matchesEntity;\n    }).sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n  }, [logs, searchQuery, roleFilter, actionFilter, entityFilter]);\n\n  const clearFilters = () => {\n    setSearchQuery(\"\");\n    setRoleFilter(\"all\");\n    setActionFilter(\"all\");\n    setEntityFilter(\"all\");\n  };\n\n  const hasActiveFilters = searchQuery !== \"\" || roleFilter !== \"all\" || actionFilter !== \"all\" || entityFilter !== \"all\";\n\n  if (isLoading) {\n    return (\n      <div className=\"p-4 md:p-6 space-y-6\">\n        <div>\n          <h1 className=\"text-2xl md:text-3xl font-bold tracking-tight\">Activity History</h1>\n          <p className=\"text-muted-foreground\">Loading activity logs...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-4 md:p-6 space-y-4 md:space-y-6\" data-testid=\"page-activity-logs\">\n      <div>\n        <h1 className=\"text-2xl md:text-3xl font-bold tracking-tight\" data-testid=\"text-page-title\">Activity History</h1>\n        <p className=\"text-sm md:text-base text-muted-foreground\">View and filter all admin and staff activity</p>\n      </div>\n\n      <Card data-testid=\"card-filters\">\n        <CardHeader className=\"pb-3\">\n          <CardTitle className=\"text-lg md:text-xl flex items-center gap-2\">\n            <Filter className=\"h-5 w-5\" />\n            Filters & Search\n          </CardTitle>\n          <CardDescription className=\"text-xs md:text-sm\">\n            Search and filter activity logs by user, action, or entity type\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          {/* Search Input */}\n          <div className=\"relative\">\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n            <Input\n              placeholder=\"Search by username, entity, or details...\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"pl-10\"\n              data-testid=\"input-search\"\n            />\n          </div>\n\n          {/* Filter Row */}\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3\">\n            <Select value={roleFilter} onValueChange={setRoleFilter}>\n              <SelectTrigger data-testid=\"select-role-filter\">\n                <SelectValue placeholder=\"Filter by Role\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All Roles</SelectItem>\n                <SelectItem value=\"admin\">Admin Only</SelectItem>\n                <SelectItem value=\"staff\">Staff Only</SelectItem>\n              </SelectContent>\n            </Select>\n\n            <Select value={actionFilter} onValueChange={setActionFilter}>\n              <SelectTrigger data-testid=\"select-action-filter\">\n                <SelectValue placeholder=\"Filter by Action\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All Actions</SelectItem>\n                {uniqueActions.map(action => (\n                  <SelectItem key={action} value={action}>\n                    {action.charAt(0).toUpperCase() + action.slice(1)}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n\n            <Select value={entityFilter} onValueChange={setEntityFilter}>\n              <SelectTrigger data-testid=\"select-entity-filter\">\n                <SelectValue placeholder=\"Filter by Entity\" />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"all\">All Entities</SelectItem>\n                {uniqueEntities.map(entity => (\n                  <SelectItem key={entity} value={entity}>\n                    {entity}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n\n            {hasActiveFilters && (\n              <Button\n                variant=\"outline\"\n                onClick={clearFilters}\n                className=\"w-full\"\n                data-testid=\"button-clear-filters\"\n              >\n                <X className=\"h-4 w-4 mr-2\" />\n                Clear Filters\n              </Button>\n            )}\n          </div>\n\n          {/* Results Count */}\n          <div className=\"flex items-center justify-between text-sm\">\n            <span className=\"text-muted-foreground\">\n              Showing <span className=\"font-medium text-foreground\">{filteredLogs.length}</span> of <span className=\"font-medium text-foreground\">{logs?.length || 0}</span> logs\n            </span>\n            {hasActiveFilters && (\n              <Badge variant=\"secondary\" className=\"text-xs\">\n                Filtered\n              </Badge>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Activity Table */}\n      <Card data-testid=\"card-activity-table\">\n        <CardHeader className=\"pb-3\">\n          <CardTitle className=\"text-lg md:text-xl\">Activity Logs</CardTitle>\n          <CardDescription className=\"text-xs md:text-sm\">\n            All activity sorted by most recent. Click on details to expand.\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"p-0\">\n          {filteredLogs.length === 0 ? (\n            <div className=\"p-8 text-center\">\n              <p className=\"text-sm text-muted-foreground\" data-testid=\"text-no-logs\">\n                {hasActiveFilters ? \"No logs match your filters\" : \"No activity logs yet\"}\n              </p>\n            </div>\n          ) : (\n            <ScrollArea className=\"h-[600px] w-full\">\n              <div className=\"min-w-full\">\n                <Table>\n                  <TableHeader className=\"sticky top-0 bg-background z-10\">\n                    <TableRow>\n                      <TableHead className=\"min-w-[140px]\">Time</TableHead>\n                      <TableHead className=\"min-w-[120px]\">User</TableHead>\n                      <TableHead className=\"min-w-[100px]\">Action</TableHead>\n                      <TableHead className=\"min-w-[100px]\">Entity</TableHead>\n                      <TableHead className=\"min-w-[250px]\">Details</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {filteredLogs.map((log) => {\n                      const isExpanded = expandedRows.has(log.id);\n                      const hasDetails = log.details && log.details.length > 0;\n                      const shouldTruncate = log.details && log.details.length > 80;\n                      \n                      return (\n                        <TableRow key={log.id} data-testid={`row-log-${log.id}`}>\n                          <TableCell className=\"font-medium text-xs md:text-sm whitespace-nowrap\" data-testid={`text-time-${log.id}`}>\n                            <div className=\"flex items-center gap-2\">\n                              <Calendar className=\"h-3 w-3 text-muted-foreground hidden md:inline\" />\n                              {format(new Date(log.createdAt), \"MMM dd, yyyy HH:mm\")}\n                            </div>\n                          </TableCell>\n                          <TableCell className=\"text-xs md:text-sm\">\n                            <div className=\"flex flex-col gap-1\">\n                              <span data-testid={`text-username-${log.id}`} className=\"font-medium\">\n                                {log.username}\n                              </span>\n                              <div>{getRoleBadge(log.userRole)}</div>\n                            </div>\n                          </TableCell>\n                          <TableCell data-testid={`badge-action-${log.id}`}>\n                            {getActionBadge(log.action, log.userRole)}\n                          </TableCell>\n                          <TableCell className=\"text-xs md:text-sm\" data-testid={`text-entity-${log.id}`}>\n                            <Badge variant=\"outline\" className=\"text-xs\">\n                              {log.entityType || \"-\"}\n                            </Badge>\n                          </TableCell>\n                          <TableCell className=\"text-xs md:text-sm\" data-testid={`text-details-${log.id}`}>\n                            {!hasDetails ? (\n                              <span className=\"text-muted-foreground\">-</span>\n                            ) : (() => {\n                              const promotionInfo = parsePromotionDetails(log.details || \"\");\n                              \n                              return (\n                                <div className=\"space-y-2\">\n                                  <p className={`break-words ${!isExpanded && shouldTruncate ? 'line-clamp-2' : ''}`}>\n                                    {log.details}\n                                  </p>\n                                  \n                                  {promotionInfo && (promotionInfo.hasDiscount || promotionInfo.hasBonus) && (\n                                    <div className=\"flex flex-wrap gap-1.5 mt-2\">\n                                      {promotionInfo.hasDiscount && (\n                                        <Badge \n                                          variant=\"outline\" \n                                          className=\"bg-emerald-50 dark:bg-emerald-950/30 text-emerald-700 dark:text-emerald-400 border-emerald-200 dark:border-emerald-800\"\n                                        >\n                                          <Percent className=\"h-3 w-3 mr-1\" />\n                                          {promotionInfo.discountPercentage}% off\n                                        </Badge>\n                                      )}\n                                      {promotionInfo.hasBonus && (\n                                        <Badge \n                                          variant=\"outline\" \n                                          className=\"bg-violet-50 dark:bg-violet-950/30 text-violet-700 dark:text-violet-400 border-violet-200 dark:border-violet-800\"\n                                        >\n                                          <Gift className=\"h-3 w-3 mr-1\" />\n                                          +{promotionInfo.bonusHours}h\n                                        </Badge>\n                                      )}\n                                    </div>\n                                  )}\n                                  \n                                  {shouldTruncate && (\n                                    <Button\n                                      variant=\"ghost\"\n                                      size=\"sm\"\n                                      onClick={() => toggleRowExpansion(log.id)}\n                                      className=\"h-6 px-2 text-xs\"\n                                      data-testid={`button-toggle-details-${log.id}`}\n                                    >\n                                      {isExpanded ? (\n                                        <>\n                                          <ChevronUp className=\"h-3 w-3 mr-1\" />\n                                          Show Less\n                                        </>\n                                      ) : (\n                                        <>\n                                          <ChevronDown className=\"h-3 w-3 mr-1\" />\n                                          Show More\n                                        </>\n                                      )}\n                                    </Button>\n                                  )}\n                                </div>\n                              );\n                            })()}\n                          </TableCell>\n                        </TableRow>\n                      );\n                    })}\n                  </TableBody>\n                </Table>\n              </div>\n            </ScrollArea>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":16005,"size_tokens":null},"client/src/pages/ConsumerGames.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Gamepad2, Monitor } from \"lucide-react\";\nimport type { Game } from \"@shared/schema\";\n\ninterface Availability {\n  category: string;\n  total: number;\n  available: number;\n  occupied: number;\n  percentage: number;\n}\n\ninterface PricingConfig {\n  id: string;\n  category: string;\n  duration: string;\n  price: string;\n}\n\nexport default function ConsumerGames() {\n  const { data: games, isLoading: gamesLoading } = useQuery<Game[]>({\n    queryKey: [\"/api/consumer/games\"],\n  });\n\n  const { data: availability, isLoading: availabilityLoading } = useQuery<Availability[]>({\n    queryKey: [\"/api/consumer/availability\"],\n    refetchInterval: 5000,\n  });\n\n  const { data: pricing, isLoading: pricingLoading } = useQuery<PricingConfig[]>({\n    queryKey: [\"/api/consumer/pricing\"],\n  });\n\n  if (gamesLoading || availabilityLoading || pricingLoading) {\n    return (\n      <div className=\"container mx-auto p-6 space-y-6\">\n        <Skeleton className=\"h-12 w-48\" />\n        <Skeleton className=\"h-64 w-full\" />\n      </div>\n    );\n  }\n\n  const pcGames = games?.filter((g) => g.category === \"PC\") || [];\n  const ps5Games = games?.filter((g) => g.category === \"PS5\") || [];\n  const pcAvailability = availability?.find((a) => a.category === \"PC\");\n  const ps5Availability = availability?.find((a) => a.category === \"PS5\");\n  const pcPricing = pricing?.filter((p) => p.category === \"PC\") || [];\n  const ps5Pricing = pricing?.filter((p) => p.category === \"PS5\") || [];\n\n  const renderAvailabilityCard = (categoryAvailability: Availability | undefined, categoryPricing: PricingConfig[]) => (\n    <Card className=\"mb-6\" data-testid={`card-availability-${categoryAvailability?.category.toLowerCase()}`}>\n      <CardHeader>\n        <CardTitle className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-2\">\n            {categoryAvailability?.category === \"PC\" ? (\n              <Monitor className=\"h-5 w-5\" />\n            ) : (\n              <Gamepad2 className=\"h-5 w-5\" />\n            )}\n            <span>Real-Time Availability</span>\n          </div>\n          {categoryAvailability && (\n            <Badge \n              variant={categoryAvailability.available > 0 ? \"default\" : \"destructive\"}\n              data-testid={`badge-${categoryAvailability.category.toLowerCase()}-status`}\n            >\n              {categoryAvailability.available}/{categoryAvailability.total} Available\n            </Badge>\n          )}\n        </CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        {categoryAvailability && (\n          <div className=\"space-y-2\">\n            <div className=\"w-full bg-secondary rounded-full h-3 overflow-hidden\">\n              <div\n                className={`h-full transition-all duration-500 ${\n                  categoryAvailability.percentage > 50\n                    ? \"bg-green-500\"\n                    : categoryAvailability.percentage > 20\n                    ? \"bg-yellow-500\"\n                    : \"bg-red-500\"\n                }`}\n                style={{ width: `${categoryAvailability.percentage}%` }}\n                data-testid={`progress-${categoryAvailability.category.toLowerCase()}`}\n              />\n            </div>\n            <p className=\"text-sm text-muted-foreground\" data-testid={`text-${categoryAvailability.category.toLowerCase()}-percentage`}>\n              {categoryAvailability.percentage}% capacity available\n            </p>\n          </div>\n        )}\n        \n        {categoryPricing.length > 0 && (\n          <div className=\"pt-4 border-t\">\n            <h4 className=\"font-semibold mb-3\">Pricing</h4>\n            <div className=\"grid grid-cols-2 md:grid-cols-3 gap-3\">\n              {categoryPricing.map((price) => (\n                <div key={price.id} className=\"p-3 rounded-lg bg-muted\" data-testid={`pricing-${price.category.toLowerCase()}-${price.duration}`}>\n                  <p className=\"text-sm font-medium\">{price.duration}</p>\n                  <p className=\"text-lg font-bold text-primary\">‚Çπ{price.price}</p>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n\n  const renderGamesList = (gamesList: Game[], categoryName: string) => {\n    if (gamesList.length === 0) {\n      return (\n        <Card>\n          <CardContent className=\"flex flex-col items-center justify-center py-12\">\n            <Gamepad2 className=\"h-16 w-16 text-muted-foreground mb-4\" />\n            <p className=\"text-muted-foreground text-center\">No {categoryName} games listed yet</p>\n          </CardContent>\n        </Card>\n      );\n    }\n\n    return (\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n        {gamesList.map((game) => (\n          <Card key={game.id} className=\"overflow-hidden hover:shadow-lg transition-shadow\" data-testid={`game-${game.id}`}>\n            <CardContent className=\"p-0\">\n              {game.imageUrl && (\n                <div className=\"relative aspect-video overflow-hidden bg-muted\">\n                  <img\n                    src={game.imageUrl}\n                    alt={game.name}\n                    className=\"object-cover w-full h-full\"\n                    data-testid={`img-${game.id}`}\n                  />\n                </div>\n              )}\n              <div className=\"p-4\">\n                <h3 className=\"font-semibold text-lg mb-1\" data-testid={`text-name-${game.id}`}>{game.name}</h3>\n                {game.description && (\n                  <p className=\"text-sm text-muted-foreground\" data-testid={`text-description-${game.id}`}>\n                    {game.description}\n                  </p>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"container mx-auto p-6 space-y-6\">\n      <h1 className=\"text-3xl md:text-4xl font-bold\" data-testid=\"heading-games\">Games Library</h1>\n      <p className=\"text-lg text-muted-foreground\">Explore our collection of games and check real-time availability</p>\n      \n      <Tabs defaultValue=\"pc\" className=\"w-full\">\n        <TabsList className=\"grid w-full max-w-md grid-cols-2\" data-testid=\"tabs-list\">\n          <TabsTrigger value=\"pc\" data-testid=\"tab-pc\">\n            <Monitor className=\"h-4 w-4 mr-2\" />\n            PC Gaming\n          </TabsTrigger>\n          <TabsTrigger value=\"ps5\" data-testid=\"tab-ps5\">\n            <Gamepad2 className=\"h-4 w-4 mr-2\" />\n            PS5 Gaming\n          </TabsTrigger>\n        </TabsList>\n        \n        <TabsContent value=\"pc\" className=\"space-y-6 mt-6\">\n          {renderAvailabilityCard(pcAvailability, pcPricing)}\n          {renderGamesList(pcGames, \"PC\")}\n        </TabsContent>\n        \n        <TabsContent value=\"ps5\" className=\"space-y-6 mt-6\">\n          {renderAvailabilityCard(ps5Availability, ps5Pricing)}\n          {renderGamesList(ps5Games, \"PS5\")}\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","path":null,"size_bytes":7269,"size_tokens":null},"client/src/hooks/useNetworkMonitor.ts":{"content":"import { useEffect, useState, useRef } from \"react\";\n\nconst HEALTH_CHECK_INTERVAL = 30 * 1000; // 30 seconds\nconst HEALTH_CHECK_TIMEOUT = 20 * 1000; // 20 seconds timeout\n\nexport function useNetworkMonitor() {\n  const [isOnline, setIsOnline] = useState(true);\n  const [showAlert, setShowAlert] = useState(false);\n  const intervalRef = useRef<NodeJS.Timeout | null>(null);\n  const failureCountRef = useRef(0);\n\n  useEffect(() => {\n    const checkServerHealth = async () => {\n      try {\n        const controller = new AbortController();\n        const timeoutId = setTimeout(() => controller.abort(), HEALTH_CHECK_TIMEOUT);\n        \n        const response = await fetch(\"/api/health\", {\n          signal: controller.signal,\n        });\n        \n        clearTimeout(timeoutId);\n\n        if (response.ok) {\n          failureCountRef.current = 0;\n          if (!isOnline) {\n            setIsOnline(true);\n            setShowAlert(false);\n          }\n        } else {\n          throw new Error(\"Server responded with error\");\n        }\n      } catch (error) {\n        failureCountRef.current += 1;\n        console.error(\"[Network Monitor] Health check failed:\", error);\n        \n        // Show alert after 3 consecutive failures\n        if (failureCountRef.current >= 3) {\n          setIsOnline(false);\n          setShowAlert(true);\n        }\n      }\n    };\n\n    // Check online status\n    const handleOnline = () => {\n      setIsOnline(true);\n      setShowAlert(false);\n      failureCountRef.current = 0;\n      checkServerHealth();\n    };\n\n    const handleOffline = () => {\n      setIsOnline(false);\n      setShowAlert(true);\n    };\n\n    // Listen to browser online/offline events\n    window.addEventListener(\"online\", handleOnline);\n    window.addEventListener(\"offline\", handleOffline);\n\n    // Start health check interval\n    checkServerHealth();\n    intervalRef.current = setInterval(checkServerHealth, HEALTH_CHECK_INTERVAL);\n\n    return () => {\n      window.removeEventListener(\"online\", handleOnline);\n      window.removeEventListener(\"offline\", handleOffline);\n      if (intervalRef.current) {\n        clearInterval(intervalRef.current);\n      }\n    };\n  }, [isOnline]);\n\n  const handleRefresh = () => {\n    window.location.reload();\n  };\n\n  const handleDismiss = () => {\n    setShowAlert(false);\n  };\n\n  return {\n    isOnline,\n    showAlert,\n    handleRefresh,\n    handleDismiss,\n  };\n}\n","path":null,"size_bytes":2393,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"client/src/components/DeviceConfigCard.tsx":{"content":"import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { Minus, Plus } from \"lucide-react\";\n\ninterface DeviceConfigCardProps {\n  title: string;\n  description: string;\n  count: number;\n  onCountChange: (newCount: number) => void;\n  seats?: { name: string; visible: boolean }[];\n  onToggleVisibility?: (seatName: string) => void;\n}\n\nexport function DeviceConfigCard({\n  title,\n  description,\n  count,\n  onCountChange,\n  seats = [],\n  onToggleVisibility,\n}: DeviceConfigCardProps) {\n  return (\n    <Card className=\"glass-card\" data-testid={`card-${title.toLowerCase().replace(/\\s/g, '-')}`}>\n      <CardHeader>\n        <CardTitle>{title}</CardTitle>\n        <CardDescription>{description}</CardDescription>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        <div className=\"flex items-center gap-4\">\n          <Label>Quantity:</Label>\n          <div className=\"flex items-center gap-2\">\n            <Button\n              size=\"icon\"\n              variant=\"outline\"\n              onClick={() => onCountChange(Math.max(0, count - 1))}\n              disabled={count === 0}\n              data-testid={`button-decrease-${title.toLowerCase()}`}\n            >\n              <Minus className=\"h-4 w-4\" />\n            </Button>\n            <span className=\"w-12 text-center font-bold\" data-testid={`text-count-${title.toLowerCase()}`}>\n              {count}\n            </span>\n            <Button\n              size=\"icon\"\n              variant=\"outline\"\n              onClick={() => onCountChange(count + 1)}\n              data-testid={`button-increase-${title.toLowerCase()}`}\n            >\n              <Plus className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n\n        {seats.length > 0 && (\n          <div className=\"space-y-2\">\n            <Label className=\"text-sm text-muted-foreground\">Seat Visibility:</Label>\n            <div className=\"grid grid-cols-2 gap-2\">\n              {seats.map((seat) => (\n                <div\n                  key={seat.name}\n                  className=\"flex items-center justify-between rounded-md border p-2\"\n                  data-testid={`seat-toggle-${seat.name.toLowerCase()}`}\n                >\n                  <span className=\"text-sm\">{seat.name}</span>\n                  <Switch\n                    checked={seat.visible}\n                    onCheckedChange={() => onToggleVisibility?.(seat.name)}\n                    data-testid={`switch-${seat.name.toLowerCase()}`}\n                  />\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":2798,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"server/neon-metrics.ts":{"content":"import { createApiClient } from '@neondatabase/api-client';\n\ninterface DatabaseMetrics {\n  name: string;\n  projectId: string;\n  storageBytes: number;\n  storageMB: number;\n  limitMB: number;\n  percentUsed: number;\n  computeTimeSeconds: number;\n  activeTimeSeconds: number;\n  quotaResetAt: string | null;\n}\n\ninterface StorageMetricsResponse {\n  databases: DatabaseMetrics[];\n  totalStorageMB: number;\n  totalLimitMB: number;\n  totalPercentUsed: number;\n  lastUpdated: string;\n}\n\nfunction extractProjectId(databaseUrl: string): string | null {\n  try {\n    const match = databaseUrl.match(/([a-z0-9-]+)\\.([a-z0-9-]+)\\.neon\\.tech/);\n    if (match) {\n      return `${match[1]}-${match[2]}`;\n    }\n    return null;\n  } catch {\n    return null;\n  }\n}\n\nexport async function fetchNeonStorageMetrics(): Promise<StorageMetricsResponse> {\n  const apiKey = process.env.NEON_API_KEY;\n  \n  if (!apiKey) {\n    throw new Error('NEON_API_KEY is not configured');\n  }\n\n  const databases = [\n    { name: 'Main', url: process.env.DATABASE_URL_MAIN || process.env.DATABASE_URL },\n    { name: 'History', url: process.env.DATABASE_URL_HISTORY },\n    { name: 'Payments', url: process.env.DATABASE_URL_PAYMENTS },\n    { name: 'Expenses', url: process.env.DATABASE_URL_EXPENSES },\n    { name: 'Logs', url: process.env.DATABASE_URL_LOGS },\n    { name: 'Analytics', url: process.env.DATABASE_URL_ANALYTICS },\n  ];\n\n  const apiClient = createApiClient({\n    apiKey,\n  });\n\n  const metrics: DatabaseMetrics[] = [];\n  const FREE_TIER_LIMIT_MB = 512;\n\n  for (const db of databases) {\n    if (!db.url) {\n      continue;\n    }\n\n    const projectId = extractProjectId(db.url);\n    if (!projectId) {\n      console.warn(`Could not extract project ID from ${db.name} database URL`);\n      continue;\n    }\n\n    try {\n      const response = await apiClient.getProject(projectId);\n      const project = response.data.project;\n\n      const storageBytes = project.synthetic_storage_size || 0;\n      const storageMB = storageBytes / (1024 * 1024);\n      const percentUsed = (storageMB / FREE_TIER_LIMIT_MB) * 100;\n\n      metrics.push({\n        name: db.name,\n        projectId,\n        storageBytes,\n        storageMB: Math.round(storageMB * 100) / 100,\n        limitMB: FREE_TIER_LIMIT_MB,\n        percentUsed: Math.round(percentUsed * 100) / 100,\n        computeTimeSeconds: project.compute_time_seconds || 0,\n        activeTimeSeconds: project.active_time_seconds || 0,\n        quotaResetAt: project.quota_reset_at || null,\n      });\n    } catch (error: any) {\n      console.error(`Error fetching metrics for ${db.name}:`, error.message);\n      metrics.push({\n        name: db.name,\n        projectId,\n        storageBytes: 0,\n        storageMB: 0,\n        limitMB: FREE_TIER_LIMIT_MB,\n        percentUsed: 0,\n        computeTimeSeconds: 0,\n        activeTimeSeconds: 0,\n        quotaResetAt: null,\n      });\n    }\n  }\n\n  const totalStorageMB = metrics.reduce((sum, m) => sum + m.storageMB, 0);\n  const TOTAL_LIMIT_MB = 3072; // 6 databases √ó 512 MB = 3 GB\n  const totalPercentUsed = totalStorageMB > 0 ? (totalStorageMB / TOTAL_LIMIT_MB) * 100 : 0;\n\n  return {\n    databases: metrics,\n    totalStorageMB: Math.round(totalStorageMB * 100) / 100,\n    totalLimitMB: TOTAL_LIMIT_MB,\n    totalPercentUsed: Math.round(totalPercentUsed * 100) / 100,\n    lastUpdated: new Date().toISOString(),\n  };\n}\n","path":null,"size_bytes":3353,"size_tokens":null},"TIMEZONE_FIX.md":{"content":"# Timezone Conversion Fix - Analytics Charts\n\n## Issue\nThe analytics charts were displaying time values in UTC (e.g., 14:00, 16:00) instead of India Standard Time (IST/Asia/Kolkata timezone).\n\n## Solution Implemented\nUpdated the Analytics component (`client/src/pages/Analytics.tsx`) to automatically convert all UTC timestamps to IST before rendering in charts.\n\n## Changes Made\n\n### 1. Added Timezone Conversion Function\nCreated a `convertToIST()` function that handles two types of time formats:\n- **Hour format** (e.g., \"14:00\"): Converts UTC hour to IST equivalent\n- **Timestamp format** (e.g., \"12:30:45\"): Converts UTC timestamp to IST time\n\n```typescript\nconst convertToIST = (utcTimeString: string, isHourFormat: boolean = false): string => {\n  if (isHourFormat) {\n    // Converts hour like \"14:00\" UTC to IST (19:30)\n    const [hour] = utcTimeString.split(':').map(Number);\n    const utcDate = new Date();\n    utcDate.setUTCHours(hour, 0, 0, 0);\n    return utcDate.toLocaleString('en-IN', { \n      timeZone: 'Asia/Kolkata',\n      hour: '2-digit',\n      minute: '2-digit',\n      hour12: false\n    });\n  } else {\n    // Converts timestamp to IST\n    const now = new Date();\n    const [time] = utcTimeString.split(' ');\n    const [hours, minutes, seconds] = time.split(':').map(Number);\n    now.setUTCHours(hours, minutes, seconds || 0, 0);\n    return now.toLocaleString('en-IN', {\n      timeZone: 'Asia/Kolkata',\n      hour: '2-digit',\n      minute: '2-digit',\n      second: '2-digit',\n      hour12: false\n    });\n  }\n};\n```\n\n### 2. Data Transformation\nCreated a `transformedStats` object using `useMemo` that converts all time values to IST:\n- `hourlyUsage[].hour`: Converted from UTC to IST\n- `realtimeData[].timestamp`: Converted from UTC to IST\n\n### 3. Updated All Charts\nAll Recharts components now use the transformed data with IST times:\n- **Occupancy Trend** (AreaChart): Uses IST timestamps\n- **Hourly Activity** (BarChart): Uses IST hour labels\n- **Revenue & Bookings** (ComposedChart): Uses IST hour labels\n- **Peak Hours** insights: Display IST times\n\n## Time Offset\nIndia Standard Time (IST) is UTC+5:30, so:\n- 14:00 UTC ‚Üí 19:30 IST\n- 16:00 UTC ‚Üí 21:30 IST\n\n## Affected Charts\n1. **Overview Tab**\n   - Occupancy Trend chart\n   - Hourly Activity chart\n\n2. **Performance Tab**\n   - Revenue & Bookings combined chart\n\n3. **Insights Tab**\n   - Peak Hours display\n\nAll time labels and tooltips now show the correct local time (Asia/Kolkata timezone).\n","path":null,"size_bytes":2471,"size_tokens":null},"client/src/components/OnboardingTour.tsx":{"content":"import { useState } from \"react\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { \n  ChevronLeft, \n  ChevronRight, \n  X, \n  Sparkles, \n  LayoutDashboard, \n  Settings, \n  UtensilsCrossed, \n  TrendingUp,\n  Plus,\n  Clock,\n  Users,\n  IndianRupee,\n  Calendar,\n  PlayCircle,\n  PauseCircle,\n  Power,\n  ShoppingCart,\n  Receipt,\n  Laptop,\n  Gamepad2,\n  BarChart3,\n  Wallet\n} from \"lucide-react\";\n\ninterface OnboardingTourProps {\n  open: boolean;\n  onComplete: () => void;\n  onSkip: () => void;\n}\n\ninterface TourStep {\n  title: string;\n  description: string;\n  icon: React.ReactNode;\n  content: string;\n  features?: Array<{\n    icon: React.ReactNode;\n    text: string;\n  }>;\n  tips?: string[];\n}\n\nconst tourSteps: TourStep[] = [\n  {\n    title: \"Welcome to Airavoto Gaming! üéÆ\",\n    description: \"Your complete gaming center management solution\",\n    icon: <Sparkles className=\"h-12 w-12 text-purple-500\" />,\n    content: \"Airavoto Gaming is designed to help you efficiently run your gaming center. From tracking gaming sessions in real-time to managing bookings, food orders, and revenue - everything you need is in one place.\",\n    tips: [\n      \"üí° All features are accessible from the sidebar on the left\",\n      \"üí° Use the dashboard for day-to-day operations\",\n      \"üí° Your changes are saved automatically\"\n    ]\n  },\n  {\n    title: \"Dashboard - Your Control Center üìä\",\n    description: \"Everything you need at your fingertips\",\n    icon: <LayoutDashboard className=\"h-12 w-12 text-blue-500\" />,\n    content: \"The Dashboard shows your gaming devices organized by category (PC, PS5, VR, etc.). Each card shows available seats, occupied seats, and lets you add new bookings instantly.\",\n    features: [\n      { icon: <Plus className=\"h-5 w-5 text-green-500\" />, text: \"Add Booking - Create walk-in or advance bookings\" },\n      { icon: <Clock className=\"h-5 w-5 text-orange-500\" />, text: \"Real-time Timers - Watch session countdowns live\" },\n      { icon: <Users className=\"h-5 w-5 text-blue-500\" />, text: \"Booking Types - Walk-in, Advance, or Happy Hours\" }\n    ],\n    tips: [\n      \"üìå Walk-in bookings start immediately\",\n      \"üìå Advance bookings let customers reserve seats ahead\",\n      \"üìå Happy Hours bookings use special time-based pricing\"\n    ]\n  },\n  {\n    title: \"Creating a Booking üéØ\",\n    description: \"Step-by-step booking process\",\n    icon: <Plus className=\"h-12 w-12 text-green-500\" />,\n    content: \"Click '+' on any device card to create a booking. You can choose between walk-in (starts now), advance (future date/time), or happy hours (special pricing).\",\n    features: [\n      { icon: <Users className=\"h-5 w-5 text-blue-500\" />, text: \"Enter customer name and phone (optional)\" },\n      { icon: <Laptop className=\"h-5 w-5 text-purple-500\" />, text: \"Select device category and available seats\" },\n      { icon: <Clock className=\"h-5 w-5 text-orange-500\" />, text: \"Choose duration and pricing tier\" },\n      { icon: <Gamepad2 className=\"h-5 w-5 text-pink-500\" />, text: \"For PS5: Select number of persons playing\" }\n    ],\n    tips: [\n      \"üí° Pricing comes from your Settings page\",\n      \"üí° Multiple seats can be booked at once\",\n      \"üí° Walk-in starts immediately, Advance needs date/time\"\n    ]\n  },\n  {\n    title: \"Managing Active Sessions ‚è±Ô∏è\",\n    description: \"Control bookings in real-time\",\n    icon: <PlayCircle className=\"h-12 w-12 text-green-500\" />,\n    content: \"Once a session starts, you have full control. You can extend time, pause/resume, add food orders, or end the session early.\",\n    features: [\n      { icon: <Clock className=\"h-5 w-5 text-blue-500\" />, text: \"Extend Time - Add more minutes using configured pricing\" },\n      { icon: <PauseCircle className=\"h-5 w-5 text-orange-500\" />, text: \"Pause/Resume - Stop timer temporarily without ending\" },\n      { icon: <ShoppingCart className=\"h-5 w-5 text-green-500\" />, text: \"Add Food - Attach food orders to booking\" },\n      { icon: <Power className=\"h-5 w-5 text-red-500\" />, text: \"End Session - Complete or delete booking\" }\n    ],\n    tips: [\n      \"üîî Timer turns red when expired - automatic alert\",\n      \"üîî Paused sessions retain remaining time\",\n      \"üîî Food orders add to total booking amount\"\n    ]\n  },\n  {\n    title: \"Payment Processing üí≥\",\n    description: \"Record payments for completed sessions\",\n    icon: <IndianRupee className=\"h-12 w-12 text-green-500\" />,\n    content: \"Use the Calculate and Payment buttons to process customer payments. Select completed bookings from the table, calculate the total, then record how they paid.\",\n    features: [\n      { icon: <Users className=\"h-5 w-5 text-blue-500\" />, text: \"Select Bookings - Check boxes on completed sessions\" },\n      { icon: <Receipt className=\"h-5 w-5 text-purple-500\" />, text: \"Calculate - Get total amount including food orders\" },\n      { icon: <Wallet className=\"h-5 w-5 text-green-500\" />, text: \"Payment - Mark as Cash, UPI, or Credit payment\" },\n      { icon: <IndianRupee className=\"h-5 w-5 text-orange-500\" />, text: \"Split Payment - Combine Cash and UPI if needed\" }\n    ],\n    tips: [\n      \"üí∞ Select multiple bookings to process payments together\",\n      \"üí∞ Calculate shows total including all food orders\",\n      \"üí∞ Split payment lets you record Cash + UPI combinations\"\n    ]\n  },\n  {\n    title: \"Refresh & Archive üîÑ\",\n    description: \"Keep your dashboard clean and organized\",\n    icon: <Clock className=\"h-12 w-12 text-blue-500\" />,\n    content: \"After marking payments, click the Refresh button to archive completed bookings and move them to the History page. This keeps your dashboard showing only active sessions.\",\n    features: [\n      { icon: <Receipt className=\"h-5 w-5 text-green-500\" />, text: \"Archive Completed - Moves paid bookings to history\" },\n      { icon: <Calendar className=\"h-5 w-5 text-blue-500\" />, text: \"Clean Dashboard - Shows only active sessions\" },\n      { icon: <Clock className=\"h-5 w-5 text-orange-500\" />, text: \"Auto-Cleanup - Daily cleanup at 2 AM\" },\n      { icon: <Settings className=\"h-5 w-5 text-purple-500\" />, text: \"Ctrl+R Shortcut - Quick data refresh (no archive)\" }\n    ],\n    tips: [\n      \"üîÑ Click Refresh button after processing payments to archive\",\n      \"üîÑ Archived bookings move to History page\",\n      \"üîÑ Ctrl+R refreshes data without archiving\"\n    ]\n  },\n  {\n    title: \"Food Orders & Revenue üçï\",\n    description: \"Boost income with food service\",\n    icon: <UtensilsCrossed className=\"h-12 w-12 text-orange-500\" />,\n    content: \"Add food items to your menu from the Food page. Then attach food orders to any active booking to track everything together.\",\n    features: [\n      { icon: <Plus className=\"h-5 w-5 text-green-500\" />, text: \"Food Page - Add snacks, drinks, meals to menu\" },\n      { icon: <ShoppingCart className=\"h-5 w-5 text-blue-500\" />, text: \"Order from Booking - Select items and quantity\" },\n      { icon: <Receipt className=\"h-5 w-5 text-purple-500\" />, text: \"Auto-Calculate - Price updates automatically\" },\n      { icon: <IndianRupee className=\"h-5 w-5 text-green-500\" />, text: \"Track Revenue - See food sales in reports\" }\n    ],\n    tips: [\n      \"üí∞ Food orders increase booking total amount\",\n      \"üí∞ All orders are tracked in booking history\",\n      \"üí∞ You can delete individual food items if needed\"\n    ]\n  },\n  {\n    title: \"Settings & Configuration ‚öôÔ∏è\",\n    description: \"Customize your gaming center setup\",\n    icon: <Settings className=\"h-12 w-12 text-indigo-500\" />,\n    content: \"The Settings page is where you configure everything. Add device categories, set pricing tiers, configure happy hours, and manage your gaming center details.\",\n    features: [\n      { icon: <Laptop className=\"h-5 w-5 text-blue-500\" />, text: \"Device Categories - Add PC, PS5, VR, Xbox, etc.\" },\n      { icon: <IndianRupee className=\"h-5 w-5 text-green-500\" />, text: \"Pricing Tiers - Set prices for different durations\" },\n      { icon: <Clock className=\"h-5 w-5 text-orange-500\" />, text: \"Happy Hours - Special time-based pricing\" },\n      { icon: <Users className=\"h-5 w-5 text-purple-500\" />, text: \"Person Count - PS5 can have multi-person pricing\" }\n    ],\n    tips: [\n      \"üéØ Each device type can have unique pricing\",\n      \"üéØ Happy Hours need both time slots AND pricing\",\n      \"üéØ Changes apply to new bookings immediately\"\n    ]\n  },\n  {\n    title: \"Happy Hours Feature ‚è∞\",\n    description: \"Special pricing for specific time windows\",\n    icon: <Clock className=\"h-12 w-12 text-yellow-500\" />,\n    content: \"Happy Hours let you offer special rates during specific times. Configure time slots (e.g., 2 PM-6 PM) and pricing tiers, then customers can book at discounted rates during those hours.\",\n    features: [\n      { icon: <Clock className=\"h-5 w-5 text-blue-500\" />, text: \"Time Slots - Define when happy hours are active\" },\n      { icon: <IndianRupee className=\"h-5 w-5 text-green-500\" />, text: \"Special Pricing - Set discounted rates\" },\n      { icon: <Calendar className=\"h-5 w-5 text-purple-500\" />, text: \"Category-Based - Each device can have different hours\" },\n      { icon: <PlayCircle className=\"h-5 w-5 text-orange-500\" />, text: \"Instant Start - Happy Hours bookings start immediately\" }\n    ],\n    tips: [\n      \"‚ö° Great for filling seats during off-peak hours\",\n      \"‚ö° Can run all day or specific time windows\",\n      \"‚ö° Pricing is separate from regular pricing\"\n    ]\n  },\n  {\n    title: \"Analytics & Reports üìà\",\n    description: \"Track performance and make smart decisions\",\n    icon: <BarChart3 className=\"h-12 w-12 text-blue-500\" />,\n    content: \"View detailed analytics about revenue, device usage, customer behavior, and more. Export reports to CSV/PDF for accounting or business analysis.\",\n    features: [\n      { icon: <TrendingUp className=\"h-5 w-5 text-green-500\" />, text: \"Revenue Analytics - Daily, weekly, monthly trends\" },\n      { icon: <BarChart3 className=\"h-5 w-5 text-blue-500\" />, text: \"Device Usage - See which devices are most popular\" },\n      { icon: <Users className=\"h-5 w-5 text-purple-500\" />, text: \"Customer Stats - Unique customers, session duration\" },\n      { icon: <Receipt className=\"h-5 w-5 text-orange-500\" />, text: \"Food Revenue - Track snacks and drinks sales\" }\n    ],\n    tips: [\n      \"üìä Reports page has export options (CSV/PDF)\",\n      \"üìä Analytics show walk-in booking data only\",\n      \"üìä Use data to optimize pricing and hours\"\n    ]\n  },\n  {\n    title: \"Expense Tracking üí∏\",\n    description: \"Monitor your costs and profits\",\n    icon: <Receipt className=\"h-12 w-12 text-red-500\" />,\n    content: \"Track all your gaming center expenses in one place. Record electricity bills, game purchases, maintenance, salaries, and more. See profit vs expenses to understand your business health.\",\n    features: [\n      { icon: <Plus className=\"h-5 w-5 text-red-500\" />, text: \"Add Expenses - Record all costs with categories\" },\n      { icon: <IndianRupee className=\"h-5 w-5 text-green-500\" />, text: \"Profit Calculation - Revenue minus expenses\" },\n      { icon: <BarChart3 className=\"h-5 w-5 text-blue-500\" />, text: \"Category Breakdown - See where money goes\" },\n      { icon: <Receipt className=\"h-5 w-5 text-purple-500\" />, text: \"Export Reports - CSV/PDF for accounting\" }\n    ],\n    tips: [\n      \"üí° Categories: Electricity, Games, Maintenance, Salary, etc.\",\n      \"üí° Keep receipts and add expenses regularly\",\n      \"üí° Monthly reports help with tax preparation\"\n    ]\n  },\n  {\n    title: \"Timeline View üìÖ\",\n    description: \"Visual calendar of all bookings\",\n    icon: <Calendar className=\"h-12 w-12 text-blue-500\" />,\n    content: \"The Timeline page shows a visual calendar of all your bookings. Great for planning and seeing your gaming center's schedule at a glance.\",\n    features: [\n      { icon: <Calendar className=\"h-5 w-5 text-blue-500\" />, text: \"Calendar View - See all bookings by date\" },\n      { icon: <Clock className=\"h-5 w-5 text-orange-500\" />, text: \"Advance Bookings - View upcoming reservations\" },\n      { icon: <Users className=\"h-5 w-5 text-purple-500\" />, text: \"Customer Names - Quick identification\" },\n      { icon: <Laptop className=\"h-5 w-5 text-green-500\" />, text: \"Device Breakdown - See which devices are booked\" }\n    ],\n    tips: [\n      \"üìÖ Click on dates to see all bookings for that day\",\n      \"üìÖ Shows both walk-in and advance bookings\"\n    ]\n  },\n  {\n    title: \"Reports & Exports üìÑ\",\n    description: \"Professional reports for your business\",\n    icon: <Receipt className=\"h-12 w-12 text-indigo-500\" />,\n    content: \"Generate comprehensive reports for accounting or business analysis. Export data to CSV or PDF formats for easy sharing and record-keeping.\",\n    features: [\n      { icon: <BarChart3 className=\"h-5 w-5 text-blue-500\" />, text: \"Booking Reports - See all sessions and revenue\" },\n      { icon: <Receipt className=\"h-5 w-5 text-green-500\" />, text: \"Expense Reports - Track all costs\" },\n      { icon: <Calendar className=\"h-5 w-5 text-purple-500\" />, text: \"Date Filters - Custom report periods\" },\n      { icon: <IndianRupee className=\"h-5 w-5 text-orange-500\" />, text: \"Export Options - CSV and PDF formats\" }\n    ],\n    tips: [\n      \"üìä Reports page has export buttons for CSV/PDF\",\n      \"üìä Use date filters to customize report periods\",\n      \"üìä Great for accounting and tax preparation\"\n    ]\n  },\n  {\n    title: \"Notifications & Alerts üîî\",\n    description: \"Stay informed about important events\",\n    icon: <Clock className=\"h-12 w-12 text-yellow-500\" />,\n    content: \"The notification center keeps you updated about expired sessions and other important events in your gaming center.\",\n    features: [\n      { icon: <Clock className=\"h-5 w-5 text-red-500\" />, text: \"Session Expiry - Alerts when time runs out\" },\n      { icon: <Calendar className=\"h-5 w-5 text-blue-500\" />, text: \"Booking Updates - Track booking changes\" },\n      { icon: <IndianRupee className=\"h-5 w-5 text-green-500\" />, text: \"Payment Alerts - Payment confirmations\" }\n    ],\n    tips: [\n      \"üîî Click the bell icon to view notifications\",\n      \"üîî Important alerts help you stay on top of operations\"\n    ]\n  },\n  {\n    title: \"History & Activity Logs üìö\",\n    description: \"Complete audit trail of all operations\",\n    icon: <Clock className=\"h-12 w-12 text-cyan-500\" />,\n    content: \"View complete history of all bookings, payments, and system activities. The Activity Logs page shows who did what and when - perfect for accountability.\",\n    features: [\n      { icon: <Calendar className=\"h-5 w-5 text-blue-500\" />, text: \"Booking History - All past sessions archived\" },\n      { icon: <Users className=\"h-5 w-5 text-purple-500\" />, text: \"Customer History - Track repeat customers\" },\n      { icon: <Receipt className=\"h-5 w-5 text-green-500\" />, text: \"Payment Records - Complete transaction log\" },\n      { icon: <Settings className=\"h-5 w-5 text-orange-500\" />, text: \"Activity Logs - Admin/staff actions tracked\" }\n    ],\n    tips: [\n      \"üìù Search and filter by date, customer, device\",\n      \"üìù Activity logs help identify who made changes\",\n      \"üìù Export history for business records\"\n    ]\n  },\n  {\n    title: \"Ready to Get Started! üöÄ\",\n    description: \"You're all set to manage your gaming center\",\n    icon: <Sparkles className=\"h-12 w-12 text-purple-500\" />,\n    content: \"You now know all the key features! Start by configuring your devices in Settings, set up pricing, then create your first booking. The system will guide you along the way.\",\n    features: [\n      { icon: <Settings className=\"h-5 w-5 text-blue-500\" />, text: \"Step 1: Go to Settings ‚Üí Add your devices\" },\n      { icon: <IndianRupee className=\"h-5 w-5 text-green-500\" />, text: \"Step 2: Configure pricing for each device\" },\n      { icon: <Plus className=\"h-5 w-5 text-purple-500\" />, text: \"Step 3: Create your first booking from Dashboard\" },\n      { icon: <BarChart3 className=\"h-5 w-5 text-orange-500\" />, text: \"Step 4: Watch your revenue grow in Analytics!\" }\n    ],\n    tips: [\n      \"üéâ Need help? Use this tour anytime from the header\",\n      \"üéâ All data is saved automatically - no worries\",\n      \"üéâ Explore and experiment - you can always undo\"\n    ]\n  }\n];\n\nexport function OnboardingTour({ open, onComplete, onSkip }: OnboardingTourProps) {\n  const [currentStep, setCurrentStep] = useState(0);\n  const [showTour, setShowTour] = useState(false);\n\n  const isFirstStep = currentStep === 0;\n  const isLastStep = currentStep === tourSteps.length - 1;\n  const step = tourSteps[currentStep];\n\n  const handleNext = () => {\n    if (isLastStep) {\n      onComplete();\n      setCurrentStep(0);\n      setShowTour(false);\n    } else {\n      setCurrentStep(currentStep + 1);\n    }\n  };\n\n  const handlePrevious = () => {\n    if (currentStep > 0) {\n      setCurrentStep(currentStep - 1);\n    }\n  };\n\n  const handleStartTour = () => {\n    setShowTour(true);\n  };\n\n  const handleSkip = () => {\n    onSkip();\n    setCurrentStep(0);\n    setShowTour(false);\n  };\n\n  const handleClose = () => {\n    setCurrentStep(0);\n    setShowTour(false);\n  };\n\n  return (\n    <>\n      {/* Welcome Dialog */}\n      <Dialog open={open && !showTour} onOpenChange={handleClose}>\n        <DialogContent className=\"sm:max-w-md\" data-testid=\"dialog-onboarding-welcome\">\n          <DialogHeader>\n            <div className=\"flex justify-center mb-4\">\n              <Sparkles className=\"h-16 w-16 text-purple-500\" />\n            </div>\n            <DialogTitle className=\"text-center text-2xl\">Welcome to Airavoto Gaming! üéÆ</DialogTitle>\n            <DialogDescription className=\"text-center text-base\">\n              Would you like a quick tour to learn about the key features and get started?\n            </DialogDescription>\n          </DialogHeader>\n          <DialogFooter className=\"flex-col sm:flex-col gap-2 mt-4\">\n            <Button \n              onClick={handleStartTour} \n              className=\"w-full\"\n              data-testid=\"button-start-tour\"\n            >\n              Start Tour\n            </Button>\n            <Button \n              onClick={handleSkip} \n              variant=\"outline\" \n              className=\"w-full\"\n              data-testid=\"button-dont-need-tour\"\n            >\n              Don't Need\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Tour Dialog */}\n      <Dialog open={showTour} onOpenChange={handleClose}>\n        <DialogContent className=\"sm:max-w-lg\" data-testid=\"dialog-onboarding-tour\">\n          <button\n            onClick={handleSkip}\n            className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\"\n            data-testid=\"button-close-tour\"\n          >\n            <X className=\"h-4 w-4\" />\n            <span className=\"sr-only\">Close</span>\n          </button>\n          <DialogHeader>\n            <div className=\"flex justify-center mb-4\">\n              {step.icon}\n            </div>\n            <DialogTitle className=\"text-center text-xl\">{step.title}</DialogTitle>\n            <DialogDescription className=\"text-center text-base font-medium\">\n              {step.description}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"py-4 space-y-4 max-h-[60vh] overflow-y-auto\">\n            <p className=\"text-center text-muted-foreground leading-relaxed\">{step.content}</p>\n            \n            {step.features && step.features.length > 0 && (\n              <>\n                <Separator className=\"my-4\" />\n                <div className=\"space-y-3\">\n                  <h4 className=\"text-sm font-semibold text-center\">Key Features:</h4>\n                  {step.features.map((feature, idx) => (\n                    <div key={idx} className=\"flex items-start gap-3 p-2 rounded-md hover:bg-muted/50 transition-colors\">\n                      <div className=\"flex-shrink-0 mt-0.5\">{feature.icon}</div>\n                      <p className=\"text-sm text-muted-foreground flex-1\">{feature.text}</p>\n                    </div>\n                  ))}\n                </div>\n              </>\n            )}\n            \n            {step.tips && step.tips.length > 0 && (\n              <>\n                <Separator className=\"my-4\" />\n                <div className=\"space-y-2 bg-muted/30 p-3 rounded-lg\">\n                  <h4 className=\"text-sm font-semibold\">üí° Pro Tips:</h4>\n                  {step.tips.map((tip, idx) => (\n                    <p key={idx} className=\"text-sm text-muted-foreground pl-2\">{tip}</p>\n                  ))}\n                </div>\n              </>\n            )}\n          </div>\n          <div className=\"flex justify-center mb-4 mt-2\">\n            <div className=\"flex gap-2\">\n              {tourSteps.map((_, index) => (\n                <div\n                  key={index}\n                  className={`h-2 w-2 rounded-full transition-colors ${\n                    index === currentStep ? 'bg-primary' : 'bg-muted'\n                  }`}\n                />\n              ))}\n            </div>\n          </div>\n          <div className=\"text-center text-xs text-muted-foreground mb-2\">\n            Step {currentStep + 1} of {tourSteps.length}\n          </div>\n          <DialogFooter className=\"flex flex-row justify-between gap-2\">\n            <Button\n              onClick={handlePrevious}\n              variant=\"outline\"\n              disabled={isFirstStep}\n              data-testid=\"button-tour-previous\"\n            >\n              <ChevronLeft className=\"h-4 w-4 mr-1\" />\n              Previous\n            </Button>\n            <Button\n              onClick={handleNext}\n              data-testid=\"button-tour-next\"\n            >\n              {isLastStep ? 'Finish' : 'Next'}\n              {!isLastStep && <ChevronRight className=\"h-4 w-4 ml-1\" />}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n}\n","path":null,"size_bytes":22398,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/60 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 glass-card p-6 duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-2xl will-change-[transform,opacity] pointer-events-auto\",\n        className\n      )}\n      style={{\n        transform: 'translate(-50%, -50%)',\n        left: '50%',\n        top: '50%',\n      }}\n      onPointerDown={(e) => e.stopPropagation()}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":4056,"size_tokens":null},"client/src/components/DeviceRestrictionAlert.tsx":{"content":"import { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\nimport { Monitor, AlertTriangle } from \"lucide-react\";\n\ninterface DeviceRestrictionAlertProps {\n  show: boolean;\n  userRole?: string;\n}\n\nexport function DeviceRestrictionAlert({ show, userRole = \"admin/staff\" }: DeviceRestrictionAlertProps) {\n  if (!show) return null;\n\n  return (\n    <Alert className=\"mb-4 border-orange-500 bg-orange-50 dark:bg-orange-950/20\" data-testid=\"alert-device-restriction\">\n      <AlertTriangle className=\"h-4 w-4 text-orange-600 dark:text-orange-400\" />\n      <AlertTitle className=\"text-orange-800 dark:text-orange-200\">\n        Desktop Access Required\n      </AlertTitle>\n      <AlertDescription className=\"text-orange-700 dark:text-orange-300\">\n        You are viewing this page from a mobile or tablet device. As a {userRole} user, you can only make changes from a desktop/PC. \n        All editing features are disabled on this device for security and usability reasons.\n      </AlertDescription>\n    </Alert>\n  );\n}\n","path":null,"size_bytes":1027,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/contexts/TourContext.tsx":{"content":"import { createContext, useContext, useState, useCallback, useEffect, ReactNode } from \"react\";\nimport Joyride, { CallBackProps, Step, STATUS, EVENTS, ACTIONS } from \"react-joyride\";\nimport { useAuth } from \"./AuthContext\";\n\ninterface TourContextValue {\n  startTour: () => void;\n  resetTour: () => void;\n  stopTour: () => void;\n  isTourRunning: boolean;\n  registerSteps: (steps: Step[]) => void;\n}\n\nconst TourContext = createContext<TourContextValue | undefined>(undefined);\n\ninterface TourProviderProps {\n  children: ReactNode;\n}\n\nconst TOUR_COMPLETION_KEY = \"airavoto_tour_completed\";\n\nconst joyrideStyles = {\n  options: {\n    arrowColor: 'hsl(var(--card))',\n    backgroundColor: 'hsl(var(--card))',\n    overlayColor: 'rgba(0, 0, 0, 0.7)',\n    primaryColor: '#8b5cf6',\n    textColor: 'hsl(var(--card-foreground))',\n    width: 380,\n    zIndex: 10000,\n  },\n  tooltip: {\n    borderRadius: '0.5rem',\n    padding: '1.25rem',\n    border: '1px solid hsl(var(--border))',\n  },\n  tooltipContainer: {\n    textAlign: 'left' as const,\n  },\n  tooltipTitle: {\n    fontSize: '1.125rem',\n    fontWeight: 600,\n    marginBottom: '0.5rem',\n    color: 'hsl(var(--card-foreground))',\n  },\n  tooltipContent: {\n    fontSize: '0.875rem',\n    lineHeight: '1.5',\n    color: 'hsl(var(--muted-foreground))',\n  },\n  buttonNext: {\n    backgroundColor: '#8b5cf6',\n    borderRadius: '0.375rem',\n    fontSize: '0.875rem',\n    padding: '0.5rem 1rem',\n    fontWeight: 500,\n  },\n  buttonBack: {\n    color: 'hsl(var(--muted-foreground))',\n    marginRight: '0.5rem',\n    fontSize: '0.875rem',\n  },\n  buttonSkip: {\n    color: 'hsl(var(--muted-foreground))',\n    fontSize: '0.875rem',\n  },\n  beacon: {\n    display: 'none',\n  },\n  spotlight: {\n    borderRadius: '0.5rem',\n  },\n};\n\nexport function TourProvider({ children }: TourProviderProps) {\n  const [run, setRun] = useState(false);\n  const [steps, setSteps] = useState<Step[]>([]);\n  const [stepIndex, setStepIndex] = useState(0);\n  const { user, onboardingCompleted } = useAuth();\n\n  const getTourCompletionKey = useCallback(() => {\n    return user?.id ? `${TOUR_COMPLETION_KEY}_${user.id}` : TOUR_COMPLETION_KEY;\n  }, [user?.id]);\n\n  const isTourCompleted = useCallback(() => {\n    const completed = localStorage.getItem(getTourCompletionKey());\n    return completed === 'true' || onboardingCompleted;\n  }, [getTourCompletionKey, onboardingCompleted]);\n\n  const markTourCompleted = useCallback(() => {\n    localStorage.setItem(getTourCompletionKey(), 'true');\n  }, [getTourCompletionKey]);\n\n  const startTour = useCallback(() => {\n    setStepIndex(0);\n    setRun(true);\n  }, []);\n\n  const resetTour = useCallback(() => {\n    localStorage.removeItem(getTourCompletionKey());\n    setStepIndex(0);\n    setRun(true);\n  }, [getTourCompletionKey]);\n\n  const stopTour = useCallback(() => {\n    setRun(false);\n  }, []);\n\n  const registerSteps = useCallback((newSteps: Step[]) => {\n    setSteps(newSteps);\n  }, []);\n\n  const handleJoyrideCallback = useCallback((data: CallBackProps) => {\n    const { status, type, action, index } = data;\n    const finishedStatuses: string[] = [STATUS.FINISHED, STATUS.SKIPPED];\n\n    if (finishedStatuses.includes(status)) {\n      setRun(false);\n      markTourCompleted();\n    } else if (type === EVENTS.STEP_AFTER || type === EVENTS.TARGET_NOT_FOUND) {\n      const nextStepIndex = index + (action === ACTIONS.PREV ? -1 : 1);\n      setStepIndex(nextStepIndex);\n    }\n  }, [markTourCompleted]);\n\n  useEffect(() => {\n    const shouldAutoStart = user && !isTourCompleted() && steps.length > 0;\n    if (shouldAutoStart) {\n      const timer = setTimeout(() => {\n        startTour();\n      }, 1500);\n      return () => clearTimeout(timer);\n    }\n  }, [user, isTourCompleted, steps.length, startTour]);\n\n  const value: TourContextValue = {\n    startTour,\n    resetTour,\n    stopTour,\n    isTourRunning: run,\n    registerSteps,\n  };\n\n  return (\n    <TourContext.Provider value={value}>\n      {children}\n      <Joyride\n        steps={steps}\n        run={run}\n        stepIndex={stepIndex}\n        continuous\n        showProgress\n        showSkipButton\n        scrollToFirstStep\n        disableScrolling={false}\n        spotlightClicks={true}\n        callback={handleJoyrideCallback}\n        styles={joyrideStyles}\n        locale={{\n          back: 'Back',\n          close: 'Close',\n          last: 'Finish Tour',\n          next: 'Next',\n          skip: 'Skip Tour',\n        }}\n      />\n    </TourContext.Provider>\n  );\n}\n\nexport function useTour() {\n  const context = useContext(TourContext);\n  if (context === undefined) {\n    throw new Error('useTour must be used within a TourProvider');\n  }\n  return context;\n}\n","path":null,"size_bytes":4647,"size_tokens":null},"client/src/pages/Food.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Plus, Pencil, Trash2, UtensilsCrossed, Package, CalendarClock } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport type { FoodItem } from \"@shared/schema\";\nimport { useAuth } from \"@/contexts/AuthContext\";\n\ninterface FormData {\n  name: string;\n  price: string;\n  costPrice: string;\n  category: string;\n  supplier: string;\n  expiryDate: string;\n  minStockLevel: string;\n}\n\nconst initialFormData: FormData = {\n  name: \"\",\n  price: \"\",\n  costPrice: \"\",\n  category: \"trackable\",\n  supplier: \"\",\n  expiryDate: \"\",\n  minStockLevel: \"10\",\n};\n\nexport default function Food() {\n  const { toast } = useToast();\n  const { canMakeChanges } = useAuth();\n  const [addDialog, setAddDialog] = useState(false);\n  const [editDialog, setEditDialog] = useState<{ open: boolean; item: FoodItem | null }>({\n    open: false,\n    item: null,\n  });\n  const [deleteDialog, setDeleteDialog] = useState<{ open: boolean; id: string; name: string }>({\n    open: false,\n    id: \"\",\n    name: \"\",\n  });\n  const [formData, setFormData] = useState<FormData>(initialFormData);\n\n  const { data: foodItems = [], isLoading } = useQuery<FoodItem[]>({\n    queryKey: [\"/api/food-items\"],\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: FormData) => {\n      const payload = {\n        name: data.name,\n        price: data.price,\n        costPrice: data.costPrice || undefined,\n        category: data.category,\n        supplier: data.supplier || undefined,\n        expiryDate: data.expiryDate || undefined,\n        minStockLevel: parseInt(data.minStockLevel) || 10,\n        currentStock: 0,\n        inInventory: 0,\n      };\n      const response = await fetch(\"/api/food-items\", {\n        method: \"POST\",\n        body: JSON.stringify(payload),\n        headers: { \"Content-Type\": \"application/json\" },\n      });\n      if (!response.ok) throw new Error(\"Failed to create food item\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/food-items\"] });\n      toast({ title: \"Food Item Added\", description: \"New item has been added to the menu\" });\n      setAddDialog(false);\n      setFormData(initialFormData);\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: FormData }) => {\n      const payload = {\n        name: data.name,\n        price: data.price,\n        costPrice: data.costPrice || undefined,\n        category: data.category,\n        supplier: data.supplier || undefined,\n        expiryDate: data.expiryDate || undefined,\n        minStockLevel: parseInt(data.minStockLevel) || 10,\n      };\n      const response = await fetch(`/api/food-items/${id}`, {\n        method: \"PATCH\",\n        body: JSON.stringify(payload),\n        headers: { \"Content-Type\": \"application/json\" },\n      });\n      if (!response.ok) throw new Error(\"Failed to update food item\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/food-items\"] });\n      toast({ title: \"Food Item Updated\", description: \"Item has been updated successfully\" });\n      setEditDialog({ open: false, item: null });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const response = await fetch(`/api/food-items/${id}`, { method: \"DELETE\" });\n      if (!response.ok) throw new Error(\"Failed to delete food item\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/food-items\"] });\n      toast({ title: \"Food Item Deleted\", description: \"Item has been removed from the menu\", variant: \"destructive\" });\n      setDeleteDialog({ open: false, id: \"\", name: \"\" });\n    },\n  });\n\n  const handleAdd = () => {\n    if (!formData.name || !formData.price) {\n      toast({ title: \"Error\", description: \"Please fill in name and price\", variant: \"destructive\" });\n      return;\n    }\n    createMutation.mutate(formData);\n  };\n\n  const handleEdit = () => {\n    if (!editDialog.item) return;\n    if (!formData.name || !formData.price) {\n      toast({ title: \"Error\", description: \"Please fill in name and price\", variant: \"destructive\" });\n      return;\n    }\n    updateMutation.mutate({ id: editDialog.item.id, data: formData });\n  };\n\n  const openEditDialog = (item: FoodItem) => {\n    setFormData({\n      name: item.name,\n      price: item.price,\n      costPrice: item.costPrice || \"\",\n      category: item.category || \"trackable\",\n      supplier: item.supplier || \"\",\n      expiryDate: item.expiryDate ? new Date(item.expiryDate).toISOString().split('T')[0] : \"\",\n      minStockLevel: item.minStockLevel.toString(),\n    });\n    setEditDialog({ open: true, item });\n  };\n\n  const openDeleteDialog = (id: string, name: string) => {\n    setDeleteDialog({ open: true, id, name });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <h1 className=\"text-3xl font-bold text-foreground\">Food Management</h1>\n        <p className=\"text-muted-foreground\">Loading food items...</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4 md:space-y-6\">\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3\">\n        <div>\n          <h1 className=\"text-2xl sm:text-3xl font-bold text-foreground\">Food Management</h1>\n          <p className=\"text-sm sm:text-base text-muted-foreground\">Manage food items available for customers</p>\n        </div>\n        <Button onClick={() => { setAddDialog(true); setFormData(initialFormData); }} data-testid=\"button-add-food\" data-joyride=\"add-food-button\" className=\"w-full sm:w-auto\">\n          <Plus className=\"mr-2 h-4 w-4\" />\n          Add Food Item\n        </Button>\n      </div>\n\n      <div className=\"grid gap-3 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4\" data-joyride=\"food-items-grid\">\n        {foodItems.map((item) => (\n          <div\n            key={item.id}\n            className=\"glass-card rounded-lg p-4 space-y-3\"\n            data-testid={`card-food-${item.id}`}\n          >\n            <div className=\"flex items-start justify-between\">\n              <div className=\"flex items-center gap-2\">\n                <div className=\"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center\">\n                  <UtensilsCrossed className=\"h-5 w-5 text-primary\" />\n                </div>\n                <div>\n                  <h3 className=\"font-semibold text-foreground\" data-testid={`text-food-name-${item.id}`}>\n                    {item.name}\n                  </h3>\n                  <p className=\"text-lg font-bold text-primary\" data-testid={`text-food-price-${item.id}`}>\n                    ‚Çπ{item.price}\n                  </p>\n                  {item.costPrice && (\n                    <p className=\"text-xs text-muted-foreground\">\n                      Cost: ‚Çπ{item.costPrice} | Profit: ‚Çπ{(parseFloat(item.price) - parseFloat(item.costPrice)).toFixed(2)}\n                    </p>\n                  )}\n                </div>\n              </div>\n              <div className=\"flex gap-1\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={() => openEditDialog(item)}\n                  disabled={!canMakeChanges}\n                  data-testid={`button-edit-food-${item.id}`}\n                >\n                  <Pencil className=\"h-4 w-4\" />\n                </Button>\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={() => openDeleteDialog(item.id, item.name)}\n                  disabled={!canMakeChanges}\n                  data-testid={`button-delete-food-${item.id}`}\n                >\n                  <Trash2 className=\"h-4 w-4 text-destructive\" />\n                </Button>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-2 text-xs\">\n              <span className={`px-2 py-1 rounded ${item.category === 'trackable' ? 'bg-blue-500/20 text-blue-600 dark:text-blue-400' : 'bg-green-500/20 text-green-600 dark:text-green-400'}`}>\n                {item.category === 'trackable' ? (\n                  <><Package className=\"h-3 w-3 inline mr-1\" />Trackable</>\n                ) : (\n                  'Made to Order'\n                )}\n              </span>\n              {item.expiryDate && (\n                <span className=\"text-muted-foreground flex items-center gap-1\">\n                  <CalendarClock className=\"h-3 w-3\" />\n                  {new Date(item.expiryDate).toLocaleDateString()}\n                </span>\n              )}\n            </div>\n          </div>\n        ))}\n      </div>\n\n      <Dialog open={addDialog} onOpenChange={setAddDialog}>\n        <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\" data-testid=\"dialog-add-food\">\n          <DialogHeader>\n            <DialogTitle>Add Food Item</DialogTitle>\n            <DialogDescription>Add a new item to the food menu</DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"name\">Food Name *</Label>\n                <Input\n                  id=\"name\"\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  placeholder=\"e.g., Cold Drink, Chips\"\n                  data-testid=\"input-food-name\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"category\">Category *</Label>\n                <Select value={formData.category} onValueChange={(value) => setFormData({ ...formData, category: value })}>\n                  <SelectTrigger data-testid=\"select-category\">\n                    <SelectValue placeholder=\"Select category\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"trackable\">Trackable (Chips, Drinks)</SelectItem>\n                    <SelectItem value=\"made-to-order\">Made to Order (Burger, Pizza)</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"price\">Selling Price (‚Çπ) *</Label>\n                <Input\n                  id=\"price\"\n                  type=\"number\"\n                  value={formData.price}\n                  onChange={(e) => setFormData({ ...formData, price: e.target.value })}\n                  placeholder=\"Price customers pay\"\n                  data-testid=\"input-food-price\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"costPrice\">Cost Price (‚Çπ)</Label>\n                <Input\n                  id=\"costPrice\"\n                  type=\"number\"\n                  value={formData.costPrice}\n                  onChange={(e) => setFormData({ ...formData, costPrice: e.target.value })}\n                  placeholder=\"What you paid\"\n                  data-testid=\"input-cost-price\"\n                />\n              </div>\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"supplier\">Supplier</Label>\n                <Input\n                  id=\"supplier\"\n                  value={formData.supplier}\n                  onChange={(e) => setFormData({ ...formData, supplier: e.target.value })}\n                  placeholder=\"Supplier name\"\n                  data-testid=\"input-supplier\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"minStockLevel\">Min Stock Level *</Label>\n                <Input\n                  id=\"minStockLevel\"\n                  type=\"number\"\n                  value={formData.minStockLevel}\n                  onChange={(e) => setFormData({ ...formData, minStockLevel: e.target.value })}\n                  placeholder=\"Reorder threshold\"\n                  data-testid=\"input-min-stock\"\n                />\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"expiryDate\">Expiry Date (Optional)</Label>\n              <Input\n                id=\"expiryDate\"\n                type=\"date\"\n                value={formData.expiryDate}\n                onChange={(e) => setFormData({ ...formData, expiryDate: e.target.value })}\n                data-testid=\"input-expiry-date\"\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setAddDialog(false)} data-testid=\"button-cancel-add-food\">\n              Cancel\n            </Button>\n            <Button onClick={handleAdd} disabled={createMutation.isPending} data-testid=\"button-confirm-add-food\">\n              {createMutation.isPending ? \"Adding...\" : \"Add Item\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={editDialog.open} onOpenChange={(open) => setEditDialog({ ...editDialog, open })}>\n        <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\" data-testid=\"dialog-edit-food\">\n          <DialogHeader>\n            <DialogTitle>Edit Food Item</DialogTitle>\n            <DialogDescription>Update the food item details</DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"edit-name\">Food Name *</Label>\n                <Input\n                  id=\"edit-name\"\n                  value={formData.name}\n                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                  placeholder=\"e.g., Cold Drink, Chips\"\n                  data-testid=\"input-edit-food-name\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"edit-category\">Category *</Label>\n                <Select value={formData.category} onValueChange={(value) => setFormData({ ...formData, category: value })}>\n                  <SelectTrigger data-testid=\"select-edit-category\">\n                    <SelectValue placeholder=\"Select category\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"trackable\">Trackable (Chips, Drinks)</SelectItem>\n                    <SelectItem value=\"made-to-order\">Made to Order (Burger, Pizza)</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"edit-price\">Selling Price (‚Çπ) *</Label>\n                <Input\n                  id=\"edit-price\"\n                  type=\"number\"\n                  value={formData.price}\n                  onChange={(e) => setFormData({ ...formData, price: e.target.value })}\n                  placeholder=\"Price customers pay\"\n                  data-testid=\"input-edit-food-price\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"edit-costPrice\">Cost Price (‚Çπ)</Label>\n                <Input\n                  id=\"edit-costPrice\"\n                  type=\"number\"\n                  value={formData.costPrice}\n                  onChange={(e) => setFormData({ ...formData, costPrice: e.target.value })}\n                  placeholder=\"What you paid\"\n                  data-testid=\"input-edit-cost-price\"\n                />\n              </div>\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"edit-supplier\">Supplier</Label>\n                <Input\n                  id=\"edit-supplier\"\n                  value={formData.supplier}\n                  onChange={(e) => setFormData({ ...formData, supplier: e.target.value })}\n                  placeholder=\"Supplier name\"\n                  data-testid=\"input-edit-supplier\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"edit-minStockLevel\">Min Stock Level *</Label>\n                <Input\n                  id=\"edit-minStockLevel\"\n                  type=\"number\"\n                  value={formData.minStockLevel}\n                  onChange={(e) => setFormData({ ...formData, minStockLevel: e.target.value })}\n                  placeholder=\"Reorder threshold\"\n                  data-testid=\"input-edit-min-stock\"\n                />\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"edit-expiryDate\">Expiry Date (Optional)</Label>\n              <Input\n                id=\"edit-expiryDate\"\n                type=\"date\"\n                value={formData.expiryDate}\n                onChange={(e) => setFormData({ ...formData, expiryDate: e.target.value })}\n                data-testid=\"input-edit-expiry-date\"\n              />\n            </div>\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setEditDialog({ open: false, item: null })} data-testid=\"button-cancel-edit-food\">\n              Cancel\n            </Button>\n            <Button onClick={handleEdit} disabled={updateMutation.isPending} data-testid=\"button-confirm-edit-food\">\n              {updateMutation.isPending ? \"Updating...\" : \"Update Item\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={deleteDialog.open} onOpenChange={(open) => setDeleteDialog({ ...deleteDialog, open })}>\n        <DialogContent data-testid=\"dialog-delete-food\">\n          <DialogHeader>\n            <DialogTitle>Delete Food Item</DialogTitle>\n            <DialogDescription>\n              Are you sure you want to delete \"{deleteDialog.name}\"? This action cannot be undone.\n            </DialogDescription>\n          </DialogHeader>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setDeleteDialog({ open: false, id: \"\", name: \"\" })} data-testid=\"button-cancel-delete-food\">\n              Cancel\n            </Button>\n            <Button\n              variant=\"destructive\"\n              onClick={() => deleteMutation.mutate(deleteDialog.id)}\n              disabled={deleteMutation.isPending}\n              data-testid=\"button-confirm-delete-food\"\n            >\n              {deleteMutation.isPending ? \"Deleting...\" : \"Delete\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":19352,"size_tokens":null},"client/src/components/ExtendSessionDialog.tsx":{"content":"import { useState, useEffect, useMemo } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Label } from \"@/components/ui/label\";\nimport { fetchPricingConfigs } from \"@/lib/api\";\nimport type { PricingConfig } from \"@shared/schema\";\n\ninterface ExtendSessionDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  seatName: string;\n  category: string;\n  personCount?: number;\n  onConfirm?: (duration: string, price: string) => void;\n}\n\nexport function ExtendSessionDialog({\n  open,\n  onOpenChange,\n  seatName,\n  category,\n  personCount = 1,\n  onConfirm,\n}: ExtendSessionDialogProps) {\n  const { data: allPricingConfigs = [], isLoading } = useQuery<PricingConfig[]>({\n    queryKey: ['/api/pricing-config'],\n    queryFn: fetchPricingConfigs,\n  });\n\n  const timeSlots = useMemo(() => {\n    const categoryConfigs = allPricingConfigs.filter(\n      (config) => config.category === category && (config.personCount || 1) === personCount\n    );\n    \n    if (categoryConfigs.length === 0) {\n      return [\n        { duration: \"30 mins\", price: \"40\" },\n        { duration: \"1 hour\", price: \"70\" },\n        { duration: \"2 hours\", price: \"130\" },\n      ];\n    }\n    \n    return categoryConfigs.map((config) => ({\n      duration: config.duration,\n      price: config.price,\n    }));\n  }, [allPricingConfigs, category, personCount]);\n\n  const [selectedSlot, setSelectedSlot] = useState<string>(\"\");\n\n  useEffect(() => {\n    if (timeSlots.length > 0 && !selectedSlot) {\n      setSelectedSlot(timeSlots[0].duration);\n    }\n  }, [timeSlots, selectedSlot]);\n\n  const handleConfirm = () => {\n    const slot = timeSlots.find(s => s.duration === selectedSlot);\n    if (slot && onConfirm) {\n      onConfirm(slot.duration, slot.price);\n    }\n    onOpenChange(false);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"w-[95vw] sm:w-full max-w-md p-4 sm:p-6\" data-testid=\"dialog-extend-session\">\n        <DialogHeader>\n          <DialogTitle className=\"text-base sm:text-lg\">Extend Session - {seatName}</DialogTitle>\n          <DialogDescription className=\"text-xs sm:text-sm\">\n            Select additional time to extend the current session.\n            {category && ` (${category}${personCount > 1 ? ` - ${personCount} persons` : ''})`}\n          </DialogDescription>\n        </DialogHeader>\n\n        {isLoading ? (\n          <div className=\"py-8 text-center text-muted-foreground text-sm\">Loading pricing...</div>\n        ) : (\n          <RadioGroup value={selectedSlot} onValueChange={setSelectedSlot} className=\"space-y-2 sm:space-y-3\">\n            {timeSlots.map((slot) => (\n              <div key={slot.duration} className=\"flex items-center space-x-2 sm:space-x-3 rounded-md border p-2.5 sm:p-3 hover-elevate\">\n                <RadioGroupItem value={slot.duration} id={slot.duration} data-testid={`radio-${slot.duration}`} />\n                <Label htmlFor={slot.duration} className=\"flex-1 cursor-pointer\">\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-sm sm:text-base\">{slot.duration}</span>\n                    <span className=\"font-bold text-primary text-sm sm:text-base\">‚Çπ{slot.price}</span>\n                  </div>\n                </Label>\n              </div>\n            ))}\n          </RadioGroup>\n        )}\n\n        <DialogFooter className=\"flex-col-reverse sm:flex-row gap-2 sm:gap-0\">\n          <Button variant=\"outline\" onClick={() => onOpenChange(false)} data-testid=\"button-cancel-extend\" className=\"w-full sm:w-auto\">\n            Cancel\n          </Button>\n          <Button onClick={handleConfirm} disabled={isLoading || !selectedSlot} data-testid=\"button-confirm-extend\" className=\"w-full sm:w-auto\">\n            Extend Session\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":4123,"size_tokens":null},"client/src/pages/ConsumerFacilities.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { \n  Wifi, \n  Coffee, \n  Zap, \n  Snowflake, \n  Armchair, \n  Gamepad2,\n  Monitor,\n  Headphones,\n  Users,\n  Sparkles\n} from \"lucide-react\";\nimport type { Facility } from \"@shared/schema\";\n\nconst iconMap: Record<string, any> = {\n  wifi: Wifi,\n  coffee: Coffee,\n  power: Zap,\n  ac: Snowflake,\n  comfort: Armchair,\n  gaming: Gamepad2,\n  monitor: Monitor,\n  headphones: Headphones,\n  community: Users,\n  premium: Sparkles,\n};\n\nexport default function ConsumerFacilities() {\n  const { data: facilities, isLoading } = useQuery<Facility[]>({\n    queryKey: [\"/api/consumer/facilities\"],\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"container mx-auto p-6 space-y-6\">\n        <Skeleton className=\"h-12 w-48\" />\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {[...Array(6)].map((_, i) => (\n            <Skeleton key={i} className=\"h-32 w-full\" />\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  if (!facilities || facilities.length === 0) {\n    return (\n      <div className=\"container mx-auto p-6 space-y-6\">\n        <h1 className=\"text-3xl font-bold\" data-testid=\"heading-facilities\">Facilities</h1>\n        <Card>\n          <CardContent className=\"flex flex-col items-center justify-center py-12\">\n            <Sparkles className=\"h-16 w-16 text-muted-foreground mb-4\" />\n            <p className=\"text-muted-foreground text-center\">No facilities information available yet</p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-6 space-y-6\">\n      <h1 className=\"text-3xl md:text-4xl font-bold\" data-testid=\"heading-facilities\">Our Facilities</h1>\n      <p className=\"text-lg text-muted-foreground\">Everything you need for the perfect gaming experience</p>\n      \n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n        {facilities.map((facility) => {\n          const IconComponent = iconMap[facility.icon] || Sparkles;\n          return (\n            <Card key={facility.id} className=\"hover:shadow-lg transition-shadow\" data-testid={`facility-${facility.id}`}>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-3\">\n                  <div className=\"p-2 rounded-lg bg-primary/10\">\n                    <IconComponent className=\"h-6 w-6 text-primary\" data-testid={`icon-${facility.id}`} />\n                  </div>\n                  <span data-testid={`text-name-${facility.id}`}>{facility.name}</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <p className=\"text-muted-foreground\" data-testid={`text-description-${facility.id}`}>\n                  {facility.description}\n                </p>\n              </CardContent>\n            </Card>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":3034,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"client/src/components/ColumnVisibilityToggle.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Label } from \"@/components/ui/label\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport { Settings2 } from \"lucide-react\";\n\ninterface Column {\n  id: string;\n  label: string;\n  defaultVisible?: boolean;\n}\n\ninterface ColumnVisibilityToggleProps {\n  columns: Column[];\n  storageKey: string;\n  onVisibilityChange: (visibleColumns: string[]) => void;\n}\n\nexport function ColumnVisibilityToggle({\n  columns,\n  storageKey,\n  onVisibilityChange,\n}: ColumnVisibilityToggleProps) {\n  const [visibleColumns, setVisibleColumns] = useState<string[]>(() => {\n    if (typeof window === 'undefined') {\n      return columns\n        .filter((col) => col.defaultVisible !== false)\n        .map((col) => col.id);\n    }\n\n    const stored = localStorage.getItem(storageKey);\n    const defaultColumns = columns\n      .filter((col) => col.defaultVisible !== false)\n      .map((col) => col.id);\n\n    if (stored) {\n      try {\n        const storedColumns = JSON.parse(stored);\n        const allColumnIds = columns.map((col) => col.id);\n        const validStoredColumns = storedColumns.filter((id: string) => \n          allColumnIds.includes(id)\n        );\n        const newColumns = allColumnIds.filter(\n          (id) => !storedColumns.includes(id) && defaultColumns.includes(id)\n        );\n        return [...validStoredColumns, ...newColumns];\n      } catch {\n        return defaultColumns;\n      }\n    }\n    return defaultColumns;\n  });\n\n  useEffect(() => {\n    localStorage.setItem(storageKey, JSON.stringify(visibleColumns));\n    onVisibilityChange(visibleColumns);\n  }, [visibleColumns, storageKey, onVisibilityChange]);\n\n  const toggleColumn = (columnId: string) => {\n    setVisibleColumns((prev) =>\n      prev.includes(columnId)\n        ? prev.filter((id) => id !== columnId)\n        : [...prev, columnId]\n    );\n  };\n\n  const showAll = () => {\n    setVisibleColumns(columns.map((col) => col.id));\n  };\n\n  const hideAll = () => {\n    setVisibleColumns([]);\n  };\n\n  return (\n    <Popover>\n      <PopoverTrigger asChild>\n        <Button variant=\"outline\" size=\"sm\" data-testid=\"button-column-visibility\">\n          <Settings2 className=\"h-4 w-4 mr-2\" />\n          Columns\n        </Button>\n      </PopoverTrigger>\n      <PopoverContent className=\"w-64\" align=\"end\">\n        <div className=\"space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <h4 className=\"text-sm font-semibold\">Toggle Columns</h4>\n            <div className=\"flex gap-2\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={showAll}\n                className=\"h-7 text-xs\"\n                data-testid=\"button-show-all-columns\"\n              >\n                Show All\n              </Button>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={hideAll}\n                className=\"h-7 text-xs\"\n                data-testid=\"button-hide-all-columns\"\n              >\n                Hide All\n              </Button>\n            </div>\n          </div>\n          <div className=\"space-y-2 max-h-80 overflow-y-auto\">\n            {columns.map((column) => (\n              <div\n                key={column.id}\n                className=\"flex items-center space-x-2\"\n                data-testid={`checkbox-column-${column.id}`}\n              >\n                <Checkbox\n                  id={`column-${column.id}`}\n                  checked={visibleColumns.includes(column.id)}\n                  onCheckedChange={() => toggleColumn(column.id)}\n                />\n                <Label\n                  htmlFor={`column-${column.id}`}\n                  className=\"text-sm font-normal cursor-pointer\"\n                >\n                  {column.label}\n                </Label>\n              </div>\n            ))}\n          </div>\n        </div>\n      </PopoverContent>\n    </Popover>\n  );\n}\n","path":null,"size_bytes":4074,"size_tokens":null},"client/src/components/SplitPaymentDialog.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Wallet, Smartphone, IndianRupee } from \"lucide-react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\n\ninterface SplitPaymentDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  bookingIds: string[];\n  totalAmount: number;\n  customerName?: string;\n  whatsappNumber?: string;\n  onSuccess?: () => void;\n}\n\nexport function SplitPaymentDialog({\n  open,\n  onOpenChange,\n  bookingIds,\n  totalAmount,\n  customerName: defaultCustomerName,\n  whatsappNumber: defaultWhatsappNumber,\n  onSuccess,\n}: SplitPaymentDialogProps) {\n  const [cashAmount, setCashAmount] = useState(\"\");\n  const [upiAmount, setUpiAmount] = useState(\"\");\n  const { toast } = useToast();\n\n  useEffect(() => {\n    const cash = parseFloat(cashAmount) || 0;\n    const remaining = Math.max(0, totalAmount - cash);\n    setUpiAmount(remaining.toFixed(2));\n  }, [cashAmount, totalAmount]);\n\n  const splitPaymentMutation = useMutation({\n    mutationFn: async (data: {\n      bookingIds: string[];\n      cashAmount: string;\n      upiAmount: string;\n    }) => {\n      return await apiRequest(\"POST\", \"/api/bookings/split-payment\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/bookings\"] });\n      toast({\n        title: \"Split Payment Recorded\",\n        description: `Cash: ‚Çπ${cashAmount} | UPI: ‚Çπ${upiAmount}`,\n      });\n      handleClose();\n      onSuccess?.();\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Payment Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = async () => {\n    const cash = parseFloat(cashAmount) || 0;\n    const upi = parseFloat(upiAmount) || 0;\n\n    if (cash < 0 || upi < 0) {\n      toast({\n        title: \"Invalid Amounts\",\n        description: \"Amounts cannot be negative\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (Math.abs(cash + upi - totalAmount) > 0.01) {\n      toast({\n        title: \"Amount Mismatch\",\n        description: `Cash (‚Çπ${cash}) + UPI (‚Çπ${upi}) must equal Total (‚Çπ${totalAmount})`,\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (cash === 0 && upi === 0) {\n      toast({\n        title: \"No Payment\",\n        description: \"Please enter payment amounts\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    await splitPaymentMutation.mutateAsync({\n      bookingIds,\n      cashAmount: cash.toFixed(2),\n      upiAmount: upi.toFixed(2),\n    });\n  };\n\n  const handleClose = () => {\n    setCashAmount(\"\");\n    setUpiAmount(\"\");\n    onOpenChange(false);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent className=\"sm:max-w-[500px]\" data-testid=\"dialog-split-payment\">\n        <DialogHeader>\n          <DialogTitle>Split Payment (Cash + UPI)</DialogTitle>\n          <DialogDescription>\n            Customer paying with both cash and UPI\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-4 py-4\">\n          <div className=\"rounded-lg border p-4 bg-gradient-to-br from-primary/5 to-primary/10\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <span className=\"text-sm font-medium flex items-center gap-2\">\n                <IndianRupee className=\"h-4 w-4\" />\n                Total Amount\n              </span>\n              <span className=\"text-2xl font-bold text-primary\" data-testid=\"text-total-amount\">\n                ‚Çπ{totalAmount.toFixed(2)}\n              </span>\n            </div>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"cashAmount\">\n              <div className=\"flex items-center gap-2\">\n                <Wallet className=\"h-4 w-4 text-green-600\" />\n                Cash Amount\n              </div>\n            </Label>\n            <Input\n              id=\"cashAmount\"\n              type=\"number\"\n              step=\"0.01\"\n              min=\"0\"\n              max={totalAmount}\n              value={cashAmount}\n              onChange={(e) => setCashAmount(e.target.value)}\n              placeholder=\"Enter cash amount\"\n              data-testid=\"input-cash-amount\"\n              className=\"text-lg\"\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"upiAmount\">\n              <div className=\"flex items-center gap-2\">\n                <Smartphone className=\"h-4 w-4 text-blue-600\" />\n                UPI Amount\n              </div>\n            </Label>\n            <Input\n              id=\"upiAmount\"\n              type=\"number\"\n              step=\"0.01\"\n              value={upiAmount}\n              readOnly\n              className=\"bg-blue-50 dark:bg-blue-950/20 border-blue-300 dark:border-blue-700 text-lg\"\n              data-testid=\"input-upi-amount\"\n            />\n            <p className=\"text-xs text-muted-foreground\">\n              Auto-calculated as remaining amount\n            </p>\n          </div>\n\n          <div className=\"rounded-lg border p-3 bg-muted/30\">\n            <div className=\"space-y-2 text-sm\">\n              <div className=\"flex justify-between\">\n                <span className=\"text-muted-foreground\">Cash:</span>\n                <span className=\"font-semibold text-green-600\">‚Çπ{cashAmount || \"0.00\"}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-muted-foreground\">UPI:</span>\n                <span className=\"font-semibold text-blue-600\">‚Çπ{upiAmount || \"0.00\"}</span>\n              </div>\n              <div className=\"flex justify-between pt-2 border-t\">\n                <span className=\"font-medium\">Total:</span>\n                <span className=\"font-bold\">‚Çπ{((parseFloat(cashAmount) || 0) + (parseFloat(upiAmount) || 0)).toFixed(2)}</span>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <DialogFooter>\n          <Button\n            variant=\"outline\"\n            onClick={handleClose}\n            disabled={splitPaymentMutation.isPending}\n            data-testid=\"button-cancel\"\n          >\n            Cancel\n          </Button>\n          <Button\n            onClick={handleSubmit}\n            disabled={splitPaymentMutation.isPending}\n            data-testid=\"button-confirm-split-payment\"\n          >\n            {splitPaymentMutation.isPending ? \"Processing...\" : \"Confirm Split Payment\"}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":6924,"size_tokens":null},"server/db-sqlite.ts":{"content":"import Database from \"better-sqlite3\";\nimport { drizzle } from \"drizzle-orm/better-sqlite3\";\nimport * as schema from \"../shared/schema-sqlite\";\nimport path from \"path\";\nimport fs from \"fs\";\nimport os from \"os\";\n\nfunction isElectronPackaged(): boolean {\n  return (\n    process.env.IS_PACKAGED === \"true\" ||\n    process.env.NODE_ENV === \"production\" ||\n    (process.execPath.includes(\"electron\") &&\n      !process.execPath.includes(\"node_modules\"))\n  );\n}\n\nfunction getDbPath(): string {\n  if (process.env.USER_DATA_PATH) {\n    return path.join(process.env.USER_DATA_PATH, \"airavoto-gaming.db\");\n  }\n\n  if (isElectronPackaged()) {\n    const appName = \"Airavoto Gaming POS\";\n    let userDataPath: string;\n\n    if (process.platform === \"win32\") {\n      userDataPath = path.join(os.homedir(), \"AppData\", \"Roaming\", appName);\n    } else if (process.platform === \"darwin\") {\n      userDataPath = path.join(\n        os.homedir(),\n        \"Library\",\n        \"Application Support\",\n        appName,\n      );\n    } else {\n      userDataPath = path.join(os.homedir(), \".config\", appName);\n    }\n\n    return path.join(userDataPath, \"airavoto-gaming.db\");\n  }\n\n  return path.join(process.cwd(), \"data\", \"airavoto-gaming.db\");\n}\n\nfunction ensureDbDirectory(dbPath: string): void {\n  const dir = path.dirname(dbPath);\n  if (!fs.existsSync(dir)) {\n    fs.mkdirSync(dir, { recursive: true });\n    console.log(\"Created database directory:\", dir);\n  }\n}\n\nfunction logDbInfo(message: string) {\n  console.log(`[DB] ${message}`);\n}\n\nlet dbPath: string;\nlet sqlite: Database.Database;\nlet db: ReturnType<typeof drizzle>;\n\ntry {\n  dbPath = getDbPath();\n  logDbInfo(`Database path: ${dbPath}`);\n  logDbInfo(`Is packaged: ${isElectronPackaged()}`);\n  logDbInfo(`Platform: ${process.platform}`);\n\n  ensureDbDirectory(dbPath);\n\n  sqlite = new Database(dbPath);\n  sqlite.pragma(\"journal_mode = WAL\");\n  sqlite.pragma(\"foreign_keys = ON\");\n  sqlite.pragma(\"busy_timeout = 5000\");\n\n  db = drizzle(sqlite, { schema });\n  logDbInfo(\"Database connection established successfully\");\n} catch (error: any) {\n  console.error(\"[DB] Failed to initialize database:\", error.message);\n  console.error(\"[DB] Stack:\", error.stack);\n  throw error;\n}\n\nexport { db, sqlite };\n\nexport function initializeSqliteDatabase() {\n  try {\n    sqlite.exec(`\n      CREATE TABLE IF NOT EXISTS sessions (\n        sid TEXT PRIMARY KEY,\n        sess TEXT NOT NULL,\n        expire INTEGER NOT NULL\n      );\n      \n      CREATE TABLE IF NOT EXISTS session_groups (\n        id TEXT PRIMARY KEY,\n        group_code TEXT UNIQUE,\n        group_name TEXT NOT NULL,\n        category TEXT NOT NULL,\n        booking_type TEXT NOT NULL,\n        created_at INTEGER NOT NULL\n      );\n      \n      CREATE TABLE IF NOT EXISTS bookings (\n        id TEXT PRIMARY KEY,\n        booking_code TEXT UNIQUE,\n        group_id TEXT,\n        group_code TEXT,\n        category TEXT NOT NULL,\n        seat_number INTEGER NOT NULL,\n        seat_name TEXT NOT NULL,\n        customer_name TEXT NOT NULL,\n        whatsapp_number TEXT,\n        start_time INTEGER NOT NULL,\n        end_time INTEGER NOT NULL,\n        price TEXT NOT NULL,\n        status TEXT NOT NULL,\n        booking_type TEXT NOT NULL,\n        paused_remaining_time INTEGER,\n        person_count INTEGER NOT NULL DEFAULT 1,\n        payment_method TEXT,\n        cash_amount TEXT,\n        upi_amount TEXT,\n        payment_status TEXT NOT NULL DEFAULT 'unpaid',\n        last_payment_action TEXT,\n        food_orders TEXT DEFAULT '[]',\n        original_price TEXT,\n        discount_applied TEXT,\n        bonus_hours_applied TEXT,\n        promotion_details TEXT,\n        is_promotional_discount INTEGER DEFAULT 0,\n        is_promotional_bonus INTEGER DEFAULT 0,\n        manual_discount_percentage INTEGER,\n        manual_free_hours TEXT,\n        discount TEXT,\n        bonus TEXT,\n        created_at INTEGER NOT NULL\n      );\n      \n      CREATE TABLE IF NOT EXISTS food_items (\n        id TEXT PRIMARY KEY,\n        name TEXT NOT NULL,\n        price TEXT NOT NULL,\n        cost_price TEXT,\n        current_stock INTEGER NOT NULL DEFAULT 0,\n        min_stock_level INTEGER NOT NULL DEFAULT 10,\n        in_inventory INTEGER NOT NULL DEFAULT 0,\n        category TEXT NOT NULL DEFAULT 'trackable',\n        supplier TEXT,\n        expiry_date INTEGER\n      );\n      \n      CREATE TABLE IF NOT EXISTS stock_batches (\n        id TEXT PRIMARY KEY,\n        food_item_id TEXT NOT NULL,\n        quantity INTEGER NOT NULL,\n        cost_price TEXT NOT NULL,\n        supplier TEXT,\n        purchase_date INTEGER NOT NULL,\n        expiry_date INTEGER,\n        notes TEXT,\n        created_at INTEGER NOT NULL\n      );\n      \n      CREATE TABLE IF NOT EXISTS device_configs (\n        id TEXT PRIMARY KEY,\n        category TEXT NOT NULL UNIQUE,\n        count INTEGER NOT NULL DEFAULT 0,\n        seats TEXT NOT NULL DEFAULT '[]'\n      );\n      \n      CREATE TABLE IF NOT EXISTS pricing_configs (\n        id TEXT PRIMARY KEY,\n        category TEXT NOT NULL,\n        duration TEXT NOT NULL,\n        price TEXT NOT NULL,\n        person_count INTEGER NOT NULL DEFAULT 1\n      );\n      \n      CREATE TABLE IF NOT EXISTS happy_hours_configs (\n        id TEXT PRIMARY KEY,\n        category TEXT NOT NULL,\n        start_time TEXT NOT NULL,\n        end_time TEXT NOT NULL,\n        enabled INTEGER NOT NULL DEFAULT 1\n      );\n      \n      CREATE TABLE IF NOT EXISTS happy_hours_pricing (\n        id TEXT PRIMARY KEY,\n        category TEXT NOT NULL,\n        duration TEXT NOT NULL,\n        price TEXT NOT NULL,\n        person_count INTEGER NOT NULL DEFAULT 1\n      );\n      \n      CREATE TABLE IF NOT EXISTS booking_history (\n        id TEXT PRIMARY KEY,\n        booking_id TEXT NOT NULL,\n        booking_code TEXT,\n        group_id TEXT,\n        group_code TEXT,\n        category TEXT NOT NULL,\n        seat_number INTEGER NOT NULL,\n        seat_name TEXT NOT NULL,\n        customer_name TEXT NOT NULL,\n        whatsapp_number TEXT,\n        start_time INTEGER NOT NULL,\n        end_time INTEGER NOT NULL,\n        price TEXT NOT NULL,\n        status TEXT NOT NULL,\n        booking_type TEXT NOT NULL,\n        paused_remaining_time INTEGER,\n        person_count INTEGER NOT NULL DEFAULT 1,\n        payment_method TEXT,\n        cash_amount TEXT,\n        upi_amount TEXT,\n        payment_status TEXT NOT NULL DEFAULT 'unpaid',\n        last_payment_action TEXT,\n        food_orders TEXT DEFAULT '[]',\n        original_price TEXT,\n        discount_applied TEXT,\n        bonus_hours_applied TEXT,\n        promotion_details TEXT,\n        is_promotional_discount INTEGER DEFAULT 0,\n        is_promotional_bonus INTEGER DEFAULT 0,\n        manual_discount_percentage INTEGER,\n        manual_free_hours TEXT,\n        discount TEXT,\n        bonus TEXT,\n        created_at INTEGER NOT NULL,\n        archived_at INTEGER NOT NULL\n      );\n      \n      CREATE TABLE IF NOT EXISTS users (\n        id TEXT PRIMARY KEY,\n        username TEXT UNIQUE,\n        password_hash TEXT,\n        role TEXT,\n        onboarding_completed INTEGER DEFAULT 0,\n        profile_image_url TEXT,\n        created_at INTEGER,\n        updated_at INTEGER\n      );\n      \n      CREATE TABLE IF NOT EXISTS expenses (\n        id TEXT PRIMARY KEY,\n        category TEXT NOT NULL,\n        description TEXT NOT NULL,\n        amount TEXT NOT NULL,\n        date INTEGER NOT NULL,\n        created_at INTEGER NOT NULL\n      );\n      \n      CREATE TABLE IF NOT EXISTS activity_logs (\n        id TEXT PRIMARY KEY,\n        user_id TEXT NOT NULL,\n        username TEXT NOT NULL,\n        user_role TEXT NOT NULL,\n        action TEXT NOT NULL,\n        entity_type TEXT,\n        entity_id TEXT,\n        details TEXT,\n        created_at INTEGER NOT NULL\n      );\n      \n      CREATE TABLE IF NOT EXISTS notifications (\n        id TEXT PRIMARY KEY,\n        type TEXT NOT NULL,\n        title TEXT NOT NULL,\n        message TEXT NOT NULL,\n        entity_type TEXT,\n        entity_id TEXT,\n        activity_log_id TEXT,\n        is_read INTEGER NOT NULL DEFAULT 0,\n        created_at INTEGER NOT NULL\n      );\n      \n      CREATE TABLE IF NOT EXISTS gaming_center_info (\n        id TEXT PRIMARY KEY,\n        name TEXT NOT NULL,\n        description TEXT NOT NULL,\n        address TEXT NOT NULL,\n        phone TEXT NOT NULL,\n        email TEXT,\n        hours TEXT NOT NULL,\n        timezone TEXT NOT NULL DEFAULT 'Asia/Kolkata',\n        updated_at INTEGER NOT NULL\n      );\n      \n      CREATE TABLE IF NOT EXISTS gallery_images (\n        id TEXT PRIMARY KEY,\n        title TEXT NOT NULL,\n        image_url TEXT NOT NULL,\n        description TEXT,\n        created_at INTEGER NOT NULL\n      );\n      \n      CREATE TABLE IF NOT EXISTS facilities (\n        id TEXT PRIMARY KEY,\n        name TEXT NOT NULL,\n        description TEXT NOT NULL,\n        icon TEXT NOT NULL\n      );\n      \n      CREATE TABLE IF NOT EXISTS games (\n        id TEXT PRIMARY KEY,\n        name TEXT NOT NULL,\n        description TEXT,\n        image_url TEXT,\n        category TEXT NOT NULL\n      );\n      \n      CREATE TABLE IF NOT EXISTS load_metrics (\n        id TEXT PRIMARY KEY,\n        timestamp INTEGER NOT NULL,\n        active_sessions INTEGER NOT NULL DEFAULT 0,\n        avg_session_length INTEGER NOT NULL DEFAULT 0,\n        food_orders INTEGER NOT NULL DEFAULT 0,\n        capacity_utilization INTEGER NOT NULL DEFAULT 0\n      );\n      \n      CREATE TABLE IF NOT EXISTS load_predictions (\n        id TEXT PRIMARY KEY,\n        timestamp INTEGER NOT NULL,\n        horizon TEXT NOT NULL,\n        predicted_load INTEGER NOT NULL,\n        model_version TEXT NOT NULL,\n        features TEXT DEFAULT '{}'\n      );\n      \n      CREATE TABLE IF NOT EXISTS retention_config (\n        id TEXT PRIMARY KEY,\n        booking_history_days INTEGER NOT NULL DEFAULT 36500,\n        activity_logs_days INTEGER NOT NULL DEFAULT 36500,\n        load_metrics_days INTEGER NOT NULL DEFAULT 36500,\n        load_predictions_days INTEGER NOT NULL DEFAULT 36500,\n        expenses_days INTEGER NOT NULL DEFAULT 36500,\n        updated_at INTEGER NOT NULL\n      );\n      \n      CREATE TABLE IF NOT EXISTS device_maintenance (\n        id TEXT PRIMARY KEY,\n        category TEXT NOT NULL,\n        seat_name TEXT NOT NULL,\n        last_maintenance_date INTEGER,\n        total_usage_hours REAL NOT NULL DEFAULT 0,\n        total_sessions INTEGER NOT NULL DEFAULT 0,\n        issues_reported INTEGER NOT NULL DEFAULT 0,\n        maintenance_notes TEXT,\n        status TEXT NOT NULL DEFAULT 'healthy',\n        created_at INTEGER NOT NULL,\n        updated_at INTEGER NOT NULL\n      );\n      \n      CREATE TABLE IF NOT EXISTS staff_visibility_settings (\n        id TEXT PRIMARY KEY,\n        pages TEXT NOT NULL,\n        elements TEXT NOT NULL,\n        updated_at INTEGER NOT NULL\n      );\n      \n      CREATE TABLE IF NOT EXISTS payment_logs (\n        id TEXT PRIMARY KEY,\n        booking_id TEXT NOT NULL,\n        seat_name TEXT NOT NULL,\n        customer_name TEXT NOT NULL,\n        amount TEXT NOT NULL,\n        payment_method TEXT NOT NULL,\n        payment_status TEXT NOT NULL,\n        user_id TEXT NOT NULL,\n        username TEXT NOT NULL,\n        previous_status TEXT,\n        previous_method TEXT,\n        created_at INTEGER NOT NULL\n      );\n      \n      CREATE INDEX IF NOT EXISTS idx_session_expire ON sessions(expire);\n      CREATE INDEX IF NOT EXISTS idx_bookings_status ON bookings(status);\n      CREATE INDEX IF NOT EXISTS idx_bookings_start_time ON bookings(start_time);\n      CREATE INDEX IF NOT EXISTS idx_booking_history_start_time ON booking_history(start_time);\n      CREATE INDEX IF NOT EXISTS idx_activity_logs_created_at ON activity_logs(created_at);\n      CREATE INDEX IF NOT EXISTS idx_notifications_is_read ON notifications(is_read);\n      CREATE INDEX IF NOT EXISTS idx_payment_logs_created_at ON payment_logs(created_at);\n    `);\n\n    logDbInfo(`SQLite database initialized at: ${dbPath}`);\n  } catch (error: any) {\n    console.error(\"[DB] Failed to initialize database tables:\", error.message);\n    console.error(\"[DB] Stack:\", error.stack);\n    throw error;\n  }\n}\n","path":null,"size_bytes":12099,"size_tokens":null},"client/src/components/RevenueCard.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { TrendingUp, TrendingDown } from \"lucide-react\";\n\ninterface RevenueCardProps {\n  title: string;\n  amount: number;\n  trend?: number;\n  icon?: React.ReactNode;\n  showCurrency?: boolean;\n  suffix?: string;\n}\n\nexport function RevenueCard({ title, amount, trend = 0, icon, showCurrency = true, suffix = \"\" }: RevenueCardProps) {\n  const isPositive = trend >= 0;\n\n  return (\n    <Card data-testid={`card-revenue-${title.toLowerCase().replace(/\\s/g, '-')}`}>\n      <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n        <CardTitle className=\"text-sm font-medium\">{title}</CardTitle>\n        {icon}\n      </CardHeader>\n      <CardContent>\n        <div className=\"text-2xl font-bold text-foreground\" data-testid={`text-amount-${title.toLowerCase()}`}>\n          {showCurrency && '‚Çπ'}{amount.toLocaleString()}{suffix}\n        </div>\n        {trend !== 0 && (\n          <div className=\"flex items-center gap-1 text-xs text-muted-foreground mt-1\">\n            {isPositive ? (\n              <TrendingUp className=\"h-3 w-3 text-chart-4\" />\n            ) : (\n              <TrendingDown className=\"h-3 w-3 text-destructive\" />\n            )}\n            <span className={isPositive ? \"text-chart-4\" : \"text-destructive\"}>\n              {Math.abs(trend)}% from last period\n            </span>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":1478,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1592,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"server/auth.ts":{"content":"import type { Express, Request, Response, NextFunction } from \"express\";\nimport { storage } from \"./storage\";\nimport { loginSchema } from \"@shared/schema\";\nimport rateLimit from \"express-rate-limit\";\n\nexport const loginLimiter = rateLimit({\n  windowMs: 15 * 60 * 1000, // 15 minutes\n  max: 5, // Limit each IP to 5 requests per windowMs\n  message: \"Too many login attempts, please try again later.\",\n  standardHeaders: true,\n  legacyHeaders: false,\n});\n\n// Rate limiter for webhook endpoints\nexport const webhookLimiter = rateLimit({\n  windowMs: 1 * 60 * 1000, // 1 minute\n  max: 30, // Limit each IP to 30 requests per minute\n  message: \"Too many webhook requests, please slow down.\",\n  standardHeaders: true,\n  legacyHeaders: false,\n});\n\n// Rate limiter for public API endpoints\nexport const publicApiLimiter = rateLimit({\n  windowMs: 1 * 60 * 1000, // 1 minute\n  max: 60, // Limit each IP to 60 requests per minute\n  message: \"Too many requests, please try again later.\",\n  standardHeaders: true,\n  legacyHeaders: false,\n});\n\n// Rate limiter for sensitive operations (payment, credit, etc.)\nexport const sensitiveOperationLimiter = rateLimit({\n  windowMs: 1 * 60 * 1000, // 1 minute\n  max: 20, // Limit each IP to 20 requests per minute for sensitive operations\n  message: \"Too many requests for this operation, please try again later.\",\n  standardHeaders: true,\n  legacyHeaders: false,\n});\n\n// Rate limiter for data export/reports\nexport const dataExportLimiter = rateLimit({\n  windowMs: 5 * 60 * 1000, // 5 minutes\n  max: 10, // Limit to 10 exports per 5 minutes\n  message: \"Too many export requests, please wait before trying again.\",\n  standardHeaders: true,\n  legacyHeaders: false,\n});\n\nexport async function loginHandler(req: Request, res: Response) {\n  try {\n    const { username, password } = loginSchema.parse(req.body);\n    \n    const user = await storage.validatePassword(username, password);\n    \n    if (!user) {\n      // Generic error message to prevent username enumeration\n      return res.status(401).json({ \n        message: \"Invalid credentials\" \n      });\n    }\n    \n    // Regenerate session to prevent session fixation attacks\n    const oldSessionData = {\n      googleVerified: req.session.googleVerified,\n      googleUserId: req.session.googleUserId,\n      googleEmail: req.session.googleEmail\n    };\n    \n    req.session.regenerate((err) => {\n      if (err) {\n        console.error('Session regeneration error:', err);\n        return res.status(500).json({ message: \"Login failed. Please try again.\" });\n      }\n      \n      // Restore Google OAuth data if it existed\n      req.session.googleVerified = oldSessionData.googleVerified;\n      req.session.googleUserId = oldSessionData.googleUserId;\n      req.session.googleEmail = oldSessionData.googleEmail;\n      \n      // Set new session data\n      req.session.userId = user.id;\n      req.session.username = user.username!;\n      req.session.role = user.role!;\n      \n      // Log login activity\n      const loginMethod = req.session.googleVerified \n        ? `two-step auth (Google: ${req.session.googleEmail})` \n        : 'direct login';\n      \n      storage.createActivityLog({\n        userId: user.id,\n        username: user.username!,\n        userRole: user.role!,\n        action: 'login',\n        entityType: null,\n        entityId: null,\n        details: `${user.role} logged in via ${loginMethod} from IP ${req.ip}`\n      }).catch(err => console.error('Activity log error:', err));\n      \n      res.json({\n        id: user.id,\n        username: user.username,\n        role: user.role,\n        googleEmail: req.session.googleEmail,\n      });\n    });\n  } catch (error: any) {\n    // Don't expose internal error details\n    console.error('Login error:', error);\n    res.status(400).json({ message: \"Invalid request\" });\n  }\n}\n\nexport async function logoutHandler(req: Request, res: Response) {\n  req.session.destroy((err) => {\n    if (err) {\n      return res.status(500).json({ message: \"Failed to logout\" });\n    }\n    res.clearCookie(\"connect.sid\");\n    res.json({ message: \"Logged out successfully\" });\n  });\n}\n\nexport async function getCurrentUserHandler(req: Request, res: Response) {\n  // Check if user is authenticated via staff/admin login\n  if (req.session.userId) {\n    try {\n      const user = await storage.getUserById(req.session.userId);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      return res.json({\n        id: user.id,\n        username: user.username,\n        role: user.role,\n        googleEmail: req.session.googleEmail,\n        onboardingCompleted: user.onboardingCompleted === 1,\n        twoStepComplete: true,\n      });\n    } catch (error: any) {\n      return res.status(500).json({ message: error.message });\n    }\n  }\n  \n  // Check if Google authentication is verified but no staff login yet\n  if (req.session.googleVerified) {\n    return res.status(200).json({\n      googleVerified: true,\n      googleEmail: req.session.googleEmail,\n      needsStaffLogin: true,\n    });\n  }\n  \n  // Not authenticated at all\n  return res.status(401).json({ message: \"Not authenticated\" });\n}\n\nexport function requireAuth(req: Request, res: Response, next: NextFunction) {\n  // Require staff/admin login (Google OAuth is optional)\n  if (!req.session.userId) {\n    return res.status(401).json({ message: \"Authentication required\" });\n  }\n  next();\n}\n\nexport function requireAdmin(req: Request, res: Response, next: NextFunction) {\n  if (!req.session.userId) {\n    return res.status(401).json({ message: \"Authentication required\" });\n  }\n  if (req.session.role !== \"admin\") {\n    return res.status(403).json({ message: \"Admin access required\" });\n  }\n  next();\n}\n\nexport function requireAdminOrStaff(req: Request, res: Response, next: NextFunction) {\n  if (!req.session.userId) {\n    return res.status(401).json({ message: \"Authentication required\" });\n  }\n  if (req.session.role !== \"admin\" && req.session.role !== \"staff\") {\n    return res.status(403).json({ message: \"Admin or staff access required\" });\n  }\n  next();\n}\n\nexport function registerAuthRoutes(app: Express) {\n  // Staff/Admin username/password authentication routes\n  app.post(\"/api/auth/login\", loginLimiter, loginHandler);\n  app.post(\"/api/auth/logout\", logoutHandler);\n  app.get(\"/api/auth/me\", getCurrentUserHandler);\n  \n  app.post(\"/api/auth/complete-onboarding\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      if (!req.session.userId) {\n        return res.status(401).json({ message: \"Not authenticated\" });\n      }\n      await storage.updateUserOnboarding(req.session.userId, true);\n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n}\n\n// Extend Express session types\ndeclare module \"express-session\" {\n  interface SessionData {\n    userId: string;\n    username: string;\n    role: string;\n    googleVerified: boolean;\n    googleUserId: string;\n    googleEmail: string;\n  }\n}\n","path":null,"size_bytes":7000,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/pages/Login.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Eye, EyeOff } from \"lucide-react\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Label } from \"@/components/ui/label\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport logoDark from \"@assets/airavoto_logo.png\";\nimport img1 from \"@assets/generated_images/Modern_gaming_cafe_with_purple_lighting_1a0efc51.png\";\nimport img2 from \"@assets/generated_images/Luxury_gaming_lounge_purple_pink_98c3a8f3.png\";\nimport img3 from \"@assets/generated_images/Gaming_cafe_night_purple_neon_964a4486.png\";\nimport { Separator } from \"@/components/ui/separator\";\n\ninterface LoginProps {\n  onLoginSuccess: (userData: any) => void;\n}\n\nconst carouselImages = [\n  { src: img1, caption: \"India's First Gaming Lounge Management POS\" },\n  { src: img2, caption: \"Complete Software Solution for Gaming Centers\" },\n  { src: img3, caption: \"Advanced Booking & Billing Management System\" }\n];\n\nfunction TermsContent() {\n  return (\n    <div className=\"space-y-6\">\n      <section>\n        <h2 className=\"text-xl font-semibold mb-3\">1. Introduction and Acceptance</h2>\n        <p className=\"text-muted-foreground leading-relaxed\">\n          Welcome to Airavoto Gaming Center. By using our gaming facilities, booking services, or participating in any activities at our center, you agree to comply with and be bound by these Terms and Conditions.\n        </p>\n      </section>\n\n      <Separator />\n\n      <section>\n        <h2 className=\"text-xl font-semibold mb-3\">2. Service Description</h2>\n        <p className=\"text-muted-foreground leading-relaxed mb-3\">\n          Airavoto Gaming Center provides the following services:\n        </p>\n        <ul className=\"list-disc list-inside space-y-2 text-muted-foreground ml-4\">\n          <li><strong>Gaming Stations:</strong> Access to various gaming devices including PCs, PlayStation 5 consoles, VR headsets, and car racing simulators</li>\n          <li><strong>Booking System:</strong> Walk-in and advance booking options with flexible session durations</li>\n          <li><strong>Food & Beverage:</strong> In-house food and drink ordering during gaming sessions</li>\n          <li><strong>Loyalty Program:</strong> Earn 1 point for every ‚Çπ1 spent and redeem rewards</li>\n          <li><strong>Tournament Participation:</strong> Organized gaming competitions with prize pools</li>\n        </ul>\n      </section>\n\n      <Separator />\n\n      <section>\n        <h2 className=\"text-xl font-semibold mb-3\">3. Booking and Reservations</h2>\n        <p className=\"text-muted-foreground leading-relaxed mb-3\">\n          <strong>3.1 Walk-in Bookings:</strong> Available on a first-come, first-served basis subject to availability.\n        </p>\n        <p className=\"text-muted-foreground leading-relaxed mb-3\">\n          <strong>3.2 Advance Bookings:</strong> Customers may book gaming sessions in advance. Advanced bookings are confirmed upon availability verification.\n        </p>\n        <p className=\"text-muted-foreground leading-relaxed\">\n          <strong>3.3 No-Shows:</strong> Customers who fail to arrive within 15 minutes of their scheduled booking time may forfeit their reservation without refund.\n        </p>\n      </section>\n\n      <Separator />\n\n      <section>\n        <h2 className=\"text-xl font-semibold mb-3\">4. Pricing and Payment</h2>\n        <p className=\"text-muted-foreground leading-relaxed mb-3\">\n          <strong>4.1 Pricing Structure:</strong> Gaming sessions are priced based on device type, duration, and number of persons. Prices are displayed in Indian Rupees (‚Çπ).\n        </p>\n        <p className=\"text-muted-foreground leading-relaxed mb-3\">\n          <strong>4.2 Payment Methods:</strong> We accept Cash, UPI, Card, and Online payment methods.\n        </p>\n        <p className=\"text-muted-foreground leading-relaxed\">\n          <strong>4.3 Refund Policy:</strong> Refunds are not provided for partially used sessions. In case of technical issues, appropriate credits will be issued at management's discretion.\n        </p>\n      </section>\n\n      <Separator />\n\n      <section>\n        <h2 className=\"text-xl font-semibold mb-3\">5. Equipment Usage and Conduct</h2>\n        <p className=\"text-muted-foreground leading-relaxed mb-3\">\n          <strong>5.1 Responsible Use:</strong> Customers must use all gaming equipment with care. Any damage caused by misuse will be charged to the customer.\n        </p>\n        <p className=\"text-muted-foreground leading-relaxed\">\n          <strong>5.2 Code of Conduct:</strong> Customers must maintain respectful behavior. We reserve the right to terminate sessions for misconduct without refund.\n        </p>\n      </section>\n\n      <Separator />\n\n      <section>\n        <h2 className=\"text-xl font-semibold mb-3\">6. Data Privacy</h2>\n        <p className=\"text-muted-foreground leading-relaxed\">\n          We collect customer information for service delivery and implement reasonable security measures to protect customer data.\n        </p>\n      </section>\n\n      <Separator />\n\n      <section>\n        <h2 className=\"text-xl font-semibold mb-3\">7. Liability and Disclaimers</h2>\n        <p className=\"text-muted-foreground leading-relaxed mb-3\">\n          <strong>7.1 Personal Property:</strong> We are not responsible for loss, theft, or damage to personal belongings.\n        </p>\n        <p className=\"text-muted-foreground leading-relaxed\">\n          <strong>7.2 Limitation of Liability:</strong> Our total liability shall not exceed the amount paid by the customer for the specific session.\n        </p>\n      </section>\n\n      <div className=\"mt-8 p-4 bg-muted rounded-lg\">\n        <p className=\"text-sm text-muted-foreground text-center\">\n          By using Airavoto Gaming Center services, you acknowledge that you have read, understood, and agree to be bound by these Terms and Conditions.\n        </p>\n      </div>\n    </div>\n  );\n}\n\nexport default function Login({ onLoginSuccess }: LoginProps) {\n  const [mode, setMode] = useState<'staff' | 'admin'>('staff');\n  const [username, setUsername] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [isLoggingIn, setIsLoggingIn] = useState(false);\n  const [showPassword, setShowPassword] = useState(false);\n  const [failedAttempts, setFailedAttempts] = useState(0);\n  const [lockoutTime, setLockoutTime] = useState<number | null>(null);\n  const [remainingTime, setRemainingTime] = useState(0);\n  const [currentImageIndex, setCurrentImageIndex] = useState(0);\n  const [agreedToTerms, setAgreedToTerms] = useState(false);\n  const { toast } = useToast();\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      setCurrentImageIndex((prev) => (prev + 1) % carouselImages.length);\n    }, 5000);\n\n    return () => clearInterval(interval);\n  }, []);\n\n\n  useEffect(() => {\n    if (lockoutTime) {\n      const interval = setInterval(() => {\n        const now = Date.now();\n        const timeLeft = Math.ceil((lockoutTime - now) / 1000);\n        \n        if (timeLeft <= 0) {\n          setLockoutTime(null);\n          setFailedAttempts(0);\n          setRemainingTime(0);\n        } else {\n          setRemainingTime(timeLeft);\n        }\n      }, 1000);\n\n      return () => clearInterval(interval);\n    }\n  }, [lockoutTime]);\n\n  const handleLogin = async () => {\n    if (!agreedToTerms) {\n      toast({\n        title: \"Terms Required\",\n        description: \"Please agree to the Terms & Conditions to continue\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (lockoutTime && Date.now() < lockoutTime) {\n      toast({\n        title: \"Too many attempts\",\n        description: `Please wait ${remainingTime} seconds before trying again`,\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsLoggingIn(true);\n    try {\n      const response = await fetch(\"/api/auth/login\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ username, password }),\n        credentials: \"include\"\n      });\n\n      if (response.ok) {\n        const userData = await response.json();\n        setFailedAttempts(0);\n        setLockoutTime(null);\n        onLoginSuccess(userData);\n        toast({\n          title: \"Login successful\",\n          description: `Welcome ${userData.username} (${userData.role})`,\n        });\n      } else {\n        const data = await response.json();\n        const newFailedAttempts = failedAttempts + 1;\n        setFailedAttempts(newFailedAttempts);\n\n        if (newFailedAttempts >= 3) {\n          const lockTime = Date.now() + 30000;\n          setLockoutTime(lockTime);\n          setRemainingTime(30);\n          toast({\n            title: \"Login failed\",\n            description: \"Too many failed attempts. Please wait 30 seconds.\",\n            variant: \"destructive\",\n          });\n        } else {\n          toast({\n            title: \"Login failed\",\n            description: `${data.message || \"Invalid username or password\"}. ${3 - newFailedAttempts} attempts remaining.`,\n            variant: \"destructive\",\n          });\n        }\n      }\n    } catch (error) {\n      toast({\n        title: \"Login failed\",\n        description: \"An error occurred. Please try again.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoggingIn(false);\n    }\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    handleLogin();\n  };\n\n  const isLockedOut = !!(lockoutTime && Date.now() < lockoutTime);\n\n  return (\n    <>\n      {/* Mobile Layout with Curved Wave */}\n      <div className=\"md:hidden min-h-screen flex flex-col bg-[#1e1a24] relative overflow-hidden\">\n        {/* Top Section - Carousel Images with Gradient */}\n        <div className=\"flex-1 relative min-h-[45vh]\">\n          {carouselImages.map((image, index) => (\n            <div\n              key={index}\n              className={`absolute inset-0 transition-opacity duration-1000 ${\n                index === currentImageIndex ? 'opacity-100' : 'opacity-0'\n              }`}\n            >\n              <img\n                src={image.src}\n                alt={image.caption}\n                className=\"w-full h-full object-cover\"\n              />\n              <div className=\"absolute inset-0 bg-gradient-to-b from-purple-900/50 via-purple-900/40 to-purple-900/60\"></div>\n            </div>\n          ))}\n          \n          {/* Logo and Text Overlay */}\n          <div className=\"absolute inset-0 flex flex-col items-center justify-center px-6 text-center z-10\">\n            <img \n              src={logoDark} \n              alt=\"Airavoto Gaming\"\n              className=\"h-20 w-20 object-contain mb-4\"\n            />\n            <h1 className=\"text-2xl font-bold text-white mb-2\">Airavoto Gaming</h1>\n            \n            {currentImageIndex === 0 && (\n              <>\n                <div className=\"flex items-center gap-3 mb-3\">\n                  <p className=\"text-2xl font-bold text-white\">India's First</p>\n                  <div className=\"relative\">\n                    <div className=\"absolute -top-2 -right-2 w-3 h-3 bg-orange-500 rounded-full animate-ping\"></div>\n                    <div className=\"w-10 h-7 rounded-md overflow-hidden shadow-lg border-2 border-white/30 animate-pulse\">\n                      <div className=\"h-1/3 bg-gradient-to-r from-orange-500 to-orange-400\"></div>\n                      <div className=\"h-1/3 bg-white flex items-center justify-center\">\n                        <div className=\"w-2.5 h-2.5 rounded-full bg-blue-600 border border-blue-700\"></div>\n                      </div>\n                      <div className=\"h-1/3 bg-gradient-to-r from-green-600 to-green-500\"></div>\n                    </div>\n                  </div>\n                </div>\n                <p className=\"text-base font-semibold text-purple-200\">Gaming Lounge Management POS</p>\n              </>\n            )}\n            {currentImageIndex === 1 && (\n              <>\n                <p className=\"text-2xl font-bold text-white mb-2\">Complete Software</p>\n                <p className=\"text-base font-semibold text-purple-200\">Solution for Gaming Centers</p>\n              </>\n            )}\n            {currentImageIndex === 2 && (\n              <>\n                <p className=\"text-2xl font-bold text-white mb-2\">Advanced Booking</p>\n                <p className=\"text-base font-semibold text-purple-200\">& Billing Management System</p>\n              </>\n            )}\n          </div>\n        </div>\n\n        {/* Curved Wave Separator */}\n        <div className=\"relative -mt-1\">\n          <svg className=\"w-full h-24\" viewBox=\"0 0 1440 320\" preserveAspectRatio=\"none\">\n            <path \n              d=\"M0,224 C240,96 480,96 720,224 C960,352 1200,352 1440,224 L1440,320 L0,320 Z\" \n              fill=\"#1e1a24\"\n            />\n          </svg>\n        </div>\n        \n        {/* Bottom Section - Login Form */}\n        <div className=\"bg-[#1e1a24] px-6 pb-8 -mt-1\">\n          <div className=\"max-w-md mx-auto\">\n            <h2 className=\"text-2xl font-bold text-white mb-1 text-center\">\n              {mode === 'staff' ? 'Staff Login' : 'Admin Login'}\n            </h2>\n            <p className=\"text-gray-400 text-sm text-center mb-6\">\n              {mode === 'staff' \n                ? 'Please sign in with your staff credentials' \n                : 'Please sign in with your admin credentials'}\n            </p>\n            \n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"username-mobile\" className=\"text-gray-300 text-sm font-medium\">\n                  Username\n                </Label>\n                <Input\n                  id=\"username-mobile\"\n                  data-testid=\"input-username\"\n                  type=\"text\"\n                  placeholder=\"Enter your username\"\n                  value={username}\n                  onChange={(e) => setUsername(e.target.value)}\n                  disabled={isLockedOut}\n                  className=\"bg-[#2d2937] border-gray-700 text-white placeholder:text-gray-500 h-11 rounded-lg focus:border-purple-500 focus:ring-purple-500/20\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"password-mobile\" className=\"text-gray-300 text-sm font-medium\">\n                  Password\n                </Label>\n                <div className=\"relative\">\n                  <Input\n                    id=\"password-mobile\"\n                    data-testid=\"input-password\"\n                    type={showPassword ? \"text\" : \"password\"}\n                    placeholder=\"Enter your password\"\n                    value={password}\n                    onChange={(e) => setPassword(e.target.value)}\n                    className=\"bg-[#2d2937] border-gray-700 text-white placeholder:text-gray-500 h-11 pr-12 rounded-lg focus:border-purple-500 focus:ring-purple-500/20\"\n                    disabled={isLockedOut}\n                  />\n                  <button\n                    type=\"button\"\n                    onClick={() => setShowPassword(!showPassword)}\n                    className=\"absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-300 transition-colors\"\n                    data-testid=\"button-toggle-password-mobile\"\n                    aria-label={showPassword ? \"Hide password\" : \"Show password\"}\n                    disabled={isLockedOut}\n                  >\n                    {showPassword ? (\n                      <EyeOff className=\"h-5 w-5\" />\n                    ) : (\n                      <Eye className=\"h-5 w-5\" />\n                    )}\n                  </button>\n                </div>\n              </div>\n\n              <div className=\"flex items-center gap-2\">\n                <Checkbox\n                  id=\"terms-mobile\"\n                  checked={agreedToTerms}\n                  onCheckedChange={(checked) => setAgreedToTerms(checked === true)}\n                  data-testid=\"checkbox-terms\"\n                  className=\"border-gray-700 data-[state=checked]:bg-purple-600 data-[state=checked]:border-purple-600\"\n                />\n                <label htmlFor=\"terms-mobile\" className=\"text-sm text-gray-400\">\n                  I agree to the{\" \"}\n                  <Dialog>\n                    <DialogTrigger asChild>\n                      <button\n                        type=\"button\"\n                        className=\"text-purple-400 hover:text-purple-300 underline\"\n                        data-testid=\"button-view-terms\"\n                      >\n                        Terms & Conditions\n                      </button>\n                    </DialogTrigger>\n                    <DialogContent className=\"max-w-4xl max-h-[80vh]\">\n                      <DialogHeader>\n                        <DialogTitle className=\"text-2xl font-bold\">Terms and Conditions</DialogTitle>\n                      </DialogHeader>\n                      <ScrollArea className=\"h-[60vh] pr-4\">\n                        <TermsContent />\n                      </ScrollArea>\n                    </DialogContent>\n                  </Dialog>\n                </label>\n              </div>\n\n              <Button\n                type=\"submit\"\n                className=\"w-full h-11 text-base font-semibold bg-gradient-to-r from-purple-600 to-purple-500 hover:from-purple-700 hover:to-purple-600 text-white rounded-lg shadow-lg transition-all duration-200\"\n                data-testid=\"button-login\"\n                disabled={isLoggingIn || isLockedOut || !agreedToTerms}\n              >\n                {isLoggingIn ? \"Signing in...\" : isLockedOut ? `Wait ${remainingTime}s` : \"Login\"}\n              </Button>\n              \n              <div className=\"text-center mt-4\">\n                <p className=\"text-sm text-gray-400\">\n                  {mode === 'staff' ? (\n                    <span \n                      className=\"text-purple-400 font-medium cursor-pointer hover:text-purple-300 transition-colors\" \n                      data-testid=\"link-admin-login\"\n                      onClick={() => setMode('admin')}\n                    >\n                      Click here to login as admin\n                    </span>\n                  ) : (\n                    <span \n                      className=\"text-purple-400 font-medium cursor-pointer hover:text-purple-300 transition-colors\" \n                      data-testid=\"link-staff-login\"\n                      onClick={() => setMode('staff')}\n                    >\n                      Click here to login as staff\n                    </span>\n                  )}\n                </p>\n              </div>\n            </form>\n\n            {/* Carousel Indicators */}\n            <div className=\"flex justify-center gap-2 mt-6\">\n              {carouselImages.map((_, index) => (\n                <div\n                  key={index}\n                  className={`h-1 rounded-full transition-all duration-300 ${\n                    index === currentImageIndex \n                      ? 'w-8 bg-purple-400' \n                      : 'w-1 bg-purple-400/30'\n                  }`}\n                />\n              ))}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Desktop Layout - Full Page Split */}\n      <div className=\"hidden md:flex min-h-screen bg-[#1e1a24]\">\n        {/* Left Side - Image Carousel */}\n        <div className=\"md:w-1/2 relative overflow-hidden\">\n          <div className=\"absolute top-6 left-6 z-20\">\n            <div className=\"flex items-center gap-3\">\n              <img \n                src={logoDark} \n              alt=\"Airavoto Gaming\"\n              className=\"h-12 w-12 object-contain\"\n            />\n            <div>\n              <h1 className=\"text-lg font-bold text-white\">Airavoto Gaming</h1>\n            </div>\n          </div>\n        </div>\n\n        {carouselImages.map((image, index) => (\n          <div\n            key={index}\n            className={`absolute inset-0 transition-opacity duration-1000 ${\n              index === currentImageIndex ? 'opacity-100' : 'opacity-0'\n            }`}\n          >\n            <img\n              src={image.src}\n              alt={image.caption}\n              className=\"w-full h-full object-cover\"\n            />\n            <div className=\"absolute inset-0 bg-gradient-to-b from-purple-900/40 via-transparent to-black/60\"></div>\n          </div>\n        ))}\n\n        <div className=\"absolute bottom-8 left-8 right-8 z-20 text-white\">\n          {currentImageIndex === 0 && (\n            <>\n              <div className=\"flex items-center gap-3 mb-1\">\n                <p className=\"text-3xl font-bold\">India's First</p>\n                <div className=\"relative\">\n                  <div className=\"absolute -top-2 -right-2 w-3 h-3 bg-orange-500 rounded-full animate-ping\"></div>\n                  <div className=\"w-12 h-8 rounded-md overflow-hidden shadow-lg border-2 border-white/30 animate-pulse\">\n                    <div className=\"h-1/3 bg-gradient-to-r from-orange-500 to-orange-400\"></div>\n                    <div className=\"h-1/3 bg-white flex items-center justify-center\">\n                      <div className=\"w-3 h-3 rounded-full bg-blue-600 border border-blue-700\"></div>\n                    </div>\n                    <div className=\"h-1/3 bg-gradient-to-r from-green-600 to-green-500\"></div>\n                  </div>\n                </div>\n              </div>\n              <p className=\"text-lg font-semibold text-purple-200\">Gaming Lounge Management POS</p>\n            </>\n          )}\n          {currentImageIndex === 1 && (\n            <>\n              <p className=\"text-3xl font-bold mb-1\">Complete Software</p>\n              <p className=\"text-lg font-semibold text-purple-200\">Solution for Gaming Centers</p>\n            </>\n          )}\n          {currentImageIndex === 2 && (\n            <>\n              <p className=\"text-3xl font-bold mb-1\">Advanced Booking</p>\n              <p className=\"text-lg font-semibold text-purple-200\">& Billing Management System</p>\n            </>\n          )}\n          <p className=\"text-purple-200 text-sm mt-2\">\n            Streamline your gaming center operations\n          </p>\n          \n          <div className=\"flex gap-2 mt-4\">\n            {carouselImages.map((_, index) => (\n              <div\n                key={index}\n                className={`h-1 rounded-full transition-all duration-300 ${\n                  index === currentImageIndex \n                    ? 'w-8 bg-purple-400' \n                    : 'w-1 bg-purple-400/30'\n                }`}\n              />\n            ))}\n          </div>\n        </div>\n      </div>\n\n      {/* Right Side - Login Form */}\n      <div className=\"w-full md:w-1/2 flex items-center justify-center p-8\">\n        <div className=\"w-full max-w-md\">\n          {/* Mobile Logo */}\n          <div className=\"md:hidden flex flex-col items-center mb-8\">\n            <img \n              src={logoDark} \n              alt=\"Airavoto Gaming\"\n              className=\"h-16 w-16 object-contain mb-3\"\n            />\n            <h1 className=\"text-xl font-bold text-white\">Airavoto Gaming</h1>\n          </div>\n\n          <div className=\"mb-8\">\n            <h2 className=\"text-3xl font-bold text-white mb-2\">\n              {mode === 'staff' ? 'Staff Login' : 'Admin Login'}\n            </h2>\n            <p className=\"text-gray-400 text-sm\">\n              {mode === 'staff' \n                ? 'Please sign in with your staff credentials' \n                : 'Please sign in with your admin credentials'}\n            </p>\n          </div>\n\n          <form onSubmit={handleSubmit} className=\"space-y-5\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"username\" className=\"text-gray-300 text-sm font-medium\">\n                Username\n              </Label>\n              <Input\n                id=\"username\"\n                data-testid=\"input-username\"\n                type=\"text\"\n                placeholder=\"Enter your username\"\n                value={username}\n                onChange={(e) => setUsername(e.target.value)}\n                disabled={isLockedOut}\n                className=\"bg-[#2d2937] border-gray-700 text-white placeholder:text-gray-500 h-11 rounded-lg focus:border-purple-500 focus:ring-purple-500/20\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"password\" className=\"text-gray-300 text-sm font-medium\">\n                Password\n              </Label>\n              <div className=\"relative\">\n                <Input\n                  id=\"password\"\n                  data-testid=\"input-password\"\n                  type={showPassword ? \"text\" : \"password\"}\n                  placeholder=\"Enter your password\"\n                  value={password}\n                  onChange={(e) => setPassword(e.target.value)}\n                  className=\"bg-[#2d2937] border-gray-700 text-white placeholder:text-gray-500 h-11 pr-12 rounded-lg focus:border-purple-500 focus:ring-purple-500/20\"\n                  disabled={isLockedOut}\n                />\n                <button\n                  type=\"button\"\n                  onClick={() => setShowPassword(!showPassword)}\n                  className=\"absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-300 transition-colors\"\n                  data-testid=\"button-toggle-password\"\n                  aria-label={showPassword ? \"Hide password\" : \"Show password\"}\n                  disabled={isLockedOut}\n                >\n                  {showPassword ? (\n                    <EyeOff className=\"h-5 w-5\" />\n                  ) : (\n                    <Eye className=\"h-5 w-5\" />\n                  )}\n                </button>\n              </div>\n            </div>\n\n            <div className=\"flex items-center gap-2\">\n              <Checkbox\n                id=\"terms\"\n                checked={agreedToTerms}\n                onCheckedChange={(checked) => setAgreedToTerms(checked === true)}\n                data-testid=\"checkbox-terms\"\n                className=\"border-gray-700 data-[state=checked]:bg-purple-600 data-[state=checked]:border-purple-600\"\n              />\n              <label htmlFor=\"terms\" className=\"text-sm text-gray-400\">\n                I agree to the{\" \"}\n                <Dialog>\n                  <DialogTrigger asChild>\n                    <button\n                      type=\"button\"\n                      className=\"text-purple-400 hover:text-purple-300 underline\"\n                      data-testid=\"button-view-terms\"\n                    >\n                      Terms & Conditions\n                    </button>\n                  </DialogTrigger>\n                  <DialogContent className=\"max-w-4xl max-h-[80vh]\">\n                    <DialogHeader>\n                      <DialogTitle className=\"text-2xl font-bold\">Terms and Conditions</DialogTitle>\n                    </DialogHeader>\n                    <ScrollArea className=\"h-[60vh] pr-4\">\n                      <TermsContent />\n                    </ScrollArea>\n                  </DialogContent>\n                </Dialog>\n              </label>\n            </div>\n\n            <Button\n              type=\"submit\"\n              className=\"w-full h-11 text-base font-semibold bg-gradient-to-r from-purple-600 to-purple-500 hover:from-purple-700 hover:to-purple-600 text-white rounded-lg shadow-lg transition-all duration-200\"\n              data-testid=\"button-login\"\n              disabled={isLoggingIn || isLockedOut || !agreedToTerms}\n            >\n              {isLoggingIn ? \"Signing in...\" : isLockedOut ? `Wait ${remainingTime}s` : \"Login\"}\n            </Button>\n            \n            <div className=\"text-center mt-4\">\n              <p className=\"text-sm text-gray-400\">\n                {mode === 'staff' ? (\n                  <span \n                    className=\"text-purple-400 font-medium cursor-pointer hover:text-purple-300 transition-colors\" \n                    data-testid=\"link-admin-login\"\n                    onClick={() => setMode('admin')}\n                  >\n                    Click here to login as admin\n                  </span>\n                ) : (\n                  <span \n                    className=\"text-purple-400 font-medium cursor-pointer hover:text-purple-300 transition-colors\" \n                    data-testid=\"link-staff-login\"\n                    onClick={() => setMode('staff')}\n                  >\n                    Click here to login as staff\n                  </span>\n                )}\n              </p>\n            </div>\n          </form>\n\n          {/* Mobile Carousel Indicators */}\n          <div className=\"md:hidden flex justify-center gap-2 mt-8\">\n            {carouselImages.map((_, index) => (\n              <div\n                key={index}\n                className={`h-1 rounded-full transition-all duration-300 ${\n                  index === currentImageIndex \n                    ? 'w-8 bg-purple-400' \n                    : 'w-1 bg-purple-400/30'\n                }`}\n              />\n            ))}\n          </div>\n        </div>\n      </div>\n      </div>\n    </>\n  );\n}\n","path":null,"size_bytes":29425,"size_tokens":null},"client/src/hooks/useUnsavedChanges.tsx":{"content":"import { useEffect, useCallback, useState } from \"react\";\nimport { useLocation } from \"wouter\";\n\ninterface UseUnsavedChangesOptions {\n  hasUnsavedChanges: boolean;\n  message?: string;\n}\n\nexport function useUnsavedChanges({ hasUnsavedChanges, message = \"You have unsaved changes. Are you sure you want to leave?\" }: UseUnsavedChangesOptions) {\n  const [location] = useLocation();\n  const [pendingLocation, setPendingLocation] = useState<string | null>(null);\n  const [showConfirmDialog, setShowConfirmDialog] = useState(false);\n\n  // Handle browser navigation (refresh, close tab, etc.)\n  useEffect(() => {\n    const handleBeforeUnload = (e: BeforeUnloadEvent) => {\n      if (hasUnsavedChanges) {\n        e.preventDefault();\n        e.returnValue = message;\n        return message;\n      }\n    };\n\n    window.addEventListener(\"beforeunload\", handleBeforeUnload);\n    return () => window.removeEventListener(\"beforeunload\", handleBeforeUnload);\n  }, [hasUnsavedChanges, message]);\n\n  // Create a navigation blocker\n  const confirmNavigation = useCallback(() => {\n    setShowConfirmDialog(false);\n    if (pendingLocation) {\n      // Navigate to the pending location\n      window.location.href = pendingLocation;\n    }\n  }, [pendingLocation]);\n\n  const cancelNavigation = useCallback(() => {\n    setShowConfirmDialog(false);\n    setPendingLocation(null);\n  }, []);\n\n  // Intercept clicks on links\n  useEffect(() => {\n    const handleClick = (e: MouseEvent) => {\n      if (!hasUnsavedChanges) return;\n\n      const target = e.target as HTMLElement;\n      const link = target.closest(\"a\");\n      \n      if (link && link.href && !link.href.includes(location)) {\n        e.preventDefault();\n        e.stopPropagation();\n        setPendingLocation(link.href);\n        setShowConfirmDialog(true);\n      }\n    };\n\n    document.addEventListener(\"click\", handleClick, true);\n    return () => document.removeEventListener(\"click\", handleClick, true);\n  }, [hasUnsavedChanges, location]);\n\n  return {\n    showConfirmDialog,\n    confirmNavigation,\n    cancelNavigation,\n    message,\n  };\n}\n","path":null,"size_bytes":2073,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto scroll-smooth touch-pan-x touch-pan-y [&::-webkit-scrollbar]:h-2 [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar-track]:bg-muted/10 [&::-webkit-scrollbar-thumb]:bg-muted/50 [&::-webkit-scrollbar-thumb]:rounded-full hover:[&::-webkit-scrollbar-thumb]:bg-muted/70\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b border-white/10 transition-all duration-300 hover:bg-white/10 dark:hover:bg-white/5 data-[state=selected]:bg-primary/10\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-semibold text-foreground/80 [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":3080,"size_tokens":null},"client/src/lib/tourSteps.ts":{"content":"import { Step } from \"react-joyride\";\n\nexport const dashboardTourSteps: Step[] = [\n  {\n    target: '[data-joyride=\"take-tour-button\"]',\n    content: 'Welcome to Airavoto Gaming! This interactive tour will guide you through all the key features. You can start the tour anytime by clicking this button.',\n    disableBeacon: true,\n    placement: 'bottom',\n  },\n  {\n    target: '[data-joyride=\"sidebar-toggle\"]',\n    content: 'Click here to toggle the sidebar navigation. The sidebar gives you access to all pages like Dashboard, Timeline, Analytics, Settings, and more.',\n    placement: 'right',\n  },\n  {\n    target: '[data-joyride=\"sidebar-dashboard\"]',\n    content: 'The Dashboard is your control center. Here you can see all gaming devices organized by category (PC, PS5, VR, etc.) and manage bookings in real-time.',\n    placement: 'right',\n  },\n  {\n    target: '[data-joyride=\"category-cards\"]',\n    content: 'These category cards show your gaming devices. Each card displays available and occupied seats. Green means available, and you\\'ll see real-time session timers for active bookings.',\n    placement: 'bottom',\n  },\n  {\n    target: '[data-joyride=\"add-booking-button\"]',\n    content: 'Click the \"+\" button on any category card to create a new booking. You can create walk-in bookings (start now), advance bookings (future), or happy hours bookings (special pricing).',\n    placement: 'right',\n  },\n  {\n    target: '[data-joyride=\"view-toggle\"]',\n    content: 'Switch between table view and card view to see your bookings in different layouts. Table view is great for detailed information, while card view is more visual.',\n    placement: 'bottom',\n  },\n  {\n    target: '[data-joyride=\"booking-table\"]',\n    content: 'The booking table shows all active sessions with real-time countdown timers. You can extend time, pause/resume sessions, add food orders, or end sessions from here.',\n    placement: 'top',\n  },\n  {\n    target: '[data-joyride=\"calculate-button\"]',\n    content: 'After completing sessions, select the checkboxes in the booking table, then click Calculate to see the total amount including all food orders. Perfect for processing multiple customers at once!',\n    placement: 'top',\n  },\n  {\n    target: '[data-joyride=\"payment-button\"]',\n    content: 'Use the Payment button to record how customers paid. You can mark payments as Cash or UPI. For mixed payments (Cash + UPI), use the Split Payment option.',\n    placement: 'top',\n  },\n  {\n    target: '[data-joyride=\"refresh-button\"]',\n    content: 'Click Refresh to archive completed bookings and move them to the History page. This keeps your dashboard clean and showing only active sessions. Use after marking payments!',\n    placement: 'top',\n  },\n  {\n    target: '[data-joyride=\"sidebar-food\"]',\n    content: 'The Food page is where you manage your menu items. Add snacks, drinks, and meals with pricing, cost price, and categories (Trackable or Made to Order). These items can be added to bookings for extra revenue!',\n    placement: 'right',\n  },\n  {\n    target: '[data-joyride=\"add-food-button\"]',\n    content: 'Click \"Add Food Item\" to create new menu items. Set the name, selling price, cost price (for profit tracking), supplier, and minimum stock levels. Trackable items can have inventory management!',\n    placement: 'left',\n  },\n  {\n    target: '[data-joyride=\"food-items-grid\"]',\n    content: 'Your menu items appear here as cards. Each card shows the item name, price, cost/profit, category, and expiry date. You can edit or delete items directly from these cards.',\n    placement: 'top',\n  },\n  {\n    target: '[data-joyride=\"sidebar-inventory\"]',\n    content: 'The Inventory page helps you track stock levels for trackable items like chips, drinks, and packaged snacks. Get low stock alerts and manage expiry dates to reduce waste!',\n    placement: 'right',\n  },\n  {\n    target: '[data-joyride=\"add-to-inventory-button\"]',\n    content: 'Add food items from your Food page to the Inventory. Only \"Trackable\" category items need inventory management - made-to-order items don\\'t need stock tracking.',\n    placement: 'left',\n  },\n  {\n    target: '[data-joyride=\"inventory-tabs\"]',\n    content: 'Filter inventory by category: view all items, only trackable items (with stock), or made-to-order items. This helps you focus on what needs restocking.',\n    placement: 'top',\n  },\n  {\n    target: '[data-joyride=\"inventory-table\"]',\n    content: 'The inventory table shows current stock, minimum levels, profit margins, and status. Items below minimum stock are highlighted in red. You can add/remove stock and track supplier information here.',\n    placement: 'top',\n  },\n  {\n    target: '[data-joyride=\"sidebar-settings\"]',\n    content: 'Visit Settings to configure your gaming devices, pricing tiers, happy hours, and more. This is where you customize everything for your gaming center.',\n    placement: 'right',\n  },\n  {\n    target: '[data-joyride=\"sidebar-analytics\"]',\n    content: 'Analytics shows revenue trends, device usage statistics, and customer insights. Export reports to CSV/PDF for accounting or business analysis.',\n    placement: 'right',\n  },\n  {\n    target: '[data-joyride=\"theme-toggle\"]',\n    content: 'Toggle between light and dark mode to match your preference. Your choice is saved automatically!',\n    placement: 'bottom',\n  },\n  {\n    target: '[data-joyride=\"notification-center\"]',\n    content: 'Stay updated with system notifications. Get alerts for expired sessions, low stock items, and important events.',\n    placement: 'bottom',\n  },\n];\n\nexport const settingsTourSteps: Step[] = [\n  {\n    target: '[data-joyride=\"settings-devices\"]',\n    content: 'Configure your gaming device categories here. Add PC, PS5, VR, Xbox, and any other gaming devices you have. Set how many seats each category has.',\n    placement: 'bottom',\n    disableBeacon: true,\n  },\n  {\n    target: '[data-joyride=\"settings-pricing\"]',\n    content: 'Set up pricing tiers for each device category. Configure prices for different duration options (30 min, 1 hour, 2 hours, etc.). PS5 can have multi-person pricing!',\n    placement: 'bottom',\n  },\n  {\n    target: '[data-joyride=\"settings-happy-hours\"]',\n    content: 'Configure Happy Hours - special time-based pricing to attract customers during off-peak hours. Set time slots (e.g., 2-6 PM) and discounted rates for each category.',\n    placement: 'bottom',\n  },\n  {\n    target: '[data-joyride=\"add-category-button\"]',\n    content: 'Click here to add a new device category to your gaming center. You can add unlimited categories to match your setup!',\n    placement: 'left',\n  },\n];\n\nexport const combinedTourSteps: Step[] = [\n  ...dashboardTourSteps,\n];\n","path":null,"size_bytes":6692,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"client/src/pages/Settings.tsx":{"content":"import { useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle, CardFooter } from \"@/components/ui/card\";\nimport { Save, X, User, Users, Lock, Edit, Trash2, Plus, Eye, EyeOff } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { DeviceConfigCard } from \"@/components/DeviceConfigCard\";\nimport { PricingTable } from \"@/components/PricingTable\";\nimport { HappyHoursPricing } from \"@/components/HappyHoursPricing\";\nimport { useState, useEffect } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport type { DeviceConfig, PricingConfig, HappyHoursConfig, HappyHoursPricing as HappyHoursPricingType } from \"@shared/schema\";\n\ninterface UserProfile {\n  id: string;\n  username: string;\n  role: string;\n  createdAt: string;\n}\n\ninterface StaffMember {\n  id: string;\n  username: string;\n  role: string;\n  createdAt: string;\n}\n\ninterface TimeSlot {\n  startTime: string;\n  endTime: string;\n}\n\nexport default function Settings() {\n  const { toast } = useToast();\n  \n  // Fetch device configs\n  const { data: deviceConfigs } = useQuery<DeviceConfig[]>({\n    queryKey: ['/api/device-config'],\n  });\n\n  // Fetch pricing configs\n  const { data: pricingConfigs } = useQuery<PricingConfig[]>({\n    queryKey: ['/api/pricing-config'],\n  });\n\n  // Fetch happy hours configs\n  const { data: happyHoursConfigs } = useQuery<HappyHoursConfig[]>({\n    queryKey: ['/api/happy-hours-config'],\n  });\n\n  // Fetch happy hours pricing\n  const { data: happyHoursPricing } = useQuery<HappyHoursPricingType[]>({\n    queryKey: ['/api/happy-hours-pricing'],\n  });\n\n  // Local state for device configs\n  const [pcConfig, setPcConfig] = useState({ count: 30, seats: [] as { name: string; visible: boolean }[] });\n  const [ps5Config, setPs5Config] = useState({ count: 20, seats: [] as { name: string; visible: boolean }[] });\n\n  // Local state for pricing\n  const [pcPricing, setPcPricing] = useState<{ duration: string; price: number; personCount?: number }[]>([]);\n  const [ps5Pricing, setPs5Pricing] = useState<{ duration: string; price: number; personCount?: number }[]>([]);\n\n  // Local state for happy hours time slots\n  const [pcHappyHoursEnabled, setPcHappyHoursEnabled] = useState(true);\n  const [ps5HappyHoursEnabled, setPs5HappyHoursEnabled] = useState(true);\n  const [pcTimeSlots, setPcTimeSlots] = useState<TimeSlot[]>([]);\n  const [ps5TimeSlots, setPs5TimeSlots] = useState<TimeSlot[]>([]);\n\n  // Local state for happy hours pricing\n  const [pcHappyHoursPricing, setPcHappyHoursPricing] = useState<{ duration: string; price: number; personCount?: number }[]>([]);\n  const [ps5HappyHoursPricing, setPs5HappyHoursPricing] = useState<{ duration: string; price: number; personCount?: number }[]>([]);\n\n  // Auth and user state\n  const { user: authUser } = useAuth();\n  const isAdmin = authUser?.role === 'admin';\n  const isAuthLoaded = authUser !== null && authUser !== undefined;\n\n  // Fetch user profile\n  const { data: profile, isLoading: profileLoading } = useQuery<UserProfile>({\n    queryKey: ['/api/profile'],\n  });\n\n  // Fetch staff members (admin only - only enabled when auth is loaded AND user is admin)\n  const { data: staffMembers, isLoading: staffLoading } = useQuery<StaffMember[]>({\n    queryKey: ['/api/staff'],\n    enabled: isAuthLoaded && isAdmin === true,\n  });\n\n  // Profile management state\n  const [profileForm, setProfileForm] = useState({\n    username: '',\n  });\n  const [passwordForm, setPasswordForm] = useState({\n    currentPassword: '',\n    newPassword: '',\n    confirmPassword: '',\n  });\n  const [showCurrentPassword, setShowCurrentPassword] = useState(false);\n  const [showNewPassword, setShowNewPassword] = useState(false);\n  const [showConfirmPassword, setShowConfirmPassword] = useState(false);\n\n  // Staff management state\n  const [newStaffForm, setNewStaffForm] = useState({\n    username: '',\n    password: '',\n  });\n  const [editStaffForm, setEditStaffForm] = useState({\n    id: '',\n    username: '',\n  });\n  const [resetPasswordForm, setResetPasswordForm] = useState({\n    staffId: '',\n    newPassword: '',\n  });\n  const [isAddStaffDialogOpen, setIsAddStaffDialogOpen] = useState(false);\n  const [isEditStaffDialogOpen, setIsEditStaffDialogOpen] = useState(false);\n  const [isResetPasswordDialogOpen, setIsResetPasswordDialogOpen] = useState(false);\n  const [staffToDelete, setStaffToDelete] = useState<StaffMember | null>(null);\n  const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false);\n  const [showNewStaffPassword, setShowNewStaffPassword] = useState(false);\n  const [showResetStaffPassword, setShowResetStaffPassword] = useState(false);\n\n  // Initialize profile form when profile data loads\n  useEffect(() => {\n    if (profile) {\n      setProfileForm({\n        username: profile.username || '',\n      });\n    }\n  }, [profile]);\n\n  // Profile update mutation\n  const updateProfileMutation = useMutation({\n    mutationFn: async (data: { username?: string }) => {\n      return apiRequest(\"PATCH\", \"/api/profile\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/profile'] });\n      toast({ title: \"Success\", description: \"Profile updated successfully\" });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update profile\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Password change mutation\n  const changePasswordMutation = useMutation({\n    mutationFn: async (data: { currentPassword: string; newPassword: string; confirmPassword: string }) => {\n      return apiRequest(\"POST\", \"/api/profile/change-password\", data);\n    },\n    onSuccess: () => {\n      setPasswordForm({ currentPassword: '', newPassword: '', confirmPassword: '' });\n      toast({ title: \"Success\", description: \"Password changed successfully\" });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to change password\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Create staff mutation\n  const createStaffMutation = useMutation({\n    mutationFn: async (data: { username: string; password: string }) => {\n      return apiRequest(\"POST\", \"/api/staff\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/staff'] });\n      setNewStaffForm({ username: '', password: '' });\n      setIsAddStaffDialogOpen(false);\n      toast({ title: \"Success\", description: \"Staff member created successfully\" });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to create staff member\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Update staff mutation\n  const updateStaffMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: { username?: string } }) => {\n      return apiRequest(\"PATCH\", `/api/staff/${id}`, data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/staff'] });\n      setIsEditStaffDialogOpen(false);\n      toast({ title: \"Success\", description: \"Staff member updated successfully\" });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update staff member\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Reset staff password mutation\n  const resetStaffPasswordMutation = useMutation({\n    mutationFn: async ({ id, newPassword }: { id: string; newPassword: string }) => {\n      return apiRequest(\"POST\", `/api/staff/${id}/reset-password`, { newPassword });\n    },\n    onSuccess: () => {\n      setResetPasswordForm({ staffId: '', newPassword: '' });\n      setIsResetPasswordDialogOpen(false);\n      toast({ title: \"Success\", description: \"Password reset successfully\" });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to reset password\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Delete staff mutation\n  const deleteStaffMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return apiRequest(\"DELETE\", `/api/staff/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/staff'] });\n      setStaffToDelete(null);\n      setIsDeleteDialogOpen(false);\n      toast({ title: \"Success\", description: \"Staff member deleted successfully\" });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to delete staff member\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Validation helpers\n  const validateUsername = (username: string): string | null => {\n    if (!username || username.trim().length < 3) {\n      return \"Username must be at least 3 characters\";\n    }\n    if (username.length > 50) {\n      return \"Username must be less than 50 characters\";\n    }\n    if (!/^[a-zA-Z0-9_-]+$/.test(username)) {\n      return \"Username can only contain letters, numbers, underscores, and hyphens\";\n    }\n    return null;\n  };\n\n  const validatePassword = (password: string): string | null => {\n    if (!password || password.length < 8) {\n      return \"Password must be at least 8 characters\";\n    }\n    return null;\n  };\n\n  // Profile handlers\n  const handleUpdateProfile = () => {\n    // Validate username if changed\n    if (profileForm.username && profileForm.username !== profile?.username) {\n      const usernameError = validateUsername(profileForm.username);\n      if (usernameError) {\n        toast({ title: \"Error\", description: usernameError, variant: \"destructive\" });\n        return;\n      }\n    }\n\n    const updates: any = {};\n    if (profileForm.username && profileForm.username !== profile?.username) {\n      updates.username = profileForm.username;\n    }\n\n    if (Object.keys(updates).length === 0) {\n      toast({ title: \"Info\", description: \"No changes to save\" });\n      return;\n    }\n\n    updateProfileMutation.mutate(updates);\n  };\n\n  const handleChangePassword = () => {\n    // Validate new password\n    const passwordError = validatePassword(passwordForm.newPassword);\n    if (passwordError) {\n      toast({ title: \"Error\", description: passwordError, variant: \"destructive\" });\n      return;\n    }\n\n    if (passwordForm.newPassword !== passwordForm.confirmPassword) {\n      toast({\n        title: \"Error\",\n        description: \"New passwords do not match\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    changePasswordMutation.mutate(passwordForm);\n  };\n\n  // Staff handlers\n  const handleCreateStaff = () => {\n    // Validate username\n    const usernameError = validateUsername(newStaffForm.username);\n    if (usernameError) {\n      toast({ title: \"Error\", description: usernameError, variant: \"destructive\" });\n      return;\n    }\n\n    // Validate password\n    const passwordError = validatePassword(newStaffForm.password);\n    if (passwordError) {\n      toast({ title: \"Error\", description: passwordError, variant: \"destructive\" });\n      return;\n    }\n\n    createStaffMutation.mutate(newStaffForm);\n  };\n\n  const handleEditStaff = (staff: StaffMember) => {\n    setEditStaffForm({\n      id: staff.id,\n      username: staff.username,\n    });\n    setIsEditStaffDialogOpen(true);\n  };\n\n  const handleUpdateStaff = () => {\n    const originalStaff = staffMembers?.find(s => s.id === editStaffForm.id);\n    \n    // Validate username if changed\n    if (editStaffForm.username && editStaffForm.username !== originalStaff?.username) {\n      const usernameError = validateUsername(editStaffForm.username);\n      if (usernameError) {\n        toast({ title: \"Error\", description: usernameError, variant: \"destructive\" });\n        return;\n      }\n    }\n\n    const updates: any = {};\n    if (editStaffForm.username && editStaffForm.username !== originalStaff?.username) {\n      updates.username = editStaffForm.username;\n    }\n\n    if (Object.keys(updates).length === 0) {\n      toast({ title: \"Info\", description: \"No changes to save\" });\n      return;\n    }\n\n    updateStaffMutation.mutate({ id: editStaffForm.id, data: updates });\n  };\n\n  const handleResetStaffPassword = (staff: StaffMember) => {\n    setResetPasswordForm({ staffId: staff.id, newPassword: '' });\n    setIsResetPasswordDialogOpen(true);\n  };\n\n  const handleConfirmResetPassword = () => {\n    const passwordError = validatePassword(resetPasswordForm.newPassword);\n    if (passwordError) {\n      toast({ title: \"Error\", description: passwordError, variant: \"destructive\" });\n      return;\n    }\n    resetStaffPasswordMutation.mutate({ id: resetPasswordForm.staffId, newPassword: resetPasswordForm.newPassword });\n  };\n\n  const handleDeleteStaff = (staff: StaffMember) => {\n    setStaffToDelete(staff);\n    setIsDeleteDialogOpen(true);\n  };\n\n  const handleConfirmDelete = () => {\n    if (staffToDelete) {\n      deleteStaffMutation.mutate(staffToDelete.id);\n    }\n  };\n\n  // Initialize local state from API data\n  useEffect(() => {\n    if (deviceConfigs) {\n      const pc = deviceConfigs.find((c) => c.category === \"PC\");\n      const ps5 = deviceConfigs.find((c) => c.category === \"PS5\");\n\n      if (pc) {\n        setPcConfig({\n          count: pc.count,\n          seats: pc.seats.map((name) => ({ name, visible: true })),\n        });\n      }\n\n      if (ps5) {\n        setPs5Config({\n          count: ps5.count,\n          seats: ps5.seats.map((name) => ({ name, visible: true })),\n        });\n      }\n    }\n  }, [deviceConfigs]);\n\n  useEffect(() => {\n    if (pricingConfigs) {\n      const pcConfigs = pricingConfigs.filter((c) => c.category === \"PC\");\n      const ps5Configs = pricingConfigs.filter((c) => c.category === \"PS5\");\n\n      setPcPricing(pcConfigs.map((c) => ({ duration: c.duration, price: parseFloat(c.price), personCount: c.personCount })));\n      setPs5Pricing(ps5Configs.map((c) => ({ duration: c.duration, price: parseFloat(c.price), personCount: c.personCount })));\n    }\n  }, [pricingConfigs]);\n\n  useEffect(() => {\n    if (happyHoursConfigs) {\n      const pcConfigs = happyHoursConfigs.filter((c) => c.category === \"PC\");\n      const ps5Configs = happyHoursConfigs.filter((c) => c.category === \"PS5\");\n\n      setPcHappyHoursEnabled(pcConfigs.length > 0 && pcConfigs[0].enabled === 1);\n      setPs5HappyHoursEnabled(ps5Configs.length > 0 && ps5Configs[0].enabled === 1);\n\n      setPcTimeSlots(pcConfigs.map((c) => ({ startTime: c.startTime, endTime: c.endTime })));\n      setPs5TimeSlots(ps5Configs.map((c) => ({ startTime: c.startTime, endTime: c.endTime })));\n    }\n  }, [happyHoursConfigs]);\n\n  useEffect(() => {\n    if (happyHoursPricing) {\n      const pcPricing = happyHoursPricing.filter((c) => c.category === \"PC\");\n      const ps5Pricing = happyHoursPricing.filter((c) => c.category === \"PS5\");\n\n      setPcHappyHoursPricing(pcPricing.map((c) => ({ duration: c.duration, price: parseFloat(c.price), personCount: c.personCount })));\n      setPs5HappyHoursPricing(ps5Pricing.map((c) => ({ duration: c.duration, price: parseFloat(c.price), personCount: c.personCount })));\n    }\n  }, [happyHoursPricing]);\n\n  // Save mutations\n  const saveDeviceConfigMutation = useMutation({\n    mutationFn: async ({ category, count, seats }: { category: string; count: number; seats: string[] }) => {\n      return apiRequest(\"POST\", \"/api/device-config\", { category, count, seats });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/device-config'] });\n      queryClient.invalidateQueries({ queryKey: ['device-configs'] });\n      toast({ title: \"Success\", description: \"Device configuration saved\" });\n    },\n    onError: (error: any) => {\n      toast({ \n        title: \"Error\", \n        description: error.message || \"Failed to save device configuration\",\n        variant: \"destructive\" \n      });\n    },\n  });\n\n  const savePricingMutation = useMutation({\n    mutationFn: async ({ category, configs }: { category: string; configs: { duration: string; price: number; personCount?: number }[] }) => {\n      return apiRequest(\"POST\", \"/api/pricing-config\", {\n        category,\n        configs: configs.map((c) => ({ duration: c.duration, price: c.price.toString(), personCount: c.personCount || 1 })),\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/pricing-config'] });\n      toast({ title: \"Success\", description: \"Pricing configuration saved\" });\n    },\n    onError: (error: any) => {\n      toast({ \n        title: \"Error\", \n        description: error.message || \"Failed to save pricing configuration\",\n        variant: \"destructive\" \n      });\n    },\n  });\n\n  const saveHappyHoursConfigMutation = useMutation({\n    mutationFn: async ({ category, enabled, timeSlots }: { category: string; enabled: boolean; timeSlots: TimeSlot[] }) => {\n      return apiRequest(\"POST\", \"/api/happy-hours-config\", {\n        category,\n        configs: timeSlots.map((slot) => ({ startTime: slot.startTime, endTime: slot.endTime, enabled: enabled ? 1 : 0 })),\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/happy-hours-config'] });\n      toast({ title: \"Success\", description: \"Happy hours configuration saved\" });\n    },\n    onError: (error: any) => {\n      toast({ \n        title: \"Error\", \n        description: error.message || \"Failed to save happy hours configuration\",\n        variant: \"destructive\" \n      });\n    },\n  });\n\n  const saveHappyHoursPricingMutation = useMutation({\n    mutationFn: async ({ category, configs }: { category: string; configs: { duration: string; price: number; personCount?: number }[] }) => {\n      return apiRequest(\"POST\", \"/api/happy-hours-pricing\", {\n        category,\n        configs: configs.map((c) => ({ duration: c.duration, price: c.price.toString(), personCount: c.personCount || 1 })),\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/happy-hours-pricing'] });\n      toast({ title: \"Success\", description: \"Happy hours pricing saved\" });\n    },\n    onError: (error: any) => {\n      toast({ \n        title: \"Error\", \n        description: error.message || \"Failed to save happy hours pricing\",\n        variant: \"destructive\" \n      });\n    },\n  });\n\n  const handleSaveAll = async () => {\n    try {\n      // Save all configurations in parallel\n      const savePromises = [\n        // Device configs\n        apiRequest(\"POST\", \"/api/device-config\", {\n          category: \"PC\",\n          count: pcConfig.count,\n          seats: pcConfig.seats.map((s) => s.name),\n        }),\n        apiRequest(\"POST\", \"/api/device-config\", {\n          category: \"PS5\",\n          count: ps5Config.count,\n          seats: ps5Config.seats.map((s) => s.name),\n        }),\n        // Pricing\n        apiRequest(\"POST\", \"/api/pricing-config\", {\n          category: \"PC\",\n          configs: pcPricing.map((c) => ({ duration: c.duration, price: c.price.toString(), personCount: c.personCount || 1 })),\n        }),\n        apiRequest(\"POST\", \"/api/pricing-config\", {\n          category: \"PS5\",\n          configs: ps5Pricing.map((c) => ({ duration: c.duration, price: c.price.toString(), personCount: c.personCount || 1 })),\n        }),\n        // Happy hours config\n        apiRequest(\"POST\", \"/api/happy-hours-config\", {\n          category: \"PC\",\n          configs: (pcTimeSlots.length > 0 ? pcTimeSlots : [{ startTime: \"11:00\", endTime: \"14:00\" }])\n            .map((slot) => ({ startTime: slot.startTime, endTime: slot.endTime, enabled: pcHappyHoursEnabled ? 1 : 0 })),\n        }),\n        apiRequest(\"POST\", \"/api/happy-hours-config\", {\n          category: \"PS5\",\n          configs: (ps5TimeSlots.length > 0 ? ps5TimeSlots : [{ startTime: \"11:00\", endTime: \"14:00\" }])\n            .map((slot) => ({ startTime: slot.startTime, endTime: slot.endTime, enabled: ps5HappyHoursEnabled ? 1 : 0 })),\n        }),\n      ];\n\n      // Add happy hours pricing if exists\n      if (pcHappyHoursPricing.length > 0) {\n        savePromises.push(\n          apiRequest(\"POST\", \"/api/happy-hours-pricing\", {\n            category: \"PC\",\n            configs: pcHappyHoursPricing.map((c) => ({ duration: c.duration, price: c.price.toString(), personCount: c.personCount || 1 })),\n          })\n        );\n      }\n      if (ps5HappyHoursPricing.length > 0) {\n        savePromises.push(\n          apiRequest(\"POST\", \"/api/happy-hours-pricing\", {\n            category: \"PS5\",\n            configs: ps5HappyHoursPricing.map((c) => ({ duration: c.duration, price: c.price.toString(), personCount: c.personCount || 1 })),\n          })\n        );\n      }\n\n      // Wait for all saves to complete\n      await Promise.all(savePromises);\n\n      // Invalidate all queries to refresh data\n      queryClient.invalidateQueries({ queryKey: ['/api/device-config'] });\n      queryClient.invalidateQueries({ queryKey: ['device-configs'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/pricing-config'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/happy-hours-config'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/happy-hours-pricing'] });\n\n      // Show single success toast\n      toast({\n        title: \"Settings Saved\",\n        description: \"All configurations have been saved successfully!\",\n      });\n    } catch (error: any) {\n      console.error(\"Save error:\", error);\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to save some settings. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handlePcCountChange = (newCount: number) => {\n    const newSeats = Array.from({ length: newCount }, (_, i) => ({\n      name: `PC-${i + 1}`,\n      visible: i < pcConfig.seats.length ? pcConfig.seats[i].visible : true,\n    }));\n    setPcConfig({ count: newCount, seats: newSeats });\n  };\n\n  const handlePs5CountChange = (newCount: number) => {\n    const newSeats = Array.from({ length: newCount }, (_, i) => ({\n      name: `PS5-${i + 1}`,\n      visible: i < ps5Config.seats.length ? ps5Config.seats[i].visible : true,\n    }));\n    setPs5Config({ count: newCount, seats: newSeats });\n  };\n\n  const handlePcToggleVisibility = (seatName: string) => {\n    setPcConfig((prev) => ({\n      ...prev,\n      seats: prev.seats.map((s) => (s.name === seatName ? { ...s, visible: !s.visible } : s)),\n    }));\n  };\n\n  const handlePs5ToggleVisibility = (seatName: string) => {\n    setPs5Config((prev) => ({\n      ...prev,\n      seats: prev.seats.map((s) => (s.name === seatName ? { ...s, visible: !s.visible } : s)),\n    }));\n  };\n\n  const addPcTimeSlot = () => {\n    setPcTimeSlots([...pcTimeSlots, { startTime: \"11:00\", endTime: \"14:00\" }]);\n  };\n\n  const addPs5TimeSlot = () => {\n    setPs5TimeSlots([...ps5TimeSlots, { startTime: \"11:00\", endTime: \"14:00\" }]);\n  };\n\n  const removePcTimeSlot = (index: number) => {\n    setPcTimeSlots(pcTimeSlots.filter((_, i) => i !== index));\n  };\n\n  const removePs5TimeSlot = (index: number) => {\n    setPs5TimeSlots(ps5TimeSlots.filter((_, i) => i !== index));\n  };\n\n  return (\n    <div className=\"container mx-auto p-6 space-y-6\">\n      <div className=\"flex items-center justify-between flex-wrap gap-4\">\n        <div>\n          <h1 className=\"text-3xl font-bold\" data-testid=\"text-settings-title\">Settings</h1>\n          <p className=\"text-muted-foreground\">Configure devices and pricing</p>\n        </div>\n        <Button onClick={handleSaveAll} data-testid=\"button-save-changes\">\n          <Save className=\"h-4 w-4 mr-2\" />\n          Save Changes\n        </Button>\n      </div>\n\n      {/* Device Configuration */}\n      <div>\n        <h2 className=\"text-2xl font-bold mb-4\">Device Configuration</h2>\n        <div className=\"grid gap-4 md:grid-cols-2\">\n          <DeviceConfigCard\n            title=\"PC\"\n            description={`Configure PC devices`}\n            count={pcConfig.count}\n            onCountChange={handlePcCountChange}\n            seats={pcConfig.seats}\n            onToggleVisibility={handlePcToggleVisibility}\n          />\n          <DeviceConfigCard\n            title=\"PS5\"\n            description={`Configure PS5 devices`}\n            count={ps5Config.count}\n            onCountChange={handlePs5CountChange}\n            seats={ps5Config.seats}\n            onToggleVisibility={handlePs5ToggleVisibility}\n          />\n        </div>\n      </div>\n\n      {/* Pricing Configuration */}\n      <div>\n        <h2 className=\"text-2xl font-bold mb-4\">Pricing Configuration</h2>\n        <div className=\"grid gap-4 md:grid-cols-2\">\n          <PricingTable category=\"PC\" slots={pcPricing} onUpdateSlots={setPcPricing} />\n          <PricingTable category=\"PS5\" slots={ps5Pricing} onUpdateSlots={setPs5Pricing} />\n        </div>\n      </div>\n\n      {/* Happy Hours Time Slots */}\n      <div>\n        <h2 className=\"text-2xl font-bold mb-4\">Happy Hours Time Slots</h2>\n        <p className=\"text-sm text-muted-foreground mb-4\">\n          Define when happy hours are active. Enable/disable and set time periods for special pricing.\n        </p>\n        <div className=\"grid gap-4 md:grid-cols-2\">\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <CardTitle>PC</CardTitle>\n                  <CardDescription>Configure happy hours time slots and pricing</CardDescription>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Label htmlFor=\"pc-enabled\">Enabled</Label>\n                  <Switch id=\"pc-enabled\" checked={pcHappyHoursEnabled} onCheckedChange={setPcHappyHoursEnabled} />\n                </div>\n              </div>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              {pcTimeSlots.map((slot, index) => (\n                <div key={index} className=\"space-y-2 p-3 rounded-md border\">\n                  <div className=\"flex items-start justify-between gap-2\">\n                    <div className=\"grid grid-cols-2 gap-2 flex-1\">\n                      <div>\n                        <Label className=\"text-xs\">Start Time</Label>\n                        <Input\n                          type=\"time\"\n                          value={slot.startTime}\n                          onChange={(e) => {\n                            const newSlots = [...pcTimeSlots];\n                            newSlots[index].startTime = e.target.value;\n                            setPcTimeSlots(newSlots);\n                          }}\n                          data-testid={`input-pc-start-${index}`}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs\">End Time</Label>\n                        <Input\n                          type=\"time\"\n                          value={slot.endTime}\n                          onChange={(e) => {\n                            const newSlots = [...pcTimeSlots];\n                            newSlots[index].endTime = e.target.value;\n                            setPcTimeSlots(newSlots);\n                          }}\n                          data-testid={`input-pc-end-${index}`}\n                        />\n                      </div>\n                    </div>\n                    <Button\n                      size=\"icon\"\n                      variant=\"ghost\"\n                      onClick={() => removePcTimeSlot(index)}\n                      className=\"mt-5\"\n                      data-testid={`button-remove-pc-timeslot-${index}`}\n                    >\n                      <X className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              ))}\n              <Button variant=\"outline\" className=\"w-full\" onClick={addPcTimeSlot} data-testid=\"button-add-pc-timeslot\">\n                + Add Time Slot\n              </Button>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <CardTitle>PS5</CardTitle>\n                  <CardDescription>Configure happy hours time slots and pricing</CardDescription>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Label htmlFor=\"ps5-enabled\">Enabled</Label>\n                  <Switch id=\"ps5-enabled\" checked={ps5HappyHoursEnabled} onCheckedChange={setPs5HappyHoursEnabled} />\n                </div>\n              </div>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              {ps5TimeSlots.map((slot, index) => (\n                <div key={index} className=\"space-y-2 p-3 rounded-md border\">\n                  <div className=\"flex items-start justify-between gap-2\">\n                    <div className=\"grid grid-cols-2 gap-2 flex-1\">\n                      <div>\n                        <Label className=\"text-xs\">Start Time</Label>\n                        <Input\n                          type=\"time\"\n                          value={slot.startTime}\n                          onChange={(e) => {\n                            const newSlots = [...ps5TimeSlots];\n                            newSlots[index].startTime = e.target.value;\n                            setPs5TimeSlots(newSlots);\n                          }}\n                          data-testid={`input-ps5-start-${index}`}\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"text-xs\">End Time</Label>\n                        <Input\n                          type=\"time\"\n                          value={slot.endTime}\n                          onChange={(e) => {\n                            const newSlots = [...ps5TimeSlots];\n                            newSlots[index].endTime = e.target.value;\n                            setPs5TimeSlots(newSlots);\n                          }}\n                          data-testid={`input-ps5-end-${index}`}\n                        />\n                      </div>\n                    </div>\n                    <Button\n                      size=\"icon\"\n                      variant=\"ghost\"\n                      onClick={() => removePs5TimeSlot(index)}\n                      className=\"mt-5\"\n                      data-testid={`button-remove-ps5-timeslot-${index}`}\n                    >\n                      <X className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              ))}\n              <Button variant=\"outline\" className=\"w-full\" onClick={addPs5TimeSlot} data-testid=\"button-add-ps5-timeslot\">\n                + Add Time Slot\n              </Button>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n\n      {/* Happy Hours Pricing */}\n      <div>\n        <h2 className=\"text-2xl font-bold mb-4\">Happy Hours Pricing</h2>\n        <p className=\"text-sm text-muted-foreground mb-4\">\n          Set pricing tiers that apply during happy hours time slots. These prices are active only when happy hours are enabled and within the configured time periods.\n        </p>\n        <div className=\"grid gap-4 md:grid-cols-2\">\n          <HappyHoursPricing category=\"PC\" slots={pcHappyHoursPricing} onUpdateSlots={setPcHappyHoursPricing} />\n          <HappyHoursPricing category=\"PS5\" slots={ps5HappyHoursPricing} onUpdateSlots={setPs5HappyHoursPricing} />\n        </div>\n      </div>\n\n      <Separator className=\"my-8\" />\n\n      {/* Profile Management */}\n      <div>\n        <h2 className=\"text-2xl font-bold mb-4 flex items-center gap-2\">\n          <User className=\"h-6 w-6\" />\n          Profile Management\n        </h2>\n        <p className=\"text-sm text-muted-foreground mb-4\">\n          Update your profile information and change your password.\n        </p>\n        <div className=\"grid gap-4 md:grid-cols-2\">\n          {/* Profile Information Card */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <User className=\"h-5 w-5\" />\n                Profile Information\n              </CardTitle>\n              <CardDescription>Update your account details</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              {profile && (\n                <div className=\"mb-4\">\n                  <Badge variant=\"secondary\" data-testid=\"badge-user-role\">\n                    {profile.role.toUpperCase()}\n                  </Badge>\n                </div>\n              )}\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"profile-username\">Username</Label>\n                <Input\n                  id=\"profile-username\"\n                  value={profileForm.username}\n                  onChange={(e) => setProfileForm({ ...profileForm, username: e.target.value })}\n                  placeholder=\"Enter username\"\n                  data-testid=\"input-profile-username\"\n                />\n              </div>\n            </CardContent>\n            <CardFooter>\n              <Button \n                onClick={handleUpdateProfile} \n                disabled={updateProfileMutation.isPending}\n                data-testid=\"button-update-profile\"\n              >\n                {updateProfileMutation.isPending ? \"Saving...\" : \"Update Profile\"}\n              </Button>\n            </CardFooter>\n          </Card>\n\n          {/* Change Password Card */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Lock className=\"h-5 w-5\" />\n                Change Password\n              </CardTitle>\n              <CardDescription>Update your account password</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"current-password\">Current Password</Label>\n                <div className=\"relative\">\n                  <Input\n                    id=\"current-password\"\n                    type={showCurrentPassword ? \"text\" : \"password\"}\n                    value={passwordForm.currentPassword}\n                    onChange={(e) => setPasswordForm({ ...passwordForm, currentPassword: e.target.value })}\n                    placeholder=\"Enter current password\"\n                    data-testid=\"input-current-password\"\n                  />\n                  <Button\n                    type=\"button\"\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    className=\"absolute right-0 top-0\"\n                    onClick={() => setShowCurrentPassword(!showCurrentPassword)}\n                    data-testid=\"button-toggle-current-password\"\n                  >\n                    {showCurrentPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                  </Button>\n                </div>\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"new-password\">New Password</Label>\n                <div className=\"relative\">\n                  <Input\n                    id=\"new-password\"\n                    type={showNewPassword ? \"text\" : \"password\"}\n                    value={passwordForm.newPassword}\n                    onChange={(e) => setPasswordForm({ ...passwordForm, newPassword: e.target.value })}\n                    placeholder=\"Enter new password (min 8 characters)\"\n                    data-testid=\"input-new-password\"\n                  />\n                  <Button\n                    type=\"button\"\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    className=\"absolute right-0 top-0\"\n                    onClick={() => setShowNewPassword(!showNewPassword)}\n                    data-testid=\"button-toggle-new-password\"\n                  >\n                    {showNewPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                  </Button>\n                </div>\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"confirm-password\">Confirm New Password</Label>\n                <div className=\"relative\">\n                  <Input\n                    id=\"confirm-password\"\n                    type={showConfirmPassword ? \"text\" : \"password\"}\n                    value={passwordForm.confirmPassword}\n                    onChange={(e) => setPasswordForm({ ...passwordForm, confirmPassword: e.target.value })}\n                    placeholder=\"Confirm new password\"\n                    data-testid=\"input-confirm-password\"\n                  />\n                  <Button\n                    type=\"button\"\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    className=\"absolute right-0 top-0\"\n                    onClick={() => setShowConfirmPassword(!showConfirmPassword)}\n                    data-testid=\"button-toggle-confirm-password\"\n                  >\n                    {showConfirmPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                  </Button>\n                </div>\n              </div>\n            </CardContent>\n            <CardFooter>\n              <Button \n                onClick={handleChangePassword} \n                disabled={changePasswordMutation.isPending || !passwordForm.currentPassword || !passwordForm.newPassword || !passwordForm.confirmPassword}\n                data-testid=\"button-change-password\"\n              >\n                {changePasswordMutation.isPending ? \"Changing...\" : \"Change Password\"}\n              </Button>\n            </CardFooter>\n          </Card>\n        </div>\n      </div>\n\n      {/* Staff Management (Admin only - only render when auth is loaded and user is confirmed admin) */}\n      {isAuthLoaded && isAdmin && (\n        <>\n          <Separator className=\"my-8\" />\n          <div>\n            <div className=\"flex items-center justify-between flex-wrap gap-4 mb-4\">\n              <div>\n                <h2 className=\"text-2xl font-bold flex items-center gap-2\">\n                  <Users className=\"h-6 w-6\" />\n                  Staff Management\n                </h2>\n                <p className=\"text-sm text-muted-foreground\">\n                  Manage staff accounts - add, edit, or remove staff members.\n                </p>\n              </div>\n              <Dialog open={isAddStaffDialogOpen} onOpenChange={setIsAddStaffDialogOpen}>\n                <DialogTrigger asChild>\n                  <Button data-testid=\"button-add-staff\">\n                    <Plus className=\"h-4 w-4 mr-2\" />\n                    Add Staff Member\n                  </Button>\n                </DialogTrigger>\n                <DialogContent>\n                  <DialogHeader>\n                    <DialogTitle>Add New Staff Member</DialogTitle>\n                    <DialogDescription>\n                      Create a new staff account. Staff members can manage sessions and view reports.\n                    </DialogDescription>\n                  </DialogHeader>\n                  <div className=\"space-y-4 py-4\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"new-staff-username\">Username *</Label>\n                      <Input\n                        id=\"new-staff-username\"\n                        value={newStaffForm.username}\n                        onChange={(e) => setNewStaffForm({ ...newStaffForm, username: e.target.value })}\n                        placeholder=\"Enter username\"\n                        data-testid=\"input-new-staff-username\"\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"new-staff-password\">Password *</Label>\n                      <div className=\"relative\">\n                        <Input\n                          id=\"new-staff-password\"\n                          type={showNewStaffPassword ? \"text\" : \"password\"}\n                          value={newStaffForm.password}\n                          onChange={(e) => setNewStaffForm({ ...newStaffForm, password: e.target.value })}\n                          placeholder=\"Enter password (min 8 characters)\"\n                          data-testid=\"input-new-staff-password\"\n                        />\n                        <Button\n                          type=\"button\"\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          className=\"absolute right-0 top-0\"\n                          onClick={() => setShowNewStaffPassword(!showNewStaffPassword)}\n                        >\n                          {showNewStaffPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                        </Button>\n                      </div>\n                    </div>\n                  </div>\n                  <DialogFooter>\n                    <Button variant=\"outline\" onClick={() => setIsAddStaffDialogOpen(false)}>\n                      Cancel\n                    </Button>\n                    <Button \n                      onClick={handleCreateStaff} \n                      disabled={createStaffMutation.isPending}\n                      data-testid=\"button-confirm-add-staff\"\n                    >\n                      {createStaffMutation.isPending ? \"Creating...\" : \"Create Staff\"}\n                    </Button>\n                  </DialogFooter>\n                </DialogContent>\n              </Dialog>\n            </div>\n\n            {/* Staff List */}\n            <div className=\"grid gap-4\">\n              {staffLoading ? (\n                <Card>\n                  <CardContent className=\"p-6\">\n                    <p className=\"text-muted-foreground text-center\">Loading staff members...</p>\n                  </CardContent>\n                </Card>\n              ) : staffMembers && staffMembers.length > 0 ? (\n                staffMembers.map((staff) => (\n                  <Card key={staff.id} data-testid={`card-staff-${staff.id}`}>\n                    <CardContent className=\"p-4\">\n                      <div className=\"flex items-center justify-between flex-wrap gap-4\">\n                        <div className=\"flex items-center gap-4\">\n                          <div className=\"h-10 w-10 rounded-full bg-secondary flex items-center justify-center\">\n                            <User className=\"h-5 w-5\" />\n                          </div>\n                          <div>\n                            <div className=\"flex items-center gap-2\">\n                              <p className=\"font-medium\" data-testid={`text-staff-username-${staff.id}`}>\n                                {staff.username}\n                              </p>\n                              <Badge variant=\"outline\" className=\"text-xs\">Staff</Badge>\n                            </div>\n                            <p className=\"text-sm text-muted-foreground\">\n                              Staff member\n                            </p>\n                          </div>\n                        </div>\n                        <div className=\"flex items-center gap-2 flex-wrap\">\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => handleEditStaff(staff)}\n                            data-testid={`button-edit-staff-${staff.id}`}\n                          >\n                            <Edit className=\"h-4 w-4 mr-1\" />\n                            Edit\n                          </Button>\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => handleResetStaffPassword(staff)}\n                            data-testid={`button-reset-password-${staff.id}`}\n                          >\n                            <Lock className=\"h-4 w-4 mr-1\" />\n                            Reset Password\n                          </Button>\n                          <Button\n                            variant=\"destructive\"\n                            size=\"sm\"\n                            onClick={() => handleDeleteStaff(staff)}\n                            data-testid={`button-delete-staff-${staff.id}`}\n                          >\n                            <Trash2 className=\"h-4 w-4 mr-1\" />\n                            Delete\n                          </Button>\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))\n              ) : (\n                <Card>\n                  <CardContent className=\"p-6\">\n                    <p className=\"text-muted-foreground text-center\">No staff members found. Add your first staff member above.</p>\n                  </CardContent>\n                </Card>\n              )}\n            </div>\n          </div>\n\n          {/* Edit Staff Dialog */}\n          <Dialog open={isEditStaffDialogOpen} onOpenChange={setIsEditStaffDialogOpen}>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>Edit Staff Member</DialogTitle>\n                <DialogDescription>\n                  Update staff member information.\n                </DialogDescription>\n              </DialogHeader>\n              <div className=\"space-y-4 py-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"edit-staff-username\">Username</Label>\n                  <Input\n                    id=\"edit-staff-username\"\n                    value={editStaffForm.username}\n                    onChange={(e) => setEditStaffForm({ ...editStaffForm, username: e.target.value })}\n                    placeholder=\"Enter username\"\n                    data-testid=\"input-edit-staff-username\"\n                  />\n                </div>\n              </div>\n              <DialogFooter>\n                <Button variant=\"outline\" onClick={() => setIsEditStaffDialogOpen(false)}>\n                  Cancel\n                </Button>\n                <Button \n                  onClick={handleUpdateStaff} \n                  disabled={updateStaffMutation.isPending}\n                  data-testid=\"button-confirm-edit-staff\"\n                >\n                  {updateStaffMutation.isPending ? \"Saving...\" : \"Save Changes\"}\n                </Button>\n              </DialogFooter>\n            </DialogContent>\n          </Dialog>\n\n          {/* Reset Password Dialog */}\n          <Dialog open={isResetPasswordDialogOpen} onOpenChange={setIsResetPasswordDialogOpen}>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>Reset Staff Password</DialogTitle>\n                <DialogDescription>\n                  Enter a new password for this staff member.\n                </DialogDescription>\n              </DialogHeader>\n              <div className=\"space-y-4 py-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"reset-staff-password\">New Password</Label>\n                  <div className=\"relative\">\n                    <Input\n                      id=\"reset-staff-password\"\n                      type={showResetStaffPassword ? \"text\" : \"password\"}\n                      value={resetPasswordForm.newPassword}\n                      onChange={(e) => setResetPasswordForm({ ...resetPasswordForm, newPassword: e.target.value })}\n                      placeholder=\"Enter new password (min 8 characters)\"\n                      data-testid=\"input-reset-staff-password\"\n                    />\n                    <Button\n                      type=\"button\"\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      className=\"absolute right-0 top-0\"\n                      onClick={() => setShowResetStaffPassword(!showResetStaffPassword)}\n                    >\n                      {showResetStaffPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                    </Button>\n                  </div>\n                </div>\n              </div>\n              <DialogFooter>\n                <Button variant=\"outline\" onClick={() => setIsResetPasswordDialogOpen(false)}>\n                  Cancel\n                </Button>\n                <Button \n                  onClick={handleConfirmResetPassword} \n                  disabled={resetStaffPasswordMutation.isPending}\n                  data-testid=\"button-confirm-reset-password\"\n                >\n                  {resetStaffPasswordMutation.isPending ? \"Resetting...\" : \"Reset Password\"}\n                </Button>\n              </DialogFooter>\n            </DialogContent>\n          </Dialog>\n\n          {/* Delete Confirmation Dialog */}\n          <Dialog open={isDeleteDialogOpen} onOpenChange={setIsDeleteDialogOpen}>\n            <DialogContent>\n              <DialogHeader>\n                <DialogTitle>Delete Staff Member</DialogTitle>\n                <DialogDescription>\n                  Are you sure you want to delete this staff member? This action cannot be undone.\n                </DialogDescription>\n              </DialogHeader>\n              {staffToDelete && (\n                <div className=\"py-4\">\n                  <p className=\"text-sm\">\n                    You are about to delete <strong>{staffToDelete.username}</strong>.\n                  </p>\n                </div>\n              )}\n              <DialogFooter>\n                <Button variant=\"outline\" onClick={() => setIsDeleteDialogOpen(false)}>\n                  Cancel\n                </Button>\n                <Button \n                  variant=\"destructive\"\n                  onClick={handleConfirmDelete} \n                  disabled={deleteStaffMutation.isPending}\n                  data-testid=\"button-confirm-delete-staff\"\n                >\n                  {deleteStaffMutation.isPending ? \"Deleting...\" : \"Delete Staff\"}\n                </Button>\n              </DialogFooter>\n            </DialogContent>\n          </Dialog>\n        </>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":50475,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1202,"size_tokens":null},"server/index-electron.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport helmet from \"helmet\";\nimport cors from \"cors\";\nimport cookieParser from \"cookie-parser\";\nimport session from \"express-session\";\nimport path from \"path\";\nimport fs from \"fs\";\nimport { fileURLToPath } from \"url\";\nimport passport from \"passport\";\nimport { Strategy as LocalStrategy } from \"passport-local\";\nimport bcrypt from \"bcryptjs\";\nimport { db, initializeSqliteDatabase, sqlite } from \"./db-sqlite\";\nimport * as schema from \"../shared/schema-sqlite\";\nimport { eq } from \"drizzle-orm\";\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\ninitializeSqliteDatabase();\n\nconst app = express();\n\napp.use(cors({\n  origin: true,\n  credentials: true,\n  methods: ['GET', 'POST', 'PUT', 'DELETE', 'PATCH'],\n  allowedHeaders: ['Content-Type', 'Authorization']\n}));\n\napp.use(\n  helmet({\n    contentSecurityPolicy: false,\n    crossOriginEmbedderPolicy: false,\n  })\n);\n\napp.use(express.json({ limit: '10mb' }));\napp.use(express.urlencoded({ extended: false, limit: '10mb' }));\napp.use(cookieParser());\n\nconst MemoryStore = session.MemoryStore;\n\napp.use(session({\n  store: new MemoryStore(),\n  secret: 'airavoto-gaming-pos-offline-secret-key-' + Date.now(),\n  resave: false,\n  saveUninitialized: false,\n  cookie: {\n    secure: false,\n    httpOnly: true,\n    maxAge: 24 * 60 * 60 * 1000,\n    sameSite: 'lax'\n  }\n}));\n\napp.use(passport.initialize());\napp.use(passport.session());\n\npassport.use(new LocalStrategy(\n  async (username: string, password: string, done: (error: any, user?: any, options?: { message: string }) => void) => {\n    try {\n      const [user] = await db.select().from(schema.users).where(eq(schema.users.username, username));\n      if (!user) {\n        return done(null, false, { message: 'Invalid username or password' });\n      }\n      if (!user.passwordHash) {\n        return done(null, false, { message: 'Invalid username or password' });\n      }\n      const isValid = await bcrypt.compare(password, user.passwordHash);\n      if (!isValid) {\n        return done(null, false, { message: 'Invalid username or password' });\n      }\n      return done(null, user);\n    } catch (error) {\n      return done(error);\n    }\n  }\n));\n\npassport.serializeUser((user: any, done) => {\n  done(null, user.id);\n});\n\npassport.deserializeUser(async (id: string, done) => {\n  try {\n    const [user] = await db.select().from(schema.users).where(eq(schema.users.id, id));\n    done(null, user || null);\n  } catch (error) {\n    done(error, null);\n  }\n});\n\nfunction isAuthenticated(req: Request, res: Response, next: NextFunction) {\n  if (req.isAuthenticated()) {\n    return next();\n  }\n  res.status(401).json({ message: 'Not authenticated' });\n}\n\nfunction isAdmin(req: Request, res: Response, next: NextFunction) {\n  if (req.isAuthenticated() && (req.user as any)?.role === 'admin') {\n    return next();\n  }\n  res.status(403).json({ message: 'Admin access required' });\n}\n\napp.post('/api/auth/login', passport.authenticate('local'), (req, res) => {\n  const user = req.user as any;\n  res.json({\n    id: user.id,\n    username: user.username,\n    role: user.role,\n    onboardingCompleted: user.onboardingCompleted === 1,\n    profileImageUrl: user.profileImageUrl\n  });\n});\n\napp.post('/api/auth/logout', (req, res) => {\n  req.logout((err) => {\n    if (err) {\n      return res.status(500).json({ message: 'Logout failed' });\n    }\n    res.json({ message: 'Logged out successfully' });\n  });\n});\n\napp.get('/api/auth/me', (req, res) => {\n  if (req.isAuthenticated()) {\n    const user = req.user as any;\n    res.json({\n      id: user.id,\n      username: user.username,\n      role: user.role,\n      onboardingCompleted: user.onboardingCompleted === 1,\n      profileImageUrl: user.profileImageUrl\n    });\n  } else {\n    res.status(401).json({ message: 'Not authenticated' });\n  }\n});\n\napp.get('/api/health', (req, res) => {\n  res.json({ \n    status: 'ok', \n    timestamp: new Date().toISOString(),\n    mode: 'offline',\n    database: 'sqlite'\n  });\n});\n\napp.get('/api/bookings', isAuthenticated, async (req, res) => {\n  try {\n    const bookings = await db.select().from(schema.bookings);\n    const parsedBookings = bookings.map(b => ({\n      ...b,\n      bookingType: JSON.parse(b.bookingType || '[]'),\n      foodOrders: JSON.parse(b.foodOrders || '[]'),\n      lastPaymentAction: b.lastPaymentAction ? JSON.parse(b.lastPaymentAction) : null,\n      promotionDetails: b.promotionDetails ? JSON.parse(b.promotionDetails) : null,\n    }));\n    res.json(parsedBookings);\n  } catch (error) {\n    console.error('Error fetching bookings:', error);\n    res.status(500).json({ message: 'Failed to fetch bookings' });\n  }\n});\n\napp.post('/api/bookings', isAuthenticated, async (req, res) => {\n  try {\n    const bookingData = {\n      ...req.body,\n      bookingType: JSON.stringify(req.body.bookingType || []),\n      foodOrders: JSON.stringify(req.body.foodOrders || []),\n      lastPaymentAction: req.body.lastPaymentAction ? JSON.stringify(req.body.lastPaymentAction) : null,\n      promotionDetails: req.body.promotionDetails ? JSON.stringify(req.body.promotionDetails) : null,\n      startTime: new Date(req.body.startTime),\n      endTime: new Date(req.body.endTime),\n    };\n    const [booking] = await db.insert(schema.bookings).values(bookingData).returning();\n    res.json({\n      ...booking,\n      bookingType: JSON.parse(booking.bookingType || '[]'),\n      foodOrders: JSON.parse(booking.foodOrders || '[]'),\n    });\n  } catch (error) {\n    console.error('Error creating booking:', error);\n    res.status(500).json({ message: 'Failed to create booking' });\n  }\n});\n\napp.patch('/api/bookings/:id', isAuthenticated, async (req, res) => {\n  try {\n    const { id } = req.params;\n    const updateData: any = { ...req.body };\n    if (req.body.bookingType) {\n      updateData.bookingType = JSON.stringify(req.body.bookingType);\n    }\n    if (req.body.foodOrders) {\n      updateData.foodOrders = JSON.stringify(req.body.foodOrders);\n    }\n    if (req.body.lastPaymentAction) {\n      updateData.lastPaymentAction = JSON.stringify(req.body.lastPaymentAction);\n    }\n    if (req.body.promotionDetails) {\n      updateData.promotionDetails = JSON.stringify(req.body.promotionDetails);\n    }\n    if (req.body.startTime) {\n      updateData.startTime = new Date(req.body.startTime);\n    }\n    if (req.body.endTime) {\n      updateData.endTime = new Date(req.body.endTime);\n    }\n    const [booking] = await db.update(schema.bookings).set(updateData).where(eq(schema.bookings.id, id)).returning();\n    if (!booking) {\n      return res.status(404).json({ message: 'Booking not found' });\n    }\n    res.json({\n      ...booking,\n      bookingType: JSON.parse(booking.bookingType || '[]'),\n      foodOrders: JSON.parse(booking.foodOrders || '[]'),\n    });\n  } catch (error) {\n    console.error('Error updating booking:', error);\n    res.status(500).json({ message: 'Failed to update booking' });\n  }\n});\n\napp.delete('/api/bookings/:id', isAuthenticated, async (req, res) => {\n  try {\n    const { id } = req.params;\n    await db.delete(schema.bookings).where(eq(schema.bookings.id, id));\n    res.json({ success: true });\n  } catch (error) {\n    console.error('Error deleting booking:', error);\n    res.status(500).json({ message: 'Failed to delete booking' });\n  }\n});\n\napp.get('/api/device-configs', isAuthenticated, async (req, res) => {\n  try {\n    const configs = await db.select().from(schema.deviceConfigs);\n    const parsedConfigs = configs.map(c => ({\n      ...c,\n      seats: JSON.parse(c.seats || '[]'),\n    }));\n    res.json(parsedConfigs);\n  } catch (error) {\n    console.error('Error fetching device configs:', error);\n    res.status(500).json({ message: 'Failed to fetch device configs' });\n  }\n});\n\napp.post('/api/device-configs', isAdmin, async (req, res) => {\n  try {\n    const configData = {\n      ...req.body,\n      seats: JSON.stringify(req.body.seats || []),\n    };\n    const [config] = await db.insert(schema.deviceConfigs).values(configData).returning();\n    res.json({\n      ...config,\n      seats: JSON.parse(config.seats || '[]'),\n    });\n  } catch (error) {\n    console.error('Error creating device config:', error);\n    res.status(500).json({ message: 'Failed to create device config' });\n  }\n});\n\napp.get('/api/pricing-configs', isAuthenticated, async (req, res) => {\n  try {\n    const configs = await db.select().from(schema.pricingConfigs);\n    res.json(configs);\n  } catch (error) {\n    console.error('Error fetching pricing configs:', error);\n    res.status(500).json({ message: 'Failed to fetch pricing configs' });\n  }\n});\n\napp.get('/api/food-items', isAuthenticated, async (req, res) => {\n  try {\n    const items = await db.select().from(schema.foodItems);\n    res.json(items);\n  } catch (error) {\n    console.error('Error fetching food items:', error);\n    res.status(500).json({ message: 'Failed to fetch food items' });\n  }\n});\n\napp.post('/api/food-items', isAuthenticated, async (req, res) => {\n  try {\n    const [item] = await db.insert(schema.foodItems).values(req.body).returning();\n    res.json(item);\n  } catch (error) {\n    console.error('Error creating food item:', error);\n    res.status(500).json({ message: 'Failed to create food item' });\n  }\n});\n\napp.patch('/api/food-items/:id', isAuthenticated, async (req, res) => {\n  try {\n    const { id } = req.params;\n    const [item] = await db.update(schema.foodItems).set(req.body).where(eq(schema.foodItems.id, id)).returning();\n    if (!item) {\n      return res.status(404).json({ message: 'Food item not found' });\n    }\n    res.json(item);\n  } catch (error) {\n    console.error('Error updating food item:', error);\n    res.status(500).json({ message: 'Failed to update food item' });\n  }\n});\n\napp.delete('/api/food-items/:id', isAuthenticated, async (req, res) => {\n  try {\n    const { id } = req.params;\n    await db.delete(schema.foodItems).where(eq(schema.foodItems.id, id));\n    res.json({ success: true });\n  } catch (error) {\n    console.error('Error deleting food item:', error);\n    res.status(500).json({ message: 'Failed to delete food item' });\n  }\n});\n\napp.get('/api/users', isAdmin, async (req, res) => {\n  try {\n    const allUsers = await db.select().from(schema.users);\n    const safeUsers = allUsers.map(u => ({\n      id: u.id,\n      username: u.username,\n      role: u.role,\n      onboardingCompleted: u.onboardingCompleted === 1,\n      profileImageUrl: u.profileImageUrl,\n      createdAt: u.createdAt,\n    }));\n    res.json(safeUsers);\n  } catch (error) {\n    console.error('Error fetching users:', error);\n    res.status(500).json({ message: 'Failed to fetch users' });\n  }\n});\n\napp.post('/api/users', isAdmin, async (req, res) => {\n  try {\n    const { username, password, role } = req.body;\n    const passwordHash = await bcrypt.hash(password, 10);\n    const [user] = await db.insert(schema.users).values({\n      username,\n      passwordHash,\n      role: role || 'staff',\n    }).returning();\n    res.json({\n      id: user.id,\n      username: user.username,\n      role: user.role,\n      onboardingCompleted: user.onboardingCompleted === 1,\n    });\n  } catch (error) {\n    console.error('Error creating user:', error);\n    res.status(500).json({ message: 'Failed to create user' });\n  }\n});\n\napp.delete('/api/users/:id', isAdmin, async (req, res) => {\n  try {\n    const { id } = req.params;\n    await db.delete(schema.users).where(eq(schema.users.id, id));\n    res.json({ success: true });\n  } catch (error) {\n    console.error('Error deleting user:', error);\n    res.status(500).json({ message: 'Failed to delete user' });\n  }\n});\n\napp.get('/api/expenses', isAuthenticated, async (req, res) => {\n  try {\n    const allExpenses = await db.select().from(schema.expenses);\n    res.json(allExpenses);\n  } catch (error) {\n    console.error('Error fetching expenses:', error);\n    res.status(500).json({ message: 'Failed to fetch expenses' });\n  }\n});\n\napp.post('/api/expenses', isAuthenticated, async (req, res) => {\n  try {\n    const expenseData = {\n      ...req.body,\n      date: new Date(req.body.date),\n    };\n    const [expense] = await db.insert(schema.expenses).values(expenseData).returning();\n    res.json(expense);\n  } catch (error) {\n    console.error('Error creating expense:', error);\n    res.status(500).json({ message: 'Failed to create expense' });\n  }\n});\n\napp.get('/api/notifications', isAuthenticated, async (req, res) => {\n  try {\n    const allNotifications = await db.select().from(schema.notifications);\n    res.json(allNotifications);\n  } catch (error) {\n    console.error('Error fetching notifications:', error);\n    res.status(500).json({ message: 'Failed to fetch notifications' });\n  }\n});\n\napp.get('/api/staff-visibility', isAuthenticated, async (req, res) => {\n  try {\n    const [settings] = await db.select().from(schema.staffVisibilitySettings);\n    if (settings) {\n      res.json({\n        ...settings,\n        pages: JSON.parse(settings.pages),\n        elements: JSON.parse(settings.elements),\n      });\n    } else {\n      res.json({\n        pages: {\n          dashboard: true,\n          bookings: true,\n          history: true,\n          food: true,\n          inventory: false,\n          expenses: false,\n          ledger: false,\n          analytics: false,\n          maintenance: false,\n          settings: false,\n        },\n        elements: {\n          customerPhone: true,\n          paymentDetails: true,\n          revenueNumbers: false,\n          expenseAmounts: false,\n          profitLoss: false,\n          costPrices: false,\n        },\n      });\n    }\n  } catch (error) {\n    console.error('Error fetching staff visibility:', error);\n    res.status(500).json({ message: 'Failed to fetch staff visibility settings' });\n  }\n});\n\nasync function initializeDefaultData() {\n  try {\n    const existingDevices = await db.select().from(schema.deviceConfigs);\n    const existingUsers = await db.select().from(schema.users);\n\n    if (existingDevices.length === 0) {\n      await db.insert(schema.deviceConfigs).values([\n        { category: \"PC\", count: 5, seats: JSON.stringify([\"PC-1\", \"PC-2\", \"PC-3\", \"PC-4\", \"PC-5\"]) },\n        { category: \"PS5\", count: 3, seats: JSON.stringify([\"PS5-1\", \"PS5-2\", \"PS5-3\"]) }\n      ]);\n\n      await db.insert(schema.pricingConfigs).values([\n        { category: \"PC\", duration: \"30 mins\", price: \"10\" },\n        { category: \"PC\", duration: \"1 hour\", price: \"18\" },\n        { category: \"PC\", duration: \"2 hours\", price: \"30\" },\n        { category: \"PS5\", duration: \"30 mins\", price: \"15\" },\n        { category: \"PS5\", duration: \"1 hour\", price: \"25\" },\n        { category: \"PS5\", duration: \"2 hours\", price: \"45\" }\n      ]);\n\n      await db.insert(schema.foodItems).values([\n        { name: \"Pizza\", price: \"8\" },\n        { name: \"Burger\", price: \"6\" },\n        { name: \"Fries\", price: \"3\" },\n        { name: \"Soda\", price: \"2\" },\n        { name: \"Water\", price: \"1\" },\n      ]);\n\n      console.log('Default data initialized');\n    }\n\n    if (existingUsers.length === 0) {\n      const adminPasswordHash = await bcrypt.hash('admin123', 10);\n      await db.insert(schema.users).values({\n        username: 'admin',\n        passwordHash: adminPasswordHash,\n        role: 'admin',\n      });\n      console.log('Default admin user created (username: admin, password: admin123)');\n      console.log('IMPORTANT: Please change the admin password after first login!');\n    }\n  } catch (error) {\n    console.error('Error initializing default data:', error);\n  }\n}\n\nfunction getDistPath(): string {\n  const possiblePaths = [\n    path.join(__dirname, '../dist'),\n    path.join(__dirname, '../../dist'),\n    path.join(process.cwd(), 'dist'),\n    path.join(process.cwd(), 'resources', 'app', 'dist-electron', 'dist'),\n  ];\n  \n  for (const p of possiblePaths) {\n    if (fs.existsSync(p) && fs.existsSync(path.join(p, 'index.html'))) {\n      console.log('Using dist path:', p);\n      return p;\n    }\n  }\n  \n  console.log('Falling back to default dist path:', possiblePaths[0]);\n  return possiblePaths[0];\n}\n\nconst distPath = getDistPath();\napp.use(express.static(distPath));\n\napp.get('*', (req, res) => {\n  if (!req.path.startsWith('/api')) {\n    const indexPath = path.join(distPath, 'index.html');\n    if (fs.existsSync(indexPath)) {\n      res.sendFile(indexPath);\n    } else {\n      res.status(404).send('Frontend not found. Please ensure the app is built correctly.');\n    }\n  }\n});\n\napp.use((err: any, req: Request, res: Response, _next: NextFunction) => {\n  console.error('Error:', err);\n  res.status(err.status || 500).json({\n    message: err.message || 'An internal error occurred'\n  });\n});\n\nconst PORT = parseInt(process.env.PORT || '5000', 10);\n\ninitializeDefaultData().then(() => {\n  app.listen(PORT, '127.0.0.1', () => {\n    console.log(`Airavoto Gaming POS server running on http://127.0.0.1:${PORT}`);\n    console.log('Mode: Offline (SQLite database)');\n  });\n});\n\nexport { app };\n","path":null,"size_bytes":16919,"size_tokens":null},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE - Frosted Glass Theme */\n:root {\n  --button-outline: rgba(255,255,255, 0.3);\n  --badge-outline: rgba(255,255,255, 0.2);\n  --opaque-button-border-intensity: -8;\n  --elevate-1: rgba(255,255,255, 0.15);\n  --elevate-2: rgba(255,255,255, 0.25);\n\n  --background: 220 20% 96%;\n  --foreground: 220 15% 20%;\n  --border: 220 15% 80%;\n\n  --card: 0 0% 100%;\n  --card-foreground: 220 15% 18%;\n  --card-border: 220 10% 88%;\n\n  --sidebar: 220 15% 98%;\n  --sidebar-foreground: 220 15% 20%;\n  --sidebar-border: 220 8% 90%;\n  --sidebar-primary: 270 75% 60%;\n  --sidebar-primary-foreground: 0 0% 100%;\n  --sidebar-accent: 220 12% 92%;\n  --sidebar-accent-foreground: 220 15% 25%;\n  --sidebar-ring: 270 75% 60%;\n\n  --popover: 0 0% 100%;\n  --popover-foreground: 220 12% 20%;\n  --popover-border: 220 8% 88%;\n\n  --primary: 270 75% 60%;\n  --primary-foreground: 0 0% 100%;\n\n  --secondary: 220 10% 92%;\n  --secondary-foreground: 220 15% 22%;\n\n  --muted: 220 12% 94%;\n  --muted-foreground: 220 10% 45%;\n\n  --accent: 220 15% 92%;\n  --accent-foreground: 220 15% 25%;\n\n  --destructive: 0 75% 50%;\n  --destructive-foreground: 0 0% 100%;\n\n  --input: 220 15% 85%;\n  --ring: 270 75% 60%;\n\n  --chart-1: 270 75% 60%;\n  --chart-2: 280 70% 65%;\n  --chart-3: 30 90% 55%;\n  --chart-4: 150 65% 45%;\n  --chart-5: 260 70% 55%;\n\n  --font-sans: Inter, -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: \"JetBrains Mono\", \"Consolas\", \"Monaco\", monospace;\n  --radius: 1rem;\n  \n  --shadow-2xs: 0px 1px 2px 0px rgba(0, 0, 0, 0.05);\n  --shadow-xs: 0px 1px 3px 0px rgba(0, 0, 0, 0.08);\n  --shadow-sm: 0px 2px 6px 0px rgba(0, 0, 0, 0.1);\n  --shadow: 0px 4px 12px 0px rgba(0, 0, 0, 0.12);\n  --shadow-md: 0px 8px 24px 0px rgba(0, 0, 0, 0.15);\n  --shadow-lg: 0px 16px 32px 0px rgba(0, 0, 0, 0.18);\n  --shadow-xl: 0px 24px 48px 0px rgba(0, 0, 0, 0.22);\n  --shadow-2xl: 0px 40px 64px 0px rgba(0, 0, 0, 0.25);\n\n  --glass-bg: rgba(255, 255, 255, 0.7);\n  --glass-border: rgba(255, 255, 255, 0.3);\n  --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);\n}\n\n/* DARK MODE - Frosted Glass Theme */\n.dark {\n  --button-outline: rgba(255,255,255, 0.15);\n  --badge-outline: rgba(255,255,255, 0.1);\n  --opaque-button-border-intensity: 9;\n  --elevate-1: rgba(255,255,255, 0.08);\n  --elevate-2: rgba(255,255,255, 0.15);\n\n  --background: 220 25% 8%;\n  --foreground: 0 0% 98%;\n  --border: 220 15% 25%;\n\n  --card: 220 20% 12%;\n  --card-foreground: 0 0% 95%;\n  --card-border: 220 12% 22%;\n\n  --sidebar: 220 20% 10%;\n  --sidebar-foreground: 0 0% 95%;\n  --sidebar-border: 220 12% 18%;\n  --sidebar-primary: 270 80% 70%;\n  --sidebar-primary-foreground: 0 0% 100%;\n  --sidebar-accent: 220 15% 16%;\n  --sidebar-accent-foreground: 0 0% 90%;\n  --sidebar-ring: 270 80% 70%;\n\n  --popover: 220 20% 12%;\n  --popover-foreground: 0 0% 92%;\n  --popover-border: 220 12% 24%;\n\n  --primary: 270 80% 70%;\n  --primary-foreground: 0 0% 100%;\n\n  --secondary: 220 12% 20%;\n  --secondary-foreground: 0 0% 88%;\n\n  --muted: 220 15% 18%;\n  --muted-foreground: 0 0% 70%;\n\n  --accent: 220 15% 20%;\n  --accent-foreground: 0 0% 92%;\n\n  --destructive: 0 85% 65%;\n  --destructive-foreground: 0 0% 100%;\n\n  --input: 220 15% 30%;\n  --ring: 270 80% 70%;\n\n  --chart-1: 270 80% 70%;\n  --chart-2: 280 75% 75%;\n  --chart-3: 30 100% 60%;\n  --chart-4: 150 70% 55%;\n  --chart-5: 260 75% 65%;\n\n  --shadow-2xs: 0px 1px 2px 0px rgba(0, 0, 0, 0.3);\n  --shadow-xs: 0px 1px 3px 0px rgba(0, 0, 0, 0.4);\n  --shadow-sm: 0px 2px 6px 0px rgba(0, 0, 0, 0.5);\n  --shadow: 0px 4px 12px 0px rgba(0, 0, 0, 0.6);\n  --shadow-md: 0px 8px 24px 0px rgba(0, 0, 0, 0.7);\n  --shadow-lg: 0px 16px 32px 0px rgba(0, 0, 0, 0.75);\n  --shadow-xl: 0px 24px 48px 0px rgba(0, 0, 0, 0.8);\n  --shadow-2xl: 0px 40px 64px 0px rgba(0, 0, 0, 0.85);\n\n  --glass-bg: rgba(20, 25, 35, 0.6);\n  --glass-border: rgba(255, 255, 255, 0.1);\n  --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased text-foreground relative;\n    background: linear-gradient(135deg, hsl(var(--background)) 0%, hsl(270 20% 95%) 50%, hsl(280 25% 92%) 100%);\n    min-height: 100vh;\n  }\n\n  .dark body {\n    background: linear-gradient(135deg, hsl(var(--background)) 0%, hsl(270 30% 12%) 50%, hsl(280 35% 10%) 100%);\n  }\n\n  /* Glass morphism effect */\n  .glass {\n    background: var(--glass-bg);\n    backdrop-filter: blur(20px) saturate(180%);\n    -webkit-backdrop-filter: blur(20px) saturate(180%);\n    border: 1px solid var(--glass-border);\n    box-shadow: var(--glass-shadow);\n  }\n\n  .glass-card {\n    background: rgba(255, 255, 255, 0.75);\n    backdrop-filter: blur(16px) saturate(180%);\n    -webkit-backdrop-filter: blur(16px) saturate(180%);\n    border: 1px solid rgba(255, 255, 255, 0.25);\n    box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);\n    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  }\n\n  .dark .glass-card {\n    background: rgba(20, 25, 35, 0.65);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);\n  }\n\n  .glass-card:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 12px 48px 0 rgba(31, 38, 135, 0.22);\n  }\n\n  .dark .glass-card:hover {\n    box-shadow: 0 12px 48px 0 rgba(0, 0, 0, 0.7);\n  }\n}\n\n/* Frosted glass utilities */\n@layer utilities {\n  .glass-button {\n    @apply glass rounded-lg px-4 py-2 font-medium transition-all duration-300;\n    @apply hover:scale-105 hover:shadow-lg active:scale-95;\n  }\n\n  .glass-input {\n    @apply glass rounded-lg px-4 py-2 outline-none transition-all duration-300;\n    @apply focus:ring-2 focus:ring-primary/50 focus:border-primary;\n  }\n\n  .glass-panel {\n    @apply glass-card rounded-2xl p-6;\n  }\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  .no-default-hover-elevate {}\n  .no-default-active-elevate {}\n\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    border-radius: inherit;\n    z-index: -1;\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    border-radius: inherit;\n    z-index: 999;\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n\n  /* Animated gradient backgrounds */\n  .gradient-animate {\n    background-size: 200% 200%;\n    animation: gradient 8s ease infinite;\n  }\n\n  @keyframes gradient {\n    0% { background-position: 0% 50%; }\n    50% { background-position: 100% 50%; }\n    100% { background-position: 0% 50%; }\n  }\n\n  @keyframes flip {\n    0% {\n      transform: rotateX(0deg);\n    }\n    100% {\n      transform: rotateX(-180deg);\n    }\n  }\n\n  .animate-flip {\n    animation: flip 0.6s ease-in-out;\n  }\n\n  /* Glow effects */\n  .glow {\n    box-shadow: 0 0 20px rgba(157, 78, 221, 0.3);\n  }\n\n  .dark .glow {\n    box-shadow: 0 0 30px rgba(157, 78, 221, 0.5);\n  }\n\n  /* Custom Rounded Corner Shapes */\n  .shape-left-rounded {\n    border-radius: 2rem 0.5rem 0.5rem 2rem;\n  }\n\n  .shape-diagonal-rounded {\n    border-radius: 2rem 0.5rem 2rem 0.5rem;\n  }\n\n  .shape-right-rounded {\n    border-radius: 0.5rem 2rem 2rem 0.5rem;\n  }\n\n  .shape-top-rounded {\n    border-radius: 2rem 2rem 0.5rem 0.5rem;\n  }\n\n  .shape-bottom-rounded {\n    border-radius: 0.5rem 0.5rem 2rem 2rem;\n  }\n\n  /* Rectangular cards with custom aspect ratios */\n  .card-rectangular {\n    aspect-ratio: 3 / 2;\n    min-height: 140px;\n  }\n\n  .card-square-lg {\n    aspect-ratio: 1 / 1;\n    min-height: 160px;\n  }\n\n  /* ============================================\n     CUSTOM GAMING SCROLLBAR - MINIMAL & INNOVATIVE\n     ============================================ */\n  \n  /* Firefox */\n  * {\n    scrollbar-width: thin;\n    scrollbar-color: hsl(270 75% 60% / 0.4) transparent;\n  }\n\n  .dark * {\n    scrollbar-color: hsl(270 80% 70% / 0.5) transparent;\n  }\n\n  /* Webkit browsers (Chrome, Safari, Edge) */\n  ::-webkit-scrollbar {\n    width: 8px;\n    height: 8px;\n  }\n\n  ::-webkit-scrollbar-track {\n    background: transparent;\n    border-radius: 100px;\n  }\n\n  ::-webkit-scrollbar-thumb {\n    background: linear-gradient(\n      180deg,\n      hsl(270 75% 60% / 0.5) 0%,\n      hsl(280 80% 65% / 0.6) 50%,\n      hsl(290 70% 70% / 0.5) 100%\n    );\n    border-radius: 100px;\n    border: 2px solid transparent;\n    background-clip: padding-box;\n    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  }\n\n  ::-webkit-scrollbar-thumb:hover {\n    background: linear-gradient(\n      180deg,\n      hsl(270 75% 60% / 0.8) 0%,\n      hsl(280 80% 65% / 0.9) 50%,\n      hsl(290 70% 70% / 0.8) 100%\n    );\n    box-shadow: 0 0 12px hsl(270 75% 60% / 0.6);\n    transform: scaleX(1.2);\n  }\n\n  ::-webkit-scrollbar-thumb:active {\n    background: linear-gradient(\n      180deg,\n      hsl(270 75% 60%) 0%,\n      hsl(280 80% 65%) 50%,\n      hsl(290 70% 70%) 100%\n    );\n    box-shadow: 0 0 20px hsl(270 75% 60% / 0.8);\n  }\n\n  /* Dark mode scrollbar */\n  .dark ::-webkit-scrollbar-thumb {\n    background: linear-gradient(\n      180deg,\n      hsl(270 80% 70% / 0.6) 0%,\n      hsl(280 85% 75% / 0.7) 50%,\n      hsl(290 75% 80% / 0.6) 100%\n    );\n  }\n\n  .dark ::-webkit-scrollbar-thumb:hover {\n    background: linear-gradient(\n      180deg,\n      hsl(270 80% 70% / 0.9) 0%,\n      hsl(280 85% 75%) 50%,\n      hsl(290 75% 80% / 0.9) 100%\n    );\n    box-shadow: 0 0 16px hsl(270 80% 70% / 0.8);\n  }\n\n  .dark ::-webkit-scrollbar-thumb:active {\n    background: linear-gradient(\n      180deg,\n      hsl(270 80% 70%) 0%,\n      hsl(280 85% 75%) 50%,\n      hsl(290 75% 80%) 100%\n    );\n    box-shadow: 0 0 24px hsl(270 80% 70%);\n  }\n\n  /* Scrollbar corner (where vertical and horizontal scrollbars meet) */\n  ::-webkit-scrollbar-corner {\n    background: transparent;\n  }\n\n  /* Enhanced glow effect on scroll */\n  @keyframes scrollGlow {\n    0%, 100% { \n      box-shadow: 0 0 8px hsl(270 75% 60% / 0.4);\n    }\n    50% { \n      box-shadow: 0 0 16px hsl(270 75% 60% / 0.8);\n    }\n  }\n\n  /* Smooth scroll behavior */\n  html {\n    scroll-behavior: smooth;\n  }\n}\n","path":null,"size_bytes":11605,"size_tokens":null},"client/src/pages/ConsumerGallery.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { ImageIcon } from \"lucide-react\";\nimport type { GalleryImage } from \"@shared/schema\";\n\nexport default function ConsumerGallery() {\n  const { data: images, isLoading } = useQuery<GalleryImage[]>({\n    queryKey: [\"/api/consumer/gallery\"],\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"container mx-auto p-6 space-y-6\">\n        <Skeleton className=\"h-12 w-48\" />\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {[...Array(6)].map((_, i) => (\n            <Skeleton key={i} className=\"h-64 w-full\" />\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  if (!images || images.length === 0) {\n    return (\n      <div className=\"container mx-auto p-6 space-y-6\">\n        <h1 className=\"text-3xl font-bold\" data-testid=\"heading-gallery\">Gallery</h1>\n        <Card>\n          <CardContent className=\"flex flex-col items-center justify-center py-12\">\n            <ImageIcon className=\"h-16 w-16 text-muted-foreground mb-4\" />\n            <p className=\"text-muted-foreground text-center\">No images available yet</p>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-6 space-y-6\">\n      <h1 className=\"text-3xl md:text-4xl font-bold\" data-testid=\"heading-gallery\">Gallery</h1>\n      <p className=\"text-lg text-muted-foreground\">Explore our gaming center</p>\n      \n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n        {images.map((image) => (\n          <Card key={image.id} className=\"overflow-hidden group hover:shadow-lg transition-shadow\" data-testid={`gallery-image-${image.id}`}>\n            <CardContent className=\"p-0\">\n              <div className=\"relative aspect-video overflow-hidden bg-muted\">\n                <img\n                  src={image.imageUrl}\n                  alt={image.title}\n                  className=\"object-cover w-full h-full group-hover:scale-105 transition-transform duration-300\"\n                  data-testid={`img-${image.id}`}\n                />\n              </div>\n              <div className=\"p-4\">\n                <h3 className=\"font-semibold text-lg mb-1\" data-testid={`text-title-${image.id}`}>{image.title}</h3>\n                {image.description && (\n                  <p className=\"text-sm text-muted-foreground\" data-testid={`text-description-${image.id}`}>\n                    {image.description}\n                  </p>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":2713,"size_tokens":null},"server/replitAuth.ts":{"content":"import * as client from \"openid-client\";\nimport { Strategy, type VerifyFunction } from \"openid-client/passport\";\n\nimport passport from \"passport\";\nimport session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport memoize from \"memoizee\";\nimport connectPg from \"connect-pg-simple\";\nimport { storage } from \"./storage\";\n\n// Check if we're running in Replit environment\nconst isReplitEnvironment = !!process.env.REPL_ID || !!process.env.REPLIT_DOMAINS;\n\nconst getOidcConfig = memoize(\n  async () => {\n    return await client.discovery(\n      new URL(process.env.ISSUER_URL ?? \"https://replit.com/oidc\"),\n      process.env.REPL_ID!\n    );\n  },\n  { maxAge: 3600 * 1000 }\n);\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  return session({\n    secret: process.env.SESSION_SECRET!,\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: true,\n      maxAge: sessionTtl,\n    },\n  });\n}\n\nfunction updateUserSession(\n  user: any,\n  tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers\n) {\n  user.claims = tokens.claims();\n  user.access_token = tokens.access_token;\n  user.refresh_token = tokens.refresh_token;\n  user.expires_at = user.claims?.exp;\n}\n\nasync function upsertUser(\n  claims: any,\n) {\n  await storage.upsertUser({\n    id: claims[\"sub\"],\n    email: claims[\"email\"],\n    firstName: claims[\"first_name\"],\n    lastName: claims[\"last_name\"],\n    profileImageUrl: claims[\"profile_image_url\"],\n  });\n}\n\nexport async function setupAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  // Check if required environment variables are set for Google login\n  if (!process.env.REPLIT_DOMAINS) {\n    console.warn(\"‚ö†Ô∏è  REPLIT_DOMAINS not set - Google login will not work\");\n    console.log(\"‚ÑπÔ∏è  To enable Google login, set: REPLIT_DOMAINS, REPL_ID, and ISSUER_URL\");\n    console.log(\"‚ÑπÔ∏è  Use staff/admin login with username and password instead\");\n    return;\n  }\n\n  console.log(\"‚úÖ Setting up Google OAuth authentication...\");\n  const config = await getOidcConfig();\n\n  const verify: VerifyFunction = async (\n    tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers,\n    verified: passport.AuthenticateCallback\n  ) => {\n    const claims = tokens.claims();\n    if (!claims) {\n      return verified(new Error(\"Failed to retrieve user claims\"), false);\n    }\n    \n    const userEmail = claims[\"email\"];\n    \n    // Check if email whitelist is enabled\n    const allowedEmail = process.env.ALLOWED_EMAIL;\n    if (allowedEmail && userEmail !== allowedEmail) {\n      console.log(`Access denied for email: ${userEmail}. Only ${allowedEmail} is allowed.`);\n      return verified(new Error(\"Access denied. Your email is not authorized to use this application.\"), false);\n    }\n    \n    const user = {};\n    updateUserSession(user, tokens);\n    await upsertUser(claims);\n    verified(null, user);\n  };\n\n  for (const domain of process.env\n    .REPLIT_DOMAINS!.split(\",\")) {\n    const strategy = new Strategy(\n      {\n        name: `replitauth:${domain}`,\n        config,\n        scope: \"openid email profile offline_access\",\n        callbackURL: `https://${domain}/api/callback`,\n      },\n      verify,\n    );\n    passport.use(strategy);\n  }\n\n  passport.serializeUser((user: Express.User, cb) => cb(null, user));\n  passport.deserializeUser((user: Express.User, cb) => cb(null, user));\n\n  app.get(\"/api/login\", (req, res, next) => {\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      prompt: \"login consent\",\n      scope: [\"openid\", \"email\", \"profile\", \"offline_access\"],\n    })(req, res, next);\n  });\n\n  app.get(\"/api/callback\", (req, res, next) => {\n    passport.authenticate(`replitauth:${req.hostname}`, (err: any, user: any, info: any) => {\n      if (err) {\n        // Check if it's an access denied error\n        if (err.message && err.message.includes(\"Access denied\")) {\n          return res.redirect(\"/?error=access_denied\");\n        }\n        return res.redirect(\"/api/login\");\n      }\n      \n      if (!user) {\n        return res.redirect(\"/api/login\");\n      }\n      \n      req.logIn(user, (loginErr) => {\n        if (loginErr) {\n          return next(loginErr);\n        }\n        return res.redirect(\"/\");\n      });\n    })(req, res, next);\n  });\n\n  app.get(\"/api/logout\", (req, res) => {\n    req.logout(() => {\n      res.redirect(\n        client.buildEndSessionUrl(config, {\n          client_id: process.env.REPL_ID!,\n          post_logout_redirect_uri: `${req.protocol}://${req.hostname}`,\n        }).href\n      );\n    });\n  });\n}\n\nexport const isAuthenticated: RequestHandler = async (req, res, next) => {\n  const user = req.user as any;\n\n  if (!req.isAuthenticated() || !user.expires_at) {\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n\n  const now = Math.floor(Date.now() / 1000);\n  if (now <= user.expires_at) {\n    return next();\n  }\n\n  const refreshToken = user.refresh_token;\n  if (!refreshToken) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n\n  try {\n    const config = await getOidcConfig();\n    const tokenResponse = await client.refreshTokenGrant(config, refreshToken);\n    updateUserSession(user, tokenResponse);\n    return next();\n  } catch (error) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n};\n","path":null,"size_bytes":5682,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"client/src/components/NotificationCenter.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Bell, X, Check, CheckCheck, Trash2 } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport {\n  Sheet,\n  SheetContent,\n  SheetHeader,\n  SheetTitle,\n  SheetTrigger,\n} from \"@/components/ui/sheet\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport type { Notification } from \"@shared/schema\";\n\nexport function NotificationCenter() {\n  const [open, setOpen] = useState(false);\n  const [activeTab, setActiveTab] = useState(\"all\");\n\n  const { data: notifications = [] } = useQuery<Notification[]>({\n    queryKey: [\"/api/notifications\"],\n    refetchInterval: 10000,\n  });\n\n  const { data: unreadCountData } = useQuery<{ count: number }>({\n    queryKey: [\"/api/notifications/unread-count\"],\n    refetchInterval: 10000,\n  });\n\n  const unreadCount = unreadCountData?.count || 0;\n  \n  const visibleNotifications = notifications;\n\n  const markAsReadMutation = useMutation({\n    mutationFn: async (id: string) =>\n      apiRequest(\"PATCH\", `/api/notifications/${id}/read`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications/unread-count\"] });\n    },\n  });\n\n  const markAllAsReadMutation = useMutation({\n    mutationFn: async () =>\n      apiRequest(\"PATCH\", \"/api/notifications/read-all\"),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications/unread-count\"] });\n    },\n  });\n\n  const deleteNotificationMutation = useMutation({\n    mutationFn: async (id: string) =>\n      apiRequest(\"DELETE\", `/api/notifications/${id}`),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/notifications/unread-count\"] });\n    },\n  });\n\n  const filteredNotifications = notifications\n    .filter(n => activeTab === \"unread\" ? n.isRead === 0 : true);\n\n  const groupedNotifications = filteredNotifications.reduce((groups, notification) => {\n    const notificationDate = new Date(notification.createdAt);\n    const today = new Date();\n    const yesterday = new Date(today);\n    yesterday.setDate(yesterday.getDate() - 1);\n\n    let group = \"Older\";\n    if (notificationDate.toDateString() === today.toDateString()) {\n      group = \"Today\";\n    } else if (notificationDate.toDateString() === yesterday.toDateString()) {\n      group = \"Yesterday\";\n    }\n\n    if (!groups[group]) {\n      groups[group] = [];\n    }\n    groups[group].push(notification);\n    return groups;\n  }, {} as Record<string, Notification[]>);\n\n  const getNotificationIcon = (type: string) => {\n    switch (type) {\n      case \"booking\":\n        return \"üìÖ\";\n      case \"payment\":\n        return \"üí∞\";\n      case \"inventory\":\n        return \"üì¶\";\n      case \"activity\":\n        return \"üìù\";\n      case \"expense\":\n        return \"üí≥\";\n      case \"alert\":\n        return \"‚ö†Ô∏è\";\n      default:\n        return \"üîî\";\n    }\n  };\n\n  return (\n    <Sheet open={open} onOpenChange={setOpen}>\n      <SheetTrigger asChild>\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          className=\"relative\"\n          data-testid=\"button-notifications\"\n        >\n          <Bell className=\"h-5 w-5\" />\n          {unreadCount > 0 && (\n            <Badge\n              variant=\"destructive\"\n              className=\"absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center p-0 text-xs\"\n              data-testid=\"badge-unread-count\"\n            >\n              {unreadCount > 9 ? \"9+\" : unreadCount}\n            </Badge>\n          )}\n        </Button>\n      </SheetTrigger>\n      <SheetContent className=\"w-full sm:max-w-md p-0\">\n        <SheetHeader className=\"p-4 border-b\">\n          <div className=\"flex items-center justify-between\">\n            <SheetTitle>Notifications</SheetTitle>\n            {unreadCount > 0 && (\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => markAllAsReadMutation.mutate()}\n                className=\"h-8 text-xs\"\n                data-testid=\"button-mark-all-read\"\n              >\n                <CheckCheck className=\"h-4 w-4 mr-1\" />\n                Mark all as read\n              </Button>\n            )}\n          </div>\n        </SheetHeader>\n\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n          <div className=\"px-4 pt-2\">\n            <TabsList className=\"grid w-full grid-cols-2\">\n              <TabsTrigger value=\"all\" data-testid=\"tab-all-notifications\">\n                All notifications\n                {visibleNotifications.length > 0 && (\n                  <Badge variant=\"secondary\" className=\"ml-2\">\n                    {visibleNotifications.length}\n                  </Badge>\n                )}\n              </TabsTrigger>\n              <TabsTrigger value=\"unread\" data-testid=\"tab-unread-notifications\">\n                Unread\n              </TabsTrigger>\n            </TabsList>\n          </div>\n\n          <TabsContent value={activeTab} className=\"m-0 mt-2\">\n            <ScrollArea className=\"h-[calc(100vh-140px)]\">\n              {filteredNotifications.length === 0 ? (\n                <div className=\"flex flex-col items-center justify-center py-12 text-center text-muted-foreground\">\n                  <Bell className=\"h-12 w-12 mb-4 opacity-20\" />\n                  <p className=\"text-sm\">\n                    {activeTab === \"unread\" \n                      ? \"No unread notifications\" \n                      : \"No notifications yet\"}\n                  </p>\n                </div>\n              ) : (\n                <div className=\"space-y-4\">\n                  {Object.entries(groupedNotifications).map(([group, groupNotifications]) => (\n                    <div key={group} className=\"px-4\">\n                      <p className=\"text-xs text-muted-foreground mb-2 font-medium\">\n                        {group}\n                      </p>\n                      <div className=\"space-y-2\">\n                        {groupNotifications.map((notification) => (\n                          <div\n                            key={notification.id}\n                            className={`p-3 rounded-lg border transition-colors ${\n                              notification.isRead === 0\n                                ? \"bg-primary/5 border-primary/20\"\n                                : \"bg-card hover:bg-accent\"\n                            }`}\n                            data-testid={`notification-${notification.id}`}\n                          >\n                            <div className=\"flex items-start gap-3\">\n                              <div className=\"text-2xl flex-shrink-0\">\n                                {getNotificationIcon(notification.type)}\n                              </div>\n                              <div className=\"flex-1 min-w-0\">\n                                <div className=\"flex items-start justify-between gap-2\">\n                                  <div className=\"flex-1\">\n                                    <div className=\"flex items-center gap-2\">\n                                      <p className=\"text-sm font-medium\">\n                                        {notification.title}\n                                      </p>\n                                      {notification.isRead === 0 && (\n                                        <div className=\"h-2 w-2 rounded-full bg-primary flex-shrink-0\" />\n                                      )}\n                                    </div>\n                                    <p className=\"text-sm text-muted-foreground mt-1\">\n                                      {notification.message}\n                                    </p>\n                                    <p className=\"text-xs text-muted-foreground mt-2\">\n                                      {formatDistanceToNow(new Date(notification.createdAt), {\n                                        addSuffix: true,\n                                      })}\n                                    </p>\n                                  </div>\n                                  <div className=\"flex items-center gap-1 flex-shrink-0\">\n                                    {notification.isRead === 0 && (\n                                      <Button\n                                        variant=\"ghost\"\n                                        size=\"icon\"\n                                        className=\"h-7 w-7\"\n                                        onClick={() => markAsReadMutation.mutate(notification.id)}\n                                        data-testid={`button-mark-read-${notification.id}`}\n                                      >\n                                        <Check className=\"h-4 w-4\" />\n                                      </Button>\n                                    )}\n                                    <Button\n                                      variant=\"ghost\"\n                                      size=\"icon\"\n                                      className=\"h-7 w-7\"\n                                      onClick={() => deleteNotificationMutation.mutate(notification.id)}\n                                      data-testid={`button-delete-${notification.id}`}\n                                    >\n                                      <Trash2 className=\"h-4 w-4\" />\n                                    </Button>\n                                  </div>\n                                </div>\n                              </div>\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </ScrollArea>\n          </TabsContent>\n        </Tabs>\n      </SheetContent>\n    </Sheet>\n  );\n}\n","path":null,"size_bytes":10240,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"client/src/components/SessionTimer.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { Clock } from \"lucide-react\";\nimport { useServerTime } from \"@/hooks/useServerTime\";\n\ninterface SessionTimerProps {\n  endTime: Date;\n  className?: string;\n}\n\nexport function SessionTimer({ endTime, className = \"\" }: SessionTimerProps) {\n  const [timeLeft, setTimeLeft] = useState<string>(\"\");\n  const [isExpiring, setIsExpiring] = useState(false);\n  const [isExpired, setIsExpired] = useState(false);\n  const { isReady, getTime } = useServerTime();\n\n  useEffect(() => {\n    const updateTimer = () => {\n      const now = isReady ? getTime() : new Date();\n      const diff = endTime.getTime() - now.getTime();\n\n      if (diff <= 0) {\n        setTimeLeft(\"00:00:00\");\n        setIsExpired(true);\n        setIsExpiring(false);\n        return;\n      }\n\n      const hours = Math.floor(diff / (1000 * 60 * 60));\n      const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));\n      const seconds = Math.floor((diff % (1000 * 60)) / 1000);\n\n      setTimeLeft(\n        `${String(hours).padStart(2, \"0\")}:${String(minutes).padStart(2, \"0\")}:${String(seconds).padStart(2, \"0\")}`\n      );\n\n      setIsExpiring(diff <= 5 * 60 * 1000);\n      setIsExpired(false);\n    };\n\n    updateTimer();\n    const interval = setInterval(updateTimer, 1000);\n\n    return () => clearInterval(interval);\n  }, [endTime, isReady, getTime]);\n\n  const timerColor = isExpired \n    ? \"text-destructive\" \n    : isExpiring \n    ? \"text-chart-3\" \n    : \"text-chart-1\";\n\n  return (\n    <div className={`flex items-center gap-2 ${className}`} data-testid=\"timer-display\">\n      <Clock className={`h-4 w-4 ${timerColor}`} />\n      <span className={`font-mono text-lg font-bold ${timerColor}`}>\n        {timeLeft}\n      </span>\n    </div>\n  );\n}\n","path":null,"size_bytes":1765,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full glass rounded-lg px-4 py-2 text-base file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground/70 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/50 focus-visible:border-primary disabled:cursor-not-allowed disabled:opacity-50 md:text-sm transition-all duration-300\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":832,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/components/AppSidebar.tsx":{"content":"import { Settings, LayoutDashboard, FileText, UtensilsCrossed, CalendarClock, History, Scale, Wallet, ScrollText, BarChart3, Gamepad2, LogOut, Brain, Package, Receipt } from \"lucide-react\";\nimport { Link, useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useTheme } from \"@/components/ThemeProvider\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\";\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarGroup,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarMenu,\n  SidebarMenuItem,\n  SidebarMenuButton,\n  SidebarFooter,\n} from \"@/components/ui/sidebar\";\nimport logoDark from \"@assets/airavoto_logo.png\";\nimport logoLight from \"@assets/airavoto_logo.png\";\nimport type { FoodItem, Expense } from \"@shared/schema\";\n\ninterface MenuItem {\n  title: string;\n  url: string;\n  icon: any;\n  countKey?: string;\n  adminOnly?: boolean;\n  tooltip: string;\n}\n\ninterface MenuCategory {\n  label: string;\n  items: MenuItem[];\n}\n\nconst menuCategories: MenuCategory[] = [\n  {\n    label: \"Main Menu\",\n    items: [\n      {\n        title: \"Dashboard\",\n        url: \"/\",\n        icon: LayoutDashboard,\n        tooltip: \"Manage active bookings, view seat availability, and control gaming sessions\",\n      },\n      {\n        title: \"Timeline\",\n        url: \"/timeline\",\n        icon: CalendarClock,\n        tooltip: \"Visual timeline view of all bookings showing session schedules\",\n      },\n      {\n        title: \"History\",\n        url: \"/history\",\n        icon: History,\n        tooltip: \"View past booking records and completed sessions\",\n      },\n    ],\n  },\n  {\n    label: \"Operations\",\n    items: [\n      {\n        title: \"Food\",\n        url: \"/food\",\n        icon: UtensilsCrossed,\n        tooltip: \"Manage food menu items, pricing, and categories\",\n      },\n      {\n        title: \"Inventory\",\n        url: \"/inventory\",\n        icon: Package,\n        countKey: \"lowStock\",\n        tooltip: \"Track food stock levels and get low stock alerts\",\n      },\n      {\n        title: \"Expenses\",\n        url: \"/expenses\",\n        icon: Wallet,\n        tooltip: \"Record and manage operational expenses\",\n      },\n    ],\n  },\n  {\n    label: \"Management\",\n    items: [\n      {\n        title: \"Analytics\",\n        url: \"/analytics\",\n        icon: BarChart3,\n        tooltip: \"View detailed analytics with traffic predictions\",\n      },\n      {\n        title: \"Reports\",\n        url: \"/reports\",\n        icon: FileText,\n        adminOnly: true,\n        tooltip: \"Generate revenue reports and view booking statistics\",\n      },\n    ],\n  },\n  {\n    label: \"Tools\",\n    items: [\n      {\n        title: \"Maintenance\",\n        url: \"/ai-maintenance\",\n        icon: Brain,\n        tooltip: \"Predictive maintenance insights for devices\",\n      },\n      {\n        title: \"Activity Logs\",\n        url: \"/activity-logs\",\n        icon: ScrollText,\n        tooltip: \"View all administrative and staff actions audit trail\",\n      },\n      {\n        title: \"Settings\",\n        url: \"/settings\",\n        icon: Settings,\n        tooltip: \"Configure devices, pricing, and happy hours settings\",\n      },\n      {\n        title: \"Terms & Conditions\",\n        url: \"/terms\",\n        icon: Scale,\n        adminOnly: true,\n        tooltip: \"View and manage service terms and conditions\",\n      },\n    ],\n  },\n];\n\nexport function AppSidebar() {\n  const [location] = useLocation();\n  const { theme } = useTheme();\n  const { toast } = useToast();\n  const { isStaff } = useAuth();\n\n  const { data: foodItems = [] } = useQuery<FoodItem[]>({\n    queryKey: [\"/api/food\"],\n  });\n\n  const lowStockCount = foodItems.filter(\n    item => item.currentStock <= item.minStockLevel && item.category === \"trackable\"\n  ).length;\n\n  const counts = {\n    lowStock: lowStockCount,\n  };\n\n  const handleLogout = async () => {\n    try {\n      window.location.href = \"/api/auth/google/logout\";\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to logout. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  return (\n    <Sidebar className=\"border-r bg-white dark:bg-gray-950\">\n      <SidebarContent>\n        <SidebarGroup>\n          <div className=\"flex items-center gap-3 px-4 py-6 border-b border-gray-200 dark:border-gray-800\">\n            <img \n              src={theme === \"dark\" ? logoDark : logoLight} \n              alt=\"Airavoto Gaming Logo\" \n              className=\"h-16 w-16 sm:h-20 sm:w-20 object-contain\"\n            />\n            <div>\n              <h2 className=\"text-base sm:text-lg font-bold text-gray-900 dark:text-white\">Airavoto Gaming</h2>\n              <p className=\"text-xs text-gray-500 dark:text-gray-400\">Admin Panel</p>\n            </div>\n          </div>\n        </SidebarGroup>\n\n        {menuCategories.map((category) => {\n          const filteredItems = category.items.filter((item) => {\n            if (isStaff && item.adminOnly) {\n              return false;\n            }\n            return true;\n          });\n\n          if (filteredItems.length === 0) return null;\n\n          return (\n            <SidebarGroup key={category.label}>\n              <SidebarGroupLabel className=\"text-xs text-gray-500 dark:text-gray-400 px-4 py-2\">\n                {category.label}\n              </SidebarGroupLabel>\n              <SidebarGroupContent>\n                <SidebarMenu>\n                  {filteredItems.map((item) => {\n                    const isActive = location === item.url;\n                    const count = item.countKey ? counts[item.countKey as keyof typeof counts] : 0;\n                    \n                    return (\n                      <SidebarMenuItem key={item.title}>\n                        <TooltipProvider>\n                          <Tooltip>\n                            <TooltipTrigger asChild>\n                              <SidebarMenuButton \n                                asChild \n                                isActive={isActive}\n                                className={isActive ? 'bg-purple-50 dark:bg-purple-950/30 text-purple-700 dark:text-purple-400 font-medium hover:bg-purple-100 dark:hover:bg-purple-950/50' : ''}\n                                data-testid={`link-${item.title.toLowerCase().replace(/\\s+/g, '-')}`}\n                                data-joyride={`sidebar-${item.title.toLowerCase().replace(/\\s+/g, '-')}`}\n                              >\n                                <Link href={item.url}>\n                                  <item.icon className={isActive ? 'text-purple-600 dark:text-purple-400' : ''} />\n                                  <span className=\"flex items-center gap-1.5 flex-1\">\n                                    {item.title}\n                                  </span>\n                                  {count > 0 && (\n                                    <Badge \n                                      variant=\"secondary\" \n                                      className=\"ml-auto bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 border-0\"\n                                    >\n                                      {count}\n                                    </Badge>\n                                  )}\n                                </Link>\n                              </SidebarMenuButton>\n                            </TooltipTrigger>\n                            <TooltipContent side=\"right\">\n                              <p>{item.tooltip}</p>\n                            </TooltipContent>\n                          </Tooltip>\n                        </TooltipProvider>\n                      </SidebarMenuItem>\n                    );\n                  })}\n                </SidebarMenu>\n              </SidebarGroupContent>\n            </SidebarGroup>\n          );\n        })}\n      </SidebarContent>\n\n      <SidebarFooter>\n        <SidebarMenu>\n          <SidebarMenuItem>\n            <TooltipProvider>\n              <Tooltip>\n                <TooltipTrigger asChild>\n                  <SidebarMenuButton onClick={handleLogout} data-testid=\"button-logout\">\n                    <LogOut />\n                    <span>Logout</span>\n                  </SidebarMenuButton>\n                </TooltipTrigger>\n                <TooltipContent side=\"right\">\n                  <p>Sign out from your account and return to login page</p>\n                </TooltipContent>\n              </Tooltip>\n            </TooltipProvider>\n          </SidebarMenuItem>\n        </SidebarMenu>\n      </SidebarFooter>\n    </Sidebar>\n  );\n}\n","path":null,"size_bytes":8663,"size_tokens":null},"client/src/components/ThemeProvider.tsx":{"content":"import { createContext, useContext, useEffect, useState } from \"react\";\n\ntype Theme = \"light\" | \"dark\";\n\ntype ThemeProviderProps = {\n  children: React.ReactNode;\n  defaultTheme?: Theme;\n};\n\ntype ThemeProviderState = {\n  theme: Theme;\n  setTheme: (theme: Theme) => void;\n  toggleTheme: () => void;\n};\n\nconst ThemeProviderContext = createContext<ThemeProviderState | undefined>(undefined);\n\nexport function ThemeProvider({\n  children,\n  defaultTheme = \"light\",\n}: ThemeProviderProps) {\n  const [theme, setTheme] = useState<Theme>(() => {\n    const stored = localStorage.getItem(\"theme\");\n    return (stored as Theme) || defaultTheme;\n  });\n\n  useEffect(() => {\n    const root = document.documentElement;\n    root.classList.remove(\"light\", \"dark\");\n    root.classList.add(theme);\n    localStorage.setItem(\"theme\", theme);\n  }, [theme]);\n\n  const toggleTheme = () => {\n    setTheme((prevTheme) => (prevTheme === \"light\" ? \"dark\" : \"light\"));\n  };\n\n  const value = {\n    theme,\n    setTheme,\n    toggleTheme,\n  };\n\n  return (\n    <ThemeProviderContext.Provider value={value}>\n      {children}\n    </ThemeProviderContext.Provider>\n  );\n}\n\nexport const useTheme = () => {\n  const context = useContext(ThemeProviderContext);\n  if (context === undefined) {\n    throw new Error(\"useTheme must be used within a ThemeProvider\");\n  }\n  return context;\n};\n","path":null,"size_bytes":1342,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"client/src/components/InstallPrompt.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Download, X } from 'lucide-react';\nimport { useInstallPrompt } from '@/hooks/useInstallPrompt';\n\ninterface InstallPromptProps {\n  onClose?: () => void;\n}\n\nexport function InstallPrompt({ onClose }: InstallPromptProps) {\n  const { canInstall, isInstalled, promptToInstall } = useInstallPrompt();\n  const [showPrompt, setShowPrompt] = useState(false);\n  const [dismissed, setDismissed] = useState(false);\n\n  useEffect(() => {\n    // Check if user has already dismissed the prompt in this session\n    const hasBeenDismissed = sessionStorage.getItem('installPromptDismissed');\n    \n    if (hasBeenDismissed) {\n      setDismissed(true);\n      return;\n    }\n\n    // Show prompt after a short delay if the app can be installed\n    if (canInstall && !isInstalled && !dismissed) {\n      const timer = setTimeout(() => {\n        setShowPrompt(true);\n      }, 2000); // Show after 2 seconds\n\n      return () => clearTimeout(timer);\n    }\n  }, [canInstall, isInstalled, dismissed]);\n\n  const handleInstall = async () => {\n    const accepted = await promptToInstall();\n    if (accepted) {\n      setShowPrompt(false);\n      onClose?.();\n    }\n  };\n\n  const handleDismiss = () => {\n    setShowPrompt(false);\n    setDismissed(true);\n    sessionStorage.setItem('installPromptDismissed', 'true');\n    onClose?.();\n  };\n\n  // Don't render if already installed or dismissed\n  if (isInstalled || dismissed || !canInstall) {\n    return null;\n  }\n\n  return (\n    <Dialog open={showPrompt} onOpenChange={setShowPrompt}>\n      <DialogContent className=\"max-w-md\" data-testid=\"dialog-install-prompt\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Download className=\"h-5 w-5 text-purple-500\" />\n            Add to Home Screen\n          </DialogTitle>\n          <DialogDescription>\n            Install Airavoto Gaming Admin Panel on your device for quick and easy access. Works offline and feels like a native app!\n          </DialogDescription>\n        </DialogHeader>\n        \n        <div className=\"space-y-3 py-4\">\n          <div className=\"flex items-start gap-3\">\n            <div className=\"flex-shrink-0 w-8 h-8 rounded-full bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center text-purple-600 dark:text-purple-400 font-bold\">\n              1\n            </div>\n            <div>\n              <p className=\"font-medium\">Launch from home screen</p>\n              <p className=\"text-sm text-muted-foreground\">Access instantly without opening your browser</p>\n            </div>\n          </div>\n          \n          <div className=\"flex items-start gap-3\">\n            <div className=\"flex-shrink-0 w-8 h-8 rounded-full bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center text-purple-600 dark:text-purple-400 font-bold\">\n              2\n            </div>\n            <div>\n              <p className=\"font-medium\">Works offline</p>\n              <p className=\"text-sm text-muted-foreground\">Continue managing bookings even without internet</p>\n            </div>\n          </div>\n          \n          <div className=\"flex items-start gap-3\">\n            <div className=\"flex-shrink-0 w-8 h-8 rounded-full bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center text-purple-600 dark:text-purple-400 font-bold\">\n              3\n            </div>\n            <div>\n              <p className=\"font-medium\">Full-screen experience</p>\n              <p className=\"text-sm text-muted-foreground\">App-like interface for better productivity</p>\n            </div>\n          </div>\n        </div>\n\n        <DialogFooter className=\"gap-2 sm:gap-0\">\n          <Button\n            variant=\"outline\"\n            onClick={handleDismiss}\n            data-testid=\"button-dismiss-install\"\n          >\n            <X className=\"h-4 w-4 mr-2\" />\n            Not Now\n          </Button>\n          <Button\n            onClick={handleInstall}\n            className=\"bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700\"\n            data-testid=\"button-install-app\"\n          >\n            <Download className=\"h-4 w-4 mr-2\" />\n            Install App\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":4454,"size_tokens":null},"client/src/components/ConsumerNav.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { ThemeToggle } from \"@/components/ThemeToggle\";\nimport { Home, ImageIcon, Sparkles, Gamepad2, Menu, X } from \"lucide-react\";\nimport { useState } from \"react\";\n\nexport function ConsumerNav() {\n  const [location] = useLocation();\n  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);\n\n  const navItems = [\n    { path: \"/home\", label: \"Home\", icon: Home },\n    { path: \"/gallery\", label: \"Gallery\", icon: ImageIcon },\n    { path: \"/facilities\", label: \"Facilities\", icon: Sparkles },\n    { path: \"/games\", label: \"Games\", icon: Gamepad2 },\n  ];\n\n  return (\n    <nav className=\"border-b sticky top-0 z-50 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60\">\n      <div className=\"container mx-auto px-4\">\n        <div className=\"flex items-center justify-between h-16\">\n          <Link href=\"/home\">\n            <a className=\"text-xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent\" data-testid=\"link-logo\">\n              Airavoto Gaming\n            </a>\n          </Link>\n\n          <div className=\"hidden md:flex items-center gap-6\">\n            {navItems.map((item) => {\n              const Icon = item.icon;\n              const isActive = location === item.path;\n              return (\n                <Link key={item.path} href={item.path}>\n                  <a\n                    className={`flex items-center gap-2 px-3 py-2 rounded-md transition-colors ${\n                      isActive\n                        ? \"bg-primary text-primary-foreground\"\n                        : \"text-muted-foreground hover:text-foreground hover:bg-muted\"\n                    }`}\n                    data-testid={`link-${item.label.toLowerCase()}`}\n                  >\n                    <Icon className=\"h-4 w-4\" />\n                    <span>{item.label}</span>\n                  </a>\n                </Link>\n              );\n            })}\n            <ThemeToggle />\n          </div>\n\n          <div className=\"md:hidden flex items-center gap-2\">\n            <ThemeToggle />\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => setMobileMenuOpen(!mobileMenuOpen)}\n              data-testid=\"button-mobile-menu\"\n            >\n              {mobileMenuOpen ? <X className=\"h-5 w-5\" /> : <Menu className=\"h-5 w-5\" />}\n            </Button>\n          </div>\n        </div>\n\n        {mobileMenuOpen && (\n          <div className=\"md:hidden py-4 space-y-2\">\n            {navItems.map((item) => {\n              const Icon = item.icon;\n              const isActive = location === item.path;\n              return (\n                <Link key={item.path} href={item.path}>\n                  <a\n                    className={`flex items-center gap-3 px-4 py-3 rounded-md transition-colors ${\n                      isActive\n                        ? \"bg-primary text-primary-foreground\"\n                        : \"text-muted-foreground hover:text-foreground hover:bg-muted\"\n                    }`}\n                    onClick={() => setMobileMenuOpen(false)}\n                    data-testid={`mobile-link-${item.label.toLowerCase()}`}\n                  >\n                    <Icon className=\"h-5 w-5\" />\n                    <span>{item.label}</span>\n                  </a>\n                </Link>\n              );\n            })}\n          </div>\n        )}\n      </div>\n    </nav>\n  );\n}\n","path":null,"size_bytes":3491,"size_tokens":null},"client/src/lib/chartUtils.ts":{"content":"import html2canvas from \"html2canvas\";\n\nexport async function saveChartAsImage(\n  elementId: string,\n  fileName: string = \"chart\"\n): Promise<void> {\n  const element = document.getElementById(elementId);\n  \n  if (!element) {\n    console.error(`Element with id \"${elementId}\" not found`);\n    alert(`Chart element not found. Please try again.`);\n    return;\n  }\n\n  try {\n    // Wait a bit for any animations to complete\n    await new Promise(resolve => setTimeout(resolve, 100));\n\n    // Get background color from CSS variable\n    const bgColor = getComputedStyle(document.documentElement)\n      .getPropertyValue('--background')\n      .trim();\n    \n    const backgroundColor = bgColor ? `hsl(${bgColor})` : '#ffffff';\n\n    const canvas = await html2canvas(element, {\n      backgroundColor,\n      scale: 2,\n      logging: true,\n      useCORS: true,\n      allowTaint: true,\n      scrollY: -window.scrollY,\n      scrollX: -window.scrollX,\n      windowWidth: element.scrollWidth,\n      windowHeight: element.scrollHeight,\n      onclone: (clonedDoc) => {\n        const clonedElement = clonedDoc.getElementById(elementId);\n        \n        if (clonedElement) {\n          // Fix SVG elements\n          clonedElement.querySelectorAll('svg').forEach((svg) => {\n            const bbox = svg.getBBox();\n            const rect = svg.getBoundingClientRect();\n            \n            // Set explicit dimensions\n            svg.setAttribute('width', String(rect.width || bbox.width));\n            svg.setAttribute('height', String(rect.height || bbox.height));\n            \n            // Remove percentage-based sizing\n            svg.style.removeProperty('width');\n            svg.style.removeProperty('height');\n            \n            // Inline styles for better rendering\n            svg.style.display = 'block';\n            \n            // Fix text elements\n            svg.querySelectorAll('text').forEach((text) => {\n              text.style.fontFamily = window.getComputedStyle(text).fontFamily;\n            });\n          });\n          \n          // Ensure ResponsiveContainer dimensions are fixed\n          clonedElement.querySelectorAll('.recharts-responsive-container').forEach((container: any) => {\n            const rect = container.getBoundingClientRect();\n            container.style.width = `${rect.width}px`;\n            container.style.height = `${rect.height}px`;\n          });\n        }\n      }\n    });\n\n    // Convert to blob and download\n    canvas.toBlob((blob) => {\n      if (blob) {\n        const url = URL.createObjectURL(blob);\n        const link = document.createElement(\"a\");\n        link.download = `${fileName}-${new Date().toISOString().slice(0, 10)}.png`;\n        link.href = url;\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n        URL.revokeObjectURL(url);\n        \n        console.log(`Chart saved as ${link.download}`);\n      }\n    }, 'image/png', 1.0);\n\n  } catch (error) {\n    console.error(\"Error saving chart as image:\", error);\n    alert(\"Failed to save chart. Please try again.\");\n  }\n}\n","path":null,"size_bytes":3077,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { requireAuth, requireAdmin, requireAdminOrStaff, webhookLimiter, publicApiLimiter, sensitiveOperationLimiter, dataExportLimiter } from \"./auth\";\nimport { retentionService } from \"./retention\";\nimport { cleanupScheduler } from \"./scheduler\";\nimport { fetchNeonStorageMetrics } from \"./neon-metrics\";\nimport { db } from \"./db\";\nimport { eq } from \"drizzle-orm\";\nimport * as schema from \"@shared/schema\";\nimport { notifyActivityLog, notifyLowInventory, notifyExpenseAdded, notifyPaymentReceived, notifySessionExpired, notifySessionCompleted } from \"./notifications\";\nimport { \n  insertBookingSchema, \n  insertSessionGroupSchema,\n  insertDeviceConfigSchema, \n  insertPricingConfigSchema, \n  insertHappyHoursConfigSchema,\n  insertHappyHoursPricingSchema,\n  insertFoodItemSchema, \n  insertExpenseSchema,\n  insertNotificationSchema,\n  insertGamingCenterInfoSchema,\n  insertGalleryImageSchema,\n  insertFacilitySchema,\n  insertGameSchema,\n  updateProfileSchema,\n  updatePasswordSchema,\n  createStaffSchema\n} from \"@shared/schema\";\nimport { z } from \"zod\";\nimport bcrypt from \"bcryptjs\";\nimport { SecurityConfig } from \"./security\";\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  app.get(\"/api/server-time\", publicApiLimiter, async (req, res) => {\n    res.json({ serverTime: new Date().toISOString() });\n  });\n\n  app.get(\"/api/health\", publicApiLimiter, async (req, res) => {\n    res.json({ status: \"ok\", timestamp: new Date().toISOString() });\n  });\n\n  // Profile Management Routes\n  app.get(\"/api/profile\", requireAuth, async (req, res) => {\n    try {\n      const user = await storage.getUserById(req.session.userId!);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      res.json({\n        id: user.id,\n        username: user.username,\n        role: user.role,\n        createdAt: user.createdAt,\n      });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.patch(\"/api/profile\", requireAuth, sensitiveOperationLimiter, async (req, res) => {\n    try {\n      const profile = updateProfileSchema.parse(req.body);\n      \n      // Check if username is being changed and if it's already taken\n      if (profile.username) {\n        const existingUser = await storage.getUserByUsername(profile.username);\n        if (existingUser && existingUser.id !== req.session.userId) {\n          return res.status(400).json({ message: \"Username already taken\" });\n        }\n      }\n\n      const updatedUser = await storage.updateUserProfile(req.session.userId!, profile);\n      if (!updatedUser) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Update session username if it was changed\n      if (profile.username) {\n        req.session.username = profile.username;\n      }\n\n      // Log activity\n      await storage.createActivityLog({\n        userId: req.session.userId!,\n        username: req.session.username,\n        userRole: req.session.role!,\n        action: 'update',\n        entityType: 'profile',\n        entityId: req.session.userId!,\n        details: 'Profile updated',\n      });\n\n      res.json({\n        id: updatedUser.id,\n        username: updatedUser.username,\n        role: updatedUser.role,\n      });\n    } catch (error: any) {\n      if (error.name === 'ZodError') {\n        return res.status(400).json({ message: error.errors[0]?.message || 'Invalid input' });\n      }\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/profile/change-password\", requireAuth, sensitiveOperationLimiter, async (req, res) => {\n    try {\n      const { currentPassword, newPassword, confirmPassword } = updatePasswordSchema.parse(req.body);\n      \n      // Verify current password\n      const user = await storage.validatePassword(req.session.username, currentPassword);\n      if (!user) {\n        return res.status(400).json({ message: \"Current password is incorrect\" });\n      }\n\n      // Hash new password\n      const saltRounds = SecurityConfig.password.saltRounds;\n      const newPasswordHash = await bcrypt.hash(newPassword, saltRounds);\n      \n      // Update password\n      const success = await storage.updateUserPassword(req.session.userId!, newPasswordHash);\n      if (!success) {\n        return res.status(500).json({ message: \"Failed to update password\" });\n      }\n\n      // Log activity\n      await storage.createActivityLog({\n        userId: req.session.userId!,\n        username: req.session.username,\n        userRole: req.session.role!,\n        action: 'update',\n        entityType: 'password',\n        entityId: req.session.userId!,\n        details: 'Password changed',\n      });\n\n      res.json({ message: \"Password updated successfully\" });\n    } catch (error: any) {\n      if (error.name === 'ZodError') {\n        return res.status(400).json({ message: error.errors[0]?.message || 'Invalid input' });\n      }\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Staff Management Routes (Admin only)\n  app.get(\"/api/staff\", requireAdmin, async (req, res) => {\n    try {\n      const staffUsers = await storage.getAllStaffUsers();\n      res.json(staffUsers.map(user => ({\n        id: user.id,\n        username: user.username,\n        role: user.role,\n        createdAt: user.createdAt,\n      })));\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/staff\", requireAdmin, sensitiveOperationLimiter, async (req, res) => {\n    try {\n      const staffData = createStaffSchema.parse(req.body);\n      \n      // Check if username is already taken\n      const existingUser = await storage.getUserByUsername(staffData.username);\n      if (existingUser) {\n        return res.status(400).json({ message: \"Username already taken\" });\n      }\n\n      // Hash password\n      const saltRounds = SecurityConfig.password.saltRounds;\n      const passwordHash = await bcrypt.hash(staffData.password, saltRounds);\n      \n      // Create staff user\n      const newUser = await storage.createStaffUser({\n        username: staffData.username,\n        passwordHash,\n      });\n\n      // Log activity\n      await storage.createActivityLog({\n        userId: req.session.userId!,\n        username: req.session.username,\n        userRole: req.session.role!,\n        action: 'create',\n        entityType: 'staff',\n        entityId: newUser.id,\n        details: `Staff member \"${staffData.username}\" created`,\n      });\n\n      res.status(201).json({\n        id: newUser.id,\n        username: newUser.username,\n        role: newUser.role,\n        createdAt: newUser.createdAt,\n      });\n    } catch (error: any) {\n      if (error.name === 'ZodError') {\n        return res.status(400).json({ message: error.errors[0]?.message || 'Invalid input' });\n      }\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.patch(\"/api/staff/:id\", requireAdmin, sensitiveOperationLimiter, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const profile = updateProfileSchema.parse(req.body);\n      \n      // Get the staff user to verify it exists and is a staff member\n      const staffUser = await storage.getUserById(id);\n      if (!staffUser || staffUser.role !== 'staff') {\n        return res.status(404).json({ message: \"Staff member not found\" });\n      }\n\n      // Check if username is being changed and if it's already taken\n      if (profile.username) {\n        const existingUser = await storage.getUserByUsername(profile.username);\n        if (existingUser && existingUser.id !== id) {\n          return res.status(400).json({ message: \"Username already taken\" });\n        }\n      }\n\n      const updatedUser = await storage.updateUserProfile(id, profile);\n      if (!updatedUser) {\n        return res.status(404).json({ message: \"Staff member not found\" });\n      }\n\n      // Log activity\n      await storage.createActivityLog({\n        userId: req.session.userId!,\n        username: req.session.username,\n        userRole: req.session.role!,\n        action: 'update',\n        entityType: 'staff',\n        entityId: id,\n        details: `Staff member \"${updatedUser.username}\" updated`,\n      });\n\n      res.json({\n        id: updatedUser.id,\n        username: updatedUser.username,\n        role: updatedUser.role,\n      });\n    } catch (error: any) {\n      if (error.name === 'ZodError') {\n        return res.status(400).json({ message: error.errors[0]?.message || 'Invalid input' });\n      }\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/staff/:id/reset-password\", requireAdmin, sensitiveOperationLimiter, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const { newPassword } = req.body;\n      \n      if (!newPassword || newPassword.length < 8) {\n        return res.status(400).json({ message: \"Password must be at least 8 characters\" });\n      }\n\n      // Get the staff user to verify it exists and is a staff member\n      const staffUser = await storage.getUserById(id);\n      if (!staffUser || staffUser.role !== 'staff') {\n        return res.status(404).json({ message: \"Staff member not found\" });\n      }\n\n      // Hash new password\n      const saltRounds = SecurityConfig.password.saltRounds;\n      const newPasswordHash = await bcrypt.hash(newPassword, saltRounds);\n      \n      // Update password\n      const success = await storage.updateUserPassword(id, newPasswordHash);\n      if (!success) {\n        return res.status(500).json({ message: \"Failed to reset password\" });\n      }\n\n      // Log activity\n      await storage.createActivityLog({\n        userId: req.session.userId!,\n        username: req.session.username,\n        userRole: req.session.role!,\n        action: 'update',\n        entityType: 'staff',\n        entityId: id,\n        details: `Password reset for staff member \"${staffUser.username}\"`,\n      });\n\n      res.json({ message: \"Password reset successfully\" });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.delete(\"/api/staff/:id\", requireAdmin, sensitiveOperationLimiter, async (req, res) => {\n    try {\n      const { id } = req.params;\n      \n      // Get the staff user to verify it exists and is a staff member\n      const staffUser = await storage.getUserById(id);\n      if (!staffUser || staffUser.role !== 'staff') {\n        return res.status(404).json({ message: \"Staff member not found\" });\n      }\n\n      // Prevent deleting yourself\n      if (id === req.session.userId) {\n        return res.status(400).json({ message: \"Cannot delete your own account\" });\n      }\n\n      const success = await storage.deleteUser(id);\n      if (!success) {\n        return res.status(500).json({ message: \"Failed to delete staff member\" });\n      }\n\n      // Log activity\n      await storage.createActivityLog({\n        userId: req.session.userId!,\n        username: req.session.username,\n        userRole: req.session.role!,\n        action: 'delete',\n        entityType: 'staff',\n        entityId: id,\n        details: `Staff member \"${staffUser.username}\" deleted`,\n      });\n\n      res.json({ message: \"Staff member deleted successfully\" });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/bookings\", requireAuth, async (req, res) => {\n    try {\n      const bookings = await storage.getAllBookings();\n      res.json(bookings);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/bookings/available-seats\", requireAuth, async (req, res) => {\n    try {\n      const { date, timeSlot, durationMinutes } = req.query;\n      \n      if (!date || !timeSlot || !durationMinutes) {\n        return res.status(400).json({ message: \"Missing required parameters: date, timeSlot, durationMinutes\" });\n      }\n\n      const bookingDate = new Date(date as string);\n      const [startTimeStr] = (timeSlot as string).split('-');\n      const [startHour, startMin] = startTimeStr.split(':').map(Number);\n      \n      const requestStart = new Date(bookingDate);\n      requestStart.setHours(startHour, startMin, 0, 0);\n      const requestEnd = new Date(requestStart.getTime() + parseInt(durationMinutes as string) * 60 * 1000);\n\n      const allBookings = await storage.getAllBookings();\n      const deviceConfigs = await storage.getAllDeviceConfigs();\n      \n      const availableSeats = deviceConfigs.map(config => {\n        const occupiedSeats = allBookings\n          .filter(booking => {\n            if (booking.category !== config.category) return false;\n            \n            const bookingStart = new Date(booking.startTime);\n            const bookingEnd = new Date(booking.endTime);\n            \n            const hasOverlap = requestStart < bookingEnd && requestEnd > bookingStart;\n            \n            return hasOverlap && (booking.status === \"running\" || booking.status === \"paused\" || booking.status === \"upcoming\");\n          })\n          .map(b => b.seatNumber);\n\n        const allSeatNumbers = config.seats.length > 0 \n          ? config.seats.map(seatName => {\n              const match = seatName.match(/\\d+$/);\n              return match ? parseInt(match[0]) : 0;\n            }).filter(n => n > 0)\n          : Array.from({ length: config.count }, (_, i) => i + 1);\n\n        const availableSeats = allSeatNumbers.filter(n => !occupiedSeats.includes(n));\n\n        return {\n          category: config.category,\n          seats: availableSeats,\n        };\n      });\n\n      res.json(availableSeats);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/bookings/active\", requireAuth, async (req, res) => {\n    try {\n      const bookings = await storage.getActiveBookings();\n      res.json(bookings);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Helper function to generate unique codes with high entropy\n  const generateUniqueCode = (prefix: string): string => {\n    const timestamp = Date.now().toString(36).toUpperCase();\n    const randomPart = Math.floor(Math.random() * 0xFFFFFF).toString(16).toUpperCase().padStart(6, '0');\n    return `${prefix}-${timestamp.slice(-5)}${randomPart.slice(0, 4)}`;\n  };\n\n  // Session Groups API\n  app.post(\"/api/session-groups\", requireAuth, async (req, res) => {\n    try {\n      const sessionGroup = insertSessionGroupSchema.parse(req.body);\n      const groupCode = generateUniqueCode('GRP');\n      const created = await db.insert(schema.sessionGroups).values({\n        ...sessionGroup,\n        groupCode,\n      }).returning();\n      res.json(created[0]);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/session-groups\", requireAuth, async (req, res) => {\n    try {\n      const groups = await db.select().from(schema.sessionGroups);\n      res.json(groups);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/session-groups/:id/bookings\", requireAuth, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const bookings = await db.select().from(schema.bookings).where(eq(schema.bookings.groupId, id));\n      res.json(bookings);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/bookings\", requireAuth, async (req, res) => {\n    try {\n      const booking = insertBookingSchema.parse(req.body);\n      \n      const manualDiscountPercentage = req.body.manualDiscountPercentage || null;\n      const manualFreeHours = req.body.manualFreeHours || null;\n      const discount = req.body.discount || null;\n      const bonus = req.body.bonus || null;\n      \n      // Validate that the seat is not already booked for this time slot\n      const allBookings = await storage.getAllBookings();\n      const requestStart = new Date(booking.startTime);\n      const requestEnd = new Date(booking.endTime);\n      \n      const hasConflict = allBookings.some(existingBooking => {\n        if (existingBooking.category !== booking.category || existingBooking.seatNumber !== booking.seatNumber) {\n          return false;\n        }\n        \n        if (existingBooking.status !== \"running\" && existingBooking.status !== \"paused\" && existingBooking.status !== \"upcoming\") {\n          return false;\n        }\n        \n        const bookingStart = new Date(existingBooking.startTime);\n        const bookingEnd = new Date(existingBooking.endTime);\n        \n        const hasOverlap = requestStart < bookingEnd && requestEnd > bookingStart;\n        \n        return hasOverlap;\n      });\n      \n      if (hasConflict) {\n        return res.status(409).json({ \n          message: `Seat ${booking.category}-${booking.seatNumber} is already booked for this time slot. Please select a different seat or time.` \n        });\n      }\n      \n      // Generate unique booking code and preserve groupId/groupCode from request\n      const bookingCode = generateUniqueCode('BK');\n      const groupId = req.body.groupId || null;\n      const groupCode = req.body.groupCode || null;\n      \n      let bookingData = { ...booking, bookingCode, groupId, groupCode };\n      let appliedPromotion: { type: 'manual_discount' | 'manual_bonus', description: string, savingsAmount?: string, hoursGiven?: string } | null = null;\n      \n      // Add discount and bonus fields if provided\n      if (discount) {\n        bookingData.discount = discount;\n      }\n      if (bonus) {\n        bookingData.bonus = bonus;\n      }\n      \n      // Apply manual discount\n      if (manualDiscountPercentage && manualDiscountPercentage > 0) {\n        const originalPrice = parseFloat(booking.price);\n        const discountAmount = originalPrice * (manualDiscountPercentage / 100);\n        const finalPrice = originalPrice - discountAmount;\n        \n        bookingData.originalPrice = booking.price;\n        bookingData.price = finalPrice.toFixed(2);\n        bookingData.discountApplied = `${manualDiscountPercentage}% manual discount`;\n        bookingData.isPromotionalDiscount = 0;\n        bookingData.manualDiscountPercentage = manualDiscountPercentage;\n        bookingData.promotionDetails = {\n          discountPercentage: manualDiscountPercentage,\n          discountAmount: discountAmount.toFixed(2),\n        };\n        \n        appliedPromotion = { \n          type: 'manual_discount', \n          description: `${manualDiscountPercentage}% manual discount`,\n          savingsAmount: discountAmount.toFixed(2)\n        };\n      }\n      // Apply manual free hours\n      else if (manualFreeHours) {\n        let freeHoursValue: number;\n        let displayFormat: string;\n        \n        // Convert to string to handle both string and numeric inputs\n        const manualFreeHoursStr = String(manualFreeHours);\n        \n        // Check if it's in HH:MM format\n        if (manualFreeHoursStr.includes(':')) {\n          const [hours, minutes] = manualFreeHoursStr.split(':').map((val: string) => parseInt(val) || 0);\n          freeHoursValue = hours + (minutes / 60);\n          displayFormat = `${hours}h ${minutes}min`;\n        } else {\n          // Fallback for decimal format (legacy or numeric input)\n          freeHoursValue = parseFloat(manualFreeHoursStr);\n          const hours = Math.floor(freeHoursValue);\n          const minutes = Math.round((freeHoursValue - hours) * 60);\n          displayFormat = minutes > 0 ? `${hours}h ${minutes}min` : `${hours}h`;\n        }\n        \n        if (freeHoursValue > 0) {\n          const newEndTime = new Date(requestEnd.getTime() + (freeHoursValue * 60 * 60 * 1000));\n          \n          bookingData.originalPrice = booking.price;\n          bookingData.endTime = newEndTime;\n          bookingData.bonusHoursApplied = `+${displayFormat} (manual)`;\n          bookingData.isPromotionalBonus = 0;\n          bookingData.manualFreeHours = manualFreeHours;\n          bookingData.promotionDetails = {\n            bonusHours: manualFreeHours,\n          };\n          \n          appliedPromotion = { \n            type: 'manual_bonus', \n            description: `+${displayFormat} free (manual)`,\n            hoursGiven: displayFormat\n          };\n        }\n      }\n      \n      const created = await storage.createBooking(bookingData);\n      \n      // Increment promotion usage counter and log activity\n      if (appliedPromotion) {\n        const userId = req.session.userId;\n        const username = req.session.username;\n        const userRole = req.session.role;\n        \n        if (userId && username && userRole) {\n          const startTime = new Date(created.startTime).toLocaleString('en-IN', { dateStyle: 'medium', timeStyle: 'short' });\n          const endTime = new Date(created.endTime).toLocaleString('en-IN', { dateStyle: 'medium', timeStyle: 'short' });\n          \n          // Handle manual discount\n          if (appliedPromotion.type === 'manual_discount' && appliedPromotion.savingsAmount) {\n            await storage.createActivityLog({\n              userId,\n              username,\n              userRole,\n              action: 'create',\n              entityType: 'manual_discount',\n              entityId: created.id,\n              details: `${userRole.toUpperCase()} gave ${appliedPromotion.description} to ${created.customerName} on ${created.seatName}. Original Price: ‚Çπ${created.originalPrice}, Discount: ‚Çπ${appliedPromotion.savingsAmount}, Final Price: ‚Çπ${created.price}. Session: ${startTime} to ${endTime}`\n            });\n          }\n          // Handle manual free hours\n          else if (appliedPromotion.type === 'manual_bonus' && appliedPromotion.hoursGiven) {\n            await storage.createActivityLog({\n              userId,\n              username,\n              userRole,\n              action: 'create',\n              entityType: 'manual_free_hours',\n              entityId: created.id,\n              details: `${userRole.toUpperCase()} gave ${appliedPromotion.hoursGiven} free hours to ${created.customerName} on ${created.seatName}. Price: ‚Çπ${created.price}. Session: ${startTime} to ${endTime}`\n            });\n          }\n        }\n      }\n      \n      // Deduct stock for food orders\n      if (created.foodOrders && created.foodOrders.length > 0) {\n        for (const order of created.foodOrders) {\n          await storage.adjustStock(order.foodId, order.quantity, 'remove');\n        }\n      }\n      \n      res.json(created);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.patch(\"/api/bookings/:id\", requireAuth, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const existingBooking = await storage.getBooking(id);\n      const updated = await storage.updateBooking(id, req.body);\n      if (!updated) {\n        return res.status(404).json({ message: \"Booking not found\" });\n      }\n      \n      // Send notification when session expires or completes\n      if (existingBooking && req.body.status) {\n        const oldStatus = existingBooking.status;\n        const newStatus = req.body.status;\n        \n        // Notify when timer expires (running -> expired)\n        if (oldStatus === \"running\" && newStatus === \"expired\") {\n          await notifySessionExpired(updated.id, updated.seatName, updated.customerName);\n        }\n        \n        // Notify when session is completed (any status except completed -> completed)\n        if (oldStatus !== \"completed\" && newStatus === \"completed\") {\n          await notifySessionCompleted(updated.id, updated.seatName, updated.customerName);\n        }\n      }\n      \n      // Adjust stock for food order changes\n      if (existingBooking) {\n        const oldOrders = existingBooking.foodOrders || [];\n        const newOrders = updated.foodOrders || [];\n        \n        // Create maps for easy lookup\n        const oldOrdersMap = new Map(oldOrders.map(o => [o.foodId, o.quantity]));\n        const newOrdersMap = new Map(newOrders.map(o => [o.foodId, o.quantity]));\n        \n        // Process new/increased orders (deduct stock)\n        for (const [foodId, newQty] of Array.from(newOrdersMap.entries())) {\n          const oldQty = oldOrdersMap.get(foodId) || 0;\n          const diff = newQty - oldQty;\n          if (diff > 0) {\n            // New order or quantity increased - deduct the difference\n            const result = await storage.adjustStock(foodId, diff, 'remove');\n            if (!result || result.currentStock === 0) {\n              console.warn(`Warning: Stock for food item ${foodId} may be insufficient`);\n            }\n          } else if (diff < 0) {\n            // Quantity decreased - add back the difference\n            await storage.adjustStock(foodId, Math.abs(diff), 'add');\n          }\n        }\n        \n        // Process removed orders (add stock back)\n        for (const [foodId, oldQty] of Array.from(oldOrdersMap.entries())) {\n          if (!newOrdersMap.has(foodId)) {\n            // Order was removed - add stock back\n            await storage.adjustStock(foodId, oldQty, 'add');\n          }\n        }\n      }\n      \n      res.json(updated);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.patch(\"/api/bookings/:id/change-seat\", requireAuth, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const { newSeatName } = req.body;\n\n      if (!newSeatName) {\n        return res.status(400).json({ message: \"New seat name is required\" });\n      }\n\n      const booking = await storage.getBooking(id);\n      if (!booking) {\n        return res.status(404).json({ message: \"Booking not found\" });\n      }\n\n      const oldSeatName = booking.seatName;\n      const oldCategory = oldSeatName.split('-')[0];\n      const newCategory = newSeatName.split('-')[0];\n\n      if (oldCategory !== newCategory) {\n        return res.status(400).json({ message: \"Cannot change to a different category\" });\n      }\n\n      const allBookings = await storage.getAllBookings();\n      const conflictingBooking = allBookings.find(b => \n        b.id !== id &&\n        b.seatName === newSeatName &&\n        (b.status === 'running' || b.status === 'paused' || b.status === 'upcoming')\n      );\n\n      if (conflictingBooking) {\n        return res.status(400).json({ \n          message: `Seat ${newSeatName} is already occupied. Please select another seat.` \n        });\n      }\n\n      const newSeatNumber = parseInt(newSeatName.split('-')[1]);\n      \n      const updated = await storage.updateBooking(id, {\n        seatName: newSeatName,\n        seatNumber: newSeatNumber,\n      });\n\n      if (!updated) {\n        return res.status(404).json({ message: \"Failed to update booking\" });\n      }\n\n      if (req.session.userId && req.session.username && req.session.role) {\n        await storage.createActivityLog({\n          userId: req.session.userId,\n          username: req.session.username,\n          userRole: req.session.role,\n          action: 'update',\n          entityType: 'booking',\n          entityId: id,\n          details: `Changed seat from ${oldSeatName} to ${newSeatName} for ${booking.customerName}`,\n        });\n      }\n\n      res.json(updated);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.delete(\"/api/bookings/:id\", requireAuth, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const userRole = req.session.role;\n      const userId = req.session.userId;\n      const username = req.session.username;\n      \n      // Get the booking for logging\n      const bookings = await storage.getAllBookings();\n      const booking = bookings.find(b => b.id === id);\n      \n      if (!booking) {\n        return res.status(404).json({ message: \"Booking not found\" });\n      }\n      \n      // Both admin and staff can delete any booking\n      const deleted = await storage.deleteBooking(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Booking not found\" });\n      }\n      \n      // Log the deletion activity\n      if (userId && username && userRole) {\n        const duration = Math.round((new Date(booking.endTime).getTime() - new Date(booking.startTime).getTime()) / 60000);\n        const durationStr = duration >= 60 ? `${Math.floor(duration/60)}h ${duration%60}m` : `${duration}m`;\n        const foodOrders = booking.foodOrders && booking.foodOrders.length > 0 \n          ? `, ${booking.foodOrders.length} food items ordered`\n          : '';\n        \n        await storage.createActivityLog({\n          userId,\n          username,\n          userRole,\n          action: 'delete',\n          entityType: 'booking',\n          entityId: id,\n          details: `Deleted ${booking.status} booking: ${booking.customerName} at ${booking.seatName} (${booking.category}). Duration: ${durationStr}, Price: ‚Çπ${booking.price}${foodOrders}. Booking was scheduled from ${new Date(booking.startTime).toLocaleString('en-IN', { dateStyle: 'short', timeStyle: 'short' })} to ${new Date(booking.endTime).toLocaleString('en-IN', { dateStyle: 'short', timeStyle: 'short' })}`\n        });\n      }\n      \n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/bookings/archive\", requireAuth, async (req, res) => {\n    try {\n      const count = await storage.moveBookingsToHistory();\n      res.json({ success: true, count });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/bookings/payment-method\", sensitiveOperationLimiter, requireAuth, async (req, res) => {\n    try {\n      const { bookingIds, paymentMethod } = req.body;\n      \n      if (!bookingIds || !Array.isArray(bookingIds) || bookingIds.length === 0) {\n        return res.status(400).json({ message: \"Booking IDs are required\" });\n      }\n      \n      if (!paymentMethod || ![\"cash\", \"upi_online\"].includes(paymentMethod)) {\n        return res.status(400).json({ message: \"Valid payment method is required (cash or upi_online)\" });\n      }\n      \n      const count = await storage.updatePaymentMethod(bookingIds, paymentMethod);\n      res.json({ success: true, count });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/bookings/payment-status\", sensitiveOperationLimiter, requireAuth, async (req, res) => {\n    try {\n      const { bookingIds, paymentStatus, paymentMethod } = req.body;\n      \n      if (!bookingIds || !Array.isArray(bookingIds) || bookingIds.length === 0) {\n        return res.status(400).json({ message: \"Booking IDs are required\" });\n      }\n      \n      if (!paymentStatus || ![\"unpaid\", \"pending\", \"paid\"].includes(paymentStatus)) {\n        return res.status(400).json({ message: \"Valid payment status is required (unpaid, pending, or paid)\" });\n      }\n\n      if (paymentStatus === \"paid\" && (!paymentMethod || ![\"cash\", \"upi_online\"].includes(paymentMethod))) {\n        return res.status(400).json({ message: \"Valid payment method is required when marking as paid (cash or upi_online)\" });\n      }\n      \n      const userId = (req.user as any)?.id || 'unknown';\n      \n      const result = await storage.updatePaymentStatus(bookingIds, paymentStatus, paymentMethod || null, userId);\n      \n      if (paymentStatus === \"paid\" && result.bookings.length > 0) {\n        for (const booking of result.bookings) {\n          const totalAmount = parseFloat(booking.price) + \n            (booking.foodOrders || []).reduce((sum: number, order: any) => \n              sum + (parseFloat(order.price) * order.quantity), 0);\n          await notifyPaymentReceived(\n            booking.id, \n            booking.seatName, \n            totalAmount.toFixed(2),\n            paymentMethod || 'unknown'\n          );\n        }\n      }\n      \n      res.json({ success: true, count: result.count, bookings: result.bookings });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/bookings/split-payment\", sensitiveOperationLimiter, requireAuth, async (req, res) => {\n    try {\n      const { bookingIds, cashAmount, upiAmount } = req.body;\n      \n      if (!bookingIds || !Array.isArray(bookingIds) || bookingIds.length === 0) {\n        return res.status(400).json({ message: \"Booking IDs are required\" });\n      }\n      \n      const totalCash = parseFloat(cashAmount) || 0;\n      const totalUpi = parseFloat(upiAmount) || 0;\n      \n      if (totalCash < 0 || totalUpi < 0) {\n        return res.status(400).json({ message: \"Amounts cannot be negative\" });\n      }\n      \n      if (totalCash === 0 && totalUpi === 0) {\n        return res.status(400).json({ message: \"At least one payment amount must be greater than zero\" });\n      }\n      \n      const bookings = await Promise.all(bookingIds.map(id => storage.getBooking(id)));\n      const missingBookings = bookings.filter(b => !b);\n      if (missingBookings.length > 0) {\n        return res.status(404).json({ message: \"One or more bookings not found\" });\n      }\n      \n      const grandTotal = bookings.reduce((sum, booking) => {\n        const bookingTotal = parseFloat(booking!.price) + \n          (booking!.foodOrders || []).reduce((fSum: number, order: any) => \n            fSum + (parseFloat(order.price) * order.quantity), 0);\n        return sum + bookingTotal;\n      }, 0);\n      \n      if (Math.abs((totalCash + totalUpi) - grandTotal) > 0.01) {\n        return res.status(400).json({ \n          message: `Cash (‚Çπ${totalCash}) + UPI (‚Çπ${totalUpi}) must equal total booking amount (‚Çπ${grandTotal.toFixed(2)})` \n        });\n      }\n      \n      const updatedBookings = [];\n      let remainingCash = totalCash;\n      let remainingUpi = totalUpi;\n      \n      for (let i = 0; i < bookings.length; i++) {\n        const booking = bookings[i]!;\n        const bookingTotal = parseFloat(booking.price) + \n          (booking.foodOrders || []).reduce((fSum: number, order: any) => \n            fSum + (parseFloat(order.price) * order.quantity), 0);\n        \n        let bookingCash: number;\n        let bookingUpi: number;\n        \n        if (i === bookings.length - 1) {\n          bookingCash = remainingCash;\n          bookingUpi = remainingUpi;\n        } else {\n          const proportion = bookingTotal / grandTotal;\n          bookingCash = Math.round(totalCash * proportion * 100) / 100;\n          bookingUpi = Math.round(totalUpi * proportion * 100) / 100;\n          remainingCash -= bookingCash;\n          remainingUpi -= bookingUpi;\n        }\n        \n        const updated = await storage.updateBooking(booking.id, {\n          paymentMethod: \"split\",\n          cashAmount: bookingCash.toFixed(2),\n          upiAmount: bookingUpi.toFixed(2),\n          paymentStatus: \"paid\"\n        });\n        \n        if (updated) {\n          const serializedBooking = {\n            ...updated,\n            startTime: updated.startTime?.toISOString(),\n            endTime: updated.endTime?.toISOString(),\n            createdAt: updated.createdAt?.toISOString(),\n          };\n          updatedBookings.push(serializedBooking);\n        }\n      }\n      \n      res.json({ success: true, count: updatedBookings.length, bookings: updatedBookings });\n    } catch (error: any) {\n      console.error('Split payment error:', error);\n      res.status(500).json({ message: error.message || \"Failed to process split payment\" });\n    }\n  });\n\n  app.get(\"/api/booking-history\", requireAuth, async (req, res) => {\n    try {\n      const history = await storage.getAllBookingHistory();\n      res.json(history);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/reports/stats\", requireAuth, async (req, res) => {\n    try {\n      const period = req.query.period as string || \"daily\";\n      const customStartDate = req.query.startDate as string;\n      const customEndDate = req.query.endDate as string;\n      \n      let startDate: Date;\n      let endDate: Date;\n      const now = new Date();\n\n      if (customStartDate && customEndDate) {\n        startDate = new Date(customStartDate);\n        endDate = new Date(customEndDate);\n        endDate.setHours(23, 59, 59, 999);\n      } else {\n        endDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59);\n\n        switch (period) {\n          case \"daily\":\n            startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0);\n            break;\n          case \"weekly\":\n            const dayOfWeek = now.getDay();\n            startDate = new Date(now);\n            startDate.setDate(now.getDate() - dayOfWeek);\n            startDate.setHours(0, 0, 0, 0);\n            break;\n          case \"monthly\":\n            startDate = new Date(now.getFullYear(), now.getMonth(), 1, 0, 0, 0);\n            break;\n          default:\n            startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0);\n        }\n      }\n\n      const stats = await storage.getBookingStats(startDate, endDate);\n      res.json(stats);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/reports/history\", requireAuth, async (req, res) => {\n    try {\n      const period = req.query.period as string || \"daily\";\n      const customStartDate = req.query.startDate as string;\n      const customEndDate = req.query.endDate as string;\n      \n      let startDate: Date;\n      let endDate: Date;\n      const now = new Date();\n\n      if (customStartDate && customEndDate) {\n        startDate = new Date(customStartDate);\n        endDate = new Date(customEndDate);\n        endDate.setHours(23, 59, 59, 999);\n      } else {\n        endDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59);\n\n        switch (period) {\n          case \"daily\":\n            startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0);\n            break;\n          case \"weekly\":\n            const dayOfWeek = now.getDay();\n            startDate = new Date(now);\n            startDate.setDate(now.getDate() - dayOfWeek);\n            startDate.setHours(0, 0, 0, 0);\n            break;\n          case \"monthly\":\n            startDate = new Date(now.getFullYear(), now.getMonth(), 1, 0, 0, 0);\n            break;\n          default:\n            startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0);\n        }\n      }\n\n      const bookingHistory = await storage.getBookingHistory(startDate, endDate);\n      res.json(bookingHistory);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/reports/retention-metrics\", requireAuth, async (req, res) => {\n    try {\n      const period = (req.query.period as 'daily' | 'weekly' | 'monthly') || \"monthly\";\n      const months = parseInt(req.query.months as string) || 6;\n      \n      const now = new Date();\n      const endDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59);\n      \n      const startDate = new Date(now);\n      startDate.setMonth(now.getMonth() - months);\n      startDate.setHours(0, 0, 0, 0);\n\n      const metrics = await storage.getRetentionMetrics(startDate, endDate, period);\n      res.json(metrics);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/analytics/usage\", requireAuth, async (req, res) => {\n    try {\n      const timeRange = req.query.timeRange as string || \"today\";\n      const allBookings = await storage.getAllBookings();\n      // Filter for walk-in bookings only\n      const bookings = allBookings.filter(b => b.bookingType.includes(\"walk-in\"));\n      const deviceConfigs = await storage.getAllDeviceConfigs();\n      const now = new Date();\n      \n      // Calculate time range dates\n      let rangeStart: Date;\n      let rangeEnd: Date = new Date(now);\n      \n      switch (timeRange) {\n        case \"today\":\n          rangeStart = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0);\n          rangeEnd = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59);\n          break;\n        case \"week\":\n          const dayOfWeek = now.getDay();\n          rangeStart = new Date(now);\n          rangeStart.setDate(now.getDate() - dayOfWeek);\n          rangeStart.setHours(0, 0, 0, 0);\n          break;\n        case \"month\":\n          rangeStart = new Date(now.getFullYear(), now.getMonth(), 1, 0, 0, 0);\n          break;\n        case \"all\":\n          rangeStart = new Date(0); // Beginning of time\n          break;\n        default:\n          rangeStart = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0);\n          rangeEnd = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59);\n      }\n      \n      // Calculate current occupancy (only from current walk-in bookings)\n      const activeBookings = bookings.filter(b => b.status === \"running\" || b.status === \"paused\");\n      const currentOccupancy = activeBookings.length;\n      const totalCapacity = deviceConfigs.reduce((sum, config) => sum + config.count, 0);\n      const occupancyRate = totalCapacity > 0 ? (currentOccupancy / totalCapacity) * 100 : 0;\n      \n      // Category usage (only from current active walk-in bookings)\n      const categoryUsage = deviceConfigs.map(config => {\n        const occupied = activeBookings.filter(b => b.category === config.category).length;\n        return {\n          category: config.category,\n          occupied,\n          total: config.count,\n          percentage: config.count > 0 ? Math.round((occupied / config.count) * 100) : 0\n        };\n      });\n      \n      // Hourly usage pattern for selected time range - INCLUDE BOTH current AND historical walk-in bookings\n      const todayStart = rangeStart;\n      const todayEnd = rangeEnd;\n      \n      // Get today's walk-in bookings from current bookings (only include active sessions, exclude upcoming)\n      const allowedStatuses = [\"running\", \"paused\", \"expired\", \"completed\"];\n      const todayCurrentBookings = bookings.filter(b => {\n        const start = new Date(b.startTime);\n        const isInRange = start >= todayStart && start <= todayEnd;\n        const isAllowedStatus = allowedStatuses.includes(b.status);\n        return isInRange && isAllowedStatus;\n      });\n      \n      // Get today's walk-in bookings from historical bookings (raw records with startTime, only allowed statuses)\n      const allHistoricalBookings = await storage.getAllBookingHistory();\n      const todayHistoricalBookings = allHistoricalBookings.filter(b => {\n        const start = new Date(b.startTime);\n        const isAllowedStatus = allowedStatuses.includes(b.status);\n        return start >= todayStart && start <= todayEnd && b.bookingType.includes(\"walk-in\") && isAllowedStatus;\n      });\n      \n      // Combine both sources for complete hourly data\n      const todayBookings = [...todayCurrentBookings, ...todayHistoricalBookings];\n      \n      const hourlyUsage = Array.from({ length: 24 }, (_, hour) => {\n        const hourStart = new Date(todayStart);\n        hourStart.setHours(hour);\n        const hourEnd = new Date(hourStart);\n        hourEnd.setHours(hour + 1);\n        \n        const hourBookings = todayBookings.filter(b => {\n          const start = new Date(b.startTime);\n          return start >= hourStart && start < hourEnd;\n        });\n        \n        const revenue = hourBookings.reduce((sum, b) => sum + parseFloat(b.price), 0);\n        \n        return {\n          hour: `${hour.toString().padStart(2, '0')}:00`,\n          bookings: hourBookings.length,\n          revenue\n        };\n      }).filter(h => h.bookings > 0 || now.getHours() >= parseInt(h.hour));\n      \n      // Real-time data (last 10 data points simulating 5-second intervals)\n      const realtimeData = Array.from({ length: 10 }, (_, i) => {\n        const timestamp = new Date(now.getTime() - (9 - i) * 5000);\n        const timeStr = timestamp.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' });\n        return {\n          timestamp: timeStr,\n          occupancy: currentOccupancy,\n          capacity: totalCapacity\n        };\n      });\n      \n      // Customer insights - unique customers in the selected time range\n      const uniqueCustomers = new Set([\n        ...todayCurrentBookings.map(b => b.customerName.toLowerCase().trim()),\n        ...todayHistoricalBookings.map(b => b.customerName.toLowerCase().trim())\n      ]).size;\n      \n      // Average session duration (in minutes)\n      const completedBookings = todayBookings.filter(b => b.status === \"completed\" || b.status === \"expired\");\n      const avgSessionDuration = completedBookings.length > 0\n        ? completedBookings.reduce((sum, b) => {\n            const start = new Date(b.startTime).getTime();\n            const end = new Date(b.endTime).getTime();\n            return sum + (end - start) / (1000 * 60); // Convert to minutes\n          }, 0) / completedBookings.length\n        : 0;\n      \n      // Food order statistics\n      const totalFoodOrders = todayBookings.reduce((sum, b) => {\n        return sum + (b.foodOrders?.length || 0);\n      }, 0);\n      \n      const foodRevenue = todayBookings.reduce((sum, b) => {\n        const orderTotal = (b.foodOrders || []).reduce((orderSum, item) => {\n          return orderSum + (parseFloat(item.price) * item.quantity);\n        }, 0);\n        return sum + orderTotal;\n      }, 0);\n      \n      res.json({\n        currentOccupancy,\n        totalCapacity,\n        occupancyRate,\n        activeBookings: activeBookings.length,\n        categoryUsage,\n        hourlyUsage,\n        realtimeData,\n        uniqueCustomers,\n        avgSessionDuration: Math.round(avgSessionDuration),\n        totalFoodOrders,\n        foodRevenue\n      });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/device-config\", requireAuth, async (req, res) => {\n    try {\n      const configs = await storage.getAllDeviceConfigs();\n      res.json(configs);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/device-config\", requireAdmin, async (req, res) => {\n    try {\n      const config = insertDeviceConfigSchema.parse(req.body);\n      const saved = await storage.upsertDeviceConfig(config);\n      \n      // Log the admin activity\n      if (req.session.userId && req.session.username && req.session.role) {\n        const seatList = config.seats && config.seats.length > 0 \n          ? `Seats: ${config.seats.join(', ')}` \n          : `${config.count} seats (auto-numbered)`;\n        \n        await storage.createActivityLog({\n          userId: req.session.userId,\n          username: req.session.username,\n          userRole: req.session.role,\n          action: 'update',\n          entityType: 'device-config',\n          entityId: saved.id,\n          details: `Updated device configuration for ${config.category}. Total capacity: ${config.count} seats. ${seatList}. Configuration updated at ${new Date().toLocaleString('en-IN', { dateStyle: 'medium', timeStyle: 'short' })}`\n        });\n      }\n      \n      res.json(saved);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/pricing-config\", requireAuth, async (req, res) => {\n    try {\n      const configs = await storage.getAllPricingConfigs();\n      res.json(configs);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/pricing-config\", requireAdmin, async (req, res) => {\n    try {\n      const { category, configs } = req.body;\n      if (!category || !Array.isArray(configs)) {\n        return res.status(400).json({ message: \"Invalid request format\" });\n      }\n      \n      const validatedConfigs = configs.map(c => insertPricingConfigSchema.parse({ ...c, category }));\n      const saved = await storage.upsertPricingConfigs(category, validatedConfigs);\n      \n      // Log the admin activity\n      if (req.session.userId && req.session.username && req.session.role) {\n        const priceDetails = configs.map(c => `${c.duration}: ‚Çπ${c.price}${c.personCount > 1 ? ` (${c.personCount} persons)` : ''}`).join(', ');\n        \n        await storage.createActivityLog({\n          userId: req.session.userId,\n          username: req.session.username,\n          userRole: req.session.role,\n          action: 'update',\n          entityType: 'pricing-config',\n          entityId: category,\n          details: `Updated pricing configuration for ${category}. ${configs.length} price tier(s) configured: ${priceDetails}. Last updated: ${new Date().toLocaleString('en-IN', { dateStyle: 'medium', timeStyle: 'short' })}`\n        });\n      }\n      \n      res.json(saved);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.delete(\"/api/device-config/:category\", requireAdmin, async (req, res) => {\n    try {\n      const { category } = req.params;\n      await storage.deleteDeviceConfig(category);\n      res.json({ success: true, message: `Deleted device config for ${category}` });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.delete(\"/api/pricing-config/:category\", requireAdmin, async (req, res) => {\n    try {\n      const { category } = req.params;\n      await storage.deletePricingConfig(category);\n      res.json({ success: true, message: `Deleted pricing config for ${category}` });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/happy-hours-config\", requireAuth, async (req, res) => {\n    try {\n      const configs = await storage.getAllHappyHoursConfigs();\n      res.json(configs);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/happy-hours-config\", requireAdmin, async (req, res) => {\n    try {\n      const { category, configs } = req.body;\n      if (!category || !Array.isArray(configs)) {\n        return res.status(400).json({ message: \"Invalid request format\" });\n      }\n      \n      const validatedConfigs = configs.map(c => insertHappyHoursConfigSchema.parse({ ...c, category }));\n      const saved = await storage.upsertHappyHoursConfigs(category, validatedConfigs);\n      \n      // Log the admin activity\n      if (req.session.userId && req.session.username && req.session.role) {\n        const timeSlots = configs.map(c => `${c.startTime}-${c.endTime} (${c.enabled ? 'enabled' : 'disabled'})`).join(', ');\n        const activeCount = configs.filter(c => c.enabled).length;\n        \n        await storage.createActivityLog({\n          userId: req.session.userId,\n          username: req.session.username,\n          userRole: req.session.role,\n          action: 'update',\n          entityType: 'happy-hours-config',\n          entityId: category,\n          details: `Updated happy hours configuration for ${category}. ${configs.length} time slot(s) configured (${activeCount} active): ${timeSlots}. Updated at ${new Date().toLocaleString('en-IN', { dateStyle: 'medium', timeStyle: 'short' })}`\n        });\n      }\n      \n      res.json(saved);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.delete(\"/api/happy-hours-config/:category\", requireAdmin, async (req, res) => {\n    try {\n      const { category } = req.params;\n      await storage.deleteHappyHoursConfig(category);\n      res.json({ success: true, message: `Deleted happy hours config for ${category}` });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/happy-hours-active/:category\", publicApiLimiter, async (req, res) => {\n    try {\n      const { category } = req.params;\n      const isActive = await storage.isHappyHoursActive(category);\n      res.json({ active: isActive });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/happy-hours-active-for-time/:category\", publicApiLimiter, async (req, res) => {\n    try {\n      const { category } = req.params;\n      const { timeSlot } = req.query;\n      \n      if (!timeSlot || typeof timeSlot !== 'string') {\n        return res.status(400).json({ message: \"timeSlot query parameter is required\" });\n      }\n      \n      const isActive = await storage.isHappyHoursActiveForTime(category, timeSlot);\n      res.json({ active: isActive });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/happy-hours-pricing\", requireAuth, async (req, res) => {\n    try {\n      const configs = await storage.getAllHappyHoursPricing();\n      res.json(configs);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/happy-hours-pricing\", requireAdmin, async (req, res) => {\n    try {\n      const { category, configs } = req.body;\n      if (!category || !Array.isArray(configs)) {\n        return res.status(400).json({ message: \"Invalid request format\" });\n      }\n      \n      const validatedConfigs = configs.map(c => insertHappyHoursPricingSchema.parse({ ...c, category }));\n      const saved = await storage.upsertHappyHoursPricing(category, validatedConfigs);\n      \n      // Log the admin activity\n      if (req.session.userId && req.session.username && req.session.role) {\n        const priceDetails = configs.map(c => `${c.duration}: ‚Çπ${c.price}${c.personCount > 1 ? ` (${c.personCount}p)` : ''}`).join(', ');\n        \n        await storage.createActivityLog({\n          userId: req.session.userId,\n          username: req.session.username,\n          userRole: req.session.role,\n          action: 'update',\n          entityType: 'happy-hours-pricing',\n          entityId: category,\n          details: `Updated happy hours pricing for ${category}. ${configs.length} price tier(s): ${priceDetails}. Special pricing configured at ${new Date().toLocaleString('en-IN', { dateStyle: 'medium', timeStyle: 'short' })}`\n        });\n      }\n      \n      res.json(saved);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.delete(\"/api/happy-hours-pricing/:category\", requireAdmin, async (req, res) => {\n    try {\n      const { category } = req.params;\n      await storage.deleteHappyHoursPricing(category);\n      res.json({ success: true, message: `Deleted happy hours pricing for ${category}` });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n\n  app.get(\"/api/food-items\", requireAuth, async (req, res) => {\n    try {\n      const items = await storage.getAllFoodItems();\n      res.json(items);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/food-items\", requireAuth, async (req, res) => {\n    try {\n      const item = insertFoodItemSchema.parse(req.body);\n      const created = await storage.createFoodItem(item);\n      \n      // Log the admin activity\n      if (req.session.userId && req.session.username && req.session.role) {\n        const categoryInfo = item.category === 'trackable' ? 'trackable inventory' : 'non-trackable';\n        const stockInfo = item.category === 'trackable' ? `, initial stock: ${item.currentStock || 0}, min level: ${item.minStockLevel || 10}` : '';\n        const supplierInfo = item.supplier ? `, supplier: ${item.supplier}` : '';\n        \n        await storage.createActivityLog({\n          userId: req.session.userId,\n          username: req.session.username,\n          userRole: req.session.role,\n          action: 'create',\n          entityType: 'food-item',\n          entityId: created.id,\n          details: `Created new food item: ${item.name} (${categoryInfo}) - Sell price: ‚Çπ${item.price}${item.costPrice ? `, cost: ‚Çπ${item.costPrice}` : ''}${stockInfo}${supplierInfo}. Added at ${new Date().toLocaleString('en-IN', { dateStyle: 'medium', timeStyle: 'short' })}`\n        });\n      }\n      \n      res.json(created);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.patch(\"/api/food-items/:id\", requireAuth, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const item = insertFoodItemSchema.parse(req.body);\n      const updated = await storage.updateFoodItem(id, item);\n      if (!updated) {\n        return res.status(404).json({ message: \"Food item not found\" });\n      }\n      \n      // Log the admin activity\n      if (req.session.userId && req.session.username && req.session.role) {\n        const stockInfo = item.category === 'trackable' ? `, stock: ${item.currentStock || 0}/${item.minStockLevel || 10} (current/min)` : '';\n        \n        await storage.createActivityLog({\n          userId: req.session.userId,\n          username: req.session.username,\n          userRole: req.session.role,\n          action: 'update',\n          entityType: 'food-item',\n          entityId: id,\n          details: `Updated food item: ${item.name} - Price: ‚Çπ${item.price}${item.costPrice ? `, cost: ‚Çπ${item.costPrice}` : ''}${stockInfo}. Category: ${item.category}. Updated at ${new Date().toLocaleString('en-IN', { dateStyle: 'medium', timeStyle: 'short' })}`\n        });\n      }\n      \n      res.json(updated);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.delete(\"/api/food-items/:id\", requireAuth, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const items = await storage.getAllFoodItems();\n      const foodItem = items.find(f => f.id === id);\n      \n      const deleted = await storage.deleteFoodItem(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Food item not found\" });\n      }\n      \n      // Log the admin activity\n      if (req.session.userId && req.session.username && req.session.role && foodItem) {\n        const stockInfo = foodItem.category === 'trackable' ? `, had ${foodItem.currentStock} units in stock` : '';\n        \n        await storage.createActivityLog({\n          userId: req.session.userId,\n          username: req.session.username,\n          userRole: req.session.role,\n          action: 'delete',\n          entityType: 'food-item',\n          entityId: id,\n          details: `Deleted food item: ${foodItem.name} (‚Çπ${foodItem.price})${stockInfo}. Item was in ${foodItem.inInventory ? 'active inventory' : 'catalog only'}. Deleted at ${new Date().toLocaleString('en-IN', { dateStyle: 'medium', timeStyle: 'short' })}`\n        });\n      }\n      \n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/food-items/:id/adjust-stock\", requireAuth, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const { quantity, type, costPrice, supplier, expiryDate, notes } = schema.stockAdjustmentSchema.parse({ ...req.body, foodId: id });\n      \n      const batchData = type === 'add' ? { costPrice, supplier, expiryDate, notes } : undefined;\n      const updated = await storage.adjustStock(id, quantity, type, batchData);\n      if (!updated) {\n        return res.status(404).json({ message: \"Food item not found\" });\n      }\n      \n      // Log the activity\n      if (req.session.userId && req.session.username && req.session.role) {\n        const oldStock = type === 'add' ? updated.currentStock - quantity : updated.currentStock + quantity;\n        const stockStatus = updated.currentStock <= updated.minStockLevel ? ' (‚ö†Ô∏è LOW STOCK)' : '';\n        const supplierInfo = supplier ? `, supplier: ${supplier}` : '';\n        const expiryInfo = expiryDate ? `, expires: ${new Date(expiryDate).toLocaleDateString('en-IN')}` : '';\n        const notesInfo = notes ? `, notes: ${notes}` : '';\n        \n        await storage.createActivityLog({\n          userId: req.session.userId,\n          username: req.session.username,\n          userRole: req.session.role,\n          action: 'update',\n          entityType: 'food-inventory',\n          entityId: id,\n          details: `${type === 'add' ? 'Added' : 'Removed'} ${quantity} units of ${updated.name}. Stock: ${oldStock} ‚Üí ${updated.currentStock} (min: ${updated.minStockLevel})${stockStatus}${supplierInfo}${expiryInfo}${notesInfo}. Updated at ${new Date().toLocaleString('en-IN', { dateStyle: 'medium', timeStyle: 'short' })}`\n        });\n      }\n      \n      // Send notification if stock is low\n      if (updated.category === 'trackable' && updated.currentStock <= updated.minStockLevel) {\n        await notifyLowInventory(updated.id, updated.name, updated.currentStock, updated.minStockLevel);\n      }\n      \n      res.json(updated);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/food-items/low-stock\", requireAuth, async (req, res) => {\n    try {\n      const items = await storage.getLowStockItems();\n      res.json(items);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/food-items/inventory\", requireAuth, async (req, res) => {\n    try {\n      const items = await storage.getInventoryItems();\n      res.json(items);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/food-items/:id/add-to-inventory\", requireAuth, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const item = await storage.getFoodItem(id);\n      if (!item) {\n        return res.status(404).json({ message: \"Food item not found\" });\n      }\n      \n      if (item.inInventory === 1) {\n        return res.status(400).json({ message: \"Item is already in inventory\" });\n      }\n      \n      const updated = await storage.addToInventory(id);\n      if (!updated) {\n        return res.status(404).json({ message: \"Food item not found\" });\n      }\n      \n      if (req.session.userId && req.session.username && req.session.role) {\n        await storage.createActivityLog({\n          userId: req.session.userId,\n          username: req.session.username,\n          userRole: req.session.role,\n          action: 'update',\n          entityType: 'food-inventory',\n          entityId: id,\n          details: `Added ${updated.name} to active inventory. Price: ‚Çπ${updated.price}, current stock: ${updated.currentStock} units (min level: ${updated.minStockLevel}). Now available for ordering at ${new Date().toLocaleString('en-IN', { dateStyle: 'medium', timeStyle: 'short' })}`\n        });\n      }\n      \n      res.json(updated);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/food-items/:id/remove-from-inventory\", requireAuth, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const updated = await storage.removeFromInventory(id);\n      if (!updated) {\n        return res.status(404).json({ message: \"Food item not found\" });\n      }\n      \n      if (req.session.userId && req.session.username && req.session.role) {\n        await storage.createActivityLog({\n          userId: req.session.userId,\n          username: req.session.username,\n          userRole: req.session.role,\n          action: 'update',\n          entityType: 'food-inventory',\n          entityId: id,\n          details: `Removed ${updated.name} from active inventory. Item moved back to catalog (${updated.currentStock} units remaining in stock). No longer available for ordering. Removed at ${new Date().toLocaleString('en-IN', { dateStyle: 'medium', timeStyle: 'short' })}`\n        });\n      }\n      \n      res.json(updated);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/food-items/reorder-list\", requireAuth, async (req, res) => {\n    try {\n      const items = await storage.getReorderList();\n      res.json(items);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/food-items/expiring\", requireAuth, async (req, res) => {\n    try {\n      const daysAhead = parseInt(req.query.days as string) || 7;\n      const items = await storage.getExpiringItems(daysAhead);\n      res.json(items);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/stock-batches\", requireAuth, async (req, res) => {\n    try {\n      const batches = await storage.getAllStockBatches();\n      res.json(batches);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/stock-batches/:foodItemId\", requireAuth, async (req, res) => {\n    try {\n      const { foodItemId } = req.params;\n      const batches = await storage.getStockBatchesByFoodItem(foodItemId);\n      res.json(batches);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/expenses\", requireAuth, async (req, res) => {\n    try {\n      const expenses = await storage.getAllExpenses();\n      res.json(expenses);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/expenses\", requireAuth, async (req, res) => {\n    try {\n      const expense = insertExpenseSchema.parse(req.body);\n      const created = await storage.createExpense(expense);\n      \n      // Send notification for new expense\n      await notifyExpenseAdded(created.id, created.category, created.amount);\n      \n      res.json(created);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.patch(\"/api/expenses/:id\", requireAuth, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const expense = insertExpenseSchema.parse(req.body);\n      const updated = await storage.updateExpense(id, expense);\n      if (!updated) {\n        return res.status(404).json({ message: \"Expense not found\" });\n      }\n      res.json(updated);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.delete(\"/api/expenses/:id\", requireAuth, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const deleted = await storage.deleteExpense(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Expense not found\" });\n      }\n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  // Activity Logs Routes\n  app.get(\"/api/activity-logs\", requireAuth, async (req, res) => {\n    try {\n      const logs = await storage.getAllActivityLogs();\n      res.json(logs);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Notification Routes\n  app.get(\"/api/notifications\", requireAuth, async (req, res) => {\n    try {\n      const notifications = await storage.getAllNotifications();\n      res.json(notifications);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/notifications/unread\", requireAuth, async (req, res) => {\n    try {\n      const notifications = await storage.getUnreadNotifications();\n      res.json(notifications);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/notifications/unread-count\", requireAuth, async (req, res) => {\n    try {\n      const count = await storage.getUnreadCount();\n      res.json({ count });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/notifications\", requireAuth, async (req, res) => {\n    try {\n      const notification = insertNotificationSchema.parse(req.body);\n      const created = await storage.createNotification(notification);\n      res.json(created);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.patch(\"/api/notifications/:id/read\", requireAuth, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const updated = await storage.markNotificationAsRead(id);\n      if (!updated) {\n        return res.status(404).json({ message: \"Notification not found\" });\n      }\n      res.json(updated);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.patch(\"/api/notifications/read-all\", requireAuth, async (req, res) => {\n    try {\n      await storage.markAllNotificationsAsRead();\n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.delete(\"/api/notifications/:id\", requireAuth, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const deleted = await storage.deleteNotification(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Notification not found\" });\n      }\n      res.json({ success: true });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Public Status Route (No Auth Required)\n  app.get(\"/api/public/status\", publicApiLimiter, async (req, res) => {\n    try {\n      const allBookings = await storage.getAllBookings();\n      const deviceConfigs = await storage.getAllDeviceConfigs();\n      \n      const availability = deviceConfigs.map(config => {\n        const activeBookings = allBookings.filter(booking => \n          booking.category === config.category && \n          (booking.status === \"running\" || booking.status === \"paused\")\n        );\n        \n        const totalSeats = config.count;\n        const occupiedSeats = activeBookings.length;\n        const availableSeats = totalSeats - occupiedSeats;\n        \n        return {\n          category: config.category,\n          total: totalSeats,\n          available: availableSeats,\n          occupied: occupiedSeats\n        };\n      });\n      \n      res.json(availability);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // WhatsApp Bot Routes\n  app.get(\"/api/whatsapp/availability\", publicApiLimiter, async (req, res) => {\n    try {\n      const allBookings = await storage.getAllBookings();\n      const deviceConfigs = await storage.getAllDeviceConfigs();\n      \n      const now = new Date();\n      \n      const availability = deviceConfigs.map(config => {\n        const activeBookings = allBookings.filter(booking => \n          booking.category === config.category && \n          (booking.status === \"running\" || booking.status === \"paused\")\n        );\n        \n        const totalSeats = config.count;\n        const occupiedSeats = activeBookings.length;\n        const availableSeats = totalSeats - occupiedSeats;\n        \n        return {\n          category: config.category,\n          total: totalSeats,\n          available: availableSeats,\n          occupied: occupiedSeats\n        };\n      });\n      \n      res.json(availability);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Import Twilio webhook verification\n  const { verifyTwilioWebhook } = await import('./twilio');\n  \n  app.post(\"/api/whatsapp/webhook\", webhookLimiter, verifyTwilioWebhook, async (req, res) => {\n    try {\n      const { Body, From } = req.body;\n      \n      if (!Body || !From) {\n        return res.status(400).json({ message: \"Missing required fields\" });\n      }\n      \n      const message = Body.toLowerCase().trim();\n      const phoneNumber = From.replace('whatsapp:', '');\n      \n      const keywords = ['available', 'availability', 'how many', 'pc', 'ps5', 'vr', 'free', 'check'];\n      const isAvailabilityQuery = keywords.some(keyword => message.includes(keyword));\n      \n      if (isAvailabilityQuery) {\n        const allBookings = await storage.getAllBookings();\n        const deviceConfigs = await storage.getAllDeviceConfigs();\n        \n        const availability = deviceConfigs.map(config => {\n          const activeBookings = allBookings.filter(booking => \n            booking.category === config.category && \n            (booking.status === \"running\" || booking.status === \"paused\")\n          );\n          \n          const totalSeats = config.count;\n          const occupiedSeats = activeBookings.length;\n          const availableSeats = totalSeats - occupiedSeats;\n          \n          return {\n            category: config.category,\n            total: totalSeats,\n            available: availableSeats,\n            occupied: occupiedSeats\n          };\n        });\n        \n        let responseMessage = \"üìä *Current Availability*\\n\\n\";\n        \n        availability.forEach(item => {\n          const percentage = item.total > 0 ? Math.round((item.available / item.total) * 100) : 0;\n          const status = item.available > 0 ? '‚úÖ' : '‚ùå';\n          responseMessage += `${status} *${item.category}*: ${item.available}/${item.total} available (${percentage}%)\\n`;\n        });\n        \n        responseMessage += `\\n_Updated: ${new Date().toLocaleString()}_`;\n        \n        const { sendWhatsAppMessage } = await import('./twilio');\n        await sendWhatsAppMessage(phoneNumber, responseMessage);\n        \n        return res.status(200).json({ success: true, message: \"Availability sent\" });\n      }\n      \n      return res.status(200).json({ success: true, message: \"Message received but not an availability query\" });\n    } catch (error: any) {\n      console.error('WhatsApp webhook error:', error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/consumer/center-info\", publicApiLimiter, async (req, res) => {\n    try {\n      const info = await storage.getGamingCenterInfo();\n      res.json(info || null);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/consumer/gallery\", publicApiLimiter, async (req, res) => {\n    try {\n      const images = await storage.getAllGalleryImages();\n      res.json(images);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/consumer/facilities\", publicApiLimiter, async (req, res) => {\n    try {\n      const facilities = await storage.getAllFacilities();\n      res.json(facilities);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/consumer/games\", publicApiLimiter, async (req, res) => {\n    try {\n      const games = await storage.getAllGames();\n      res.json(games);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/consumer/availability\", publicApiLimiter, async (req, res) => {\n    try {\n      const allBookings = await storage.getAllBookings();\n      const deviceConfigs = await storage.getAllDeviceConfigs();\n      \n      const availability = deviceConfigs.map(config => {\n        const activeBookings = allBookings.filter(booking => \n          booking.category === config.category && \n          (booking.status === \"running\" || booking.status === \"paused\")\n        );\n        \n        const totalSeats = config.count;\n        const occupiedSeats = activeBookings.length;\n        const availableSeats = totalSeats - occupiedSeats;\n        \n        return {\n          category: config.category,\n          total: totalSeats,\n          available: availableSeats,\n          occupied: occupiedSeats,\n          percentage: totalSeats > 0 ? Math.round((availableSeats / totalSeats) * 100) : 0\n        };\n      });\n      \n      res.json(availability);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/consumer/pricing\", publicApiLimiter, async (req, res) => {\n    try {\n      const pricing = await storage.getAllPricingConfigs();\n      res.json(pricing);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Data Retention Endpoints\n  app.get(\"/api/retention/config\", requireAdmin, async (req, res) => {\n    try {\n      const config = await retentionService.getConfig();\n      res.json(config);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/retention/cleanup\", requireAdmin, async (req, res) => {\n    try {\n      const result = await cleanupScheduler.runNow();\n      res.json({ \n        message: \"Cleanup completed successfully\",\n        result \n      });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.put(\"/api/retention/config\", requireAdmin, async (req, res) => {\n    try {\n      const updateSchema = z.object({\n        bookingHistoryDays: z.number().min(1).optional(),\n        activityLogsDays: z.number().min(1).optional(),\n        loadMetricsDays: z.number().min(1).optional(),\n        loadPredictionsDays: z.number().min(1).optional(),\n        expensesDays: z.number().min(1).optional(),\n      });\n      \n      const validatedData = updateSchema.parse(req.body);\n      const updated = await retentionService.updateConfig(validatedData);\n      \n      res.json({ \n        message: \"Retention config updated successfully\",\n        config: updated\n      });\n    } catch (error: any) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid retention config\", errors: error.errors });\n      }\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Neon Storage Metrics Endpoint\n  app.get(\"/api/storage/metrics\", requireAdmin, async (req, res) => {\n    try {\n      const metrics = await fetchNeonStorageMetrics();\n      res.json(metrics);\n    } catch (error: any) {\n      res.status(500).json({ \n        message: error.message || \"Failed to fetch storage metrics\",\n        error: process.env.NODE_ENV === 'development' ? error.stack : undefined\n      });\n    }\n  });\n\n  // Generate and download PDF documentation\n  app.get(\"/api/documentation/pdf\", publicApiLimiter, async (req, res) => {\n    try {\n      const { generateApplicationPDF } = await import('./pdf-generator');\n      generateApplicationPDF(res);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Maintenance Prediction Routes\n  app.get(\"/api/ai/maintenance/predictions\", requireAuth, async (req, res) => {\n    try {\n      const { generateMaintenancePredictions } = await import('./ai-maintenance');\n      const predictions = await generateMaintenancePredictions();\n      res.json(predictions);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Traffic Prediction Routes\n  app.get(\"/api/ai/traffic/predictions\", requireAuth, async (req, res) => {\n    try {\n      const { generateTrafficPredictions } = await import('./ai-traffic');\n      const predictions = await generateTrafficPredictions();\n      res.json(predictions);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n\n  app.get(\"/api/maintenance\", requireAuth, async (req, res) => {\n    try {\n      const maintenanceRecords = await storage.getAllDeviceMaintenance();\n      res.json(maintenanceRecords);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/maintenance\", requireAuth, async (req, res) => {\n    try {\n      const maintenanceSchema = z.object({\n        category: z.string(),\n        seatName: z.string(),\n        totalUsageHours: z.number().optional(),\n        totalSessions: z.number().optional(),\n        issuesReported: z.number().optional(),\n        maintenanceNotes: z.string().optional(),\n        status: z.string().optional(),\n        lastMaintenanceDate: z.union([z.string(), z.date()]).optional().transform(val => {\n          if (!val) return null;\n          return typeof val === 'string' ? new Date(val) : val;\n        }),\n      });\n\n      const validatedData = maintenanceSchema.parse(req.body);\n      const created = await storage.upsertDeviceMaintenance(validatedData);\n      \n      const { invalidateMaintenanceCache } = await import('./ai-maintenance');\n      invalidateMaintenanceCache();\n      \n      res.json(created);\n    } catch (error: any) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid maintenance data\", errors: error.errors });\n      }\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.put(\"/api/maintenance/:category/:seatName/status\", requireAuth, async (req, res) => {\n    try {\n      const { category, seatName } = req.params;\n      const { status, notes } = req.body;\n\n      if (!status) {\n        return res.status(400).json({ message: \"Status is required\" });\n      }\n\n      const updated = await storage.updateDeviceMaintenanceStatus(\n        category,\n        decodeURIComponent(seatName),\n        status,\n        notes\n      );\n\n      if (!updated) {\n        return res.status(404).json({ message: \"Device maintenance record not found\" });\n      }\n\n      const { invalidateMaintenanceCache } = await import('./ai-maintenance');\n      invalidateMaintenanceCache();\n\n      res.json(updated);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/maintenance/:category/:seatName/report-issue\", requireAuth, async (req, res) => {\n    try {\n      const { category, seatName } = req.params;\n      const { issueType } = req.body;\n\n      if (!issueType) {\n        return res.status(400).json({ message: \"Issue type is required\" });\n      }\n\n      const decodedSeatName = decodeURIComponent(seatName);\n      const existing = await storage.getDeviceMaintenance(category, decodedSeatName);\n\n      const currentIssues = existing?.issuesReported || 0;\n      const updatedIssues = currentIssues + 1;\n\n      await storage.upsertDeviceMaintenance({\n        category,\n        seatName: decodedSeatName,\n        totalUsageHours: existing?.totalUsageHours || 0,\n        totalSessions: existing?.totalSessions || 0,\n        issuesReported: updatedIssues,\n        status: issueType === \"repair\" ? \"needs_repair\" : \"has_glitch\",\n        maintenanceNotes: `${issueType === \"repair\" ? \"Repair\" : \"Glitch\"} reported by staff`,\n        lastMaintenanceDate: existing?.lastMaintenanceDate || null,\n      });\n\n      let suggestion = `Issue reported successfully. Device now has ${updatedIssues} issue(s) on record.`;\n\n      try {\n        const { getMaintenanceRecommendation } = await import('./ai-maintenance');\n        const daysSince = existing?.lastMaintenanceDate \n          ? Math.floor((Date.now() - new Date(existing.lastMaintenanceDate).getTime()) / (1000 * 60 * 60 * 24))\n          : null;\n\n        const recommendation = await getMaintenanceRecommendation({\n          category,\n          seatName: decodedSeatName,\n          usageHours: existing?.totalUsageHours || 0,\n          sessions: existing?.totalSessions || 0,\n          issues: updatedIssues,\n          daysSinceMaintenance: daysSince,\n        });\n\n        suggestion = `${issueType === \"repair\" ? \"Repair needed\" : \"Glitch detected\"}: ${recommendation}`;\n      } catch (recError) {\n        console.error(\"Recommendation failed:\", recError);\n        suggestion = `${issueType === \"repair\" ? \"Repair needed\" : \"Glitch detected\"}. Please check the Maintenance predictions for detailed analysis.`;\n      }\n\n      const { invalidateMaintenanceCache } = await import('./ai-maintenance');\n      invalidateMaintenanceCache();\n\n      res.json({ \n        success: true, \n        issuesReported: updatedIssues,\n        aiSuggestion: suggestion \n      });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/customer/:whatsappNumber/active-bookings\", requireAuth, async (req, res) => {\n    try {\n      const { whatsappNumber } = req.params;\n      const allBookings = await storage.getAllBookings();\n      const activeBookings = allBookings.filter(booking => \n        booking.whatsappNumber === decodeURIComponent(whatsappNumber) && \n        (booking.status === 'running' || booking.status === 'paused')\n      );\n      res.json(activeBookings);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  const httpServer = createServer(app);\n\n  return httpServer;\n}\n","path":null,"size_bytes":84445,"size_tokens":null},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":2263,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/hooks/useSoundAlert.ts":{"content":"import { useCallback, useRef } from 'react';\n\nexport type SoundType = 'success' | 'error' | 'warning' | 'info' | 'timer';\n\nexport function useSoundAlert() {\n  const audioContextRef = useRef<AudioContext | null>(null);\n\n  const initAudioContext = useCallback(() => {\n    if (!audioContextRef.current) {\n      audioContextRef.current = new (window.AudioContext || (window as any).webkitAudioContext)();\n    }\n    return audioContextRef.current;\n  }, []);\n\n  const playBeep = useCallback((frequency: number, duration: number, type: OscillatorType = 'sine') => {\n    const ctx = initAudioContext();\n    const oscillator = ctx.createOscillator();\n    const gainNode = ctx.createGain();\n\n    oscillator.connect(gainNode);\n    gainNode.connect(ctx.destination);\n\n    oscillator.frequency.value = frequency;\n    oscillator.type = type;\n    gainNode.gain.setValueAtTime(0.3, ctx.currentTime);\n    gainNode.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + duration);\n\n    oscillator.start(ctx.currentTime);\n    oscillator.stop(ctx.currentTime + duration);\n  }, [initAudioContext]);\n\n  const playSound = useCallback((soundType: SoundType) => {\n    switch (soundType) {\n      case 'success':\n        // Happy ascending tones\n        playBeep(523.25, 0.1); // C5\n        setTimeout(() => playBeep(659.25, 0.15), 100); // E5\n        break;\n      case 'error':\n        // Harsh descending tones\n        playBeep(493.88, 0.1, 'square'); // B4\n        setTimeout(() => playBeep(329.63, 0.2, 'square'), 100); // E4\n        break;\n      case 'warning':\n        // Alert pattern\n        playBeep(880, 0.1); // A5\n        setTimeout(() => playBeep(880, 0.1), 150);\n        break;\n      case 'info':\n        // Gentle single beep\n        playBeep(523.25, 0.15); // C5\n        break;\n      case 'timer':\n        // Urgent repeating beeps\n        playBeep(1046.5, 0.2); // C6\n        setTimeout(() => playBeep(1046.5, 0.2), 250);\n        setTimeout(() => playBeep(1046.5, 0.2), 500);\n        break;\n    }\n  }, [playBeep]);\n\n  return { playSound };\n}\n","path":null,"size_bytes":2035,"size_tokens":null},"server/db.ts":{"content":"import { Pool } from 'pg';\nimport { drizzle } from 'drizzle-orm/node-postgres';\nimport * as schema from \"@shared/schema\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ \n  connectionString: process.env.DATABASE_URL,\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,\n  max: 20,\n  idleTimeoutMillis: 30000,\n  connectionTimeoutMillis: 5000,\n});\n\nexport const db = drizzle(pool, { schema });\n","path":null,"size_bytes":542,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"DATA_RETENTION_SUMMARY.md":{"content":"# ‚úÖ Data Retention Configuration Complete\n\n**Date:** November 14, 2025  \n**Requested By:** Owner  \n**Requirement:** Keep ALL business data safe forever (no automatic cleanup)\n\n---\n\n## üéØ What Was Done\n\n### 1. ‚úÖ Automatic Cleanup DISABLED\n- **Before:** System deleted old data automatically at 2:00 AM daily\n- **After:** NO automatic cleanup - all data kept forever\n- **File Changed:** `server/index.ts` (line 159)\n\n### 2. ‚úÖ Retention Settings Updated to 100 Years\n- **Before:** Data deleted after:\n  - Booking history: 2 years\n  - Activity logs: 6 months\n  - Load metrics: 90 days\n  - Expenses: 7 years\n\n- **After:** All data kept for 100 years (36,500 days)\n  - Booking history: 100 years ‚úÖ\n  - Activity logs: 100 years ‚úÖ\n  - Load metrics: 100 years ‚úÖ\n  - Expenses: 100 years ‚úÖ\n- **File Changed:** `shared/schema.ts` (lines 434-440)\n\n### 3. ‚úÖ Database Created\n- **Provider:** Neon PostgreSQL (FREE tier)\n- **Storage:** 512 MB\n- **Location:** Replit-hosted\n- **Status:** Active and running\n\n### 4. ‚úÖ Documentation Created\n- **Main Guide:** `NEON_6_DATABASE_SETUP.md`\n  - How to scale to 3 GB (6 free databases) when needed\n  - Timeline and cost projections\n  - Implementation guide for future\n  \n- **Project Docs:** `replit.md` updated with retention strategy\n\n---\n\n## üìä Storage Capacity & Timeline\n\n**With Your Current Usage (70 customers/day):**\n\n| Year | Storage Used | % of 512 MB | Status |\n|------|--------------|-------------|--------|\n| 1 | 106 MB | 21% | ‚úÖ Plenty of space |\n| 3 | 251 MB | 49% | ‚úÖ Still good |\n| 5 | 396 MB | 77% | ‚ö†Ô∏è Getting full |\n| 6 | 469 MB | 92% | üö® Near limit |\n| 7 | 541 MB | 106% | ‚ùå Exceeds 512 MB |\n\n**You have 6-7 years before needing to make any changes!**\n\n---\n\n## üí∞ Cost Status\n\n**Current:** **$0/month** (FREE Neon tier)\n\n**Future Options (when you reach 400-500 MB in ~5-6 years):**\n\n1. **Upgrade to Paid Neon:** $5-7/month\n   - Simple, no code changes\n   - Unlimited storage\n\n2. **Use 6 Free Neon Projects:** $0/month\n   - 3 GB total storage (6 √ó 512 MB)\n   - Requires code changes\n   - Good for 41+ years\n   - See `NEON_6_DATABASE_SETUP.md` for details\n\n---\n\n## üîí What Data is Now Protected Forever\n\n‚úÖ **All Booking History** - Every customer session ever  \n‚úÖ **All Payment Logs** - Complete financial records  \n‚úÖ **All Expenses** - Tax-deductible business costs  \n‚úÖ **All Activity Logs** - Complete audit trail  \n‚úÖ **All Analytics Data** - Business insights and metrics  \n\n**Nothing will be deleted automatically!**\n\n---\n\n## üìà Benefits for Your Business\n\n1. **Tax Compliance** ‚úÖ\n   - Keep all financial records for audits\n   - Expense tracking for deductions\n\n2. **Customer History** ‚úÖ\n   - See every customer's complete history\n   - Analyze long-term patterns\n\n3. **Business Analytics** ‚úÖ\n   - Year-over-year comparisons\n   - Growth trends and forecasting\n\n4. **Legal Protection** ‚úÖ\n   - Complete audit trail\n   - Dispute resolution records\n\n---\n\n## üîç How to Monitor Storage\n\n1. **Neon Dashboard:** https://console.neon.tech/\n   - Login with your account\n   - View storage usage graph\n   - See real-time metrics\n\n2. **When to Check:**\n   - Monthly review (5 minutes)\n   - Set reminder for Year 5 (when ~400 MB used)\n\n3. **Alert Threshold:**\n   - When you reach 400 MB (75% full)\n   - You'll have plenty of time to decide on scaling\n\n---\n\n## ‚úÖ Verification\n\n**System Status Confirmed:**\n- ‚úÖ Cleanup scheduler: DISABLED\n- ‚úÖ Retention config: 100 years\n- ‚úÖ Database: Created and running\n- ‚úÖ Application: Working correctly\n- ‚úÖ All data: Being preserved\n\n**How to Verify:**\n- Server logs show NO cleanup messages\n- No \"Next cleanup scheduled\" warnings\n- System running normally\n\n---\n\n## üìû What to Do in 5-6 Years\n\nWhen you approach 400-500 MB storage:\n\n1. **Check Neon Dashboard** - Review actual usage\n2. **Choose Your Path:**\n   - Easy: Upgrade to paid ($5-7/month)\n   - Free: Set up 6 databases (requires coding help)\n3. **Contact Support** - Request assistance if needed\n\n**For now, you're completely set!**\n\n---\n\n## üéÆ Summary\n\n**‚úÖ Owner's Requirement Met:** All business data kept safe forever  \n**‚úÖ Cost:** $0/month for next 6-7 years  \n**‚úÖ Storage:** 512 MB with room to grow  \n**‚úÖ Timeline:** No action needed until Year 5-6  \n**‚úÖ Documentation:** Complete guides created  \n\n**Your data is safe, your costs are zero, and you have years of runway!** üéâ\n\n---\n\n## üìÑ Related Files\n\n- `NEON_6_DATABASE_SETUP.md` - Future scaling guide\n- `replit.md` - Project architecture (updated)\n- `server/index.ts` - Cleanup disabled (line 159)\n- `shared/schema.ts` - Retention config (lines 434-440)\n\n**Everything is documented and ready for the long term!** ‚ú®\n","path":null,"size_bytes":4696,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"server/ai-maintenance.ts":{"content":"import { storage } from \"./storage\";\nimport type { DeviceMaintenance } from \"@shared/schema\";\n\nexport interface MaintenancePrediction {\n  category: string;\n  seatName: string;\n  riskLevel: \"low\" | \"medium\" | \"high\";\n  recommendedAction: string;\n  estimatedDaysUntilMaintenance: number;\n  reasoning: string;\n  metrics: {\n    usageHours: number;\n    totalSessions: number;\n    issuesReported: number;\n    daysSinceLastMaintenance: number | null;\n  };\n}\n\nexport interface MaintenanceInsights {\n  predictions: MaintenancePrediction[];\n  summary: {\n    highRiskDevices: number;\n    mediumRiskDevices: number;\n    lowRiskDevices: number;\n    totalDevices: number;\n    recommendedActions: string[];\n  };\n  generatedAt: Date;\n}\n\nlet cachedPredictions: { data: MaintenanceInsights; timestamp: number } | null = null;\nlet cacheGeneration = 0;\nconst CACHE_DURATION = 5 * 60 * 1000;\n\nexport function invalidateMaintenanceCache() {\n  cachedPredictions = null;\n  cacheGeneration++;\n}\n\nexport async function generateMaintenancePredictions(): Promise<MaintenanceInsights> {\n  if (cachedPredictions && Date.now() - cachedPredictions.timestamp < CACHE_DURATION) {\n    return cachedPredictions.data;\n  }\n\n  const currentGeneration = cacheGeneration;\n\n  const [maintenanceRecords, deviceConfigs, bookingHistory] = await Promise.all([\n    storage.getAllDeviceMaintenance(),\n    storage.getAllDeviceConfigs(),\n    storage.getAllBookingHistory()\n  ]);\n\n  const allDevices: Array<{ category: string; seatName: string }> = [];\n  deviceConfigs.forEach(config => {\n    config.seats.forEach(seat => {\n      allDevices.push({ category: config.category, seatName: seat });\n    });\n  });\n\n  const predictionPromises = allDevices.map(async (device) => {\n    const maintenance = maintenanceRecords.find(\n      m => m.category === device.category && m.seatName === device.seatName\n    );\n\n    const deviceBookings = bookingHistory.filter(\n      b => b.category === device.category && b.seatName === device.seatName\n    );\n    const historicalUsageHours = deviceBookings.reduce((sum, b) => {\n      const duration = new Date(b.endTime).getTime() - new Date(b.startTime).getTime();\n      return sum + (duration / (1000 * 60 * 60));\n    }, 0);\n\n    const usageHours = (maintenance?.totalUsageHours || 0) + historicalUsageHours;\n    const totalSessions = (maintenance?.totalSessions || 0) + deviceBookings.length;\n    const issuesReported = maintenance?.issuesReported || 0;\n    const lastMaintenance = maintenance?.lastMaintenanceDate;\n    \n    const daysSinceLastMaintenance = lastMaintenance\n      ? Math.floor((Date.now() - new Date(lastMaintenance).getTime()) / (1000 * 60 * 60 * 24))\n      : null;\n\n    const prediction = calculateMaintenancePrediction(\n      usageHours,\n      totalSessions,\n      issuesReported,\n      daysSinceLastMaintenance\n    );\n\n    return {\n      category: device.category,\n      seatName: device.seatName,\n      riskLevel: prediction.riskLevel,\n      recommendedAction: prediction.recommendedAction,\n      estimatedDaysUntilMaintenance: prediction.estimatedDays,\n      reasoning: prediction.reasoning,\n      metrics: {\n        usageHours,\n        totalSessions,\n        issuesReported,\n        daysSinceLastMaintenance,\n      },\n    };\n  });\n\n  const predictions = await Promise.all(predictionPromises);\n\n  const highRisk = predictions.filter(p => p.riskLevel === \"high\");\n  const mediumRisk = predictions.filter(p => p.riskLevel === \"medium\");\n  const lowRisk = predictions.filter(p => p.riskLevel === \"low\");\n\n  const recommendedActions: string[] = [];\n  if (highRisk.length > 0) {\n    recommendedActions.push(`Prioritize maintenance for ${highRisk.length} high-risk device(s)`);\n  }\n  if (mediumRisk.length > 0) {\n    recommendedActions.push(`Schedule preventive maintenance for ${mediumRisk.length} medium-risk device(s)`);\n  }\n  recommendedActions.push(`${lowRisk.length} device(s) operating normally`);\n\n  const result = {\n    predictions: predictions.sort((a, b) => {\n      const riskOrder = { high: 3, medium: 2, low: 1 };\n      return riskOrder[b.riskLevel] - riskOrder[a.riskLevel];\n    }),\n    summary: {\n      highRiskDevices: highRisk.length,\n      mediumRiskDevices: mediumRisk.length,\n      lowRiskDevices: lowRisk.length,\n      totalDevices: predictions.length,\n      recommendedActions,\n    },\n    generatedAt: new Date(),\n  };\n\n  if (currentGeneration === cacheGeneration) {\n    cachedPredictions = { data: result, timestamp: Date.now() };\n  }\n\n  return result;\n}\n\nfunction calculateMaintenancePrediction(\n  usageHours: number,\n  totalSessions: number,\n  issuesReported: number,\n  daysSinceLastMaintenance: number | null\n) {\n  let riskLevel: \"low\" | \"medium\" | \"high\" = \"low\";\n  let estimatedDays = 90;\n  let recommendedAction = \"Continue regular monitoring\";\n  let reasoning = \"\";\n\n  const averageSessionDuration = totalSessions > 0 ? usageHours / totalSessions : 0;\n  const usageIntensity = averageSessionDuration;\n  \n  let riskScore = 0;\n  \n  if (usageHours > 500) riskScore += 40;\n  else if (usageHours > 300) riskScore += 25;\n  else if (usageHours > 150) riskScore += 10;\n  \n  if (totalSessions > 200) riskScore += 25;\n  else if (totalSessions > 100) riskScore += 15;\n  else if (totalSessions > 50) riskScore += 5;\n  \n  if (issuesReported > 3) riskScore += 30;\n  else if (issuesReported > 1) riskScore += 20;\n  else if (issuesReported > 0) riskScore += 10;\n  \n  if (daysSinceLastMaintenance !== null) {\n    if (daysSinceLastMaintenance > 90) riskScore += 35;\n    else if (daysSinceLastMaintenance > 60) riskScore += 25;\n    else if (daysSinceLastMaintenance > 30) riskScore += 10;\n  } else {\n    riskScore += 15;\n  }\n  \n  if (usageIntensity > 3) riskScore += 10;\n  else if (usageIntensity > 2) riskScore += 5;\n\n  if (riskScore >= 70) {\n    riskLevel = \"high\";\n    estimatedDays = Math.max(3, 14 - Math.floor(riskScore / 10));\n    recommendedAction = \"Schedule immediate maintenance - device needs urgent attention\";\n    reasoning = `Critical condition detected: ${Math.round(usageHours)}h total usage, ${totalSessions} sessions, ${issuesReported} issue(s) reported${daysSinceLastMaintenance ? `, ${daysSinceLastMaintenance} days since last maintenance` : ', never serviced'}. Risk score: ${riskScore}/100. Immediate maintenance required to prevent breakdown.`;\n  } else if (riskScore >= 40) {\n    riskLevel = \"medium\";\n    estimatedDays = Math.max(14, 45 - Math.floor(riskScore / 2));\n    recommendedAction = \"Plan preventive maintenance within 2-4 weeks\";\n    reasoning = `Moderate wear detected: ${Math.round(usageHours)}h total usage, ${totalSessions} sessions, ${issuesReported} issue(s) reported${daysSinceLastMaintenance ? `, ${daysSinceLastMaintenance} days since last maintenance` : ', never serviced'}. Risk score: ${riskScore}/100. Preventive maintenance recommended to avoid future issues.`;\n  } else {\n    riskLevel = \"low\";\n    estimatedDays = Math.max(30, 90 - riskScore);\n    recommendedAction = \"Continue regular monitoring\";\n    reasoning = `Normal operation: ${Math.round(usageHours)}h total usage, ${totalSessions} sessions, ${issuesReported} issue(s) reported${daysSinceLastMaintenance ? `, ${daysSinceLastMaintenance} days since last maintenance` : ', never serviced'}. Risk score: ${riskScore}/100. Device is operating within safe parameters.`;\n  }\n\n  return { riskLevel, estimatedDays, recommendedAction, reasoning };\n}\n\nexport async function getMaintenanceRecommendation(\n  deviceData: {\n    category: string;\n    seatName: string;\n    usageHours: number;\n    sessions: number;\n    issues: number;\n    daysSinceMaintenance: number | null;\n  }\n): Promise<string> {\n  const prediction = calculateMaintenancePrediction(\n    deviceData.usageHours,\n    deviceData.sessions,\n    deviceData.issues,\n    deviceData.daysSinceMaintenance\n  );\n\n  let recommendation = `${deviceData.category} - ${deviceData.seatName}: `;\n  \n  if (prediction.riskLevel === \"high\") {\n    recommendation += `‚ö†Ô∏è URGENT - Schedule maintenance within ${prediction.estimatedDays} days. `;\n    recommendation += `Device has accumulated ${Math.round(deviceData.usageHours)} hours of use across ${deviceData.sessions} sessions`;\n    if (deviceData.issues > 0) {\n      recommendation += ` with ${deviceData.issues} reported issue(s)`;\n    }\n    recommendation += `. Immediate attention required to prevent downtime.`;\n  } else if (prediction.riskLevel === \"medium\") {\n    recommendation += `üìã Plan maintenance within ${prediction.estimatedDays} days. `;\n    recommendation += `Preventive servicing recommended based on ${Math.round(deviceData.usageHours)} usage hours`;\n    if (deviceData.daysSinceMaintenance) {\n      recommendation += ` and ${deviceData.daysSinceMaintenance} days since last service`;\n    }\n    recommendation += `. Early intervention will extend device lifespan.`;\n  } else {\n    recommendation += `‚úì Operating normally. Next routine check recommended in ${prediction.estimatedDays} days. `;\n    recommendation += `Current metrics are within acceptable ranges.`;\n  }\n\n  return recommendation;\n}\n","path":null,"size_bytes":9026,"size_tokens":null},"client/src/components/CategoryCard.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { LucideIcon } from \"lucide-react\";\n\ninterface CategoryCardProps {\n  title: string;\n  icon: LucideIcon;\n  available: number;\n  total: number;\n  color: string;\n  onViewDetails?: () => void;\n}\n\nexport function CategoryCard({ title, icon: Icon, available, total, color, onViewDetails }: CategoryCardProps) {\n  const occupied = total - available;\n  const percentage = total > 0 ? (occupied / total) * 100 : 0;\n  \n  return (\n    <Card \n      className=\"glass-card group shape-diagonal-rounded card-rectangular overflow-hidden cursor-pointer hover:shadow-xl hover:scale-[1.03] active:scale-[0.98] transition-all duration-300 border-2 hover:border-primary/20\" \n      data-testid={`card-category-${title.toLowerCase()}`}\n      onClick={onViewDetails}\n    >\n      <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-3 pt-5\">\n        <CardTitle className=\"text-base sm:text-lg font-bold text-foreground\">{title}</CardTitle>\n        <div className=\"p-2 rounded-lg bg-gradient-to-br from-primary/10 to-primary/5 group-hover:from-primary/20 group-hover:to-primary/10 transition-colors\">\n          <Icon className={`h-5 w-5 sm:h-6 sm:w-6 ${color} group-hover:scale-110 transition-transform duration-300`} />\n        </div>\n      </CardHeader>\n      <CardContent className=\"flex flex-col gap-4 pb-5\">\n        <div className=\"text-3xl sm:text-4xl md:text-5xl font-bold text-foreground\" data-testid={`text-availability-${title.toLowerCase()}`}>\n          {available}<span className=\"text-xl sm:text-2xl md:text-3xl text-muted-foreground font-semibold\">/{total}</span>\n        </div>\n        <div className=\"space-y-2\">\n          <div className=\"flex justify-between items-center\">\n            <p className=\"text-xs sm:text-sm text-muted-foreground font-medium\">\n              Seat occupancy\n            </p>\n            <p className=\"text-xs sm:text-sm font-bold text-foreground px-2 py-0.5 rounded-md bg-muted\">\n              {Math.round(percentage)}%\n            </p>\n          </div>\n          <div className=\"h-2.5 sm:h-3 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden shadow-inner\">\n            <div \n              className={`h-full ${color} bg-current transition-all duration-500 ease-out rounded-full`}\n              style={{ width: `${percentage}%` }}\n            />\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":2463,"size_tokens":null},"client/src/pages/TermsAndConditions.tsx":{"content":"import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Button } from \"@/components/ui/button\";\nimport { Instagram, Linkedin, Github, Twitter, Mail } from \"lucide-react\";\n\nexport default function TermsAndConditions() {\n  return (\n    <div className=\"container mx-auto max-w-4xl\" data-testid=\"page-terms\">\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-3xl font-bold\">Terms and Conditions</CardTitle>\n          <CardDescription>\n            Effective Date: October 27, 2025\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <ScrollArea className=\"h-[600px] pr-4\">\n            <div className=\"space-y-6\">\n              <section>\n                <h2 className=\"text-2xl font-semibold mb-3\">1. Introduction and Acceptance</h2>\n                <p className=\"text-muted-foreground leading-relaxed\">\n                  Welcome to Airavoto Gaming Center. By using our gaming facilities, booking services, or participating in any activities at our center, you agree to comply with and be bound by these Terms and Conditions. This document governs your use of our gaming center services, including PC gaming, PlayStation 5, VR experiences, car simulators, food and beverage services, loyalty programs, and tournament participation.\n                </p>\n              </section>\n\n              <Separator />\n\n              <section>\n                <h2 className=\"text-2xl font-semibold mb-3\">2. Service Description</h2>\n                <p className=\"text-muted-foreground leading-relaxed mb-3\">\n                  Airavoto Gaming Center provides the following services:\n                </p>\n                <ul className=\"list-disc list-inside space-y-2 text-muted-foreground ml-4\">\n                  <li><strong>Gaming Stations:</strong> Access to various gaming devices including PCs, PlayStation 5 consoles, VR headsets, and car racing simulators</li>\n                  <li><strong>Booking System:</strong> Walk-in and advance booking options with flexible session durations</li>\n                  <li><strong>Food & Beverage:</strong> In-house food and drink ordering during gaming sessions</li>\n                  <li><strong>Loyalty Program:</strong> Earn 1 point for every ‚Çπ1 spent and redeem rewards</li>\n                  <li><strong>Tournament Participation:</strong> Organized gaming competitions with prize pools</li>\n                  <li><strong>WhatsApp Notifications:</strong> Real-time availability updates and booking confirmations</li>\n                  <li><strong>Happy Hours:</strong> Special pricing during designated time periods</li>\n                </ul>\n              </section>\n\n              <Separator />\n\n              <section>\n                <h2 className=\"text-2xl font-semibold mb-3\">3. Booking and Reservations</h2>\n                <p className=\"text-muted-foreground leading-relaxed mb-3\">\n                  <strong>3.1 Walk-in Bookings:</strong> Available on a first-come, first-served basis subject to availability of gaming stations.\n                </p>\n                <p className=\"text-muted-foreground leading-relaxed mb-3\">\n                  <strong>3.2 Advance Bookings:</strong> Customers may book gaming sessions in advance. Advanced bookings are confirmed upon availability verification and require customer contact information (name and WhatsApp number).\n                </p>\n                <p className=\"text-muted-foreground leading-relaxed mb-3\">\n                  <strong>3.3 Booking Modifications:</strong> Session times may be paused, resumed, or extended based on availability and pricing policies. Extensions are charged according to the current pricing tier.\n                </p>\n                <p className=\"text-muted-foreground leading-relaxed\">\n                  <strong>3.4 No-Shows:</strong> Customers who fail to arrive within 15 minutes of their scheduled booking time may forfeit their reservation without refund.\n                </p>\n              </section>\n\n              <Separator />\n\n              <section>\n                <h2 className=\"text-2xl font-semibold mb-3\">4. Pricing and Payment</h2>\n                <p className=\"text-muted-foreground leading-relaxed mb-3\">\n                  <strong>4.1 Pricing Structure:</strong> Gaming sessions are priced based on device type, duration, and number of persons (for applicable categories like PlayStation 5). Prices are displayed in Indian Rupees (‚Çπ).\n                </p>\n                <p className=\"text-muted-foreground leading-relaxed mb-3\">\n                  <strong>4.2 Happy Hours:</strong> Special discounted rates apply during designated happy hour time slots. Happy hour pricing is subject to change and availability.\n                </p>\n                <p className=\"text-muted-foreground leading-relaxed mb-3\">\n                  <strong>4.3 Payment Methods:</strong> We accept Cash, UPI, Card, and Online payment methods. Full payment is required at the completion of the gaming session.\n                </p>\n                <p className=\"text-muted-foreground leading-relaxed mb-3\">\n                  <strong>4.4 Additional Charges:</strong> Food and beverage orders are charged separately and added to your final bill.\n                </p>\n                <p className=\"text-muted-foreground leading-relaxed\">\n                  <strong>4.5 Refund Policy:</strong> Refunds are not provided for partially used sessions. In case of technical issues with equipment that prevent gameplay, appropriate credits or refunds will be issued at management's discretion.\n                </p>\n              </section>\n\n              <Separator />\n\n              <section>\n                <h2 className=\"text-2xl font-semibold mb-3\">5. Customer Loyalty Program</h2>\n                <p className=\"text-muted-foreground leading-relaxed mb-3\">\n                  <strong>5.1 Points Earning:</strong> Customers automatically earn 1 loyalty point for every ‚Çπ1 spent on gaming sessions and food orders. Points are credited when bookings are marked as completed or expired.\n                </p>\n                <p className=\"text-muted-foreground leading-relaxed mb-3\">\n                  <strong>5.2 Points Redemption:</strong> Accumulated points can be redeemed for rewards from our rewards catalog. Minimum point requirements apply per reward.\n                </p>\n                <p className=\"text-muted-foreground leading-relaxed mb-3\">\n                  <strong>5.3 Points Validity:</strong> Loyalty points do not expire but are tied to your WhatsApp number. Customers are responsible for maintaining accurate contact information.\n                </p>\n                <p className=\"text-muted-foreground leading-relaxed\">\n                  <strong>5.4 Program Modifications:</strong> We reserve the right to modify or discontinue the loyalty program at any time. Existing points will be honored for a reasonable transition period.\n                </p>\n              </section>\n\n              <Separator />\n\n              <section>\n                <h2 className=\"text-2xl font-semibold mb-3\">6. Food and Beverage Services</h2>\n                <p className=\"text-muted-foreground leading-relaxed mb-3\">\n                  <strong>6.1 Ordering:</strong> Food and beverages can be ordered during gaming sessions through our staff. Items are subject to availability based on current inventory levels.\n                </p>\n                <p className=\"text-muted-foreground leading-relaxed mb-3\">\n                  <strong>6.2 Outside Food:</strong> Outside food and beverages are not permitted inside the gaming center.\n                </p>\n                <p className=\"text-muted-foreground leading-relaxed\">\n                  <strong>6.3 Allergies and Dietary Restrictions:</strong> Customers must inform staff of any food allergies or dietary restrictions when ordering. We cannot guarantee a completely allergen-free environment.\n                </p>\n              </section>\n\n              <Separator />\n\n              <section>\n                <h2 className=\"text-2xl font-semibold mb-3\">7. Tournament Participation</h2>\n                <p className=\"text-muted-foreground leading-relaxed mb-3\">\n                  <strong>7.1 Registration:</strong> Tournament registration is open to all customers on a first-come, first-served basis until maximum participant capacity is reached.\n                </p>\n                <p className=\"text-muted-foreground leading-relaxed mb-3\">\n                  <strong>7.2 Rules and Conduct:</strong> Participants must adhere to specific tournament rules, game settings, and codes of conduct as announced by tournament organizers. Violation may result in disqualification.\n                </p>\n                <p className=\"text-muted-foreground leading-relaxed mb-3\">\n                  <strong>7.3 Prize Distribution:</strong> Prizes are awarded based on final standings as determined by tournament organizers. Prize pool amounts are announced prior to tournament start.\n                </p>\n                <p className=\"text-muted-foreground leading-relaxed\">\n                  <strong>7.4 Cancellation:</strong> Management reserves the right to cancel or reschedule tournaments due to insufficient participation or unforeseen circumstances. Registered participants will be notified via WhatsApp.\n                </p>\n              </section>\n\n              <Separator />\n\n              <section>\n                <h2 className=\"text-2xl font-semibold mb-3\">8. Equipment Usage and Conduct</h2>\n                <p className=\"text-muted-foreground leading-relaxed mb-3\">\n                  <strong>8.1 Responsible Use:</strong> Customers must use all gaming equipment with care and follow staff instructions. Any damage caused by misuse, negligence, or intentional actions will be charged to the customer.\n                </p>\n                <p className=\"text-muted-foreground leading-relaxed mb-3\">\n                  <strong>8.2 Prohibited Activities:</strong> The following activities are strictly prohibited:\n                </p>\n                <ul className=\"list-disc list-inside space-y-2 text-muted-foreground ml-4\">\n                  <li>Installing unauthorized software or games</li>\n                  <li>Accessing inappropriate or illegal content</li>\n                  <li>Tampering with system settings or hardware</li>\n                  <li>Sharing gaming stations without staff authorization</li>\n                  <li>Engaging in disruptive behavior or harassment</li>\n                </ul>\n                <p className=\"text-muted-foreground leading-relaxed mt-3\">\n                  <strong>8.3 Code of Conduct:</strong> Customers must maintain respectful behavior toward staff and other customers. We reserve the right to terminate sessions and ban individuals for misconduct without refund.\n                </p>\n              </section>\n\n              <Separator />\n\n              <section>\n                <h2 className=\"text-2xl font-semibold mb-3\">9. Data Privacy and WhatsApp Communications</h2>\n                <p className=\"text-muted-foreground leading-relaxed mb-3\">\n                  <strong>9.1 Data Collection:</strong> We collect customer information including name, WhatsApp number, booking history, spending records, and loyalty points for service delivery and business operations.\n                </p>\n                <p className=\"text-muted-foreground leading-relaxed mb-3\">\n                  <strong>9.2 WhatsApp Notifications:</strong> By providing your WhatsApp number, you consent to receive automated messages regarding booking confirmations, availability updates, tournament notifications, and promotional offers.\n                </p>\n                <p className=\"text-muted-foreground leading-relaxed mb-3\">\n                  <strong>9.3 Data Security:</strong> We implement reasonable security measures to protect customer data. However, we cannot guarantee absolute security against unauthorized access.\n                </p>\n                <p className=\"text-muted-foreground leading-relaxed\">\n                  <strong>9.4 Data Retention:</strong> Customer data is retained according to our data retention policies. Booking history is retained for 2 years, and expense records for 7 years, after which data is automatically purged from our systems.\n                </p>\n              </section>\n\n              <Separator />\n\n              <section>\n                <h2 className=\"text-2xl font-semibold mb-3\">10. System Availability and Technical Issues</h2>\n                <p className=\"text-muted-foreground leading-relaxed mb-3\">\n                  <strong>10.1 Service Availability:</strong> We strive to maintain operational gaming equipment at all times, but cannot guarantee 100% uptime. Scheduled maintenance may result in temporary unavailability of specific devices.\n                </p>\n                <p className=\"text-muted-foreground leading-relaxed mb-3\">\n                  <strong>10.2 Technical Support:</strong> Staff will provide reasonable technical assistance for gaming-related issues. However, we are not responsible for game-specific bugs or third-party service outages (e.g., Steam, PlayStation Network).\n                </p>\n                <p className=\"text-muted-foreground leading-relaxed\">\n                  <strong>10.3 Equipment Failure:</strong> In case of equipment malfunction during a paid session, customers will be offered alternative equipment or session credits at our discretion.\n                </p>\n              </section>\n\n              <Separator />\n\n              <section>\n                <h2 className=\"text-2xl font-semibold mb-3\">11. Age Restrictions and Parental Consent</h2>\n                <p className=\"text-muted-foreground leading-relaxed mb-3\">\n                  <strong>11.1 Minimum Age:</strong> Customers under 13 years of age must be accompanied by a parent or legal guardian at all times.\n                </p>\n                <p className=\"text-muted-foreground leading-relaxed mb-3\">\n                  <strong>11.2 Age-Restricted Content:</strong> Access to games rated for mature audiences (18+) requires valid age verification. Parents are responsible for monitoring content accessed by minors.\n                </p>\n                <p className=\"text-muted-foreground leading-relaxed\">\n                  <strong>11.3 Parental Responsibility:</strong> Parents/guardians are liable for any damages or violations caused by minors under their supervision.\n                </p>\n              </section>\n\n              <Separator />\n\n              <section>\n                <h2 className=\"text-2xl font-semibold mb-3\">12. Liability and Disclaimers</h2>\n                <p className=\"text-muted-foreground leading-relaxed mb-3\">\n                  <strong>12.1 Service \"As Is\":</strong> Our services are provided on an \"as is\" basis. We make no warranties regarding uninterrupted service, specific game availability, or fitness for particular purposes.\n                </p>\n                <p className=\"text-muted-foreground leading-relaxed mb-3\">\n                  <strong>12.2 Personal Property:</strong> Airavoto Gaming Center is not responsible for loss, theft, or damage to personal belongings. Customers should secure their valuables.\n                </p>\n                <p className=\"text-muted-foreground leading-relaxed mb-3\">\n                  <strong>12.3 Health and Safety:</strong> Customers with medical conditions (epilepsy, motion sickness, etc.) should consult healthcare providers before using VR or gaming equipment. We are not liable for health issues arising from equipment use.\n                </p>\n                <p className=\"text-muted-foreground leading-relaxed\">\n                  <strong>12.4 Limitation of Liability:</strong> Our total liability for any claims arising from services shall not exceed the amount paid by the customer for the specific session in question.\n                </p>\n              </section>\n\n              <Separator />\n\n              <section>\n                <h2 className=\"text-2xl font-semibold mb-3\">13. Intellectual Property</h2>\n                <p className=\"text-muted-foreground leading-relaxed\">\n                  All games, software, and content available at our facility are licensed for use on our premises only. Customers may not copy, distribute, or reproduce any proprietary content. All trademarks and copyrights belong to their respective owners.\n                </p>\n              </section>\n\n              <Separator />\n\n              <section>\n                <h2 className=\"text-2xl font-semibold mb-3\">14. Modifications to Terms</h2>\n                <p className=\"text-muted-foreground leading-relaxed\">\n                  We reserve the right to modify these Terms and Conditions at any time. Updated terms will be posted at our facility and on our systems. Continued use of our services after modifications constitutes acceptance of the revised terms.\n                </p>\n              </section>\n\n              <Separator />\n\n              <section>\n                <h2 className=\"text-2xl font-semibold mb-3\">15. Governing Law and Dispute Resolution</h2>\n                <p className=\"text-muted-foreground leading-relaxed mb-3\">\n                  <strong>15.1 Jurisdiction:</strong> These Terms and Conditions are governed by the laws of India. Any disputes shall be subject to the exclusive jurisdiction of courts in [Your City], India.\n                </p>\n                <p className=\"text-muted-foreground leading-relaxed\">\n                  <strong>15.2 Dispute Resolution:</strong> In the event of any dispute, customers are encouraged to first contact management for amicable resolution before pursuing legal action.\n                </p>\n              </section>\n\n              <Separator />\n\n              <section>\n                <h2 className=\"text-2xl font-semibold mb-3\">16. Contact Information</h2>\n                <p className=\"text-muted-foreground leading-relaxed mb-3\">\n                  For questions, concerns, or support regarding these Terms and Conditions, please contact:\n                </p>\n                <div className=\"ml-4 text-muted-foreground space-y-1\">\n                  <p><strong>Airavoto Gaming Center</strong></p>\n                  <p>Email: support@airavotogaming.com</p>\n                  <p>Phone: Available through our staff panel</p>\n                  <p>Address: As listed in gaming center information</p>\n                </div>\n              </section>\n\n              <div className=\"mt-8 p-4 bg-muted rounded-lg\">\n                <p className=\"text-sm text-muted-foreground text-center\">\n                  By using Airavoto Gaming Center services, booking gaming sessions, participating in tournaments, or enrolling in our loyalty program, you acknowledge that you have read, understood, and agree to be bound by these Terms and Conditions effective October 27, 2025.\n                </p>\n              </div>\n            </div>\n          </ScrollArea>\n        </CardContent>\n      </Card>\n      \n      <footer className=\"mt-8 py-6 border-t\">\n        <div className=\"flex flex-col items-center gap-4\">\n          <p className=\"text-lg font-semibold text-foreground\">\n            Created by <span className=\"text-primary\">Airavoto Gaming</span>\n          </p>\n          <div className=\"flex items-center gap-3\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              asChild\n              data-testid=\"link-instagram\"\n            >\n              <a\n                href=\"https://instagram.com\"\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                aria-label=\"Instagram\"\n              >\n                <Instagram className=\"h-5 w-5\" />\n              </a>\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              asChild\n              data-testid=\"link-linkedin\"\n            >\n              <a\n                href=\"https://linkedin.com\"\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                aria-label=\"LinkedIn\"\n              >\n                <Linkedin className=\"h-5 w-5\" />\n              </a>\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              asChild\n              data-testid=\"link-github\"\n            >\n              <a\n                href=\"https://github.com\"\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                aria-label=\"GitHub\"\n              >\n                <Github className=\"h-5 w-5\" />\n              </a>\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              asChild\n              data-testid=\"link-twitter\"\n            >\n              <a\n                href=\"https://twitter.com\"\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                aria-label=\"Twitter\"\n              >\n                <Twitter className=\"h-5 w-5\" />\n              </a>\n            </Button>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              asChild\n              data-testid=\"link-email\"\n            >\n              <a\n                href=\"mailto:ujwal@example.com\"\n                aria-label=\"Email\"\n              >\n                <Mail className=\"h-5 w-5\" />\n              </a>\n            </Button>\n          </div>\n        </div>\n      </footer>\n    </div>\n  );\n}\n","path":null,"size_bytes":21674,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"server/csrf.ts":{"content":"import type { Request, Response, NextFunction } from \"express\";\nimport crypto from \"crypto\";\n\n// Modern CSRF protection using signed double-submit cookie pattern\n// This is better suited for SPAs than the deprecated csurf package\n\nconst CSRF_SECRET = process.env.CSRF_SECRET || process.env.SESSION_SECRET || 'csrf-secret-change-in-production';\nconst CSRF_TOKEN_LENGTH = 32;\nconst CSRF_COOKIE_NAME = 'XSRF-TOKEN';\nconst CSRF_HEADER_NAME = 'x-csrf-token';\n\nif (!process.env.CSRF_SECRET && !process.env.SESSION_SECRET) {\n  if (process.env.NODE_ENV === 'production') {\n    throw new Error('CSRF_SECRET or SESSION_SECRET environment variable is required in production');\n  }\n  console.warn('‚ö†Ô∏è  WARNING: CSRF_SECRET not set - using insecure default');\n}\n\n// Generate a random CSRF token\nexport function generateCsrfToken(): string {\n  return crypto.randomBytes(CSRF_TOKEN_LENGTH).toString('hex');\n}\n\n// Sign a token with HMAC\nfunction signToken(token: string): string {\n  const hmac = crypto.createHmac('sha256', CSRF_SECRET);\n  hmac.update(token);\n  return hmac.digest('hex');\n}\n\n// Verify a signed token\nfunction verifyToken(token: string, signature: string): boolean {\n  const expectedSignature = signToken(token);\n  // Use constant-time comparison to prevent timing attacks\n  try {\n    return crypto.timingSafeEqual(\n      Buffer.from(signature, 'hex'),\n      Buffer.from(expectedSignature, 'hex')\n    );\n  } catch {\n    return false;\n  }\n}\n\n// Middleware to attach CSRF token to response\nexport function csrfProtectionInit(req: Request, res: Response, next: NextFunction) {\n  // Generate new token if it doesn't exist or is invalid\n  let token = req.cookies?.[CSRF_COOKIE_NAME];\n  \n  if (!token) {\n    token = generateCsrfToken();\n    const signature = signToken(token);\n    const signedToken = `${token}.${signature}`;\n    \n    // Set cookie with token\n    res.cookie(CSRF_COOKIE_NAME, signedToken, {\n      httpOnly: false, // Must be accessible to JavaScript for SPA\n      secure: process.env.NODE_ENV === 'production',\n      sameSite: 'strict',\n      maxAge: 7 * 24 * 60 * 60 * 1000, // 1 week\n    });\n  }\n  \n  next();\n}\n\n// Middleware to verify CSRF token on state-changing requests\nexport function csrfProtection(req: Request, res: Response, next: NextFunction) {\n  // Skip CSRF check for GET, HEAD, OPTIONS (safe methods)\n  if (['GET', 'HEAD', 'OPTIONS'].includes(req.method)) {\n    return next();\n  }\n  \n  // Skip CSRF check for unauthenticated requests (no session)\n  if (!req.session?.userId) {\n    return next();\n  }\n  \n  // Get token from cookie\n  const cookieToken = req.cookies?.[CSRF_COOKIE_NAME];\n  if (!cookieToken) {\n    return res.status(403).json({ \n      message: 'CSRF token missing from cookie',\n      code: 'CSRF_COOKIE_MISSING'\n    });\n  }\n  \n  // Parse signed token\n  const [token, signature] = cookieToken.split('.');\n  if (!token || !signature) {\n    return res.status(403).json({ \n      message: 'Invalid CSRF token format',\n      code: 'CSRF_INVALID_FORMAT'\n    });\n  }\n  \n  // Verify signature\n  if (!verifyToken(token, signature)) {\n    return res.status(403).json({ \n      message: 'CSRF token signature verification failed',\n      code: 'CSRF_SIGNATURE_INVALID'\n    });\n  }\n  \n  // Get token from header or body\n  const headerToken = req.headers[CSRF_HEADER_NAME] as string || req.body?._csrf;\n  \n  if (!headerToken) {\n    return res.status(403).json({ \n      message: 'CSRF token missing from request',\n      code: 'CSRF_TOKEN_MISSING'\n    });\n  }\n  \n  // Verify header token matches cookie token (double-submit pattern)\n  try {\n    if (!crypto.timingSafeEqual(\n      Buffer.from(token, 'hex'),\n      Buffer.from(headerToken, 'hex')\n    )) {\n      return res.status(403).json({ \n        message: 'CSRF token mismatch',\n        code: 'CSRF_TOKEN_MISMATCH'\n      });\n    }\n  } catch {\n    return res.status(403).json({ \n      message: 'Invalid CSRF token',\n      code: 'CSRF_TOKEN_INVALID'\n    });\n  }\n  \n  next();\n}\n\n// Endpoint to get CSRF token (for SPAs)\nexport function getCsrfToken(req: Request, res: Response) {\n  const cookieToken = req.cookies?.[CSRF_COOKIE_NAME];\n  \n  if (cookieToken) {\n    const [token] = cookieToken.split('.');\n    if (token) {\n      return res.json({ csrfToken: token });\n    }\n  }\n  \n  // Generate new token\n  const token = generateCsrfToken();\n  const signature = signToken(token);\n  const signedToken = `${token}.${signature}`;\n  \n  res.cookie(CSRF_COOKIE_NAME, signedToken, {\n    httpOnly: false,\n    secure: process.env.NODE_ENV === 'production',\n    sameSite: 'strict',\n    maxAge: 7 * 24 * 60 * 60 * 1000,\n  });\n  \n  res.json({ csrfToken: token });\n}\n","path":null,"size_bytes":4626,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { SidebarProvider, SidebarTrigger } from \"@/components/ui/sidebar\";\nimport { AppSidebar } from \"@/components/AppSidebar\";\nimport { ThemeProvider } from \"@/components/ThemeProvider\";\nimport { ThemeToggle } from \"@/components/ThemeToggle\";\nimport { AuthProvider } from \"@/contexts/AuthContext\";\nimport { TourProvider, useTour } from \"@/contexts/TourContext\";\nimport { Lock, Sparkles, Keyboard } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useLocation } from \"wouter\";\nimport { KeyboardShortcutsDialog } from \"@/components/KeyboardShortcutsDialog\";\nimport { useKeyboardShortcuts, type KeyboardShortcut } from \"@/hooks/useKeyboardShortcuts\";\nimport { ShortcutsProvider } from \"@/contexts/ShortcutsContext\";\nimport Dashboard from \"@/pages/Dashboard\";\nimport Settings from \"@/pages/Settings\";\nimport Reports from \"@/pages/Reports\";\nimport Analytics from \"@/pages/Analytics\";\nimport AIMaintenance from \"@/pages/AIMaintenance\";\nimport Food from \"@/pages/Food\";\nimport Inventory from \"@/pages/Inventory\";\nimport Expenses from \"@/pages/Expenses\";\nimport Timeline from \"@/pages/Timeline\";\nimport History from \"@/pages/History\";\nimport ActivityLogs from \"@/pages/ActivityLogs\";\nimport TermsAndConditions from \"@/pages/TermsAndConditions\";\nimport PublicStatus from \"@/pages/PublicStatus\";\nimport Home from \"@/pages/Home\";\nimport ConsumerGallery from \"@/pages/ConsumerGallery\";\nimport ConsumerFacilities from \"@/pages/ConsumerFacilities\";\nimport ConsumerGames from \"@/pages/ConsumerGames\";\nimport NotFound from \"@/pages/not-found\";\nimport Login from \"@/pages/Login\";\nimport { ConsumerNav } from \"@/components/ConsumerNav\";\nimport { CursorTrail } from \"@/components/CursorTrail\";\nimport { SplashScreen } from \"@/components/SplashScreen\";\nimport { NetworkAlert } from \"@/components/NetworkAlert\";\nimport { NotificationCenter } from \"@/components/NotificationCenter\";\nimport { InactivityRefreshPrompt } from \"@/components/InactivityRefreshPrompt\";\nimport { FlipClock } from \"@/components/FlipClock\";\nimport { useState, useEffect } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useNetworkMonitor } from \"@/hooks/useNetworkMonitor\";\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={Dashboard} />\n      <Route path=\"/dashboard\" component={Dashboard} />\n      <Route path=\"/timeline\" component={Timeline} />\n      <Route path=\"/history\" component={History} />\n      <Route path=\"/activity-logs\" component={ActivityLogs} />\n      <Route path=\"/analytics\" component={Analytics} />\n      <Route path=\"/ai-maintenance\" component={AIMaintenance} />\n      <Route path=\"/food\" component={Food} />\n      <Route path=\"/inventory\" component={Inventory} />\n      <Route path=\"/expenses\" component={Expenses} />\n      <Route path=\"/settings\" component={Settings} />\n      <Route path=\"/reports\" component={Reports} />\n      <Route path=\"/terms\" component={TermsAndConditions} />\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\ninterface User {\n  id: string;\n  username: string;\n  role: \"admin\" | \"staff\";\n}\n\nfunction App() {\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [user, setUser] = useState<User | null>(null);\n  const [showLogin, setShowLogin] = useState(false);\n  const [showSplash, setShowSplash] = useState(true);\n  const [showShortcuts, setShowShortcuts] = useState(false);\n  const { toast } = useToast();\n  const [, setLocation] = useLocation();\n  const { showAlert, handleRefresh, handleDismiss } = useNetworkMonitor();\n\n  const style = {\n    \"--sidebar-width\": \"16rem\",\n  };\n\n  const handleLoginSuccess = (userData: User) => {\n    setUser(userData);\n    setIsAuthenticated(true);\n    setShowLogin(false);\n  };\n\n  const handleLock = async () => {\n    try {\n      await fetch(\"/api/auth/logout\", { method: \"POST\" });\n      setUser(null);\n      setIsAuthenticated(false);\n      setShowLogin(true);\n      toast({\n        title: \"Locked\",\n        description: \"Please login again to continue\",\n      });\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to logout\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n\n  // Define global keyboard shortcuts\n  const globalShortcuts: KeyboardShortcut[] = [\n    {\n      key: '?',\n      shiftKey: true,\n      description: 'Show keyboard shortcuts',\n      action: () => setShowShortcuts(true),\n      category: 'General'\n    },\n    {\n      key: 'k',\n      ctrlKey: true,\n      description: 'Show keyboard shortcuts',\n      action: () => setShowShortcuts(true),\n      category: 'General'\n    },\n    {\n      key: 'l',\n      ctrlKey: true,\n      description: 'Lock screen',\n      action: handleLock,\n      category: 'General'\n    },\n    {\n      key: 't',\n      ctrlKey: true,\n      description: 'Toggle theme',\n      action: () => {\n        const themeToggle = document.querySelector('[data-testid=\"button-toggle-theme\"]') as HTMLButtonElement;\n        themeToggle?.click();\n      },\n      category: 'General'\n    },\n    {\n      key: 'b',\n      ctrlKey: true,\n      description: 'Toggle sidebar',\n      action: () => {\n        const sidebarToggle = document.querySelector('[data-testid=\"button-sidebar-toggle\"]') as HTMLButtonElement;\n        sidebarToggle?.click();\n      },\n      category: 'General'\n    },\n    {\n      key: '1',\n      altKey: true,\n      description: 'Go to Dashboard',\n      action: () => setLocation('/'),\n      category: 'Navigation'\n    },\n    {\n      key: '2',\n      altKey: true,\n      description: 'Go to Timeline',\n      action: () => setLocation('/timeline'),\n      category: 'Navigation'\n    },\n    {\n      key: '3',\n      altKey: true,\n      description: 'Go to History',\n      action: () => setLocation('/history'),\n      category: 'Navigation'\n    },\n    {\n      key: '4',\n      altKey: true,\n      description: 'Go to Activity Logs',\n      action: () => setLocation('/activity-logs'),\n      category: 'Navigation'\n    },\n    {\n      key: '5',\n      altKey: true,\n      description: 'Go to Analytics',\n      action: () => setLocation('/analytics'),\n      category: 'Navigation'\n    },\n    {\n      key: '6',\n      altKey: true,\n      description: 'Go to Food Management',\n      action: () => setLocation('/food'),\n      category: 'Navigation'\n    },\n    {\n      key: '7',\n      altKey: true,\n      description: 'Go to Expenses',\n      action: () => setLocation('/expenses'),\n      category: 'Navigation'\n    },\n    {\n      key: '8',\n      altKey: true,\n      description: 'Go to Settings',\n      action: () => setLocation('/settings'),\n      category: 'Navigation'\n    },\n    {\n      key: '9',\n      altKey: true,\n      description: 'Go to Reports',\n      action: () => setLocation('/reports'),\n      category: 'Navigation'\n    }\n  ];\n\n  // Register global shortcuts\n  useKeyboardShortcuts(globalShortcuts);\n\n  useEffect(() => {\n    // Check if user is already authenticated via session\n    const checkAuth = async () => {\n      try {\n        const response = await fetch(\"/api/auth/me\", {\n          credentials: \"include\"\n        });\n        if (response.ok) {\n          const userData = await response.json();\n          \n          // Only grant full access if BOTH Google and staff/admin login are complete\n          if (userData.twoStepComplete && userData.id) {\n            setUser(userData);\n            setIsAuthenticated(true);\n          } else {\n            // Google verified but needs staff/admin login, or not authenticated\n            setShowLogin(true);\n          }\n        } else {\n          setShowLogin(true);\n        }\n      } catch (error) {\n        setShowLogin(true);\n      }\n    };\n    checkAuth();\n  }, []);\n\n  if (showSplash) {\n    return (\n      <ThemeProvider>\n        <SplashScreen onComplete={() => setShowSplash(false)} />\n      </ThemeProvider>\n    );\n  }\n\n  if (!isAuthenticated) {\n    return (\n      <ThemeProvider>\n        <QueryClientProvider client={queryClient}>\n          <TooltipProvider>\n            <Switch>\n              <Route path=\"/status\" component={PublicStatus} />\n              <Route path=\"/analytics\" component={Analytics} />\n              <Route path=\"/history\" component={History} />\n              <Route path=\"/home\">\n                <ConsumerNav />\n                <Home />\n              </Route>\n              <Route path=\"/gallery\">\n                <ConsumerNav />\n                <ConsumerGallery />\n              </Route>\n              <Route path=\"/facilities\">\n                <ConsumerNav />\n                <ConsumerFacilities />\n              </Route>\n              <Route path=\"/games\">\n                <ConsumerNav />\n                <ConsumerGames />\n              </Route>\n              <Route path=\"/staff\">\n                <Login onLoginSuccess={handleLoginSuccess} />\n              </Route>\n              <Route>\n                <Login onLoginSuccess={handleLoginSuccess} />\n              </Route>\n            </Switch>\n            <CursorTrail />\n            <Toaster />\n          </TooltipProvider>\n        </QueryClientProvider>\n      </ThemeProvider>\n    );\n  }\n\n  return (\n    <ThemeProvider>\n      <QueryClientProvider client={queryClient}>\n        <ShortcutsProvider globalShortcuts={globalShortcuts}>\n          <AuthProvider user={user}>\n            <TourProvider>\n              <TooltipProvider>\n                <SidebarProvider style={style as React.CSSProperties}>\n                  <div className=\"flex h-screen w-full\">\n                    <AppSidebar />\n                    <div className=\"flex flex-col flex-1 min-w-0\">\n                      <header className=\"flex items-center justify-between p-3 md:p-4 border-b sticky top-0 z-50 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/80\">\n                        <SidebarTrigger data-testid=\"button-sidebar-toggle\" data-joyride=\"sidebar-toggle\" />\n                        <div className=\"flex items-center gap-2 md:gap-4\">\n                          {user && (\n                            <div className=\"text-xs md:text-sm font-medium hidden sm:block\" data-testid=\"text-user-info\">\n                              {user.username} <span className=\"text-xs text-muted-foreground hidden md:inline\">({user.role})</span>\n                            </div>\n                          )}\n                          <div className=\"hidden md:block\">\n                            <FlipClock />\n                          </div>\n                          <div data-joyride=\"notification-center\">\n                            <NotificationCenter />\n                          </div>\n                          <div data-joyride=\"theme-toggle\">\n                            <ThemeToggle />\n                          </div>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => setShowShortcuts(true)}\n                            data-testid=\"button-shortcuts\"\n                            aria-label=\"Keyboard shortcuts\"\n                            className=\"h-8 w-8 md:h-10 md:w-10\"\n                          >\n                            <Keyboard className=\"h-4 w-4 md:h-5 md:w-5\" />\n                          </Button>\n                          <TakeTourButton />\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={handleLock}\n                            data-testid=\"button-lock\"\n                            aria-label=\"Lock screen\"\n                            className=\"h-8 w-8 md:h-10 md:w-10\"\n                          >\n                            <Lock className=\"h-4 w-4 md:h-5 md:w-5\" />\n                          </Button>\n                        </div>\n                      </header>\n                      <main className=\"flex-1 overflow-auto p-3 sm:p-4 md:p-6\">\n                        <Router />\n                      </main>\n                    </div>\n                  </div>\n                </SidebarProvider>\n                <KeyboardShortcutsDialog \n                  open={showShortcuts} \n                  onOpenChange={setShowShortcuts}\n                />\n                <NetworkAlert \n                  open={showAlert}\n                  onRefresh={handleRefresh}\n                  onDismiss={handleDismiss}\n                />\n                <InactivityRefreshPrompt />\n                <CursorTrail />\n                <Toaster />\n              </TooltipProvider>\n            </TourProvider>\n          </AuthProvider>\n        </ShortcutsProvider>\n      </QueryClientProvider>\n    </ThemeProvider>\n  );\n}\n\nfunction TakeTourButton() {\n  const { startTour } = useTour();\n  \n  return (\n    <Button\n      variant=\"ghost\"\n      size=\"sm\"\n      onClick={startTour}\n      data-testid=\"button-take-tour\"\n      data-joyride=\"take-tour-button\"\n      aria-label=\"Take Tour\"\n      className=\"hidden sm:flex items-center gap-1\"\n    >\n      <Sparkles className=\"h-4 w-4\" />\n      <span className=\"hidden md:inline\">Take Tour</span>\n    </Button>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":13314,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/components/SeatCard.tsx":{"content":"import { Card } from \"@/components/ui/card\";\nimport { StatusBadge } from \"./StatusBadge\";\nimport { SessionTimer } from \"./SessionTimer\";\nimport { Button } from \"@/components/ui/button\";\nimport { Clock, X } from \"lucide-react\";\n\ntype SeatStatus = \"available\" | \"running\" | \"expired\" | \"upcoming\";\n\ninterface SeatCardProps {\n  seatName: string;\n  status: SeatStatus;\n  customerName?: string;\n  endTime?: Date;\n  onExtend?: () => void;\n  onEnd?: () => void;\n}\n\nexport function SeatCard({ seatName, status, customerName, endTime, onExtend, onEnd }: SeatCardProps) {\n  const isActive = status === \"running\";\n  const isExpiring = endTime && (endTime.getTime() - new Date().getTime()) <= 5 * 60 * 1000;\n  const isExpired = status === \"expired\";\n\n  const glowClass = isExpired \n    ? \"animate-pulse-danger\" \n    : isExpiring \n    ? \"animate-pulse-warning\" \n    : isActive \n    ? \"animate-pulse-glow\" \n    : \"\";\n\n  return (\n    <Card \n      className={`p-4 hover-elevate transition-all ${glowClass}`} \n      data-testid={`card-seat-${seatName.toLowerCase().replace(/\\s/g, '-')}`}\n    >\n      <div className=\"space-y-3\">\n        <div className=\"flex items-center justify-between\">\n          <h3 className=\"font-bold text-foreground\">{seatName}</h3>\n          <StatusBadge status={status} />\n        </div>\n\n        {customerName && (\n          <p className=\"text-sm text-muted-foreground\" data-testid={`text-customer-${seatName}`}>\n            {customerName}\n          </p>\n        )}\n\n        {endTime && isActive && (\n          <SessionTimer endTime={endTime} />\n        )}\n\n        {isActive && (\n          <div className=\"flex gap-2\">\n            <Button \n              size=\"sm\" \n              variant=\"outline\" \n              className=\"flex-1\" \n              onClick={onExtend}\n              data-testid={`button-extend-${seatName}`}\n            >\n              <Clock className=\"mr-2 h-4 w-4\" />\n              Extend\n            </Button>\n            <Button \n              size=\"sm\" \n              variant=\"destructive\" \n              onClick={onEnd}\n              data-testid={`button-end-${seatName}`}\n            >\n              <X className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        )}\n\n        {isExpired && (\n          <Button \n            size=\"sm\" \n            variant=\"destructive\" \n            className=\"w-full\"\n            onClick={onEnd}\n            data-testid={`button-clear-${seatName}`}\n          >\n            Clear Session\n          </Button>\n        )}\n      </div>\n    </Card>\n  );\n}\n","path":null,"size_bytes":2522,"size_tokens":null},"TAURI_BUILD_GUIDE.md":{"content":"# Tauri Desktop Application Build Guide\n\n## Overview\n\nThis project has been converted from a web application to a Tauri desktop application with offline SQLite database storage. The desktop app provides the same functionality as the web app but works completely offline.\n\n## Prerequisites\n\nBefore building the desktop application, you need:\n\n### Windows\n- **Rust** (install from https://rustup.rs/)\n- **Microsoft Visual Studio Build Tools** with C++ workload\n- **Node.js 18+** and npm\n\n### macOS\n- **Rust** (install from https://rustup.rs/)\n- **Xcode Command Line Tools** (`xcode-select --install`)\n- **Node.js 18+** and npm\n\n### Linux\n- **Rust** (install from https://rustup.rs/)\n- **Build essentials**: `sudo apt install build-essential`\n- **WebKit2GTK**: `sudo apt install libwebkit2gtk-4.1-dev`\n- **Other dependencies**:\n  ```bash\n  sudo apt install libssl-dev libayatana-appindicator3-dev librsvg2-dev\n  ```\n- **Node.js 18+** and npm\n\n## Project Structure\n\n```\n‚îú‚îÄ‚îÄ src-tauri/              # Tauri backend (Rust)\n‚îÇ   ‚îú‚îÄ‚îÄ src/\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lib.rs          # Main Tauri app with SQLite migrations\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.rs         # Entry point\n‚îÇ   ‚îú‚îÄ‚îÄ capabilities/\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ default.json    # Permissions for SQL plugin\n‚îÇ   ‚îú‚îÄ‚îÄ icons/              # Application icons\n‚îÇ   ‚îú‚îÄ‚îÄ Cargo.toml          # Rust dependencies\n‚îÇ   ‚îî‚îÄ‚îÄ tauri.conf.json     # Tauri configuration\n‚îú‚îÄ‚îÄ client/                  # React frontend\n‚îÇ   ‚îî‚îÄ‚îÄ src/\n‚îÇ       ‚îî‚îÄ‚îÄ lib/\n‚îÇ           ‚îú‚îÄ‚îÄ api.ts      # Unified API (web/tauri)\n‚îÇ           ‚îú‚îÄ‚îÄ tauri-db.ts # Local SQLite database layer\n‚îÇ           ‚îî‚îÄ‚îÄ queryClient.ts\n‚îî‚îÄ‚îÄ package.json            # Node.js scripts\n```\n\n## Development\n\n### Web Development (Online Mode)\n```bash\nnpm run dev\n```\nThis runs the Express backend server at port 5000 with PostgreSQL database.\n\n### Tauri Development (Desktop Mode)\n```bash\nnpm run tauri:dev\n```\nThis starts the Tauri development environment with hot-reload and SQLite database.\n\n## Building\n\n### Build for Current Platform\n```bash\nnpm run tauri:build\n```\n\nThis will:\n1. Build the React frontend\n2. Compile the Rust backend\n3. Create an installer for your current operating system\n\n### Build Output Locations\n\n- **Windows**: `src-tauri/target/release/bundle/msi/` or `nsis/`\n- **macOS**: `src-tauri/target/release/bundle/dmg/` or `app/`\n- **Linux**: `src-tauri/target/release/bundle/deb/` or `appimage/`\n\n## Database\n\n### SQLite Database Location\n\nWhen running as a desktop app, the SQLite database is stored at:\n\n- **Windows**: `%APPDATA%/com.airavoto.gaming.pos/airavoto_pos.db`\n- **macOS**: `~/Library/Application Support/com.airavoto.gaming.pos/airavoto_pos.db`\n- **Linux**: `~/.config/com.airavoto.gaming.pos/airavoto_pos.db`\n\n### Database Migrations\n\nMigrations are automatically applied on first run. The following tables are created:\n\n1. `users` - Staff and admin accounts\n2. `session_groups` - Group booking sessions\n3. `bookings` - Active bookings\n4. `booking_history` - Archived bookings\n5. `food_items` - Menu items\n6. `stock_batches` - Inventory tracking\n7. `device_configs` - Gaming device configuration\n8. `pricing_configs` - Pricing tiers\n9. `happy_hours_configs` - Happy hour settings\n10. `happy_hours_pricing` - Happy hour pricing\n11. `expenses` - Business expenses\n12. `activity_logs` - User activity tracking\n13. `notifications` - System notifications\n14. `gaming_center_info` - Center information\n15. `gallery_images` - Photo gallery\n16. `facilities` - Available facilities\n17. `games` - Available games\n18. `device_maintenance` - Maintenance records\n19. `staff_visibility_settings` - Staff permissions\n20. `app_settings` - Application settings\n\n### Default Admin Account\n\nA default admin account is created on first run via SQLite migrations:\n- **Username**: `admin`\n- **Password**: `Admin@123`\n- **Role**: `admin`\n\n**IMPORTANT**: Change this password immediately after first login!\n\nNote: The password hash is pre-generated using bcrypt with 12 rounds. If you need to reset, delete the database file and restart the application.\n\n## Application Features\n\nThe desktop version supports offline mode for core functionality:\n\n### Fully Supported Offline:\n1. **Booking Management** - Create, update, pause, resume, and end sessions\n2. **Food & Inventory** - Track food items and stock levels\n3. **Device Configuration** - Set up gaming stations and categories\n4. **Pricing Configuration** - Manage pricing tiers and durations\n5. **Happy Hours** - Configure promotional pricing windows\n6. **Expense Tracking** - Record and manage business expenses\n7. **Booking History** - View archived booking records\n8. **Activity Logs** - Track user actions\n9. **Notifications** - System notifications and alerts\n10. **User Management** - Create and manage staff accounts\n11. **Gaming Center Info** - Update business information\n12. **Session Groups** - Manage group bookings\n\n### Web-Only Features (require online connection):\n- Reports & Analytics (complex aggregations)\n- Google OAuth authentication\n- Real-time sync with cloud database\n- Advanced payment integrations\n\n## Icons\n\nBefore building, place your application icons in `src-tauri/icons/`:\n\n- `32x32.png` - 32x32 pixels PNG\n- `128x128.png` - 128x128 pixels PNG\n- `128x128@2x.png` - 256x256 pixels PNG (for Retina)\n- `icon.icns` - macOS icon bundle\n- `icon.ico` - Windows icon\n\nYou can generate these from a source image using:\n```bash\nnpm run tauri icon path/to/your-logo.png\n```\n\n## Troubleshooting\n\n### Build Errors\n\n**\"Couldn't recognize the current folder as a Tauri project\" Error**:\n\nThis error means the Tauri CLI cannot find the configuration file. Solutions:\n\n1. **Verify the src-tauri folder exists**:\n   ```bash\n   # Windows (PowerShell)\n   Test-Path src-tauri/tauri.conf.json\n   \n   # macOS/Linux\n   ls -la src-tauri/tauri.conf.json\n   ```\n\n2. **If src-tauri folder is missing**, re-download the project or create it:\n   ```bash\n   npx tauri init\n   ```\n\n3. **Run from project root** - Make sure you're in the main project folder (where package.json is located):\n   ```bash\n   # Check you're in the right folder\n   dir package.json        # Windows\n   ls package.json         # macOS/Linux\n   ```\n\n4. **Clear npm cache and reinstall**:\n   ```bash\n   npm cache clean --force\n   rm -rf node_modules\n   npm install\n   ```\n\n**Missing Rust toolchain**:\n```bash\nrustup default stable\nrustup update\n```\n\n**Windows: Missing Visual Studio Build Tools**:\n1. Download from: https://visualstudio.microsoft.com/visual-cpp-build-tools/\n2. Install with \"Desktop development with C++\" workload\n3. Restart your terminal\n\n**Windows: WebView2 Missing**:\nWebView2 is required for Tauri on Windows. It's usually pre-installed on Windows 10/11, but if needed:\n- Download from: https://developer.microsoft.com/en-us/microsoft-edge/webview2/\n\n**Missing WebKit2GTK (Linux)**:\n```bash\nsudo apt install libwebkit2gtk-4.1-dev\n```\n\n**Permission denied on Linux**:\n```bash\nchmod +x src-tauri/target/release/airavoto-gaming-pos\n```\n\n### Database Issues\n\n**Reset database**:\nDelete the SQLite file at the location mentioned above, and the app will recreate it on next launch.\n\n**View database**:\nUse any SQLite browser (like DB Browser for SQLite) to inspect the database file.\n\n## Updating\n\nWhen updating the application:\n\n1. Back up your database file (optional but recommended)\n2. Install the new version\n3. Migrations will automatically apply any schema changes\n\n## Support\n\nFor issues specific to:\n- **Desktop app**: Check the Tauri logs and this guide\n- **Web app**: Check server logs and browser console\n- **Database**: Use SQLite browser to inspect data\n\n## License\n\nMIT License - Airavoto Gaming\n","path":null,"size_bytes":7736,"size_tokens":null},"REPLIT_DATABASE_SETUP.md":{"content":"# üóÑÔ∏è Replit Database Setup Guide\n\n## Quick Setup (Required to Run the Application)\n\nYour application uses PostgreSQL and needs a database to be provisioned in Replit.\n\n### Step 1: Create the Database\n\n1. Look for the **\"Database\"** or **\"PostgreSQL\"** icon in the left sidebar\n2. Click on it to open the database panel\n3. Click **\"Create Database\"** or **\"Provision Database\"**\n4. Wait for the database to be created (usually takes a few seconds)\n\nOnce created, Replit will automatically set the `DATABASE_URL` environment variable.\n\n### Step 2: Run Database Migrations\n\nAfter the database is created, the migrations will run automatically when you start the application. The system will:\n\n- Create all 20+ database tables\n- Set up indexes and relationships\n- Create a default admin user (admin/Admin@123)\n- Initialize device configurations\n\n### Step 3: Start the Application\n\nThe workflow should start automatically. If not, click the **Run** button or restart the workflow.\n\n---\n\n## What Gets Created\n\nThe database includes:\n\n**Core Tables:**\n- bookings (gaming sessions)\n- sessionGroups (group bookings)\n- foodItems (cafe menu)\n- deviceConfigs (gaming devices)\n- pricingConfigs (hourly rates)\n\n**Management Tables:**\n- users (staff accounts)\n- activityLogs (audit trail)\n- expenses (business costs)\n- stockBatches (inventory)\n\n**Plus 12 more tables** for complete business operations\n\n---\n\n## Default Admin Account\n\nAfter setup, you can login with:\n- **Username:** admin\n- **Password:** Admin@123\n\n**‚ö†Ô∏è Change this password immediately after first login!**\n\n---\n\n## Troubleshooting\n\n**Database creation failed?**\n- Make sure you have permission to create databases\n- Check if you're on a free plan (may have limits)\n- Contact Replit support if issues persist\n\n**Application won't start after database creation?**\n- Wait 10-15 seconds and try again\n- Check the console logs for errors\n- Restart the workflow manually\n\n---\n\n## Need Help?\n\nIf you encounter any issues:\n1. Check the console logs for error messages\n2. Verify the database is showing as \"provisioned\" in the database panel\n3. Try restarting the workflow\n4. Contact support if problems persist\n\n---\n\n**Once the database is provisioned, you're ready to go! üéÆ‚ú®**\n","path":null,"size_bytes":2238,"size_tokens":null},"src-tauri/src/lib.rs":{"content":"use tauri_plugin_sql::{Migration, MigrationKind};\n\n#[cfg_attr(mobile, tauri::mobile_entry_point)]\npub fn run() {\n    let migrations = vec![\n        Migration {\n            version: 1,\n            description: \"create_users_table\",\n            sql: r#\"\n                CREATE TABLE IF NOT EXISTS users (\n                    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n                    username TEXT UNIQUE,\n                    password_hash TEXT,\n                    role TEXT,\n                    onboarding_completed INTEGER DEFAULT 0,\n                    profile_image_url TEXT,\n                    created_at TEXT DEFAULT (datetime('now')),\n                    updated_at TEXT DEFAULT (datetime('now'))\n                )\n            \"#,\n            kind: MigrationKind::Up,\n        },\n        Migration {\n            version: 2,\n            description: \"create_session_groups_table\",\n            sql: r#\"\n                CREATE TABLE IF NOT EXISTS session_groups (\n                    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n                    group_code TEXT UNIQUE,\n                    group_name TEXT NOT NULL,\n                    category TEXT NOT NULL,\n                    booking_type TEXT NOT NULL,\n                    created_at TEXT DEFAULT (datetime('now'))\n                )\n            \"#,\n            kind: MigrationKind::Up,\n        },\n        Migration {\n            version: 3,\n            description: \"create_bookings_table\",\n            sql: r#\"\n                CREATE TABLE IF NOT EXISTS bookings (\n                    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n                    booking_code TEXT UNIQUE,\n                    group_id TEXT,\n                    group_code TEXT,\n                    category TEXT NOT NULL,\n                    seat_number INTEGER NOT NULL,\n                    seat_name TEXT NOT NULL,\n                    customer_name TEXT NOT NULL,\n                    whatsapp_number TEXT,\n                    start_time TEXT NOT NULL,\n                    end_time TEXT NOT NULL,\n                    price TEXT NOT NULL,\n                    status TEXT NOT NULL,\n                    booking_type TEXT NOT NULL,\n                    paused_remaining_time INTEGER,\n                    person_count INTEGER NOT NULL DEFAULT 1,\n                    payment_method TEXT,\n                    cash_amount TEXT,\n                    upi_amount TEXT,\n                    payment_status TEXT NOT NULL DEFAULT 'unpaid',\n                    last_payment_action TEXT,\n                    food_orders TEXT DEFAULT '[]',\n                    original_price TEXT,\n                    discount_applied TEXT,\n                    bonus_hours_applied TEXT,\n                    promotion_details TEXT,\n                    is_promotional_discount INTEGER DEFAULT 0,\n                    is_promotional_bonus INTEGER DEFAULT 0,\n                    manual_discount_percentage INTEGER,\n                    manual_free_hours TEXT,\n                    discount TEXT,\n                    bonus TEXT,\n                    created_at TEXT DEFAULT (datetime('now'))\n                )\n            \"#,\n            kind: MigrationKind::Up,\n        },\n        Migration {\n            version: 4,\n            description: \"create_booking_history_table\",\n            sql: r#\"\n                CREATE TABLE IF NOT EXISTS booking_history (\n                    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n                    booking_id TEXT NOT NULL,\n                    booking_code TEXT,\n                    group_id TEXT,\n                    group_code TEXT,\n                    category TEXT NOT NULL,\n                    seat_number INTEGER NOT NULL,\n                    seat_name TEXT NOT NULL,\n                    customer_name TEXT NOT NULL,\n                    whatsapp_number TEXT,\n                    start_time TEXT NOT NULL,\n                    end_time TEXT NOT NULL,\n                    price TEXT NOT NULL,\n                    status TEXT NOT NULL,\n                    booking_type TEXT NOT NULL,\n                    paused_remaining_time INTEGER,\n                    person_count INTEGER NOT NULL DEFAULT 1,\n                    payment_method TEXT,\n                    cash_amount TEXT,\n                    upi_amount TEXT,\n                    payment_status TEXT NOT NULL DEFAULT 'unpaid',\n                    last_payment_action TEXT,\n                    food_orders TEXT DEFAULT '[]',\n                    original_price TEXT,\n                    discount_applied TEXT,\n                    bonus_hours_applied TEXT,\n                    promotion_details TEXT,\n                    is_promotional_discount INTEGER DEFAULT 0,\n                    is_promotional_bonus INTEGER DEFAULT 0,\n                    manual_discount_percentage INTEGER,\n                    manual_free_hours TEXT,\n                    discount TEXT,\n                    bonus TEXT,\n                    created_at TEXT NOT NULL,\n                    archived_at TEXT DEFAULT (datetime('now'))\n                )\n            \"#,\n            kind: MigrationKind::Up,\n        },\n        Migration {\n            version: 5,\n            description: \"create_food_items_table\",\n            sql: r#\"\n                CREATE TABLE IF NOT EXISTS food_items (\n                    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n                    name TEXT NOT NULL,\n                    price TEXT NOT NULL,\n                    cost_price TEXT,\n                    current_stock INTEGER NOT NULL DEFAULT 0,\n                    min_stock_level INTEGER NOT NULL DEFAULT 10,\n                    in_inventory INTEGER NOT NULL DEFAULT 0,\n                    category TEXT NOT NULL DEFAULT 'trackable',\n                    supplier TEXT,\n                    expiry_date TEXT\n                )\n            \"#,\n            kind: MigrationKind::Up,\n        },\n        Migration {\n            version: 6,\n            description: \"create_stock_batches_table\",\n            sql: r#\"\n                CREATE TABLE IF NOT EXISTS stock_batches (\n                    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n                    food_item_id TEXT NOT NULL,\n                    quantity INTEGER NOT NULL,\n                    cost_price TEXT NOT NULL,\n                    supplier TEXT,\n                    purchase_date TEXT DEFAULT (datetime('now')),\n                    expiry_date TEXT,\n                    notes TEXT,\n                    created_at TEXT DEFAULT (datetime('now'))\n                )\n            \"#,\n            kind: MigrationKind::Up,\n        },\n        Migration {\n            version: 7,\n            description: \"create_device_configs_table\",\n            sql: r#\"\n                CREATE TABLE IF NOT EXISTS device_configs (\n                    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n                    category TEXT NOT NULL UNIQUE,\n                    count INTEGER NOT NULL DEFAULT 0,\n                    seats TEXT NOT NULL DEFAULT '[]'\n                )\n            \"#,\n            kind: MigrationKind::Up,\n        },\n        Migration {\n            version: 8,\n            description: \"create_pricing_configs_table\",\n            sql: r#\"\n                CREATE TABLE IF NOT EXISTS pricing_configs (\n                    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n                    category TEXT NOT NULL,\n                    duration TEXT NOT NULL,\n                    price TEXT NOT NULL,\n                    person_count INTEGER NOT NULL DEFAULT 1\n                )\n            \"#,\n            kind: MigrationKind::Up,\n        },\n        Migration {\n            version: 9,\n            description: \"create_happy_hours_configs_table\",\n            sql: r#\"\n                CREATE TABLE IF NOT EXISTS happy_hours_configs (\n                    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n                    category TEXT NOT NULL,\n                    start_time TEXT NOT NULL,\n                    end_time TEXT NOT NULL,\n                    enabled INTEGER NOT NULL DEFAULT 1\n                )\n            \"#,\n            kind: MigrationKind::Up,\n        },\n        Migration {\n            version: 10,\n            description: \"create_happy_hours_pricing_table\",\n            sql: r#\"\n                CREATE TABLE IF NOT EXISTS happy_hours_pricing (\n                    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n                    category TEXT NOT NULL,\n                    duration TEXT NOT NULL,\n                    price TEXT NOT NULL,\n                    person_count INTEGER NOT NULL DEFAULT 1\n                )\n            \"#,\n            kind: MigrationKind::Up,\n        },\n        Migration {\n            version: 11,\n            description: \"create_expenses_table\",\n            sql: r#\"\n                CREATE TABLE IF NOT EXISTS expenses (\n                    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n                    category TEXT NOT NULL,\n                    description TEXT NOT NULL,\n                    amount TEXT NOT NULL,\n                    date TEXT NOT NULL,\n                    created_at TEXT DEFAULT (datetime('now'))\n                )\n            \"#,\n            kind: MigrationKind::Up,\n        },\n        Migration {\n            version: 12,\n            description: \"create_activity_logs_table\",\n            sql: r#\"\n                CREATE TABLE IF NOT EXISTS activity_logs (\n                    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n                    user_id TEXT NOT NULL,\n                    username TEXT NOT NULL,\n                    user_role TEXT NOT NULL,\n                    action TEXT NOT NULL,\n                    entity_type TEXT,\n                    entity_id TEXT,\n                    details TEXT,\n                    created_at TEXT DEFAULT (datetime('now'))\n                )\n            \"#,\n            kind: MigrationKind::Up,\n        },\n        Migration {\n            version: 13,\n            description: \"create_notifications_table\",\n            sql: r#\"\n                CREATE TABLE IF NOT EXISTS notifications (\n                    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n                    type TEXT NOT NULL,\n                    title TEXT NOT NULL,\n                    message TEXT NOT NULL,\n                    entity_type TEXT,\n                    entity_id TEXT,\n                    activity_log_id TEXT,\n                    is_read INTEGER NOT NULL DEFAULT 0,\n                    created_at TEXT DEFAULT (datetime('now'))\n                )\n            \"#,\n            kind: MigrationKind::Up,\n        },\n        Migration {\n            version: 14,\n            description: \"create_gaming_center_info_table\",\n            sql: r#\"\n                CREATE TABLE IF NOT EXISTS gaming_center_info (\n                    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n                    name TEXT NOT NULL,\n                    description TEXT NOT NULL,\n                    address TEXT NOT NULL,\n                    phone TEXT NOT NULL,\n                    email TEXT,\n                    hours TEXT NOT NULL,\n                    timezone TEXT NOT NULL DEFAULT 'Asia/Kolkata',\n                    updated_at TEXT DEFAULT (datetime('now'))\n                )\n            \"#,\n            kind: MigrationKind::Up,\n        },\n        Migration {\n            version: 15,\n            description: \"create_gallery_images_table\",\n            sql: r#\"\n                CREATE TABLE IF NOT EXISTS gallery_images (\n                    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n                    title TEXT NOT NULL,\n                    image_url TEXT NOT NULL,\n                    description TEXT,\n                    created_at TEXT DEFAULT (datetime('now'))\n                )\n            \"#,\n            kind: MigrationKind::Up,\n        },\n        Migration {\n            version: 16,\n            description: \"create_facilities_table\",\n            sql: r#\"\n                CREATE TABLE IF NOT EXISTS facilities (\n                    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n                    name TEXT NOT NULL,\n                    description TEXT NOT NULL,\n                    icon TEXT NOT NULL\n                )\n            \"#,\n            kind: MigrationKind::Up,\n        },\n        Migration {\n            version: 17,\n            description: \"create_games_table\",\n            sql: r#\"\n                CREATE TABLE IF NOT EXISTS games (\n                    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n                    name TEXT NOT NULL,\n                    description TEXT,\n                    image_url TEXT,\n                    category TEXT NOT NULL\n                )\n            \"#,\n            kind: MigrationKind::Up,\n        },\n        Migration {\n            version: 18,\n            description: \"create_device_maintenance_table\",\n            sql: r#\"\n                CREATE TABLE IF NOT EXISTS device_maintenance (\n                    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n                    category TEXT NOT NULL,\n                    seat_name TEXT NOT NULL,\n                    last_maintenance_date TEXT,\n                    total_usage_hours REAL NOT NULL DEFAULT 0,\n                    total_sessions INTEGER NOT NULL DEFAULT 0,\n                    issues_reported INTEGER NOT NULL DEFAULT 0,\n                    maintenance_notes TEXT,\n                    status TEXT NOT NULL DEFAULT 'healthy',\n                    created_at TEXT DEFAULT (datetime('now')),\n                    updated_at TEXT DEFAULT (datetime('now'))\n                )\n            \"#,\n            kind: MigrationKind::Up,\n        },\n        Migration {\n            version: 19,\n            description: \"create_staff_visibility_settings_table\",\n            sql: r#\"\n                CREATE TABLE IF NOT EXISTS staff_visibility_settings (\n                    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n                    pages TEXT NOT NULL DEFAULT '{}',\n                    dashboard TEXT NOT NULL DEFAULT '{}',\n                    updated_at TEXT DEFAULT (datetime('now'))\n                )\n            \"#,\n            kind: MigrationKind::Up,\n        },\n        Migration {\n            version: 20,\n            description: \"create_app_settings_table\",\n            sql: r#\"\n                CREATE TABLE IF NOT EXISTS app_settings (\n                    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),\n                    theme TEXT NOT NULL DEFAULT 'system',\n                    language TEXT NOT NULL DEFAULT 'en',\n                    notifications TEXT NOT NULL DEFAULT '{}',\n                    updated_at TEXT DEFAULT (datetime('now'))\n                )\n            \"#,\n            kind: MigrationKind::Up,\n        },\n        Migration {\n            version: 21,\n            description: \"create_indexes\",\n            sql: r#\"\n                CREATE INDEX IF NOT EXISTS idx_bookings_category ON bookings(category);\n                CREATE INDEX IF NOT EXISTS idx_bookings_status ON bookings(status);\n                CREATE INDEX IF NOT EXISTS idx_bookings_start_time ON bookings(start_time);\n                CREATE INDEX IF NOT EXISTS idx_booking_history_booking_id ON booking_history(booking_id);\n                CREATE INDEX IF NOT EXISTS idx_activity_logs_user_id ON activity_logs(user_id);\n                CREATE INDEX IF NOT EXISTS idx_activity_logs_created_at ON activity_logs(created_at);\n                CREATE INDEX IF NOT EXISTS idx_notifications_is_read ON notifications(is_read);\n                CREATE INDEX IF NOT EXISTS idx_expenses_date ON expenses(date);\n            \"#,\n            kind: MigrationKind::Up,\n        },\n        Migration {\n            version: 22,\n            description: \"insert_default_admin\",\n            sql: r#\"\n                INSERT OR IGNORE INTO users (id, username, password_hash, role, onboarding_completed)\n                VALUES (\n                    'default-admin-id',\n                    'admin',\n                    '$2a$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewdBPj/9.5C5RdFi',\n                    'admin',\n                    0\n                )\n            \"#,\n            kind: MigrationKind::Up,\n        },\n    ];\n\n    tauri::Builder::default()\n        .plugin(tauri_plugin_shell::init())\n        .plugin(\n            tauri_plugin_sql::Builder::default()\n                .add_migrations(\"sqlite:airavoto_pos.db\", migrations)\n                .build()\n        )\n        .run(tauri::generate_context!())\n        .expect(\"error while running Tauri application\");\n}\n","path":null,"size_bytes":16681,"size_tokens":null},"src-tauri/Cargo.toml":{"content":"[package]\nname = \"airavoto-gaming-pos\"\nversion = \"1.0.0\"\ndescription = \"Airavoto Gaming Lounge Management POS - Desktop Application\"\nauthors = [\"Airavoto Gaming\"]\nedition = \"2021\"\n\n[lib]\nname = \"app_lib\"\ncrate-type = [\"staticlib\", \"cdylib\", \"rlib\"]\n\n[build-dependencies]\ntauri-build = { version = \"2.0\", features = [] }\n\n[dependencies]\ntauri = { version = \"2.0\", features = [\"devtools\"] }\ntauri-plugin-sql = { version = \"2.0\", features = [\"sqlite\"] }\ntauri-plugin-shell = \"2.0\"\nserde = { version = \"1.0\", features = [\"derive\"] }\nserde_json = \"1.0\"\nchrono = { version = \"0.4\", features = [\"serde\"] }\nuuid = { version = \"1.0\", features = [\"v4\", \"serde\"] }\nbcrypt = \"0.17\"\nrusqlite = { version = \"0.33\", features = [\"bundled\"] }\nonce_cell = \"1.19\"\nlog = \"0.4\"\nenv_logger = \"0.11\"\n\n[profile.release]\nlto = true\nopt-level = \"s\"\nstrip = true\n","path":null,"size_bytes":836,"size_tokens":null},"src-tauri/src/main.rs":{"content":"#![cfg_attr(not(debug_assertions), windows_subsystem = \"windows\")]\n\nfn main() {\n    app_lib::run();\n}\n","path":null,"size_bytes":102,"size_tokens":null},"src-tauri/build.rs":{"content":"fn main() {\n    tauri_build::build()\n}\n","path":null,"size_bytes":39,"size_tokens":null},"client/src/lib/tauri-db.ts":{"content":"import Database from '@tauri-apps/plugin-sql';\n\nlet db: Awaited<ReturnType<typeof Database.load>> | null = null;\n\nexport async function initDatabase() {\n  if (db) return db;\n  db = await Database.load('sqlite:airavoto_pos.db');\n  return db;\n}\n\nexport async function getDatabase() {\n  if (!db) {\n    return initDatabase();\n  }\n  return db;\n}\n\nfunction generateUUID(): string {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {\n    const r = Math.random() * 16 | 0;\n    const v = c === 'x' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}\n\nfunction generateCode(prefix: string): string {\n  const timestamp = Date.now().toString(36).toUpperCase();\n  const randomPart = Math.floor(Math.random() * 0xFFFFFF).toString(16).toUpperCase().padStart(6, '0');\n  return `${prefix}-${timestamp.slice(-5)}${randomPart.slice(0, 4)}`;\n}\n\nfunction snakeToCamel(str: string): string {\n  return str.replace(/_([a-z])/g, (_, letter) => letter.toUpperCase());\n}\n\nfunction transformRow(row: any): any {\n  const transformed: any = {};\n  for (const [key, value] of Object.entries(row)) {\n    const camelKey = snakeToCamel(key);\n    transformed[camelKey] = value;\n  }\n  return transformed;\n}\n\nfunction transformBookingRow(row: any): any {\n  return {\n    id: row.id,\n    bookingCode: row.booking_code,\n    groupId: row.group_id,\n    groupCode: row.group_code,\n    category: row.category,\n    seatNumber: row.seat_number,\n    seatName: row.seat_name,\n    customerName: row.customer_name,\n    whatsappNumber: row.whatsapp_number,\n    startTime: row.start_time,\n    endTime: row.end_time,\n    price: row.price,\n    status: row.status,\n    bookingType: JSON.parse(row.booking_type || '[]'),\n    pausedRemainingTime: row.paused_remaining_time,\n    personCount: row.person_count,\n    paymentMethod: row.payment_method,\n    cashAmount: row.cash_amount,\n    upiAmount: row.upi_amount,\n    paymentStatus: row.payment_status,\n    lastPaymentAction: row.last_payment_action ? JSON.parse(row.last_payment_action) : null,\n    foodOrders: JSON.parse(row.food_orders || '[]'),\n    originalPrice: row.original_price,\n    discountApplied: row.discount_applied,\n    bonusHoursApplied: row.bonus_hours_applied,\n    promotionDetails: row.promotion_details ? JSON.parse(row.promotion_details) : null,\n    isPromotionalDiscount: row.is_promotional_discount,\n    isPromotionalBonus: row.is_promotional_bonus,\n    manualDiscountPercentage: row.manual_discount_percentage,\n    manualFreeHours: row.manual_free_hours,\n    discount: row.discount,\n    bonus: row.bonus,\n    createdAt: row.created_at,\n  };\n}\n\nfunction transformFoodItemRow(row: any): any {\n  return {\n    id: row.id,\n    name: row.name,\n    price: row.price,\n    costPrice: row.cost_price,\n    currentStock: row.current_stock,\n    minStockLevel: row.min_stock_level,\n    inInventory: row.in_inventory,\n    category: row.category,\n    supplier: row.supplier,\n    expiryDate: row.expiry_date,\n  };\n}\n\nfunction transformExpenseRow(row: any): any {\n  return {\n    id: row.id,\n    category: row.category,\n    description: row.description,\n    amount: row.amount,\n    date: row.date,\n    createdAt: row.created_at,\n  };\n}\n\nfunction transformActivityLogRow(row: any): any {\n  return {\n    id: row.id,\n    userId: row.user_id,\n    username: row.username,\n    userRole: row.user_role,\n    action: row.action,\n    entityType: row.entity_type,\n    entityId: row.entity_id,\n    details: row.details,\n    createdAt: row.created_at,\n  };\n}\n\nfunction transformNotificationRow(row: any): any {\n  return {\n    id: row.id,\n    type: row.type,\n    title: row.title,\n    message: row.message,\n    entityType: row.entity_type,\n    entityId: row.entity_id,\n    activityLogId: row.activity_log_id,\n    isRead: row.is_read,\n    createdAt: row.created_at,\n  };\n}\n\nfunction transformUserRow(row: any): any {\n  return {\n    id: row.id,\n    username: row.username,\n    role: row.role,\n    onboardingCompleted: row.onboarding_completed,\n    profileImageUrl: row.profile_image_url,\n    createdAt: row.created_at,\n    updatedAt: row.updated_at,\n  };\n}\n\nfunction transformDeviceConfigRow(row: any): any {\n  return {\n    id: row.id,\n    category: row.category,\n    count: row.count,\n    seats: JSON.parse(row.seats || '[]'),\n  };\n}\n\nfunction transformPricingConfigRow(row: any): any {\n  return {\n    id: row.id,\n    category: row.category,\n    duration: row.duration,\n    price: row.price,\n    personCount: row.person_count,\n  };\n}\n\nfunction transformBookingHistoryRow(row: any): any {\n  return {\n    id: row.id,\n    bookingId: row.booking_id,\n    bookingCode: row.booking_code,\n    groupId: row.group_id,\n    groupCode: row.group_code,\n    category: row.category,\n    seatNumber: row.seat_number,\n    seatName: row.seat_name,\n    customerName: row.customer_name,\n    whatsappNumber: row.whatsapp_number,\n    startTime: row.start_time,\n    endTime: row.end_time,\n    price: row.price,\n    status: row.status,\n    bookingType: JSON.parse(row.booking_type || '[]'),\n    pausedRemainingTime: row.paused_remaining_time,\n    personCount: row.person_count,\n    paymentMethod: row.payment_method,\n    cashAmount: row.cash_amount,\n    upiAmount: row.upi_amount,\n    paymentStatus: row.payment_status,\n    lastPaymentAction: row.last_payment_action ? JSON.parse(row.last_payment_action) : null,\n    foodOrders: JSON.parse(row.food_orders || '[]'),\n    originalPrice: row.original_price,\n    discountApplied: row.discount_applied,\n    bonusHoursApplied: row.bonus_hours_applied,\n    promotionDetails: row.promotion_details ? JSON.parse(row.promotion_details) : null,\n    isPromotionalDiscount: row.is_promotional_discount,\n    isPromotionalBonus: row.is_promotional_bonus,\n    manualDiscountPercentage: row.manual_discount_percentage,\n    manualFreeHours: row.manual_free_hours,\n    discount: row.discount,\n    bonus: row.bonus,\n    createdAt: row.created_at,\n    archivedAt: row.archived_at,\n  };\n}\n\nfunction transformGamingCenterInfoRow(row: any): any {\n  return {\n    id: row.id,\n    name: row.name,\n    description: row.description,\n    address: row.address,\n    phone: row.phone,\n    email: row.email,\n    hours: row.hours,\n    timezone: row.timezone,\n    updatedAt: row.updated_at,\n  };\n}\n\nfunction transformSessionGroupRow(row: any): any {\n  return {\n    id: row.id,\n    groupCode: row.group_code,\n    groupName: row.group_name,\n    category: row.category,\n    bookingType: JSON.parse(row.booking_type || '[]'),\n    createdAt: row.created_at,\n  };\n}\n\nexport const localDb = {\n  async getAllBookings() {\n    const database = await getDatabase();\n    const result = await database.select<any[]>('SELECT * FROM bookings ORDER BY created_at DESC');\n    return result.map(transformBookingRow);\n  },\n\n  async getActiveBookings() {\n    const database = await getDatabase();\n    const result = await database.select<any[]>(\n      \"SELECT * FROM bookings WHERE status IN ('running', 'paused', 'upcoming') ORDER BY start_time\"\n    );\n    return result.map(transformBookingRow);\n  },\n\n  async getBookingById(id: string) {\n    const database = await getDatabase();\n    const result = await database.select<any[]>('SELECT * FROM bookings WHERE id = $1', [id]);\n    return result[0] ? transformBookingRow(result[0]) : null;\n  },\n\n  async createBooking(booking: any) {\n    const database = await getDatabase();\n    const id = generateUUID();\n    const bookingCode = generateCode('BK');\n    const now = new Date().toISOString();\n    \n    await database.execute(\n      `INSERT INTO bookings (\n        id, booking_code, group_id, group_code, category, seat_number, seat_name,\n        customer_name, whatsapp_number, start_time, end_time, price, status,\n        booking_type, paused_remaining_time, person_count, payment_method,\n        cash_amount, upi_amount, payment_status, last_payment_action, food_orders,\n        original_price, discount_applied, bonus_hours_applied, promotion_details,\n        is_promotional_discount, is_promotional_bonus, manual_discount_percentage,\n        manual_free_hours, discount, bonus, created_at\n      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33)`,\n      [\n        id, bookingCode, booking.groupId || null, booking.groupCode || null,\n        booking.category, booking.seatNumber, booking.seatName,\n        booking.customerName, booking.whatsappNumber || null,\n        booking.startTime, booking.endTime, booking.price, booking.status,\n        JSON.stringify(booking.bookingType || []), booking.pausedRemainingTime || null,\n        booking.personCount || 1, booking.paymentMethod || null,\n        booking.cashAmount || null, booking.upiAmount || null,\n        booking.paymentStatus || 'unpaid', JSON.stringify(booking.lastPaymentAction || null),\n        JSON.stringify(booking.foodOrders || []), booking.originalPrice || null,\n        booking.discountApplied || null, booking.bonusHoursApplied || null,\n        JSON.stringify(booking.promotionDetails || null), booking.isPromotionalDiscount || 0,\n        booking.isPromotionalBonus || 0, booking.manualDiscountPercentage || null,\n        booking.manualFreeHours || null, booking.discount || null, booking.bonus || null, now\n      ]\n    );\n    \n    return { \n      id, \n      bookingCode,\n      groupId: booking.groupId || null,\n      groupCode: booking.groupCode || null,\n      category: booking.category,\n      seatNumber: booking.seatNumber,\n      seatName: booking.seatName,\n      customerName: booking.customerName,\n      whatsappNumber: booking.whatsappNumber || null,\n      startTime: booking.startTime,\n      endTime: booking.endTime,\n      price: booking.price,\n      status: booking.status,\n      bookingType: booking.bookingType || [],\n      pausedRemainingTime: booking.pausedRemainingTime || null,\n      personCount: booking.personCount || 1,\n      paymentMethod: booking.paymentMethod || null,\n      cashAmount: booking.cashAmount || null,\n      upiAmount: booking.upiAmount || null,\n      paymentStatus: booking.paymentStatus || 'unpaid',\n      lastPaymentAction: booking.lastPaymentAction || null,\n      foodOrders: booking.foodOrders || [],\n      originalPrice: booking.originalPrice || null,\n      discountApplied: booking.discountApplied || null,\n      bonusHoursApplied: booking.bonusHoursApplied || null,\n      promotionDetails: booking.promotionDetails || null,\n      isPromotionalDiscount: booking.isPromotionalDiscount || 0,\n      isPromotionalBonus: booking.isPromotionalBonus || 0,\n      manualDiscountPercentage: booking.manualDiscountPercentage || null,\n      manualFreeHours: booking.manualFreeHours || null,\n      discount: booking.discount || null,\n      bonus: booking.bonus || null,\n      createdAt: now,\n    };\n  },\n\n  async updateBooking(id: string, updates: any) {\n    const database = await getDatabase();\n    const setClauses: string[] = [];\n    const values: any[] = [];\n    let paramIndex = 1;\n\n    const fieldMappings: Record<string, string> = {\n      groupId: 'group_id', groupCode: 'group_code', seatNumber: 'seat_number',\n      seatName: 'seat_name', customerName: 'customer_name', whatsappNumber: 'whatsapp_number',\n      startTime: 'start_time', endTime: 'end_time', bookingType: 'booking_type',\n      pausedRemainingTime: 'paused_remaining_time', personCount: 'person_count',\n      paymentMethod: 'payment_method', cashAmount: 'cash_amount', upiAmount: 'upi_amount',\n      paymentStatus: 'payment_status', lastPaymentAction: 'last_payment_action',\n      foodOrders: 'food_orders', originalPrice: 'original_price', discountApplied: 'discount_applied',\n      bonusHoursApplied: 'bonus_hours_applied', promotionDetails: 'promotion_details',\n      isPromotionalDiscount: 'is_promotional_discount', isPromotionalBonus: 'is_promotional_bonus',\n      manualDiscountPercentage: 'manual_discount_percentage', manualFreeHours: 'manual_free_hours',\n    };\n\n    for (const [key, value] of Object.entries(updates)) {\n      const dbField = fieldMappings[key] || key;\n      setClauses.push(`${dbField} = $${paramIndex}`);\n      if (['bookingType', 'foodOrders', 'lastPaymentAction', 'promotionDetails'].includes(key)) {\n        values.push(JSON.stringify(value));\n      } else {\n        values.push(value);\n      }\n      paramIndex++;\n    }\n\n    values.push(id);\n    await database.execute(\n      `UPDATE bookings SET ${setClauses.join(', ')} WHERE id = $${paramIndex}`,\n      values\n    );\n    \n    const updated = await this.getBookingById(id);\n    return updated;\n  },\n\n  async deleteBooking(id: string) {\n    const database = await getDatabase();\n    await database.execute('DELETE FROM bookings WHERE id = $1', [id]);\n  },\n\n  async getAllFoodItems() {\n    const database = await getDatabase();\n    const result = await database.select<any[]>('SELECT * FROM food_items ORDER BY name');\n    return result.map(transformFoodItemRow);\n  },\n\n  async getFoodItemById(id: string) {\n    const database = await getDatabase();\n    const result = await database.select<any[]>('SELECT * FROM food_items WHERE id = $1', [id]);\n    return result[0] ? transformFoodItemRow(result[0]) : null;\n  },\n\n  async createFoodItem(item: any) {\n    const database = await getDatabase();\n    const id = generateUUID();\n    await database.execute(\n      `INSERT INTO food_items (id, name, price, cost_price, current_stock, min_stock_level, in_inventory, category, supplier, expiry_date)\n       VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10)`,\n      [id, item.name, item.price, item.costPrice || null, item.currentStock || 0,\n       item.minStockLevel || 10, item.inInventory || 0, item.category || 'trackable',\n       item.supplier || null, item.expiryDate || null]\n    );\n    return {\n      id,\n      name: item.name,\n      price: item.price,\n      costPrice: item.costPrice || null,\n      currentStock: item.currentStock || 0,\n      minStockLevel: item.minStockLevel || 10,\n      inInventory: item.inInventory || 0,\n      category: item.category || 'trackable',\n      supplier: item.supplier || null,\n      expiryDate: item.expiryDate || null,\n    };\n  },\n\n  async updateFoodItem(id: string, updates: any) {\n    const database = await getDatabase();\n    const setClauses: string[] = [];\n    const values: any[] = [];\n    let paramIndex = 1;\n\n    const fieldMappings: Record<string, string> = {\n      costPrice: 'cost_price', currentStock: 'current_stock', minStockLevel: 'min_stock_level',\n      inInventory: 'in_inventory', expiryDate: 'expiry_date'\n    };\n\n    for (const [key, value] of Object.entries(updates)) {\n      const dbField = fieldMappings[key] || key;\n      setClauses.push(`${dbField} = $${paramIndex}`);\n      values.push(value);\n      paramIndex++;\n    }\n\n    values.push(id);\n    await database.execute(\n      `UPDATE food_items SET ${setClauses.join(', ')} WHERE id = $${paramIndex}`,\n      values\n    );\n    return await this.getFoodItemById(id);\n  },\n\n  async deleteFoodItem(id: string) {\n    const database = await getDatabase();\n    await database.execute('DELETE FROM food_items WHERE id = $1', [id]);\n  },\n\n  async adjustStock(foodId: string, quantity: number, type: 'add' | 'remove') {\n    const database = await getDatabase();\n    const operator = type === 'add' ? '+' : '-';\n    await database.execute(\n      `UPDATE food_items SET current_stock = current_stock ${operator} $1 WHERE id = $2`,\n      [quantity, foodId]\n    );\n    return await this.getFoodItemById(foodId);\n  },\n\n  async getAllDeviceConfigs() {\n    const database = await getDatabase();\n    const result = await database.select<any[]>('SELECT * FROM device_configs ORDER BY category');\n    return result.map(transformDeviceConfigRow);\n  },\n\n  async getDeviceConfigById(id: string) {\n    const database = await getDatabase();\n    const result = await database.select<any[]>('SELECT * FROM device_configs WHERE id = $1', [id]);\n    return result[0] ? transformDeviceConfigRow(result[0]) : null;\n  },\n\n  async createDeviceConfig(config: any) {\n    const database = await getDatabase();\n    const id = generateUUID();\n    await database.execute(\n      'INSERT INTO device_configs (id, category, count, seats) VALUES ($1, $2, $3, $4)',\n      [id, config.category, config.count || 0, JSON.stringify(config.seats || [])]\n    );\n    return {\n      id,\n      category: config.category,\n      count: config.count || 0,\n      seats: config.seats || [],\n    };\n  },\n\n  async updateDeviceConfig(id: string, updates: any) {\n    const database = await getDatabase();\n    const setClauses: string[] = [];\n    const values: any[] = [];\n    let paramIndex = 1;\n\n    for (const [key, value] of Object.entries(updates)) {\n      setClauses.push(`${key} = $${paramIndex}`);\n      values.push(key === 'seats' ? JSON.stringify(value) : value);\n      paramIndex++;\n    }\n\n    values.push(id);\n    await database.execute(\n      `UPDATE device_configs SET ${setClauses.join(', ')} WHERE id = $${paramIndex}`,\n      values\n    );\n    return await this.getDeviceConfigById(id);\n  },\n\n  async deleteDeviceConfig(id: string) {\n    const database = await getDatabase();\n    await database.execute('DELETE FROM device_configs WHERE id = $1', [id]);\n  },\n\n  async getAllPricingConfigs() {\n    const database = await getDatabase();\n    const result = await database.select<any[]>('SELECT * FROM pricing_configs ORDER BY category, duration');\n    return result.map(transformPricingConfigRow);\n  },\n\n  async getPricingConfigById(id: string) {\n    const database = await getDatabase();\n    const result = await database.select<any[]>('SELECT * FROM pricing_configs WHERE id = $1', [id]);\n    return result[0] ? transformPricingConfigRow(result[0]) : null;\n  },\n\n  async createPricingConfig(config: any) {\n    const database = await getDatabase();\n    const id = generateUUID();\n    await database.execute(\n      'INSERT INTO pricing_configs (id, category, duration, price, person_count) VALUES ($1, $2, $3, $4, $5)',\n      [id, config.category, config.duration, config.price, config.personCount || 1]\n    );\n    return {\n      id,\n      category: config.category,\n      duration: config.duration,\n      price: config.price,\n      personCount: config.personCount || 1,\n    };\n  },\n\n  async updatePricingConfig(id: string, updates: any) {\n    const database = await getDatabase();\n    const setClauses: string[] = [];\n    const values: any[] = [];\n    let paramIndex = 1;\n\n    for (const [key, value] of Object.entries(updates)) {\n      const dbField = key === 'personCount' ? 'person_count' : key;\n      setClauses.push(`${dbField} = $${paramIndex}`);\n      values.push(value);\n      paramIndex++;\n    }\n\n    values.push(id);\n    await database.execute(\n      `UPDATE pricing_configs SET ${setClauses.join(', ')} WHERE id = $${paramIndex}`,\n      values\n    );\n    return await this.getPricingConfigById(id);\n  },\n\n  async deletePricingConfig(id: string) {\n    const database = await getDatabase();\n    await database.execute('DELETE FROM pricing_configs WHERE id = $1', [id]);\n  },\n\n  async getAllHappyHoursConfigs() {\n    const database = await getDatabase();\n    const result = await database.select<any[]>('SELECT * FROM happy_hours_configs');\n    return result.map(row => ({\n      id: row.id,\n      category: row.category,\n      startTime: row.start_time,\n      endTime: row.end_time,\n      enabled: row.enabled\n    }));\n  },\n\n  async getAllHappyHoursPricing() {\n    const database = await getDatabase();\n    const result = await database.select<any[]>('SELECT * FROM happy_hours_pricing');\n    return result.map(row => ({\n      id: row.id,\n      category: row.category,\n      duration: row.duration,\n      price: row.price,\n      personCount: row.person_count\n    }));\n  },\n\n  async getAllExpenses() {\n    const database = await getDatabase();\n    const result = await database.select<any[]>('SELECT * FROM expenses ORDER BY date DESC');\n    return result.map(transformExpenseRow);\n  },\n\n  async getExpenseById(id: string) {\n    const database = await getDatabase();\n    const result = await database.select<any[]>('SELECT * FROM expenses WHERE id = $1', [id]);\n    return result[0] ? transformExpenseRow(result[0]) : null;\n  },\n\n  async createExpense(expense: any) {\n    const database = await getDatabase();\n    const id = generateUUID();\n    const now = new Date().toISOString();\n    await database.execute(\n      'INSERT INTO expenses (id, category, description, amount, date, created_at) VALUES ($1, $2, $3, $4, $5, $6)',\n      [id, expense.category, expense.description, expense.amount, expense.date, now]\n    );\n    return {\n      id,\n      category: expense.category,\n      description: expense.description,\n      amount: expense.amount,\n      date: expense.date,\n      createdAt: now,\n    };\n  },\n\n  async updateExpense(id: string, updates: any) {\n    const database = await getDatabase();\n    const setClauses: string[] = [];\n    const values: any[] = [];\n    let paramIndex = 1;\n\n    for (const [key, value] of Object.entries(updates)) {\n      setClauses.push(`${key} = $${paramIndex}`);\n      values.push(value);\n      paramIndex++;\n    }\n\n    values.push(id);\n    await database.execute(\n      `UPDATE expenses SET ${setClauses.join(', ')} WHERE id = $${paramIndex}`,\n      values\n    );\n    return await this.getExpenseById(id);\n  },\n\n  async deleteExpense(id: string) {\n    const database = await getDatabase();\n    await database.execute('DELETE FROM expenses WHERE id = $1', [id]);\n  },\n\n  async getBookingHistory() {\n    const database = await getDatabase();\n    const result = await database.select<any[]>('SELECT * FROM booking_history ORDER BY archived_at DESC');\n    return result.map(transformBookingHistoryRow);\n  },\n\n  async archiveBooking(booking: any) {\n    const database = await getDatabase();\n    const id = generateUUID();\n    const now = new Date().toISOString();\n    \n    await database.execute(\n      `INSERT INTO booking_history (\n        id, booking_id, booking_code, group_id, group_code, category, seat_number, seat_name,\n        customer_name, whatsapp_number, start_time, end_time, price, status,\n        booking_type, paused_remaining_time, person_count, payment_method,\n        cash_amount, upi_amount, payment_status, last_payment_action, food_orders,\n        original_price, discount_applied, bonus_hours_applied, promotion_details,\n        is_promotional_discount, is_promotional_bonus, manual_discount_percentage,\n        manual_free_hours, discount, bonus, created_at, archived_at\n      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18, $19, $20, $21, $22, $23, $24, $25, $26, $27, $28, $29, $30, $31, $32, $33, $34, $35)`,\n      [\n        id, booking.id, booking.bookingCode, booking.groupId, booking.groupCode,\n        booking.category, booking.seatNumber, booking.seatName,\n        booking.customerName, booking.whatsappNumber,\n        booking.startTime, booking.endTime, booking.price, booking.status,\n        JSON.stringify(booking.bookingType || []), booking.pausedRemainingTime,\n        booking.personCount, booking.paymentMethod,\n        booking.cashAmount, booking.upiAmount, booking.paymentStatus,\n        JSON.stringify(booking.lastPaymentAction || null), JSON.stringify(booking.foodOrders || []),\n        booking.originalPrice, booking.discountApplied, booking.bonusHoursApplied,\n        JSON.stringify(booking.promotionDetails || null), booking.isPromotionalDiscount,\n        booking.isPromotionalBonus, booking.manualDiscountPercentage,\n        booking.manualFreeHours, booking.discount, booking.bonus,\n        booking.createdAt, now\n      ]\n    );\n    \n    return { ...booking, id, bookingId: booking.id, archivedAt: now };\n  },\n\n  async getAllUsers() {\n    const database = await getDatabase();\n    const result = await database.select<any[]>('SELECT id, username, role, onboarding_completed, profile_image_url, created_at, updated_at FROM users');\n    return result.map(transformUserRow);\n  },\n\n  async getUserById(id: string) {\n    const database = await getDatabase();\n    const result = await database.select<any[]>('SELECT * FROM users WHERE id = $1', [id]);\n    return result[0] ? transformUserRow(result[0]) : null;\n  },\n\n  async getUserByUsername(username: string) {\n    const database = await getDatabase();\n    const result = await database.select<any[]>(\n      'SELECT * FROM users WHERE username = $1',\n      [username]\n    );\n    if (!result[0]) return null;\n    return {\n      ...transformUserRow(result[0]),\n      passwordHash: result[0].password_hash,\n    };\n  },\n\n  async validatePassword(username: string, password: string) {\n    const user = await this.getUserByUsername(username);\n    if (!user || !user.passwordHash) return null;\n    \n    const bcrypt = await import('bcryptjs');\n    const isValid = await bcrypt.compare(password, user.passwordHash);\n    if (!isValid) return null;\n    \n    const { passwordHash, ...userWithoutPassword } = user;\n    return userWithoutPassword;\n  },\n\n  async createUser(userData: { username: string; password: string; role: string }) {\n    const database = await getDatabase();\n    const id = generateUUID();\n    const now = new Date().toISOString();\n    const bcrypt = await import('bcryptjs');\n    const passwordHash = await bcrypt.hash(userData.password, 10);\n    \n    await database.execute(\n      `INSERT INTO users (id, username, password_hash, role, onboarding_completed, created_at, updated_at)\n       VALUES ($1, $2, $3, $4, $5, $6, $7)`,\n      [id, userData.username, passwordHash, userData.role, 0, now, now]\n    );\n    \n    return {\n      id,\n      username: userData.username,\n      role: userData.role,\n      onboardingCompleted: 0,\n      profileImageUrl: null,\n      createdAt: now,\n      updatedAt: now,\n    };\n  },\n\n  async updateUser(id: string, updates: any) {\n    const database = await getDatabase();\n    const now = new Date().toISOString();\n    const setClauses: string[] = ['updated_at = $1'];\n    const values: any[] = [now];\n    let paramIndex = 2;\n\n    const fieldMappings: Record<string, string> = {\n      onboardingCompleted: 'onboarding_completed',\n      profileImageUrl: 'profile_image_url',\n    };\n\n    for (const [key, value] of Object.entries(updates)) {\n      if (key === 'password') {\n        const bcrypt = await import('bcryptjs');\n        const passwordHash = await bcrypt.hash(value as string, 10);\n        setClauses.push(`password_hash = $${paramIndex}`);\n        values.push(passwordHash);\n      } else {\n        const dbField = fieldMappings[key] || key;\n        setClauses.push(`${dbField} = $${paramIndex}`);\n        values.push(value);\n      }\n      paramIndex++;\n    }\n\n    values.push(id);\n    await database.execute(\n      `UPDATE users SET ${setClauses.join(', ')} WHERE id = $${paramIndex}`,\n      values\n    );\n    return await this.getUserById(id);\n  },\n\n  async deleteUser(id: string) {\n    const database = await getDatabase();\n    await database.execute('DELETE FROM users WHERE id = $1', [id]);\n  },\n\n  async getActivityLogs() {\n    const database = await getDatabase();\n    const result = await database.select<any[]>('SELECT * FROM activity_logs ORDER BY created_at DESC LIMIT 1000');\n    return result.map(transformActivityLogRow);\n  },\n\n  async createActivityLog(log: any) {\n    const database = await getDatabase();\n    const id = generateUUID();\n    const now = new Date().toISOString();\n    await database.execute(\n      `INSERT INTO activity_logs (id, user_id, username, user_role, action, entity_type, entity_id, details, created_at)\n       VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9)`,\n      [id, log.userId, log.username, log.userRole, log.action, log.entityType || null, log.entityId || null, log.details || null, now]\n    );\n    return {\n      id,\n      userId: log.userId,\n      username: log.username,\n      userRole: log.userRole,\n      action: log.action,\n      entityType: log.entityType || null,\n      entityId: log.entityId || null,\n      details: log.details || null,\n      createdAt: now,\n    };\n  },\n\n  async getNotifications() {\n    const database = await getDatabase();\n    const result = await database.select<any[]>('SELECT * FROM notifications ORDER BY created_at DESC LIMIT 100');\n    return result.map(transformNotificationRow);\n  },\n\n  async getUnreadNotifications() {\n    const database = await getDatabase();\n    const result = await database.select<any[]>('SELECT * FROM notifications WHERE is_read = 0 ORDER BY created_at DESC');\n    return result.map(transformNotificationRow);\n  },\n\n  async createNotification(notification: any) {\n    const database = await getDatabase();\n    const id = generateUUID();\n    const now = new Date().toISOString();\n    await database.execute(\n      `INSERT INTO notifications (id, type, title, message, entity_type, entity_id, activity_log_id, is_read, created_at)\n       VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9)`,\n      [id, notification.type, notification.title, notification.message, \n       notification.entityType || null, notification.entityId || null, \n       notification.activityLogId || null, 0, now]\n    );\n    return {\n      id,\n      type: notification.type,\n      title: notification.title,\n      message: notification.message,\n      entityType: notification.entityType || null,\n      entityId: notification.entityId || null,\n      activityLogId: notification.activityLogId || null,\n      isRead: 0,\n      createdAt: now,\n    };\n  },\n\n  async markNotificationAsRead(id: string) {\n    const database = await getDatabase();\n    await database.execute('UPDATE notifications SET is_read = 1 WHERE id = $1', [id]);\n  },\n\n  async markAllNotificationsAsRead() {\n    const database = await getDatabase();\n    await database.execute('UPDATE notifications SET is_read = 1 WHERE is_read = 0');\n  },\n\n  async getGamingCenterInfo() {\n    const database = await getDatabase();\n    const result = await database.select<any[]>('SELECT * FROM gaming_center_info LIMIT 1');\n    return result[0] ? transformGamingCenterInfoRow(result[0]) : null;\n  },\n\n  async updateGamingCenterInfo(info: any) {\n    const database = await getDatabase();\n    const existing = await this.getGamingCenterInfo();\n    const now = new Date().toISOString();\n    \n    if (existing) {\n      await database.execute(\n        `UPDATE gaming_center_info SET name = $1, description = $2, address = $3, phone = $4, email = $5, hours = $6, timezone = $7, updated_at = $8 WHERE id = $9`,\n        [info.name, info.description, info.address, info.phone, info.email || null, info.hours, info.timezone || 'Asia/Kolkata', now, existing.id]\n      );\n      return { ...existing, ...info, updatedAt: now };\n    } else {\n      const id = generateUUID();\n      await database.execute(\n        `INSERT INTO gaming_center_info (id, name, description, address, phone, email, hours, timezone, updated_at)\n         VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9)`,\n        [id, info.name, info.description, info.address, info.phone, info.email || null, info.hours, info.timezone || 'Asia/Kolkata', now]\n      );\n      return { id, ...info, updatedAt: now };\n    }\n  },\n\n  async getAllSessionGroups() {\n    const database = await getDatabase();\n    const result = await database.select<any[]>('SELECT * FROM session_groups ORDER BY created_at DESC');\n    return result.map(transformSessionGroupRow);\n  },\n\n  async createSessionGroup(group: any) {\n    const database = await getDatabase();\n    const id = generateUUID();\n    const groupCode = generateCode('GRP');\n    const now = new Date().toISOString();\n    \n    await database.execute(\n      `INSERT INTO session_groups (id, group_code, group_name, category, booking_type, created_at)\n       VALUES ($1, $2, $3, $4, $5, $6)`,\n      [id, groupCode, group.groupName, group.category, JSON.stringify(group.bookingType || []), now]\n    );\n    \n    return {\n      id,\n      groupCode,\n      groupName: group.groupName,\n      category: group.category,\n      bookingType: group.bookingType || [],\n      createdAt: now,\n    };\n  },\n\n  async deleteSessionGroup(id: string) {\n    const database = await getDatabase();\n    await database.execute('DELETE FROM session_groups WHERE id = $1', [id]);\n  },\n\n  async getStaffVisibilitySettings() {\n    const database = await getDatabase();\n    const result = await database.select<any[]>('SELECT * FROM staff_visibility_settings LIMIT 1');\n    if (!result[0]) return null;\n    return {\n      id: result[0].id,\n      pages: result[0].pages ? JSON.parse(result[0].pages) : {},\n      dashboard: result[0].dashboard ? JSON.parse(result[0].dashboard) : {},\n      updatedAt: result[0].updated_at,\n    };\n  },\n\n  async updateStaffVisibilitySettings(settings: any) {\n    const database = await getDatabase();\n    const existing = await this.getStaffVisibilitySettings();\n    const now = new Date().toISOString();\n    \n    if (existing) {\n      await database.execute(\n        `UPDATE staff_visibility_settings SET pages = $1, dashboard = $2, updated_at = $3 WHERE id = $4`,\n        [JSON.stringify(settings.pages || {}), JSON.stringify(settings.dashboard || {}), now, existing.id]\n      );\n      return { ...existing, ...settings, updatedAt: now };\n    } else {\n      const id = generateUUID();\n      await database.execute(\n        `INSERT INTO staff_visibility_settings (id, pages, dashboard, updated_at)\n         VALUES ($1, $2, $3, $4)`,\n        [id, JSON.stringify(settings.pages || {}), JSON.stringify(settings.dashboard || {}), now]\n      );\n      return { id, ...settings, updatedAt: now };\n    }\n  },\n\n  async getAppSettings() {\n    const database = await getDatabase();\n    const result = await database.select<any[]>('SELECT * FROM app_settings LIMIT 1');\n    if (!result[0]) return null;\n    return {\n      id: result[0].id,\n      theme: result[0].theme,\n      language: result[0].language,\n      notifications: result[0].notifications ? JSON.parse(result[0].notifications) : {},\n      updatedAt: result[0].updated_at,\n    };\n  },\n\n  async updateAppSettings(settings: any) {\n    const database = await getDatabase();\n    const existing = await this.getAppSettings();\n    const now = new Date().toISOString();\n    \n    if (existing) {\n      await database.execute(\n        `UPDATE app_settings SET theme = $1, language = $2, notifications = $3, updated_at = $4 WHERE id = $5`,\n        [settings.theme || 'system', settings.language || 'en', JSON.stringify(settings.notifications || {}), now, existing.id]\n      );\n      return { ...existing, ...settings, updatedAt: now };\n    } else {\n      const id = generateUUID();\n      await database.execute(\n        `INSERT INTO app_settings (id, theme, language, notifications, updated_at)\n         VALUES ($1, $2, $3, $4, $5)`,\n        [id, settings.theme || 'system', settings.language || 'en', JSON.stringify(settings.notifications || {}), now]\n      );\n      return { id, ...settings, updatedAt: now };\n    }\n  },\n};\n\nexport function isTauri(): boolean {\n  return typeof window !== 'undefined' && '__TAURI__' in window;\n}\n","path":null,"size_bytes":34850,"size_tokens":null}},"version":2}